<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Xmipp: xmippCore/core/linear_system_helper.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xmipp_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Xmipp
   &#160;<span id="projectnumber">v20.07</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_ce4d0d8fc85c2c70612466225bfce71d.html">xmippCore</a></li><li class="navelem"><a class="el" href="dir_7b263f08efd4b5bafd60790250e211a5.html">core</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">linear_system_helper.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="matrix1d_8h_source.html">matrix1d.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="matrix2d_8h_source.html">matrix2d.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for linear_system_helper.h:</div>
<div class="dyncontent">
<div class="center"><img src="linear__system__helper_8h__incl.png" border="0" usemap="#xmippCore_2core_2linear__system__helper_8h" alt=""/></div>
<map name="xmippCore_2core_2linear__system__helper_8h" id="xmippCore_2core_2linear__system__helper_8h">
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="linear__system__helper_8h__dep__incl.png" border="0" usemap="#xmippCore_2core_2linear__system__helper_8hdep" alt=""/></div>
<map name="xmippCore_2core_2linear__system__helper_8hdep" id="xmippCore_2core_2linear__system__helper_8hdep">
</map>
</div>
</div>
<p><a href="linear__system__helper_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPseudoInverseHelper.html">PseudoInverseHelper</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeightedLeastSquaresHelper.html">WeightedLeastSquaresHelper</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeightedLeastSquaresHelperMany.html">WeightedLeastSquaresHelperMany</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0a79c5996e677f33ab13a49ae0215c0f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="linear__system__helper_8h.html#a0a79c5996e677f33ab13a49ae0215c0f">solveLinearSystem</a> (<a class="el" href="classPseudoInverseHelper.html">PseudoInverseHelper</a> &amp;h, <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;result)</td></tr>
<tr class="separator:a0a79c5996e677f33ab13a49ae0215c0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a94f9cb1ece9d9d4a17bdb99d069345d4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="linear__system__helper_8h.html#a94f9cb1ece9d9d4a17bdb99d069345d4">solveLinearSystem</a> (<a class="el" href="classWeightedLeastSquaresHelperMany.html">WeightedLeastSquaresHelperMany</a> &amp;h, std::vector&lt; <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt;&gt; &amp;result)</td></tr>
<tr class="separator:a94f9cb1ece9d9d4a17bdb99d069345d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a653836391e166277cf010f118ef5828a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="linear__system__helper_8h.html#a653836391e166277cf010f118ef5828a">weightedLeastSquares</a> (<a class="el" href="classWeightedLeastSquaresHelper.html">WeightedLeastSquaresHelper</a> &amp;h, <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;result)</td></tr>
<tr class="separator:a653836391e166277cf010f118ef5828a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b13504d480b08a33ccea1058db7d35e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="linear__system__helper_8h.html#a7b13504d480b08a33ccea1058db7d35e">weightedLeastSquares</a> (<a class="el" href="classWeightedLeastSquaresHelperMany.html">WeightedLeastSquaresHelperMany</a> &amp;h, std::vector&lt; <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt;&gt; &amp;results)</td></tr>
<tr class="separator:a7b13504d480b08a33ccea1058db7d35e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01559880c85f721b534889c36e0cbe76"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="linear__system__helper_8h.html#a01559880c85f721b534889c36e0cbe76">ransacWeightedLeastSquares</a> (<a class="el" href="classWeightedLeastSquaresHelper.html">WeightedLeastSquaresHelper</a> &amp;h, <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;result, double tol, int Niter=10000, double outlierFraction=0.25, int Nthreads=1)</td></tr>
<tr class="separator:a01559880c85f721b534889c36e0cbe76"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a01559880c85f721b534889c36e0cbe76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01559880c85f721b534889c36e0cbe76">&#9670;&nbsp;</a></span>ransacWeightedLeastSquares()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ransacWeightedLeastSquares </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classWeightedLeastSquaresHelper.html">WeightedLeastSquaresHelper</a> &amp;&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>result</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>tol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>Niter</em> = <code>10000</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>outlierFraction</em> = <code>0.25</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>Nthreads</em> = <code>1</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Solve Weighted least square problem Ax=b and weights w, with RANSAC. Tol is a tolerance value: if an equation is fulfilled with an error smaller than tol, then it is considered to fulfill the model. Niter is the number of RANSAC iterations to perform. The outlier fraction is the fraction of equations that, at maximum, can be considered as outliers. </p>

<p class="definition">Definition at line <a class="el" href="linear__system__helper_8cpp_source.html#l00332">332</a> of file <a class="el" href="linear__system__helper_8cpp_source.html">linear_system_helper.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;{</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="comment">// Read and preprocess the images</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    pthread_t * th_ids = <span class="keyword">new</span> pthread_t[Nthreads];</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <a class="code" href="structThreadRansacArgs.html">ThreadRansacArgs</a> * th_args = <span class="keyword">new</span> <a class="code" href="structThreadRansacArgs.html">ThreadRansacArgs</a>[Nthreads];</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nt = 0; nt &lt; Nthreads; nt++) {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="comment">// Passing parameters to each thread</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        th_args[nt].<a class="code" href="structThreadRansacArgs.html#ae4e1b11b2415c841e2a388829b5f2e99">myThreadID</a> = nt;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        th_args[nt].<a class="code" href="structThreadRansacArgs.html#ad65ea4d4de970b60c52fb4f5deb59271">h</a> = &amp;h;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        th_args[nt].<a class="code" href="structThreadRansacArgs.html#a63c5d3e88af9351864ed9d5f71056615">tol</a> = tol;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        th_args[nt].<a class="code" href="structThreadRansacArgs.html#adfb6292fc2a44512554ba9e124d50edb">Niter</a> = Niter/Nthreads;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        th_args[nt].<a class="code" href="structThreadRansacArgs.html#a5e08d58b2630f33b58bc83b6a8e15b8a">outlierFraction</a> = outlierFraction;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        pthread_create((th_ids + nt), NULL, <a class="code" href="linear__system__helper_8cpp.html#a2f4531461a1daa66c75b2cb7d44ca92e">threadRansacWeightedLeastSquares</a>,</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                (<span class="keywordtype">void</span> *) (th_args + nt));</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="comment">// Waiting for threads to finish</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keywordtype">double</span> err=1e38;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> nt = 0; nt &lt; Nthreads; nt++)</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        pthread_join(*(th_ids + nt), NULL);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keywordflow">if</span> (th_args[nt].<a class="code" href="namespaceerror.html">error</a>&lt;err)</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        {</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            err=th_args[nt].<a class="code" href="structThreadRansacArgs.html#a195dc02c09dc09e166bcba88c20b6928">error</a>;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            result=th_args[nt].<a class="code" href="structThreadRansacArgs.html#a1e441ee3889ff9c1d21d66f7409c4bbd">result</a>;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        }</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    }</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="comment">// Threads structures are not needed any more</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keyword">delete</span> []th_ids;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keyword">delete</span> []th_args;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;}</div><div class="ttc" id="structThreadRansacArgs_html_ae4e1b11b2415c841e2a388829b5f2e99"><div class="ttname"><a href="structThreadRansacArgs.html#ae4e1b11b2415c841e2a388829b5f2e99">ThreadRansacArgs::myThreadID</a></div><div class="ttdeci">int myThreadID</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8cpp_source.html#l00313">linear_system_helper.cpp:313</a></div></div>
<div class="ttc" id="structThreadRansacArgs_html_a1e441ee3889ff9c1d21d66f7409c4bbd"><div class="ttname"><a href="structThreadRansacArgs.html#a1e441ee3889ff9c1d21d66f7409c4bbd">ThreadRansacArgs::result</a></div><div class="ttdeci">Matrix1D&lt; double &gt; result</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8cpp_source.html#l00320">linear_system_helper.cpp:320</a></div></div>
<div class="ttc" id="structThreadRansacArgs_html_a195dc02c09dc09e166bcba88c20b6928"><div class="ttname"><a href="structThreadRansacArgs.html#a195dc02c09dc09e166bcba88c20b6928">ThreadRansacArgs::error</a></div><div class="ttdeci">double error</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8cpp_source.html#l00321">linear_system_helper.cpp:321</a></div></div>
<div class="ttc" id="structThreadRansacArgs_html_a5e08d58b2630f33b58bc83b6a8e15b8a"><div class="ttname"><a href="structThreadRansacArgs.html#a5e08d58b2630f33b58bc83b6a8e15b8a">ThreadRansacArgs::outlierFraction</a></div><div class="ttdeci">double outlierFraction</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8cpp_source.html#l00317">linear_system_helper.cpp:317</a></div></div>
<div class="ttc" id="structThreadRansacArgs_html_ad65ea4d4de970b60c52fb4f5deb59271"><div class="ttname"><a href="structThreadRansacArgs.html#ad65ea4d4de970b60c52fb4f5deb59271">ThreadRansacArgs::h</a></div><div class="ttdeci">WeightedLeastSquaresHelper * h</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8cpp_source.html#l00314">linear_system_helper.cpp:314</a></div></div>
<div class="ttc" id="structThreadRansacArgs_html"><div class="ttname"><a href="structThreadRansacArgs.html">ThreadRansacArgs</a></div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8cpp_source.html#l00311">linear_system_helper.cpp:311</a></div></div>
<div class="ttc" id="namespaceerror_html"><div class="ttname"><a href="namespaceerror.html">error</a></div><div class="ttdef"><b>Definition:</b> <a href="pdb2cif_8cpp_source.html#l00049">pdb2cif.cpp:49</a></div></div>
<div class="ttc" id="structThreadRansacArgs_html_adfb6292fc2a44512554ba9e124d50edb"><div class="ttname"><a href="structThreadRansacArgs.html#adfb6292fc2a44512554ba9e124d50edb">ThreadRansacArgs::Niter</a></div><div class="ttdeci">int Niter</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8cpp_source.html#l00316">linear_system_helper.cpp:316</a></div></div>
<div class="ttc" id="linear__system__helper_8cpp_html_a2f4531461a1daa66c75b2cb7d44ca92e"><div class="ttname"><a href="linear__system__helper_8cpp.html#a2f4531461a1daa66c75b2cb7d44ca92e">threadRansacWeightedLeastSquares</a></div><div class="ttdeci">void * threadRansacWeightedLeastSquares(void *args)</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8cpp_source.html#l00324">linear_system_helper.cpp:324</a></div></div>
<div class="ttc" id="structThreadRansacArgs_html_a63c5d3e88af9351864ed9d5f71056615"><div class="ttname"><a href="structThreadRansacArgs.html#a63c5d3e88af9351864ed9d5f71056615">ThreadRansacArgs::tol</a></div><div class="ttdeci">double tol</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8cpp_source.html#l00315">linear_system_helper.cpp:315</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0a79c5996e677f33ab13a49ae0215c0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a79c5996e677f33ab13a49ae0215c0f">&#9670;&nbsp;</a></span>solveLinearSystem() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void solveLinearSystem </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPseudoInverseHelper.html">PseudoInverseHelper</a> &amp;&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Solve Linear system Ax=b with pseudoinverse. A and b must be set inside the <a class="el" href="classPseudoInverseHelper.html">PseudoInverseHelper</a>, the rest of the fields in <a class="el" href="classPseudoInverseHelper.html">PseudoInverseHelper</a> are used by this routine to avoid several allocation/deallocations DEPRECATED, use <a class="el" href="linear__system__helper_8h.html#a94f9cb1ece9d9d4a17bdb99d069345d4">solveLinearSystem(WeightedLeastSquaresHelperMany &amp;h, std::vector&lt;Matrix1D&lt;double&gt;&gt; &amp;results)</a> </p>

<p class="definition">Definition at line <a class="el" href="linear__system__helper_8cpp_source.html#l00033">33</a> of file <a class="el" href="linear__system__helper_8cpp_source.html">linear_system_helper.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;{</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <a class="code" href="classMatrix2D.html">Matrix2D&lt;double&gt;</a> &amp;A=h.<a class="code" href="classPseudoInverseHelper.html#a2c4c18f833531f98c690c6183094018b">A</a>;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> &amp;<a class="code" href="numerical__recipes_8cpp.html#af090b2fbbd2916bfb2e493c5162969d6">b</a>=h.<a class="code" href="classPseudoInverseHelper.html#a8c69af67cbc52793cb1c8fd2da90a2aa">b</a>;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <a class="code" href="classMatrix2D.html">Matrix2D&lt;double&gt;</a> &amp;AtA=h.<a class="code" href="classPseudoInverseHelper.html#ae7b3fafd609ce7967631163eec24f6d0">AtA</a>;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <a class="code" href="classMatrix2D.html">Matrix2D&lt;double&gt;</a> &amp;AtAinv=h.<a class="code" href="classPseudoInverseHelper.html#af3376693057f719404ba4bdaeba460b8">AtAinv</a>;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> &amp;Atb=h.<a class="code" href="classPseudoInverseHelper.html#a158b961c78d40c947b8656e46e559ff8">Atb</a>;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="comment">// Compute AtA and Atb</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordtype">int</span> I=<a class="code" href="group__Matrices.html#ga43e28f6079b3652588d5b76ff199ff1e">MAT_YSIZE</a>(A);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordtype">int</span> J=<a class="code" href="group__Matrices.html#gacd5c6ac63f21fdbbd4343a9caf1ee9c6">MAT_XSIZE</a>(A);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    AtA.<a class="code" href="classMatrix2D.html#a35921c37b27282bac3b3868cce8feb26">initZeros</a>(J,J);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    Atb.<a class="code" href="classMatrix1D.html#a203e2128d65fd2d51dc764f5e7c52a63">initZeros</a>(J);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;J; ++<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>=0; <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>&lt;J; ++<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        {</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;            <span class="keywordtype">double</span> AtA_ij=0;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a>=0; <a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a>&lt;I; ++<a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a>)</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                AtA_ij+=<a class="code" href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a>(A,<a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a>,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>)*<a class="code" href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a>(A,<a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a>,<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;            <a class="code" href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a>(AtA,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)=AtA_ij;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        }</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="keywordtype">double</span> Atb_i=0;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a>=0; <a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a>&lt;I; ++<a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a>)</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;            Atb_i+=<a class="code" href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a>(A,<a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a>,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>)*<a class="code" href="group__Vectors.html#ga58173d9430e8e68017e3698f30382d5d">VEC_ELEM</a>(b,<a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a>);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <a class="code" href="group__Vectors.html#ga58173d9430e8e68017e3698f30382d5d">VEC_ELEM</a>(Atb,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>)=Atb_i;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    }</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// Compute the inverse of AtA</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    AtA.<a class="code" href="classMatrix2D.html#a9f030f9fa81662482c08a2ac186a57ba">inv</a>(AtAinv);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">// Now multiply by Atb</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    result.<a class="code" href="classMatrix1D.html#a203e2128d65fd2d51dc764f5e7c52a63">initZeros</a>(J);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="group__Matrices.html#ga80aee91a3508fa5d1df6fc0ee3693b06">FOR_ALL_ELEMENTS_IN_MATRIX2D</a>(AtAinv)</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <a class="code" href="group__Vectors.html#ga58173d9430e8e68017e3698f30382d5d">VEC_ELEM</a>(result,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>)+=<a class="code" href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a>(AtAinv,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)*<a class="code" href="group__Vectors.html#ga58173d9430e8e68017e3698f30382d5d">VEC_ELEM</a>(Atb,<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;}</div><div class="ttc" id="group__Matrices_html_ga80aee91a3508fa5d1df6fc0ee3693b06"><div class="ttname"><a href="group__Matrices.html#ga80aee91a3508fa5d1df6fc0ee3693b06">FOR_ALL_ELEMENTS_IN_MATRIX2D</a></div><div class="ttdeci">#define FOR_ALL_ELEMENTS_IN_MATRIX2D(m)</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00104">matrix2d.h:104</a></div></div>
<div class="ttc" id="group__Matrices_html_ga43e28f6079b3652588d5b76ff199ff1e"><div class="ttname"><a href="group__Matrices.html#ga43e28f6079b3652588d5b76ff199ff1e">MAT_YSIZE</a></div><div class="ttdeci">#define MAT_YSIZE(m)</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00124">matrix2d.h:124</a></div></div>
<div class="ttc" id="group__Vectors_html_ga58173d9430e8e68017e3698f30382d5d"><div class="ttname"><a href="group__Vectors.html#ga58173d9430e8e68017e3698f30382d5d">VEC_ELEM</a></div><div class="ttdeci">#define VEC_ELEM(v, i)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00245">matrix1d.h:245</a></div></div>
<div class="ttc" id="classMatrix2D_html_a9f030f9fa81662482c08a2ac186a57ba"><div class="ttname"><a href="classMatrix2D.html#a9f030f9fa81662482c08a2ac186a57ba">Matrix2D::inv</a></div><div class="ttdeci">void inv(Matrix2D&lt; T &gt; &amp;result) const</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8cpp_source.html#l00663">matrix2d.cpp:663</a></div></div>
<div class="ttc" id="classPseudoInverseHelper_html_af3376693057f719404ba4bdaeba460b8"><div class="ttname"><a href="classPseudoInverseHelper.html#af3376693057f719404ba4bdaeba460b8">PseudoInverseHelper::AtAinv</a></div><div class="ttdeci">Matrix2D&lt; double &gt; AtAinv</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8h_source.html#l00036">linear_system_helper.h:36</a></div></div>
<div class="ttc" id="classPseudoInverseHelper_html_a158b961c78d40c947b8656e46e559ff8"><div class="ttname"><a href="classPseudoInverseHelper.html#a158b961c78d40c947b8656e46e559ff8">PseudoInverseHelper::Atb</a></div><div class="ttdeci">Matrix1D&lt; double &gt; Atb</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8h_source.html#l00037">linear_system_helper.h:37</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">#define i</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02493">numerical_recipes.cpp:2493</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_a49b762d2a516fa75afa9a3c581a8e893"><div class="ttname"><a href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a></div><div class="ttdeci">ql0001_ &amp; k(htemp+1),(cvec+1),(atemp+1),(bj+1),(bl+1),(bu+1),(x+1),(clamda+1), &amp;iout, infoqp, &amp;zero,(w+1), &amp;lenw,(iw+1), &amp;leniw, &amp;glob_grd.epsmac</div></div>
<div class="ttc" id="group__Matrices_html_gab40746be05d4bbf352787018922ecc2e"><div class="ttname"><a href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a></div><div class="ttdeci">#define MAT_ELEM(m, i, j)</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00116">matrix2d.h:116</a></div></div>
<div class="ttc" id="classMatrix2D_html"><div class="ttname"><a href="classMatrix2D.html">Matrix2D&lt; double &gt;</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_af090b2fbbd2916bfb2e493c5162969d6"><div class="ttname"><a href="numerical__recipes_8cpp.html#af090b2fbbd2916bfb2e493c5162969d6">b</a></div><div class="ttdeci">doublereal * b</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02230">numerical_recipes.cpp:2230</a></div></div>
<div class="ttc" id="classPseudoInverseHelper_html_a8c69af67cbc52793cb1c8fd2da90a2aa"><div class="ttname"><a href="classPseudoInverseHelper.html#a8c69af67cbc52793cb1c8fd2da90a2aa">PseudoInverseHelper::b</a></div><div class="ttdeci">Matrix1D&lt; double &gt; b</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8h_source.html#l00037">linear_system_helper.h:37</a></div></div>
<div class="ttc" id="classPseudoInverseHelper_html_a2c4c18f833531f98c690c6183094018b"><div class="ttname"><a href="classPseudoInverseHelper.html#a2c4c18f833531f98c690c6183094018b">PseudoInverseHelper::A</a></div><div class="ttdeci">Matrix2D&lt; double &gt; A</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8h_source.html#l00036">linear_system_helper.h:36</a></div></div>
<div class="ttc" id="classMatrix1D_html_a203e2128d65fd2d51dc764f5e7c52a63"><div class="ttname"><a href="classMatrix1D.html#a203e2128d65fd2d51dc764f5e7c52a63">Matrix1D::initZeros</a></div><div class="ttdeci">void initZeros()</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00592">matrix1d.h:592</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_aae82a1338cf72eb9a1cc7043f569537e"><div class="ttname"><a href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a></div><div class="ttdeci">#define j</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02493">numerical_recipes.cpp:2493</a></div></div>
<div class="ttc" id="classPseudoInverseHelper_html_ae7b3fafd609ce7967631163eec24f6d0"><div class="ttname"><a href="classPseudoInverseHelper.html#ae7b3fafd609ce7967631163eec24f6d0">PseudoInverseHelper::AtA</a></div><div class="ttdeci">Matrix2D&lt; double &gt; AtA</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8h_source.html#l00036">linear_system_helper.h:36</a></div></div>
<div class="ttc" id="classMatrix1D_html"><div class="ttname"><a href="classMatrix1D.html">Matrix1D&lt; double &gt;</a></div></div>
<div class="ttc" id="group__Matrices_html_gacd5c6ac63f21fdbbd4343a9caf1ee9c6"><div class="ttname"><a href="group__Matrices.html#gacd5c6ac63f21fdbbd4343a9caf1ee9c6">MAT_XSIZE</a></div><div class="ttdeci">#define MAT_XSIZE(m)</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00120">matrix2d.h:120</a></div></div>
<div class="ttc" id="classMatrix2D_html_a35921c37b27282bac3b3868cce8feb26"><div class="ttname"><a href="classMatrix2D.html#a35921c37b27282bac3b3868cce8feb26">Matrix2D::initZeros</a></div><div class="ttdeci">void initZeros()</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00626">matrix2d.h:626</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a94f9cb1ece9d9d4a17bdb99d069345d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94f9cb1ece9d9d4a17bdb99d069345d4">&#9670;&nbsp;</a></span>solveLinearSystem() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void solveLinearSystem </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classWeightedLeastSquaresHelperMany.html">WeightedLeastSquaresHelperMany</a> &amp;&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Solve Linear system Ax=[b] with pseudoinverse. A and all 'b's must be set inside the helper </p>

<p class="definition">Definition at line <a class="el" href="linear__system__helper_8cpp_source.html#l00070">70</a> of file <a class="el" href="linear__system__helper_8cpp_source.html">linear_system_helper.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;{</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> sizeI = h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a70d284ab04a585a7e18398880091931e">A</a>.<a class="code" href="classMatrix2D.html#a94ad82d742f99604da666ec5c702c727">mdimy</a>;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> sizeJ = h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a70d284ab04a585a7e18398880091931e">A</a>.<a class="code" href="classMatrix2D.html#a7c0d7516f43cca2668837d805b0001c6">mdimx</a>;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#af5f3f940cad84b72a90ca658783bd6fb">AtA</a>.<a class="code" href="classMatrix2D.html#a6928f78d5ccff2c21a26811702fa4d82">resizeNoCopy</a>(sizeJ, sizeJ);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a6439f3c4bf35fd551939f528cb99759a">Atb</a>.<a class="code" href="classMatrix1D.html#aaebbafda17938a0fb7d8b243f2342a51">resizeNoCopy</a>(sizeJ);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">// compute AtA</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a7adf0bc6b947d3e39ae3ae0009de5ba8">At</a> = h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a70d284ab04a585a7e18398880091931e">A</a>.<a class="code" href="classMatrix2D.html#a8073200797ec6121b2ad960f6a41f52a">transpose</a>();</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">// for each row of the output</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; sizeJ; ++<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="comment">// for each column of the output (notice that we read row-wise from At)</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> = <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>; <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> &lt; sizeJ; ++<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <span class="keywordtype">double</span> AtA_ij = 0;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <span class="comment">// multiply elementwise row by row from At</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a> = 0; <a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a> &lt; sizeI; ++<a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a>) {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                AtA_ij += h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a7adf0bc6b947d3e39ae3ae0009de5ba8">At</a>.<a class="code" href="classMatrix2D.html#a7031d47ba196940dd5e70d80431273e6">mdata</a>[<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> * sizeI + <a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a>] * h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a7adf0bc6b947d3e39ae3ae0009de5ba8">At</a>.<a class="code" href="classMatrix2D.html#a7031d47ba196940dd5e70d80431273e6">mdata</a>[<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> * sizeI + <a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a>];</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            }</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <span class="comment">// AtA is symmetric, so we don&#39;t need to iterate over everything</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#af5f3f940cad84b72a90ca658783bd6fb">AtA</a>.<a class="code" href="classMatrix2D.html#a7031d47ba196940dd5e70d80431273e6">mdata</a>[<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> * sizeJ + <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>] = h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#af5f3f940cad84b72a90ca658783bd6fb">AtA</a>.<a class="code" href="classMatrix2D.html#a7031d47ba196940dd5e70d80431273e6">mdata</a>[<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> * sizeJ + <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = AtA_ij;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        }</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    }</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">// Compute the inverse of AtA</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#af5f3f940cad84b72a90ca658783bd6fb">AtA</a>.<a class="code" href="classMatrix2D.html#a9f030f9fa81662482c08a2ac186a57ba">inv</a>(h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a0ed7d94aa0070432e6caad707658e3eb">AtAinv</a>); <span class="comment">// AtAinv is also square matrix, same size as AtA</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    assert(results.size() == h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#ac098bc203f521fe946cc1af38ad2037e">bs</a>.size());</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keyword">auto</span> res_it = results.begin();</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keyword">auto</span> b_it = h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#ac098bc203f521fe946cc1af38ad2037e">bs</a>.begin(); </div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">for</span> (; res_it != results.end(); ++res_it, ++b_it) {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; sizeJ; ++<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        {</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <span class="keywordtype">double</span> Atb_i = 0;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a> = 0; <a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a> &lt; sizeI; ++<a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a>) {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                Atb_i += h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a70d284ab04a585a7e18398880091931e">A</a>.<a class="code" href="classMatrix2D.html#a7031d47ba196940dd5e70d80431273e6">mdata</a>[<a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a> * sizeJ + <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] * b_it-&gt;vdata[<a class="code" href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a>];</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            }</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a6439f3c4bf35fd551939f528cb99759a">Atb</a>.<a class="code" href="classMatrix1D.html#a72e79de2f0a9145c873f8c16ed157d0a">vdata</a>[<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = Atb_i;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="comment">// Now multiply by Atb</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        res_it-&gt;initZeros(sizeJ);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; sizeJ; <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++) { </div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> = 0; <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> &lt; sizeJ; <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>++) {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                res_it-&gt;vdata[<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] += h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a0ed7d94aa0070432e6caad707658e3eb">AtAinv</a>.<a class="code" href="classMatrix2D.html#a7031d47ba196940dd5e70d80431273e6">mdata</a>[<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> * sizeJ +<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>] * h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a6439f3c4bf35fd551939f528cb99759a">Atb</a>.<a class="code" href="classMatrix1D.html#a72e79de2f0a9145c873f8c16ed157d0a">vdata</a>[<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>];</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            }</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div><div class="ttc" id="classWeightedLeastSquaresHelperMany_html_a6439f3c4bf35fd551939f528cb99759a"><div class="ttname"><a href="classWeightedLeastSquaresHelperMany.html#a6439f3c4bf35fd551939f528cb99759a">WeightedLeastSquaresHelperMany::Atb</a></div><div class="ttdeci">Matrix1D&lt; double &gt; Atb</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8h_source.html#l00057">linear_system_helper.h:57</a></div></div>
<div class="ttc" id="classMatrix2D_html_a9f030f9fa81662482c08a2ac186a57ba"><div class="ttname"><a href="classMatrix2D.html#a9f030f9fa81662482c08a2ac186a57ba">Matrix2D::inv</a></div><div class="ttdeci">void inv(Matrix2D&lt; T &gt; &amp;result) const</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8cpp_source.html#l00663">matrix2d.cpp:663</a></div></div>
<div class="ttc" id="classMatrix2D_html_a7031d47ba196940dd5e70d80431273e6"><div class="ttname"><a href="classMatrix2D.html#a7031d47ba196940dd5e70d80431273e6">Matrix2D::mdata</a></div><div class="ttdeci">T * mdata</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00395">matrix2d.h:395</a></div></div>
<div class="ttc" id="classMatrix2D_html_a8073200797ec6121b2ad960f6a41f52a"><div class="ttname"><a href="classMatrix2D.html#a8073200797ec6121b2ad960f6a41f52a">Matrix2D::transpose</a></div><div class="ttdeci">Matrix2D&lt; T &gt; transpose() const</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8cpp_source.html#l01314">matrix2d.cpp:1314</a></div></div>
<div class="ttc" id="classWeightedLeastSquaresHelperMany_html_ac098bc203f521fe946cc1af38ad2037e"><div class="ttname"><a href="classWeightedLeastSquaresHelperMany.html#ac098bc203f521fe946cc1af38ad2037e">WeightedLeastSquaresHelperMany::bs</a></div><div class="ttdeci">std::vector&lt; Matrix1D&lt; double &gt; &gt; bs</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8h_source.html#l00052">linear_system_helper.h:52</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">#define i</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02493">numerical_recipes.cpp:2493</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_a49b762d2a516fa75afa9a3c581a8e893"><div class="ttname"><a href="numerical__recipes_8cpp.html#a49b762d2a516fa75afa9a3c581a8e893">k</a></div><div class="ttdeci">ql0001_ &amp; k(htemp+1),(cvec+1),(atemp+1),(bj+1),(bl+1),(bu+1),(x+1),(clamda+1), &amp;iout, infoqp, &amp;zero,(w+1), &amp;lenw,(iw+1), &amp;leniw, &amp;glob_grd.epsmac</div></div>
<div class="ttc" id="classMatrix2D_html_a6928f78d5ccff2c21a26811702fa4d82"><div class="ttname"><a href="classMatrix2D.html#a6928f78d5ccff2c21a26811702fa4d82">Matrix2D::resizeNoCopy</a></div><div class="ttdeci">void resizeNoCopy(int Ydim, int Xdim)</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00534">matrix2d.h:534</a></div></div>
<div class="ttc" id="classWeightedLeastSquaresHelperMany_html_af5f3f940cad84b72a90ca658783bd6fb"><div class="ttname"><a href="classWeightedLeastSquaresHelperMany.html#af5f3f940cad84b72a90ca658783bd6fb">WeightedLeastSquaresHelperMany::AtA</a></div><div class="ttdeci">Matrix2D&lt; double &gt; AtA</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8h_source.html#l00055">linear_system_helper.h:55</a></div></div>
<div class="ttc" id="classWeightedLeastSquaresHelperMany_html_a0ed7d94aa0070432e6caad707658e3eb"><div class="ttname"><a href="classWeightedLeastSquaresHelperMany.html#a0ed7d94aa0070432e6caad707658e3eb">WeightedLeastSquaresHelperMany::AtAinv</a></div><div class="ttdeci">Matrix2D&lt; double &gt; AtAinv</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8h_source.html#l00056">linear_system_helper.h:56</a></div></div>
<div class="ttc" id="classMatrix2D_html_a94ad82d742f99604da666ec5c702c727"><div class="ttname"><a href="classMatrix2D.html#a94ad82d742f99604da666ec5c702c727">Matrix2D::mdimy</a></div><div class="ttdeci">size_t mdimy</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00413">matrix2d.h:413</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_aae82a1338cf72eb9a1cc7043f569537e"><div class="ttname"><a href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a></div><div class="ttdeci">#define j</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02493">numerical_recipes.cpp:2493</a></div></div>
<div class="ttc" id="classWeightedLeastSquaresHelperMany_html_a7adf0bc6b947d3e39ae3ae0009de5ba8"><div class="ttname"><a href="classWeightedLeastSquaresHelperMany.html#a7adf0bc6b947d3e39ae3ae0009de5ba8">WeightedLeastSquaresHelperMany::At</a></div><div class="ttdeci">Matrix2D&lt; double &gt; At</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8h_source.html#l00051">linear_system_helper.h:51</a></div></div>
<div class="ttc" id="classMatrix1D_html_aaebbafda17938a0fb7d8b243f2342a51"><div class="ttname"><a href="classMatrix1D.html#aaebbafda17938a0fb7d8b243f2342a51">Matrix1D::resizeNoCopy</a></div><div class="ttdeci">void resizeNoCopy(int Xdim)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00458">matrix1d.h:458</a></div></div>
<div class="ttc" id="classMatrix2D_html_a7c0d7516f43cca2668837d805b0001c6"><div class="ttname"><a href="classMatrix2D.html#a7c0d7516f43cca2668837d805b0001c6">Matrix2D::mdimx</a></div><div class="ttdeci">size_t mdimx</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00410">matrix2d.h:410</a></div></div>
<div class="ttc" id="classMatrix1D_html_a72e79de2f0a9145c873f8c16ed157d0a"><div class="ttname"><a href="classMatrix1D.html#a72e79de2f0a9145c873f8c16ed157d0a">Matrix1D::vdata</a></div><div class="ttdeci">T * vdata</div><div class="ttdoc">The array itself. </div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00258">matrix1d.h:258</a></div></div>
<div class="ttc" id="classWeightedLeastSquaresHelperMany_html_a70d284ab04a585a7e18398880091931e"><div class="ttname"><a href="classWeightedLeastSquaresHelperMany.html#a70d284ab04a585a7e18398880091931e">WeightedLeastSquaresHelperMany::A</a></div><div class="ttdeci">Matrix2D&lt; double &gt; A</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8h_source.html#l00050">linear_system_helper.h:50</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a653836391e166277cf010f118ef5828a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a653836391e166277cf010f118ef5828a">&#9670;&nbsp;</a></span>weightedLeastSquares() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void weightedLeastSquares </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classWeightedLeastSquaresHelper.html">WeightedLeastSquaresHelper</a> &amp;&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Solve Weighted least square problem Ax=b with pseudoinverse and weights w. A, w and b must be set inside the <a class="el" href="classWeightedLeastSquaresHelper.html">WeightedLeastSquaresHelper</a>, the rest of the fields in <a class="el" href="classWeightedLeastSquaresHelper.html">WeightedLeastSquaresHelper</a> are used by this routine to avoid several allocation/deallocations.</p>
<p>The normal equations of this problem are A^t W A x = A^t W b, where W is a diagonal matrix whose entries are in the vector w.</p>
<p>DEPRECATED, use <a class="el" href="linear__system__helper_8h.html#a7b13504d480b08a33ccea1058db7d35e">weightedLeastSquares(WeightedLeastSquaresHelperMany &amp;h, std::vector&lt;Matrix1D&lt;double&gt;&gt; &amp;results)</a> </p>

<p class="definition">Definition at line <a class="el" href="linear__system__helper_8cpp_source.html#l00119">119</a> of file <a class="el" href="linear__system__helper_8cpp_source.html">linear_system_helper.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;{</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="classMatrix2D.html">Matrix2D&lt;double&gt;</a> &amp;A=h.<a class="code" href="classPseudoInverseHelper.html#a2c4c18f833531f98c690c6183094018b">A</a>;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> &amp;<a class="code" href="numerical__recipes_8cpp.html#af090b2fbbd2916bfb2e493c5162969d6">b</a>=h.<a class="code" href="classPseudoInverseHelper.html#a8c69af67cbc52793cb1c8fd2da90a2aa">b</a>;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> &amp;<a class="code" href="numerical__recipes_8cpp.html#a2b83edee7677c7a2b0a4e5ac99baa586">w</a>=h.<a class="code" href="classWeightedLeastSquaresHelper.html#a291fe654a1ebb714a4d49b743187b95a">w</a>;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// See http://en.wikipedia.org/wiki/Least_squares#Weighted_least_squares</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <a class="code" href="group__Vectors.html#ga8333ba47b67df6174e1d4cfb85920c71">FOR_ALL_ELEMENTS_IN_MATRIX1D</a>(w)</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    {</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="keywordtype">double</span> wii=<a class="code" href="image__operate_8cpp.html#aba02a4405b44e10470c7af98477800a9">sqrt</a>(<a class="code" href="group__Vectors.html#ga58173d9430e8e68017e3698f30382d5d">VEC_ELEM</a>(w,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <a class="code" href="group__Vectors.html#ga58173d9430e8e68017e3698f30382d5d">VEC_ELEM</a>(b,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>)*=wii;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>=0; <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>&lt;<a class="code" href="group__Matrices.html#gacd5c6ac63f21fdbbd4343a9caf1ee9c6">MAT_XSIZE</a>(A); ++<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <a class="code" href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a>(A,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)*=wii;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <a class="code" href="linear__system__helper_8cpp.html#a0a79c5996e677f33ab13a49ae0215c0f">solveLinearSystem</a>(h,result);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;}</div><div class="ttc" id="group__Vectors_html_ga58173d9430e8e68017e3698f30382d5d"><div class="ttname"><a href="group__Vectors.html#ga58173d9430e8e68017e3698f30382d5d">VEC_ELEM</a></div><div class="ttdeci">#define VEC_ELEM(v, i)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00245">matrix1d.h:245</a></div></div>
<div class="ttc" id="classWeightedLeastSquaresHelper_html_a291fe654a1ebb714a4d49b743187b95a"><div class="ttname"><a href="classWeightedLeastSquaresHelper.html#a291fe654a1ebb714a4d49b743187b95a">WeightedLeastSquaresHelper::w</a></div><div class="ttdeci">Matrix1D&lt; double &gt; w</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8h_source.html#l00044">linear_system_helper.h:44</a></div></div>
<div class="ttc" id="image__operate_8cpp_html_aba02a4405b44e10470c7af98477800a9"><div class="ttname"><a href="image__operate_8cpp.html#aba02a4405b44e10470c7af98477800a9">sqrt</a></div><div class="ttdeci">void sqrt(Image&lt; double &gt; &amp;op)</div><div class="ttdef"><b>Definition:</b> <a href="image__operate_8cpp_source.html#l00210">image_operate.cpp:210</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_a2b83edee7677c7a2b0a4e5ac99baa586"><div class="ttname"><a href="numerical__recipes_8cpp.html#a2b83edee7677c7a2b0a4e5ac99baa586">w</a></div><div class="ttdeci">doublereal * w</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02477">numerical_recipes.cpp:2477</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">#define i</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02493">numerical_recipes.cpp:2493</a></div></div>
<div class="ttc" id="group__Matrices_html_gab40746be05d4bbf352787018922ecc2e"><div class="ttname"><a href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a></div><div class="ttdeci">#define MAT_ELEM(m, i, j)</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00116">matrix2d.h:116</a></div></div>
<div class="ttc" id="classMatrix2D_html"><div class="ttname"><a href="classMatrix2D.html">Matrix2D&lt; double &gt;</a></div></div>
<div class="ttc" id="group__Vectors_html_ga8333ba47b67df6174e1d4cfb85920c71"><div class="ttname"><a href="group__Vectors.html#ga8333ba47b67df6174e1d4cfb85920c71">FOR_ALL_ELEMENTS_IN_MATRIX1D</a></div><div class="ttdeci">#define FOR_ALL_ELEMENTS_IN_MATRIX1D(v)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00072">matrix1d.h:72</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_af090b2fbbd2916bfb2e493c5162969d6"><div class="ttname"><a href="numerical__recipes_8cpp.html#af090b2fbbd2916bfb2e493c5162969d6">b</a></div><div class="ttdeci">doublereal * b</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02230">numerical_recipes.cpp:2230</a></div></div>
<div class="ttc" id="classPseudoInverseHelper_html_a8c69af67cbc52793cb1c8fd2da90a2aa"><div class="ttname"><a href="classPseudoInverseHelper.html#a8c69af67cbc52793cb1c8fd2da90a2aa">PseudoInverseHelper::b</a></div><div class="ttdeci">Matrix1D&lt; double &gt; b</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8h_source.html#l00037">linear_system_helper.h:37</a></div></div>
<div class="ttc" id="classPseudoInverseHelper_html_a2c4c18f833531f98c690c6183094018b"><div class="ttname"><a href="classPseudoInverseHelper.html#a2c4c18f833531f98c690c6183094018b">PseudoInverseHelper::A</a></div><div class="ttdeci">Matrix2D&lt; double &gt; A</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8h_source.html#l00036">linear_system_helper.h:36</a></div></div>
<div class="ttc" id="linear__system__helper_8cpp_html_a0a79c5996e677f33ab13a49ae0215c0f"><div class="ttname"><a href="linear__system__helper_8cpp.html#a0a79c5996e677f33ab13a49ae0215c0f">solveLinearSystem</a></div><div class="ttdeci">void solveLinearSystem(PseudoInverseHelper &amp;h, Matrix1D&lt; double &gt; &amp;result)</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8cpp_source.html#l00033">linear_system_helper.cpp:33</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_aae82a1338cf72eb9a1cc7043f569537e"><div class="ttname"><a href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a></div><div class="ttdeci">#define j</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02493">numerical_recipes.cpp:2493</a></div></div>
<div class="ttc" id="classMatrix1D_html"><div class="ttname"><a href="classMatrix1D.html">Matrix1D&lt; double &gt;</a></div></div>
<div class="ttc" id="group__Matrices_html_gacd5c6ac63f21fdbbd4343a9caf1ee9c6"><div class="ttname"><a href="group__Matrices.html#gacd5c6ac63f21fdbbd4343a9caf1ee9c6">MAT_XSIZE</a></div><div class="ttdeci">#define MAT_XSIZE(m)</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00120">matrix2d.h:120</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7b13504d480b08a33ccea1058db7d35e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b13504d480b08a33ccea1058db7d35e">&#9670;&nbsp;</a></span>weightedLeastSquares() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void weightedLeastSquares </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classWeightedLeastSquaresHelperMany.html">WeightedLeastSquaresHelperMany</a> &amp;&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt;&gt; &amp;&#160;</td>
          <td class="paramname"><em>results</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Solve Weighted least square problem Ax=b with pseudoinverse and weights w for multiple b. A, w and all 'b's must be set inside the helper to avoid several allocation/deallocations.</p>
<p>The normal equations of this problem are A^t W A x = A^t W b, where W is a diagonal matrix whose entries are in the vector w. </p>

<p class="definition">Definition at line <a class="el" href="linear__system__helper_8cpp_source.html#l00136">136</a> of file <a class="el" href="linear__system__helper_8cpp_source.html">linear_system_helper.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;{</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> sizeW = h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a8f10128c263f2040c11d73b0afe50ff9">w</a>.<a class="code" href="classMatrix1D.html#abfa591caeecfcc19221b7bf00b0fbf62">vdim</a>;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a23145d69089e956dc7e9961be527ac04">w_sqrt</a>.<a class="code" href="classMatrix1D.html#aaebbafda17938a0fb7d8b243f2342a51">resizeNoCopy</a>(h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a8f10128c263f2040c11d73b0afe50ff9">w</a>);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">// compute weights</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; sizeW; ++<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a23145d69089e956dc7e9961be527ac04">w_sqrt</a>.<a class="code" href="classMatrix1D.html#a72e79de2f0a9145c873f8c16ed157d0a">vdata</a>[<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="image__operate_8cpp.html#aba02a4405b44e10470c7af98477800a9">sqrt</a>(h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a8f10128c263f2040c11d73b0afe50ff9">w</a>.<a class="code" href="classMatrix1D.html#a72e79de2f0a9145c873f8c16ed157d0a">vdata</a>[<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    }</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">// update the matrix</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> sizeX = h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a70d284ab04a585a7e18398880091931e">A</a>.<a class="code" href="classMatrix2D.html#a7c0d7516f43cca2668837d805b0001c6">mdimx</a>;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; sizeW; ++<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">size_t</span> offset = <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> * sizeX; </div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> v = h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a23145d69089e956dc7e9961be527ac04">w_sqrt</a>[<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> = 0; <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> &lt; sizeX; ++<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a70d284ab04a585a7e18398880091931e">A</a>.<a class="code" href="classMatrix2D.html#a7031d47ba196940dd5e70d80431273e6">mdata</a>[offset + <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>] *= v;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">// update values</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;<a class="code" href="numerical__recipes_8cpp.html#af090b2fbbd2916bfb2e493c5162969d6">b</a> : h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#ac098bc203f521fe946cc1af38ad2037e">bs</a>) {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; sizeW; ++<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>) {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <a class="code" href="numerical__recipes_8cpp.html#af090b2fbbd2916bfb2e493c5162969d6">b</a>.vdata[<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] *= h.<a class="code" href="classWeightedLeastSquaresHelperMany.html#a23145d69089e956dc7e9961be527ac04">w_sqrt</a>[<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        }</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="linear__system__helper_8cpp.html#a0a79c5996e677f33ab13a49ae0215c0f">solveLinearSystem</a>(h, results);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;}</div><div class="ttc" id="image__operate_8cpp_html_aba02a4405b44e10470c7af98477800a9"><div class="ttname"><a href="image__operate_8cpp.html#aba02a4405b44e10470c7af98477800a9">sqrt</a></div><div class="ttdeci">void sqrt(Image&lt; double &gt; &amp;op)</div><div class="ttdef"><b>Definition:</b> <a href="image__operate_8cpp_source.html#l00210">image_operate.cpp:210</a></div></div>
<div class="ttc" id="classMatrix2D_html_a7031d47ba196940dd5e70d80431273e6"><div class="ttname"><a href="classMatrix2D.html#a7031d47ba196940dd5e70d80431273e6">Matrix2D::mdata</a></div><div class="ttdeci">T * mdata</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00395">matrix2d.h:395</a></div></div>
<div class="ttc" id="classWeightedLeastSquaresHelperMany_html_ac098bc203f521fe946cc1af38ad2037e"><div class="ttname"><a href="classWeightedLeastSquaresHelperMany.html#ac098bc203f521fe946cc1af38ad2037e">WeightedLeastSquaresHelperMany::bs</a></div><div class="ttdeci">std::vector&lt; Matrix1D&lt; double &gt; &gt; bs</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8h_source.html#l00052">linear_system_helper.h:52</a></div></div>
<div class="ttc" id="classWeightedLeastSquaresHelperMany_html_a23145d69089e956dc7e9961be527ac04"><div class="ttname"><a href="classWeightedLeastSquaresHelperMany.html#a23145d69089e956dc7e9961be527ac04">WeightedLeastSquaresHelperMany::w_sqrt</a></div><div class="ttdeci">Matrix1D&lt; double &gt; w_sqrt</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8h_source.html#l00054">linear_system_helper.h:54</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">#define i</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02493">numerical_recipes.cpp:2493</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_af090b2fbbd2916bfb2e493c5162969d6"><div class="ttname"><a href="numerical__recipes_8cpp.html#af090b2fbbd2916bfb2e493c5162969d6">b</a></div><div class="ttdeci">doublereal * b</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02230">numerical_recipes.cpp:2230</a></div></div>
<div class="ttc" id="classWeightedLeastSquaresHelperMany_html_a8f10128c263f2040c11d73b0afe50ff9"><div class="ttname"><a href="classWeightedLeastSquaresHelperMany.html#a8f10128c263f2040c11d73b0afe50ff9">WeightedLeastSquaresHelperMany::w</a></div><div class="ttdeci">Matrix1D&lt; double &gt; w</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8h_source.html#l00053">linear_system_helper.h:53</a></div></div>
<div class="ttc" id="linear__system__helper_8cpp_html_a0a79c5996e677f33ab13a49ae0215c0f"><div class="ttname"><a href="linear__system__helper_8cpp.html#a0a79c5996e677f33ab13a49ae0215c0f">solveLinearSystem</a></div><div class="ttdeci">void solveLinearSystem(PseudoInverseHelper &amp;h, Matrix1D&lt; double &gt; &amp;result)</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8cpp_source.html#l00033">linear_system_helper.cpp:33</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_aae82a1338cf72eb9a1cc7043f569537e"><div class="ttname"><a href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a></div><div class="ttdeci">#define j</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02493">numerical_recipes.cpp:2493</a></div></div>
<div class="ttc" id="classMatrix1D_html_aaebbafda17938a0fb7d8b243f2342a51"><div class="ttname"><a href="classMatrix1D.html#aaebbafda17938a0fb7d8b243f2342a51">Matrix1D::resizeNoCopy</a></div><div class="ttdeci">void resizeNoCopy(int Xdim)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00458">matrix1d.h:458</a></div></div>
<div class="ttc" id="classMatrix2D_html_a7c0d7516f43cca2668837d805b0001c6"><div class="ttname"><a href="classMatrix2D.html#a7c0d7516f43cca2668837d805b0001c6">Matrix2D::mdimx</a></div><div class="ttdeci">size_t mdimx</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00410">matrix2d.h:410</a></div></div>
<div class="ttc" id="classMatrix1D_html_a72e79de2f0a9145c873f8c16ed157d0a"><div class="ttname"><a href="classMatrix1D.html#a72e79de2f0a9145c873f8c16ed157d0a">Matrix1D::vdata</a></div><div class="ttdeci">T * vdata</div><div class="ttdoc">The array itself. </div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00258">matrix1d.h:258</a></div></div>
<div class="ttc" id="classWeightedLeastSquaresHelperMany_html_a70d284ab04a585a7e18398880091931e"><div class="ttname"><a href="classWeightedLeastSquaresHelperMany.html#a70d284ab04a585a7e18398880091931e">WeightedLeastSquaresHelperMany::A</a></div><div class="ttdeci">Matrix2D&lt; double &gt; A</div><div class="ttdef"><b>Definition:</b> <a href="linear__system__helper_8h_source.html#l00050">linear_system_helper.h:50</a></div></div>
<div class="ttc" id="classMatrix1D_html_abfa591caeecfcc19221b7bf00b0fbf62"><div class="ttname"><a href="classMatrix1D.html#abfa591caeecfcc19221b7bf00b0fbf62">Matrix1D::vdim</a></div><div class="ttdeci">size_t vdim</div><div class="ttdoc">Number of elements. </div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00264">matrix1d.h:264</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
