<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Xmipp: xmipp/libraries/reconstruction_starpu/mpi/mpi_reconstruct_fourier_starpu.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xmipp_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Xmipp
   &#160;<span id="projectnumber">v20.07</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5bce755d3f27cf36e7d1a940cfd4182d.html">xmipp</a></li><li class="navelem"><a class="el" href="dir_29dba3f3840f20df3b04d1972e99046b.html">libraries</a></li><li class="navelem"><a class="el" href="dir_6b129a60ca9bd264678b4ace681dc7e5.html">reconstruction_starpu</a></li><li class="navelem"><a class="el" href="dir_ab45d7b88f3e275bfbb9ab8cff27341a.html">mpi</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">mpi_reconstruct_fourier_starpu.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="mpi__reconstruct__fourier__starpu_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/***************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Authors:     Jan Polak (456647@mail.muni.cz)</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *              David Strelak (davidstrelak@gmail.com)</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Unidad de  Bioinformatica of Centro Nacional de Biotecnologia , CSIC</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * This program is free software; you can redistribute it and/or modify</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * it under the terms of the GNU General Public License as published by</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * (at your option) any later version.</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * This program is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * GNU General Public License for more details.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * along with this program; if not, write to the Free Software</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * 02111-1307  USA</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> *  All comments concerning this program package may be sent to the</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> *  e-mail address &#39;xmipp@cnb.csic.es&#39;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> ***************************************************************************/</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;cstdint&gt;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;deque&gt;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;semaphore.h&gt;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="mpi__reconstruct__fourier__starpu_8cpp.html#a27507dcb2714ececf82370e48144cc5e">   32</a></span>&#160;<span class="preprocessor">#define STARPU_DONT_INCLUDE_CUDA_HEADERS</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &lt;starpu.h&gt;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;../reconstruct_fourier_util.h&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;../reconstruct_fourier_starpu_util.h&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mpi__reconstruct__fourier__starpu_8h.html">mpi_reconstruct_fourier_starpu.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="mpi__reconstruct__fourier__starpu_8cpp.html#aa68101301fdd524f921116f58f57bf5d">   41</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#aa68101301fdd524f921116f58f57bf5d">mpiLogging</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">   43</a></span>&#160;<span class="preprocessor">#define LOG_MPI(COUT) do { if (mpiLogging) {\</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">int logRank = -1, logIsMpiInitialized = 0;\</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">MPI_Initialized(&amp;logIsMpiInitialized);\</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">if (logIsMpiInitialized) MPI_Comm_rank(MPI_COMM_WORLD, &amp;logRank);\</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">std::cout &lt;&lt; &quot;[mpi_rec_fou] &quot; &lt;&lt; logRank &lt;&lt; &quot;: &quot; &lt;&lt; COUT &lt;&lt; &#39;\n&#39;; } } while (0)</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="classProgRecFourierMpiStarPU.html#ab79de376dffb5929b980d77f360c8325">   49</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgRecFourierMpiStarPU.html#ab79de376dffb5929b980d77f360c8325">ProgRecFourierMpiStarPU::defineParams</a>() {</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="classProgRecFourierStarPU.html#aebcac01efb9aab01cfa0190f540a4609">ProgRecFourierStarPU::defineParams</a>();</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="classXmippProgram.html#aaeb37f0bac83f5d2a605aaa0e5c4b6ef">addParamsLine</a>(<span class="stringliteral">&quot;  [--mpiDistribute &lt;pc=0.3&gt;]     : Ratio [0,1] describing how many batches should be initially distributed.&quot;</span>);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="classXmippProgram.html#aaeb37f0bac83f5d2a605aaa0e5c4b6ef">addParamsLine</a>(<span class="stringliteral">&quot;                                 : Use less for more heterogeneous group of computers, more for more homogeneous group.&quot;</span>);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="classXmippProgram.html#aaeb37f0bac83f5d2a605aaa0e5c4b6ef">addParamsLine</a>(<span class="stringliteral">&quot;  [--mpiPrefetch &lt;batches=25&gt;]    : How many batches should be in the processing pipeline at all times.&quot;</span>);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="classXmippProgram.html#aaeb37f0bac83f5d2a605aaa0e5c4b6ef">addParamsLine</a>(<span class="stringliteral">&quot;                                 : Higher numbers could be faster with faster and/or more homogeneous computers.&quot;</span>);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="classXmippProgram.html#aaeb37f0bac83f5d2a605aaa0e5c4b6ef">addParamsLine</a>(<span class="stringliteral">&quot;                                 : Very low numbers will have severe performance implications.&quot;</span>);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;}</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="classProgRecFourierMpiStarPU.html#aaa4cd6b028fd723ec465857321f0fdcc">   58</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgRecFourierMpiStarPU.html#aaa4cd6b028fd723ec465857321f0fdcc">ProgRecFourierMpiStarPU::readParams</a>() {</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="classProgRecFourierStarPU.html#a02e5fa2fa30c4a591ee1e85b50a95a98">ProgRecFourierStarPU::readParams</a>();</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    percentOfJobsDistributedByDefault = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(<a class="code" href="classXmippProgram.html#a552e1ea4a84576d9149b965d9edb6277">getDoubleParam</a>(<span class="stringliteral">&quot;--mpiDistribute&quot;</span>));</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    preferredBatchesInPipeline = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(<a class="code" href="classXmippProgram.html#a7b7ddf0836dc1079ea2622e2a420c39c">getIntParam</a>(<span class="stringliteral">&quot;--mpiPrefetch&quot;</span>));</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;}</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="classProgRecFourierMpiStarPU.html#a6cf90a434e8d4f235f74b3e362388756">   65</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgRecFourierMpiStarPU.html#a6cf90a434e8d4f235f74b3e362388756">ProgRecFourierMpiStarPU::run</a>() {</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordtype">int</span> rank, size;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <a class="code" href="reconstruct__fourier__util_8h.html#a39adc154265d38e2e19f560174b68c57">CHECK_MPI</a>(MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank));</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <a class="code" href="reconstruct__fourier__util_8h.html#a39adc154265d38e2e19f560174b68c57">CHECK_MPI</a>(MPI_Comm_size(MPI_COMM_WORLD, &amp;size));</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    {<span class="comment">// Implementation of tip 6 from https://www.open-mpi.org/faq/?category=debugging</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="comment">// Set this env variable to the rank which is to be debugged</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="keywordtype">char</span>* rankStr = getenv(<span class="stringliteral">&quot;XMIPP_MPI_DEBUG_RANK&quot;</span>);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordtype">int</span> rankToBlock = rankStr == <span class="keyword">nullptr</span> ? -1 : atoi(rankStr);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keywordflow">if</span> (rankToBlock == rank) {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            <span class="keyword">volatile</span> <span class="comment">/* so it isn&#39;t optimized out */</span> <span class="keywordtype">int</span> <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            <span class="keywordtype">char</span> hostname[256];</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            gethostname(hostname, <span class="keyword">sizeof</span>(hostname));</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            printf(<span class="stringliteral">&quot;PID %d on %s ready for attach\n&quot;</span>, getpid(), hostname);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            fflush(stdout);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            <span class="comment">// After attaching with debugger, set i to arbitrary non-zero value to continue</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            <span class="comment">// gdb&gt; set var i = 7</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <span class="keywordflow">while</span> (0 == i)</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                sleep(1);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        }</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    }</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordflow">if</span> (size &lt; 2) {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keywordflow">if</span> (rank == 0) {</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <a class="code" href="group__ErrorHandling.html#ga4ab7f9b2fd1ec4b9efcfba0c9b33052c">REPORT_ERROR</a>(<a class="code" href="group__ErrorHandling.html#ggab0df38968e4f03a3f1f6d6df0f31f45aa555c502c1c822cdce0220c242aa31dcd">ERR_ARG_DEPENDENCE</a>, <span class="stringliteral">&quot;This MPI implementation needs at least two instances&quot;</span>);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            <span class="comment">// no need to report error from all nodes at the same time</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    }</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    MPI_Comm workComm;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">// Rest of the code in this file assumes, that world rank 0 is master and other ranks are simply shifted by 1 to form workComm.</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// This code does that, but any modification must take this requirement into account.</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <a class="code" href="reconstruct__fourier__util_8h.html#a39adc154265d38e2e19f560174b68c57">CHECK_MPI</a>(MPI_Comm_split(MPI_COMM_WORLD, rank == 0 ? MPI_UNDEFINED : 0, 0, &amp;workComm));</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> workerCount = size - 1;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordflow">if</span> (workComm == MPI_COMM_NULL) {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        runMaster(workerCount);</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="keywordtype">int</span> workerRank;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <a class="code" href="reconstruct__fourier__util_8h.html#a39adc154265d38e2e19f560174b68c57">CHECK_MPI</a>(MPI_Comm_rank(workComm, &amp;workerRank));</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        runWorker(workComm, workerCount, workerRank);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    }</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;}</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;uint32_t ProgRecFourierMpiStarPU::defaultBatchDistribution(<span class="keyword">const</span> uint32_t batchCount, <span class="keyword">const</span> <span class="keywordtype">int</span> workerCount, <span class="keyword">const</span> <span class="keywordtype">int</span> selfWorkerId, std::deque&lt;uint32_t&gt;* myBatches)<span class="keyword"> const </span>{</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    uint32_t distributedByDefault = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(percentOfJobsDistributedByDefault * batchCount);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="comment">// Always distribute at least preferredBatchesInPipeline batches to each worker</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    distributedByDefault = <a class="code" href="group__Macros.html#gae0a4180e923e3ffca3989e20e441aa3c">XMIPP_MAX</a>(distributedByDefault, workerCount * preferredBatchesInPipeline);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">// But when there is less batches than workers, that is not possible</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    distributedByDefault = <a class="code" href="group__Macros.html#gac9ae6a207f10c821b06a8c0df153a7d5">XMIPP_MIN</a>(distributedByDefault, batchCount);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    uint32_t nextRoundFirstBatch = 0;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">while</span> (nextRoundFirstBatch &lt; distributedByDefault) {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="comment">// There is still something to distribute</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        uint32_t roundSize = <a class="code" href="group__Macros.html#gac9ae6a207f10c821b06a8c0df153a7d5">XMIPP_MIN</a>(distributedByDefault - nextRoundFirstBatch, workerCount);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">if</span> (myBatches != <span class="keyword">nullptr</span> &amp;&amp; selfWorkerId &lt; roundSize) {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            myBatches-&gt;push_back(nextRoundFirstBatch + selfWorkerId);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        nextRoundFirstBatch += roundSize;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    }</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">return</span> nextRoundFirstBatch;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;}</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="mpi__reconstruct__fourier__starpu_8cpp.html#a0eda245d63a7cb310d1421d6ab503c0a">  142</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a0eda245d63a7cb310d1421d6ab503c0a">TAG_WORKER_TO_MASTER</a> = 1;</div><div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="mpi__reconstruct__fourier__starpu_8cpp.html#a41410129650f452feea4408bfa81c28f">  143</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a41410129650f452feea4408bfa81c28f">TAG_MASTER_TO_WORKER</a> = 2;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="keywordtype">void</span> ProgRecFourierMpiStarPU::runMaster(<span class="keywordtype">int</span> workerCount) {</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classXmippProgram.html#aed62cfe3c074e69076bf348fc101a717">verbose</a>) {</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <a class="code" href="classProgRecFourierStarPU.html#a6b4b8ac8c309bc03444d2a401432460b">show</a>();</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    }</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">// mpiLogging completely breaks the progress bar</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> progressBar = !<a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#aa68101301fdd524f921116f58f57bf5d">mpiLogging</a> &amp;&amp; <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(<a class="code" href="classXmippProgram.html#aed62cfe3c074e69076bf348fc101a717">verbose</a>) &amp;&amp; <span class="keyword">false</span> <span class="comment">/* Progress bar on MPI processes is broken anyway. */</span>;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="classProgRecFourierStarPU.html#a2e89bda5f0b35339c57552ebd2c5ca49">prepareMetaData</a>(<a class="code" href="classProgRecFourierStarPU.html#aa87a33be6c19dd7c3a373b4665cdacef">fn_in</a>, <a class="code" href="classProgRecFourierStarPU.html#a08d7189455e88cc530186c6a241ee271">SF</a>);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keyword">const</span> uint32_t batchCount = <a class="code" href="classProgRecFourierStarPU.html#ae9d3895ec5a8187c2b89c91a7572388c">computeBatchCount</a>(<a class="code" href="classProgRecFourierStarPU.html#a07eb734c5301b9f9a9a60b7cf0cb32d3">params</a>, <a class="code" href="classProgRecFourierStarPU.html#a08d7189455e88cc530186c6a241ee271">SF</a>);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">if</span> (progressBar) {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <a class="code" href="group__GeneralFunctions.html#ga8c220fe710ecdb4f9b1696dd53e20ff3">init_progress_bar</a>(batchCount);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    uint32_t nextBatch = defaultBatchDistribution(batchCount, workerCount, workerCount, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    assert(nextBatch &lt;= batchCount);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;default distributed &quot;</span> &lt;&lt; nextBatch &lt;&lt; <span class="stringliteral">&quot; out of &quot;</span> &lt;&lt; batchCount &lt;&lt; <span class="stringliteral">&quot; batches&quot;</span>);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">if</span> (nextBatch == batchCount) {</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="comment">// Everything has been given out by default, nobody should ask for anything, master is done</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;skipping batch distribution loop&quot;</span>);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    }</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">// Workers will send how many batches they have processed uint32_t[1]</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">// and master will respond with the next batch they should process int32_t[1], or -1 if they should not process any more batches</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keyword">struct </span>WorkerInfo {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        uint32_t processedBatches;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        int32_t sendBuffer;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        MPI_Request lastSendRequest = MPI_REQUEST_NULL;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    };</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    std::vector&lt;WorkerInfo&gt; workerInfos(workerCount);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordtype">int</span> workersComplete = 0;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    uint32_t batchesComplete = 0;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">while</span> (workersComplete &lt; workerCount) {</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;waiting for next batch query&quot;</span>);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        MPI_Status recvStatus;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        uint32_t complete;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <a class="code" href="reconstruct__fourier__util_8h.html#a39adc154265d38e2e19f560174b68c57">CHECK_MPI</a>(MPI_Recv(&amp;complete, 1, MPI_UINT32_T, MPI_ANY_SOURCE, <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a0eda245d63a7cb310d1421d6ab503c0a">TAG_WORKER_TO_MASTER</a>, MPI_COMM_WORLD, &amp;recvStatus));</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="comment">// Somebody needs another batch to process</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;batch query received from &quot;</span> &lt;&lt; recvStatus.MPI_SOURCE &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; complete &lt;&lt; <span class="stringliteral">&quot; completed)&quot;</span>);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="comment">// NOTE: This assumes, that ranks of workers are 1..workerCount! This is currently true as it is how MPI_Comm_split does things.</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        WorkerInfo&amp; workerInfo = workerInfos[recvStatus.MPI_SOURCE - 1];</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <a class="code" href="reconstruct__fourier__util_8h.html#a39adc154265d38e2e19f560174b68c57">CHECK_MPI</a>(MPI_Wait(&amp;workerInfo.lastSendRequest, MPI_STATUS_IGNORE)); <span class="comment">// Should be no-op</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="comment">// Send new batch or notification that there are no more batches</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="keywordflow">if</span> (nextBatch &gt;= batchCount) {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;replying with no more batches&quot;</span>);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            workerInfo.sendBuffer = -1;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            workersComplete++;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;replying with batch &quot;</span> &lt;&lt; nextBatch);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            workerInfo.sendBuffer = nextBatch++;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <a class="code" href="reconstruct__fourier__util_8h.html#a39adc154265d38e2e19f560174b68c57">CHECK_MPI</a>(MPI_Isend(&amp;workerInfo.sendBuffer, 1, MPI_INT32_T, recvStatus.MPI_SOURCE, <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a41410129650f452feea4408bfa81c28f">TAG_MASTER_TO_WORKER</a>, MPI_COMM_WORLD, &amp;workerInfo.lastSendRequest));</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="comment">// Request carried information about how many batches has that worker completed in total.</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="comment">// Update internal counters with that.</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        uint32_t newCompleteBatches = workerInfo.processedBatches - complete;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        workerInfo.processedBatches = complete;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        batchesComplete += newCompleteBatches;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keywordflow">if</span> (progressBar) {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            <a class="code" href="group__GeneralFunctions.html#ga3bdba82f045e73fb216c6be539e6b129">progress_bar</a>(batchesComplete);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        }</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    }</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;batch loop complete, waiting for any pending messages&quot;</span>);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">// Every batch has been sent, make sure it has reached its destination</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordflow">for</span> (WorkerInfo&amp; workerInfo : workerInfos) {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <a class="code" href="reconstruct__fourier__util_8h.html#a39adc154265d38e2e19f560174b68c57">CHECK_MPI</a>(MPI_Wait(&amp;workerInfo.lastSendRequest, MPI_STATUS_IGNORE));</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">if</span> (progressBar) {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="comment">// Just to make sure that it is really done</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <a class="code" href="group__GeneralFunctions.html#ga3bdba82f045e73fb216c6be539e6b129">progress_bar</a>(batchCount);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    }</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;done&quot;</span>);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="comment">// Done</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;}</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno"><a class="line" href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html">  237</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html">ProgRecFourierMpiStarPU::DistributedBatchProvider</a> : <a class="code" href="structProgRecFourierStarPU_1_1BatchProvider.html">ProgRecFourierStarPU::BatchProvider</a> {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keyword">const</span> <a class="code" href="classProgRecFourierMpiStarPU.html">ProgRecFourierMpiStarPU</a>&amp; parent;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    std::deque&lt;uint32_t&gt; defaultBatchQueue;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    uint32_t maxBatchCount;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keyword">enum class</span> State {</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        QUEUE_AND_POOL,</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        QUEUE_ONLY,</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        POOL_REQUEST_PENDING,</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        NO_MORE_BATCHES</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    } state;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    uint32_t completedBatches = 0;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    sem_t batchesInPipeline;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    MPI_Request mpiRequests[2];</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    uint32_t mpiSendBuf;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    int32_t mpiRecvBuf;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordtype">void</span> doRequestFromPool() {</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="comment">// See runMaster() for description of sent data</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;doRequestFromPool&quot;</span>);</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        mpiSendBuf = completedBatches;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <a class="code" href="reconstruct__fourier__util_8h.html#a39adc154265d38e2e19f560174b68c57">CHECK_MPI</a>(MPI_Isend(&amp;mpiSendBuf, 1, MPI_UINT32_T, 0, <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a0eda245d63a7cb310d1421d6ab503c0a">TAG_WORKER_TO_MASTER</a>, MPI_COMM_WORLD, &amp;mpiRequests[0]));</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <a class="code" href="reconstruct__fourier__util_8h.html#a39adc154265d38e2e19f560174b68c57">CHECK_MPI</a>(MPI_Irecv(&amp;mpiRecvBuf, 1, MPI_INT32_T, 0, <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a41410129650f452feea4408bfa81c28f">TAG_MASTER_TO_WORKER</a>, MPI_COMM_WORLD, &amp;mpiRequests[1]));</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    int32_t doCompleteRequestFromPool() {</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="comment">// Wait for the request!</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;doCompleteRequestFromPool&quot;</span>);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <a class="code" href="reconstruct__fourier__util_8h.html#a39adc154265d38e2e19f560174b68c57">CHECK_MPI</a>(MPI_Waitall(2, mpiRequests, MPI_STATUSES_IGNORE));</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <span class="keywordflow">return</span> mpiRecvBuf;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    }</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00284"></a><span class="lineno"><a class="line" href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html#afae1c2afbc6cd25fa23023d31f503ec2">  284</a></span>&#160;    <a class="code" href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html#afae1c2afbc6cd25fa23023d31f503ec2">DistributedBatchProvider</a>(<span class="keyword">const</span> <a class="code" href="classProgRecFourierMpiStarPU.html">ProgRecFourierMpiStarPU</a>&amp; parent, uint32_t batchCount, <span class="keywordtype">int</span> workerCount, <span class="keywordtype">int</span> workerRank)</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    : parent(parent) {</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        uint32_t nextBatch = parent.defaultBatchDistribution(batchCount, workerCount, workerRank, &amp;defaultBatchQueue);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        maxBatchCount = <span class="keyword">static_cast&lt;</span>uint32_t<span class="keyword">&gt;</span>(defaultBatchQueue.size() + batchCount - nextBatch);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">if</span> (defaultBatchQueue.empty()) {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            assert(nextBatch &gt;= batchCount);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            state = State::NO_MORE_BATCHES;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nextBatch &gt;= batchCount) {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            state = State::QUEUE_ONLY;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            state = State::QUEUE_AND_POOL;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        }</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        sem_init(&amp;batchesInPipeline, 0, parent.preferredBatchesInPipeline);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    }</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno"><a class="line" href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html#ae17e05e751a06dfe1a0e3e33e1005f33">  301</a></span>&#160;    <a class="code" href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html#ae17e05e751a06dfe1a0e3e33e1005f33">~DistributedBatchProvider</a>() {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        sem_destroy(&amp;batchesInPipeline);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    }</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno"><a class="line" href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html#a3c9d6a4a51df9411edf684d5a0293bd9">  305</a></span>&#160;    uint32_t <a class="code" href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html#a3c9d6a4a51df9411edf684d5a0293bd9">maxBatches</a>()<span class="keyword"> override </span>{</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="keywordflow">return</span> maxBatchCount;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    }</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno"><a class="line" href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html#a8f829e47218dc69361b98666820bd8d5">  309</a></span>&#160;    int32_t <a class="code" href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html#a8f829e47218dc69361b98666820bd8d5">nextBatch</a>()<span class="keyword"> override </span>{</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <span class="keywordflow">switch</span> (state) {</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            <span class="keywordflow">case</span> State::QUEUE_AND_POOL: {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                uint32_t fromQueue = defaultBatchQueue.front();</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                defaultBatchQueue.pop_front();</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                <span class="keywordflow">if</span> (defaultBatchQueue.empty()) {</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                    <span class="comment">// Send request for more</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                    doRequestFromPool();</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                    state = State::POOL_REQUEST_PENDING;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                }</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                sem_wait(&amp;batchesInPipeline);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                <span class="keywordflow">return</span> fromQueue;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <span class="keywordflow">case</span> State::QUEUE_ONLY: {</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                uint32_t fromQueue = defaultBatchQueue.front();</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                defaultBatchQueue.pop_front();</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                <span class="keywordflow">if</span> (defaultBatchQueue.empty()) {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                    <span class="comment">// That&#39;s it</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                    state = State::NO_MORE_BATCHES;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                }</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                sem_wait(&amp;batchesInPipeline);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                <span class="keywordflow">return</span> fromQueue;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            }</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            <span class="keywordflow">case</span> State::POOL_REQUEST_PENDING: {</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                int32_t fromPool = doCompleteRequestFromPool();</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                <span class="keywordflow">if</span> (fromPool == -1) {</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                    <span class="comment">// That&#39;s it</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                    state = State::NO_MORE_BATCHES;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                    <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                    assert(fromPool &gt;= 0);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                    <span class="comment">// Got something meaningful, query for more!</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                    doRequestFromPool();</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                    sem_wait(&amp;batchesInPipeline);</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                    <span class="keywordflow">return</span> fromPool;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                }</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            }</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            <span class="keywordflow">case</span> State::NO_MORE_BATCHES: {</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            }</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        }</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        assert(<span class="keyword">false</span>);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    }</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno"><a class="line" href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html#a148c6721e246a1ad0dcdffc2fbaee24c">  353</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html#a148c6721e246a1ad0dcdffc2fbaee24c">batchCompleted</a>()<span class="keyword"> override </span>{</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        completedBatches++;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        sem_post(&amp;batchesInPipeline);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    }</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;};</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="keywordtype">void</span> ProgRecFourierMpiStarPU::runWorker(MPI_Comm workComm, <span class="keywordtype">int</span> workerCount, <span class="keywordtype">int</span> workerRank) {</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <a class="code" href="classProgRecFourierStarPU.html#a2e89bda5f0b35339c57552ebd2c5ca49">prepareMetaData</a>(<a class="code" href="classProgRecFourierStarPU.html#aa87a33be6c19dd7c3a373b4665cdacef">fn_in</a>, <a class="code" href="classProgRecFourierStarPU.html#a08d7189455e88cc530186c6a241ee271">SF</a>);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keyword">const</span> uint32_t batchCount = <a class="code" href="classProgRecFourierStarPU.html#ae9d3895ec5a8187c2b89c91a7572388c">computeBatchCount</a>(<a class="code" href="classProgRecFourierStarPU.html#a07eb734c5301b9f9a9a60b7cf0cb32d3">params</a>, <a class="code" href="classProgRecFourierStarPU.html#a08d7189455e88cc530186c6a241ee271">SF</a>);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <a class="code" href="classProgRecFourierStarPU.html#a12837d2a5ba372ee02f5778f573525d5">prepareConstants</a>(<a class="code" href="classProgRecFourierStarPU.html#a07eb734c5301b9f9a9a60b7cf0cb32d3">params</a>, <a class="code" href="classProgRecFourierStarPU.html#a08d7189455e88cc530186c6a241ee271">SF</a>, <a class="code" href="classProgRecFourierStarPU.html#a299ed1eb81bf237016f6b84163b55cea">fn_sym</a>, <a class="code" href="classProgRecFourierStarPU.html#a56144db5cfa495d382d81bc8f3ba712e">computeConstants</a>);</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <a class="code" href="classProgRecFourierStarPU.html#af35fae17ab93de476227d590c47024a1">initStarPU</a>();</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;runWorker - starpu start&quot;</span>);</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <a class="code" href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html">ProgRecFourierMpiStarPU::DistributedBatchProvider</a> batchSource(*<span class="keyword">this</span>, batchCount, workerCount, workerRank);</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <a class="code" href="structProgRecFourierStarPU_1_1ComputeStarPUResult.html">ComputeStarPUResult</a> result = <a class="code" href="classProgRecFourierStarPU.html#aa301ddc5c0900113d6b37d46340b1592">computeStarPU</a>(<a class="code" href="classProgRecFourierStarPU.html#a07eb734c5301b9f9a9a60b7cf0cb32d3">params</a>, <a class="code" href="classProgRecFourierStarPU.html#a08d7189455e88cc530186c6a241ee271">SF</a>, <a class="code" href="classProgRecFourierStarPU.html#a56144db5cfa495d382d81bc8f3ba712e">computeConstants</a>, batchSource, (<span class="keywordtype">bool</span>) <a class="code" href="classXmippProgram.html#aed62cfe3c074e69076bf348fc101a717">verbose</a>);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;runWorker - starpu end&quot;</span>);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="comment">// We won&#39;t need StarPU anymore</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <a class="code" href="classProgRecFourierStarPU.html#aee1e220b912da3033b59f960813c2fe5">shutdownStarPU</a>();</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> primary = workerRank == 0;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    { <span class="comment">// Reduce result into the primary worker</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="keywordtype">int</span> reduceSize = (<a class="code" href="classProgRecFourierStarPU.html#a56144db5cfa495d382d81bc8f3ba712e">computeConstants</a>.<a class="code" href="structProgRecFourierStarPU_1_1ComputeConstants.html#a0b0eadc3d609bc6b7e6144911614f39f">maxVolumeIndex</a> + 1) * (<a class="code" href="classProgRecFourierStarPU.html#a56144db5cfa495d382d81bc8f3ba712e">computeConstants</a>.<a class="code" href="structProgRecFourierStarPU_1_1ComputeConstants.html#a0b0eadc3d609bc6b7e6144911614f39f">maxVolumeIndex</a> + 1) *</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                         (<a class="code" href="classProgRecFourierStarPU.html#a56144db5cfa495d382d81bc8f3ba712e">computeConstants</a>.<a class="code" href="structProgRecFourierStarPU_1_1ComputeConstants.html#a0b0eadc3d609bc6b7e6144911614f39f">maxVolumeIndex</a> + 1);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        MPI_Request requests[2];</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;runWorker - reduce submit&quot;</span>);</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <a class="code" href="reconstruct__fourier__util_8h.html#a39adc154265d38e2e19f560174b68c57">CHECK_MPI</a>(MPI_Ireduce(primary ? MPI_IN_PLACE : result.<a class="code" href="structProgRecFourierStarPU_1_1ComputeStarPUResult.html#a847045cdc394fe93111c6771e4d314ac">volumeData</a>, result.<a class="code" href="structProgRecFourierStarPU_1_1ComputeStarPUResult.html#a847045cdc394fe93111c6771e4d314ac">volumeData</a>,</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                              reduceSize * 2, MPI_FLOAT,</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                              MPI_SUM, 0, workComm, &amp;requests[0]));</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <a class="code" href="reconstruct__fourier__util_8h.html#a39adc154265d38e2e19f560174b68c57">CHECK_MPI</a>(MPI_Ireduce(primary ? MPI_IN_PLACE : result.<a class="code" href="structProgRecFourierStarPU_1_1ComputeStarPUResult.html#af4a69eebb17cd861e2ffcf501ea5c02a">weightsData</a>, result.<a class="code" href="structProgRecFourierStarPU_1_1ComputeStarPUResult.html#af4a69eebb17cd861e2ffcf501ea5c02a">weightsData</a>,</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                              reduceSize, MPI_FLOAT,</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                              MPI_SUM, 0, workComm, &amp;requests[1]));</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;runWorker - reduce wait&quot;</span>);</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <a class="code" href="reconstruct__fourier__util_8h.html#a39adc154265d38e2e19f560174b68c57">CHECK_MPI</a>(MPI_Waitall(2, requests, MPI_STATUSES_IGNORE));</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;runWorker - reduce done&quot;</span>);</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    }</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordflow">if</span> (!primary) {</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="comment">// Only primary worker continues past this point, other workers may end now</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        result.<a class="code" href="structProgRecFourierStarPU_1_1ComputeStarPUResult.html#a7c1b8732015ecce271448350f0e7d5d9">destroy</a>();</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;runWorker - non primary quitting&quot;</span>);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="comment">// Convert flat volume and weight arrays into multidimensional arrays and destroy originals</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    std::complex&lt;float&gt;*** tempVolume = result.<a class="code" href="structProgRecFourierStarPU_1_1ComputeStarPUResult.html#aea08c5f7905a8bafa5698a82354f9c2f">createXmippStyleVolume</a>(<a class="code" href="classProgRecFourierStarPU.html#a56144db5cfa495d382d81bc8f3ba712e">computeConstants</a>.<a class="code" href="structProgRecFourierStarPU_1_1ComputeConstants.html#a0b0eadc3d609bc6b7e6144911614f39f">maxVolumeIndex</a>);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordtype">float</span>*** tempWeights = result.<a class="code" href="structProgRecFourierStarPU_1_1ComputeStarPUResult.html#a4ec543f98f6a128341ce79f843051148">createXmippStyleWeights</a>(<a class="code" href="classProgRecFourierStarPU.html#a56144db5cfa495d382d81bc8f3ba712e">computeConstants</a>.<a class="code" href="structProgRecFourierStarPU_1_1ComputeConstants.html#a0b0eadc3d609bc6b7e6144911614f39f">maxVolumeIndex</a>);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    result.<a class="code" href="structProgRecFourierStarPU_1_1ComputeStarPUResult.html#a7c1b8732015ecce271448350f0e7d5d9">destroy</a>();</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="comment">// Adjust and save the resulting volume</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <a class="code" href="classProgRecFourierStarPU.html#a513ae2c349350be1c85f2bb836206ac3">postProcessAndSave</a>(<a class="code" href="classProgRecFourierStarPU.html#a07eb734c5301b9f9a9a60b7cf0cb32d3">params</a>, <a class="code" href="classProgRecFourierStarPU.html#a56144db5cfa495d382d81bc8f3ba712e">computeConstants</a>, <a class="code" href="classProgRecFourierStarPU.html#a99ccb0ff5310b171d45bb1cb692f56a9">fn_out</a>, tempVolume, tempWeights);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;}</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno"><a class="line" href="classProgRecFourierMpiStarPU.html#a4306f12d8e9e1499c8fa1d767a482816">  409</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgRecFourierMpiStarPU.html#a4306f12d8e9e1499c8fa1d767a482816">ProgRecFourierMpiStarPU::read</a>(<span class="keywordtype">int</span> <a class="code" href="classXmippProgram.html#a8659f9e603143c1788360f0eeb01e589">argc</a>, <span class="keywordtype">char</span> **<a class="code" href="classXmippProgram.html#af2f60708934c302e1289c5405109dd45">argv</a>, <span class="keywordtype">bool</span> reportErrors) {</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="comment">// Not using XmippMpiProgram, because it is unnecessarily complicated for this use-case</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="comment">// and does not initialize MPI with thread support, which is required</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;Initializing MPI&quot;</span>);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordtype">int</span> providedThreadSupport;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <a class="code" href="reconstruct__fourier__util_8h.html#a39adc154265d38e2e19f560174b68c57">CHECK_MPI</a>(MPI_Init_thread(&amp;argc, &amp;argv, MPI_THREAD_SERIALIZED, &amp;providedThreadSupport));</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    mpiInitialized = <span class="keyword">true</span>;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;MPI initialized with thread level &quot;</span> &lt;&lt; providedThreadSupport);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">if</span> (providedThreadSupport &lt; MPI_THREAD_SERIALIZED) {</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;MPI implementation does not support MPI_THREAD_SERIALIZED concurrency level, which is required. Provided level is &quot;</span> &lt;&lt; providedThreadSupport &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <a class="code" href="group__ErrorHandling.html#ga4ab7f9b2fd1ec4b9efcfba0c9b33052c">REPORT_ERROR</a>(<a class="code" href="group__ErrorHandling.html#ggab0df38968e4f03a3f1f6d6df0f31f45aa5bed3f42a08e195b307cf8622e913327">ERR_NOT_IMPLEMENTED</a>, <span class="stringliteral">&quot;Could not initialize MPI&quot;</span>);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    }</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <a class="code" href="classXmippProgram.html#a4eff3704eab2b7a94a89185e22f89512">XmippProgram::read</a>(argc, argv, reportErrors);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;}</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno"><a class="line" href="classProgRecFourierMpiStarPU.html#a5295fe4a55710812d5106030a989a664">  426</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classProgRecFourierMpiStarPU.html#a5295fe4a55710812d5106030a989a664">ProgRecFourierMpiStarPU::tryRun</a>() {</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="comment">// Based on XmippMpiProgram::tryRun()</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classXmippProgram.html#ae829d20125d500b80d008ea4b9a0e0bd">doRun</a>)</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            this-&gt;<a class="code" href="classProgRecFourierMpiStarPU.html#a6cf90a434e8d4f235f74b3e362388756">run</a>();</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    } <span class="keywordflow">catch</span> (<a class="code" href="classXmippError.html">XmippError</a> &amp;xe) {</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        std::cerr &lt;&lt; xe;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <a class="code" href="classXmippProgram.html#aa8d070e9454a1282137facadd3e45a35">errorCode</a> = xe.__errno;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        MPI_Abort(MPI_COMM_WORLD, xe.__errno);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    }</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classXmippProgram.html#aa8d070e9454a1282137facadd3e45a35">errorCode</a>;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;}</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno"><a class="line" href="classProgRecFourierMpiStarPU.html#a7a19985204dabfcb35c43693b76a8309">  439</a></span>&#160;<a class="code" href="classProgRecFourierMpiStarPU.html#a7a19985204dabfcb35c43693b76a8309">ProgRecFourierMpiStarPU::~ProgRecFourierMpiStarPU</a>() {</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">if</span> (mpiInitialized) {</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <a class="code" href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a>(<span class="stringliteral">&quot;Finalizing MPI&quot;</span>);</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <a class="code" href="reconstruct__fourier__util_8h.html#a39adc154265d38e2e19f560174b68c57">CHECK_MPI</a>(MPI_Finalize());</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    }</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;}</div><div class="ttc" id="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider_html_a3c9d6a4a51df9411edf684d5a0293bd9"><div class="ttname"><a href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html#a3c9d6a4a51df9411edf684d5a0293bd9">ProgRecFourierMpiStarPU::DistributedBatchProvider::maxBatches</a></div><div class="ttdeci">uint32_t maxBatches() override</div><div class="ttdef"><b>Definition:</b> <a href="mpi__reconstruct__fourier__starpu_8cpp_source.html#l00305">mpi_reconstruct_fourier_starpu.cpp:305</a></div></div>
<div class="ttc" id="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider_html_ae17e05e751a06dfe1a0e3e33e1005f33"><div class="ttname"><a href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html#ae17e05e751a06dfe1a0e3e33e1005f33">ProgRecFourierMpiStarPU::DistributedBatchProvider::~DistributedBatchProvider</a></div><div class="ttdeci">~DistributedBatchProvider()</div><div class="ttdef"><b>Definition:</b> <a href="mpi__reconstruct__fourier__starpu_8cpp_source.html#l00301">mpi_reconstruct_fourier_starpu.cpp:301</a></div></div>
<div class="ttc" id="group__GeneralFunctions_html_ga8c220fe710ecdb4f9b1696dd53e20ff3"><div class="ttname"><a href="group__GeneralFunctions.html#ga8c220fe710ecdb4f9b1696dd53e20ff3">init_progress_bar</a></div><div class="ttdeci">void init_progress_bar(long total)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__funcs_8cpp_source.html#l00781">xmipp_funcs.cpp:781</a></div></div>
<div class="ttc" id="mpi__reconstruct__fourier__starpu_8cpp_html_a0eda245d63a7cb310d1421d6ab503c0a"><div class="ttname"><a href="mpi__reconstruct__fourier__starpu_8cpp.html#a0eda245d63a7cb310d1421d6ab503c0a">TAG_WORKER_TO_MASTER</a></div><div class="ttdeci">const int TAG_WORKER_TO_MASTER</div><div class="ttdef"><b>Definition:</b> <a href="mpi__reconstruct__fourier__starpu_8cpp_source.html#l00142">mpi_reconstruct_fourier_starpu.cpp:142</a></div></div>
<div class="ttc" id="group__Macros_html_gae0a4180e923e3ffca3989e20e441aa3c"><div class="ttname"><a href="group__Macros.html#gae0a4180e923e3ffca3989e20e441aa3c">XMIPP_MAX</a></div><div class="ttdeci">#define XMIPP_MAX(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00193">xmipp_macros.h:193</a></div></div>
<div class="ttc" id="group__ErrorHandling_html_ggab0df38968e4f03a3f1f6d6df0f31f45aa5bed3f42a08e195b307cf8622e913327"><div class="ttname"><a href="group__ErrorHandling.html#ggab0df38968e4f03a3f1f6d6df0f31f45aa5bed3f42a08e195b307cf8622e913327">ERR_NOT_IMPLEMENTED</a></div><div class="ttdoc">Case or algorithm not implemented yet. </div><div class="ttdef"><b>Definition:</b> <a href="xmipp__error_8h_source.html#l00182">xmipp_error.h:182</a></div></div>
<div class="ttc" id="classXmippProgram_html_a552e1ea4a84576d9149b965d9edb6277"><div class="ttname"><a href="classXmippProgram.html#a552e1ea4a84576d9149b965d9edb6277">XmippProgram::getDoubleParam</a></div><div class="ttdeci">double getDoubleParam(const char *param, int arg=0)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8cpp_source.html#l00361">xmipp_program.cpp:361</a></div></div>
<div class="ttc" id="classXmippProgram_html_a4eff3704eab2b7a94a89185e22f89512"><div class="ttname"><a href="classXmippProgram.html#a4eff3704eab2b7a94a89185e22f89512">XmippProgram::read</a></div><div class="ttdeci">virtual void read(int argc, const char **argv, bool reportErrors=true)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8cpp_source.html#l00191">xmipp_program.cpp:191</a></div></div>
<div class="ttc" id="classXmippError_html"><div class="ttname"><a href="classXmippError.html">XmippError</a></div><div class="ttdef"><b>Definition:</b> <a href="xmipp__error_8h_source.html#l00248">xmipp_error.h:248</a></div></div>
<div class="ttc" id="group__ErrorHandling_html_ga4ab7f9b2fd1ec4b9efcfba0c9b33052c"><div class="ttname"><a href="group__ErrorHandling.html#ga4ab7f9b2fd1ec4b9efcfba0c9b33052c">REPORT_ERROR</a></div><div class="ttdeci">#define REPORT_ERROR(nerr, ErrormMsg)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__error_8h_source.html#l00238">xmipp_error.h:238</a></div></div>
<div class="ttc" id="structProgRecFourierStarPU_1_1BatchProvider_html"><div class="ttname"><a href="structProgRecFourierStarPU_1_1BatchProvider.html">ProgRecFourierStarPU::BatchProvider</a></div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8h_source.html#l00158">reconstruct_fourier_starpu.h:158</a></div></div>
<div class="ttc" id="group__ErrorHandling_html_ggab0df38968e4f03a3f1f6d6df0f31f45aa555c502c1c822cdce0220c242aa31dcd"><div class="ttname"><a href="group__ErrorHandling.html#ggab0df38968e4f03a3f1f6d6df0f31f45aa555c502c1c822cdce0220c242aa31dcd">ERR_ARG_DEPENDENCE</a></div><div class="ttdoc">Error with some arguments dependencies. </div><div class="ttdef"><b>Definition:</b> <a href="xmipp__error_8h_source.html#l00120">xmipp_error.h:120</a></div></div>
<div class="ttc" id="classProgRecFourierMpiStarPU_html_ab79de376dffb5929b980d77f360c8325"><div class="ttname"><a href="classProgRecFourierMpiStarPU.html#ab79de376dffb5929b980d77f360c8325">ProgRecFourierMpiStarPU::defineParams</a></div><div class="ttdeci">void defineParams() override</div><div class="ttdef"><b>Definition:</b> <a href="mpi__reconstruct__fourier__starpu_8cpp_source.html#l00049">mpi_reconstruct_fourier_starpu.cpp:49</a></div></div>
<div class="ttc" id="classProgRecFourierMpiStarPU_html_a4306f12d8e9e1499c8fa1d767a482816"><div class="ttname"><a href="classProgRecFourierMpiStarPU.html#a4306f12d8e9e1499c8fa1d767a482816">ProgRecFourierMpiStarPU::read</a></div><div class="ttdeci">void read(int argc, char **argv, bool reportErrors=true) override</div><div class="ttdef"><b>Definition:</b> <a href="mpi__reconstruct__fourier__starpu_8cpp_source.html#l00409">mpi_reconstruct_fourier_starpu.cpp:409</a></div></div>
<div class="ttc" id="structProgRecFourierStarPU_1_1ComputeStarPUResult_html"><div class="ttname"><a href="structProgRecFourierStarPU_1_1ComputeStarPUResult.html">ProgRecFourierStarPU::ComputeStarPUResult</a></div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8h_source.html#l00188">reconstruct_fourier_starpu.h:188</a></div></div>
<div class="ttc" id="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider_html_a8f829e47218dc69361b98666820bd8d5"><div class="ttname"><a href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html#a8f829e47218dc69361b98666820bd8d5">ProgRecFourierMpiStarPU::DistributedBatchProvider::nextBatch</a></div><div class="ttdeci">int32_t nextBatch() override</div><div class="ttdef"><b>Definition:</b> <a href="mpi__reconstruct__fourier__starpu_8cpp_source.html#l00309">mpi_reconstruct_fourier_starpu.cpp:309</a></div></div>
<div class="ttc" id="classProgRecFourierMpiStarPU_html_aaa4cd6b028fd723ec465857321f0fdcc"><div class="ttname"><a href="classProgRecFourierMpiStarPU.html#aaa4cd6b028fd723ec465857321f0fdcc">ProgRecFourierMpiStarPU::readParams</a></div><div class="ttdeci">void readParams() override</div><div class="ttdef"><b>Definition:</b> <a href="mpi__reconstruct__fourier__starpu_8cpp_source.html#l00058">mpi_reconstruct_fourier_starpu.cpp:58</a></div></div>
<div class="ttc" id="classProgRecFourierStarPU_html_a2e89bda5f0b35339c57552ebd2c5ca49"><div class="ttname"><a href="classProgRecFourierStarPU.html#a2e89bda5f0b35339c57552ebd2c5ca49">ProgRecFourierStarPU::prepareMetaData</a></div><div class="ttdeci">static void prepareMetaData(const FileName &amp;fn_in, MetaDataVec &amp;SF)</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8cpp_source.html#l00112">reconstruct_fourier_starpu.cpp:112</a></div></div>
<div class="ttc" id="classProgRecFourierMpiStarPU_html_a5295fe4a55710812d5106030a989a664"><div class="ttname"><a href="classProgRecFourierMpiStarPU.html#a5295fe4a55710812d5106030a989a664">ProgRecFourierMpiStarPU::tryRun</a></div><div class="ttdeci">int tryRun() override</div><div class="ttdef"><b>Definition:</b> <a href="mpi__reconstruct__fourier__starpu_8cpp_source.html#l00426">mpi_reconstruct_fourier_starpu.cpp:426</a></div></div>
<div class="ttc" id="classProgRecFourierStarPU_html_aebcac01efb9aab01cfa0190f540a4609"><div class="ttname"><a href="classProgRecFourierStarPU.html#aebcac01efb9aab01cfa0190f540a4609">ProgRecFourierStarPU::defineParams</a></div><div class="ttdeci">void defineParams() override</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8cpp_source.html#l00048">reconstruct_fourier_starpu.cpp:48</a></div></div>
<div class="ttc" id="classProgRecFourierMpiStarPU_html"><div class="ttname"><a href="classProgRecFourierMpiStarPU.html">ProgRecFourierMpiStarPU</a></div><div class="ttdef"><b>Definition:</b> <a href="mpi__reconstruct__fourier__starpu_8h_source.html#l00052">mpi_reconstruct_fourier_starpu.h:52</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">#define i</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02510">numerical_recipes.cpp:2510</a></div></div>
<div class="ttc" id="structProgRecFourierStarPU_1_1ComputeStarPUResult_html_aea08c5f7905a8bafa5698a82354f9c2f"><div class="ttname"><a href="structProgRecFourierStarPU_1_1ComputeStarPUResult.html#aea08c5f7905a8bafa5698a82354f9c2f">ProgRecFourierStarPU::ComputeStarPUResult::createXmippStyleVolume</a></div><div class="ttdeci">std::complex&lt; float &gt; *** createXmippStyleVolume(uint32_t maxVolumeIndex)</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8cpp_source.html#l00527">reconstruct_fourier_starpu.cpp:527</a></div></div>
<div class="ttc" id="classProgRecFourierStarPU_html_a56144db5cfa495d382d81bc8f3ba712e"><div class="ttname"><a href="classProgRecFourierStarPU.html#a56144db5cfa495d382d81bc8f3ba712e">ProgRecFourierStarPU::computeConstants</a></div><div class="ttdeci">struct ProgRecFourierStarPU::ComputeConstants computeConstants</div></div>
<div class="ttc" id="classXmippProgram_html_a8659f9e603143c1788360f0eeb01e589"><div class="ttname"><a href="classXmippProgram.html#a8659f9e603143c1788360f0eeb01e589">XmippProgram::argc</a></div><div class="ttdeci">int argc</div><div class="ttdoc">Original command line arguments. </div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8h_source.html#l00086">xmipp_program.h:86</a></div></div>
<div class="ttc" id="classProgRecFourierStarPU_html_a299ed1eb81bf237016f6b84163b55cea"><div class="ttname"><a href="classProgRecFourierStarPU.html#a299ed1eb81bf237016f6b84163b55cea">ProgRecFourierStarPU::fn_sym</a></div><div class="ttdeci">FileName fn_sym</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8h_source.html#l00054">reconstruct_fourier_starpu.h:54</a></div></div>
<div class="ttc" id="classProgRecFourierMpiStarPU_html_a7a19985204dabfcb35c43693b76a8309"><div class="ttname"><a href="classProgRecFourierMpiStarPU.html#a7a19985204dabfcb35c43693b76a8309">ProgRecFourierMpiStarPU::~ProgRecFourierMpiStarPU</a></div><div class="ttdeci">~ProgRecFourierMpiStarPU() override</div><div class="ttdef"><b>Definition:</b> <a href="mpi__reconstruct__fourier__starpu_8cpp_source.html#l00439">mpi_reconstruct_fourier_starpu.cpp:439</a></div></div>
<div class="ttc" id="reconstruct__fourier__util_8h_html_a39adc154265d38e2e19f560174b68c57"><div class="ttname"><a href="reconstruct__fourier__util_8h.html#a39adc154265d38e2e19f560174b68c57">CHECK_MPI</a></div><div class="ttdeci">#define CHECK_MPI(operationWithReturnCode)</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__util_8h_source.html#l00073">reconstruct_fourier_util.h:73</a></div></div>
<div class="ttc" id="classProgRecFourierStarPU_html_a08d7189455e88cc530186c6a241ee271"><div class="ttname"><a href="classProgRecFourierStarPU.html#a08d7189455e88cc530186c6a241ee271">ProgRecFourierStarPU::SF</a></div><div class="ttdeci">MetaDataVec SF</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8h_source.html#l00085">reconstruct_fourier_starpu.h:85</a></div></div>
<div class="ttc" id="structProgRecFourierStarPU_1_1ComputeStarPUResult_html_a7c1b8732015ecce271448350f0e7d5d9"><div class="ttname"><a href="structProgRecFourierStarPU_1_1ComputeStarPUResult.html#a7c1b8732015ecce271448350f0e7d5d9">ProgRecFourierStarPU::ComputeStarPUResult::destroy</a></div><div class="ttdeci">void destroy()</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8cpp_source.html#l00541">reconstruct_fourier_starpu.cpp:541</a></div></div>
<div class="ttc" id="group__GeneralFunctions_html_ga3bdba82f045e73fb216c6be539e6b129"><div class="ttname"><a href="group__GeneralFunctions.html#ga3bdba82f045e73fb216c6be539e6b129">progress_bar</a></div><div class="ttdeci">void progress_bar(long rlen)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__funcs_8cpp_source.html#l00790">xmipp_funcs.cpp:790</a></div></div>
<div class="ttc" id="classXmippProgram_html_ae829d20125d500b80d008ea4b9a0e0bd"><div class="ttname"><a href="classXmippProgram.html#ae829d20125d500b80d008ea4b9a0e0bd">XmippProgram::doRun</a></div><div class="ttdeci">bool doRun</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8h_source.html#l00091">xmipp_program.h:91</a></div></div>
<div class="ttc" id="classXmippProgram_html_af2f60708934c302e1289c5405109dd45"><div class="ttname"><a href="classXmippProgram.html#af2f60708934c302e1289c5405109dd45">XmippProgram::argv</a></div><div class="ttdeci">const char ** argv</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8h_source.html#l00087">xmipp_program.h:87</a></div></div>
<div class="ttc" id="classProgRecFourierStarPU_html_aee1e220b912da3033b59f960813c2fe5"><div class="ttname"><a href="classProgRecFourierStarPU.html#aee1e220b912da3033b59f960813c2fe5">ProgRecFourierStarPU::shutdownStarPU</a></div><div class="ttdeci">static void shutdownStarPU()</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8cpp_source.html#l00546">reconstruct_fourier_starpu.cpp:546</a></div></div>
<div class="ttc" id="mpi__reconstruct__fourier__starpu_8h_html"><div class="ttname"><a href="mpi__reconstruct__fourier__starpu_8h.html">mpi_reconstruct_fourier_starpu.h</a></div></div>
<div class="ttc" id="structProgRecFourierStarPU_1_1ComputeStarPUResult_html_a4ec543f98f6a128341ce79f843051148"><div class="ttname"><a href="structProgRecFourierStarPU_1_1ComputeStarPUResult.html#a4ec543f98f6a128341ce79f843051148">ProgRecFourierStarPU::ComputeStarPUResult::createXmippStyleWeights</a></div><div class="ttdeci">float *** createXmippStyleWeights(uint32_t maxVolumeIndex)</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8cpp_source.html#l00534">reconstruct_fourier_starpu.cpp:534</a></div></div>
<div class="ttc" id="classXmippProgram_html_aed62cfe3c074e69076bf348fc101a717"><div class="ttname"><a href="classXmippProgram.html#aed62cfe3c074e69076bf348fc101a717">XmippProgram::verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Verbosity level. </div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8h_source.html#l00159">xmipp_program.h:159</a></div></div>
<div class="ttc" id="classProgRecFourierStarPU_html_aa87a33be6c19dd7c3a373b4665cdacef"><div class="ttname"><a href="classProgRecFourierStarPU.html#aa87a33be6c19dd7c3a373b4665cdacef">ProgRecFourierStarPU::fn_in</a></div><div class="ttdeci">FileName fn_in</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8h_source.html#l00048">reconstruct_fourier_starpu.h:48</a></div></div>
<div class="ttc" id="classProgRecFourierStarPU_html_a12837d2a5ba372ee02f5778f573525d5"><div class="ttname"><a href="classProgRecFourierStarPU.html#a12837d2a5ba372ee02f5778f573525d5">ProgRecFourierStarPU::prepareConstants</a></div><div class="ttdeci">static void prepareConstants(const Params &amp;params, const MetaData &amp;SF, const FileName &amp;fn_sym, ComputeConstants &amp;constants)</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8cpp_source.html#l00122">reconstruct_fourier_starpu.cpp:122</a></div></div>
<div class="ttc" id="group__Macros_html_gac9ae6a207f10c821b06a8c0df153a7d5"><div class="ttname"><a href="group__Macros.html#gac9ae6a207f10c821b06a8c0df153a7d5">XMIPP_MIN</a></div><div class="ttdeci">#define XMIPP_MIN(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00181">xmipp_macros.h:181</a></div></div>
<div class="ttc" id="classProgRecFourierStarPU_html_a513ae2c349350be1c85f2bb836206ac3"><div class="ttname"><a href="classProgRecFourierStarPU.html#a513ae2c349350be1c85f2bb836206ac3">ProgRecFourierStarPU::postProcessAndSave</a></div><div class="ttdeci">static void postProcessAndSave(const Params &amp;params, const ComputeConstants &amp;computeConstants, const FileName &amp;fn_out, std::complex&lt; float &gt; ***tempVolume, float ***tempWeights)</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8cpp_source.html#l00550">reconstruct_fourier_starpu.cpp:550</a></div></div>
<div class="ttc" id="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider_html"><div class="ttname"><a href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html">ProgRecFourierMpiStarPU::DistributedBatchProvider</a></div><div class="ttdef"><b>Definition:</b> <a href="mpi__reconstruct__fourier__starpu_8cpp_source.html#l00237">mpi_reconstruct_fourier_starpu.cpp:237</a></div></div>
<div class="ttc" id="classProgRecFourierStarPU_html_a02e5fa2fa30c4a591ee1e85b50a95a98"><div class="ttname"><a href="classProgRecFourierStarPU.html#a02e5fa2fa30c4a591ee1e85b50a95a98">ProgRecFourierStarPU::readParams</a></div><div class="ttdeci">void readParams() override</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8cpp_source.html#l00082">reconstruct_fourier_starpu.cpp:82</a></div></div>
<div class="ttc" id="structProgRecFourierStarPU_1_1ComputeStarPUResult_html_af4a69eebb17cd861e2ffcf501ea5c02a"><div class="ttname"><a href="structProgRecFourierStarPU_1_1ComputeStarPUResult.html#af4a69eebb17cd861e2ffcf501ea5c02a">ProgRecFourierStarPU::ComputeStarPUResult::weightsData</a></div><div class="ttdeci">float * weightsData</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8h_source.html#l00199">reconstruct_fourier_starpu.h:199</a></div></div>
<div class="ttc" id="classProgRecFourierStarPU_html_aa301ddc5c0900113d6b37d46340b1592"><div class="ttname"><a href="classProgRecFourierStarPU.html#aa301ddc5c0900113d6b37d46340b1592">ProgRecFourierStarPU::computeStarPU</a></div><div class="ttdeci">static ComputeStarPUResult computeStarPU(const Params &amp;params, const MetaData &amp;SF, const ComputeConstants &amp;computeConstants, BatchProvider &amp;batches, bool verbose)</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8cpp_source.html#l00317">reconstruct_fourier_starpu.cpp:317</a></div></div>
<div class="ttc" id="mpi__reconstruct__fourier__starpu_8cpp_html_aa68101301fdd524f921116f58f57bf5d"><div class="ttname"><a href="mpi__reconstruct__fourier__starpu_8cpp.html#aa68101301fdd524f921116f58f57bf5d">mpiLogging</a></div><div class="ttdeci">const bool mpiLogging</div><div class="ttdef"><b>Definition:</b> <a href="mpi__reconstruct__fourier__starpu_8cpp_source.html#l00041">mpi_reconstruct_fourier_starpu.cpp:41</a></div></div>
<div class="ttc" id="classProgRecFourierStarPU_html_a6b4b8ac8c309bc03444d2a401432460b"><div class="ttname"><a href="classProgRecFourierStarPU.html#a6b4b8ac8c309bc03444d2a401432460b">ProgRecFourierStarPU::show</a></div><div class="ttdeci">void show() const override</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8cpp_source.html#l00191">reconstruct_fourier_starpu.cpp:191</a></div></div>
<div class="ttc" id="structProgRecFourierStarPU_1_1ComputeStarPUResult_html_a847045cdc394fe93111c6771e4d314ac"><div class="ttname"><a href="structProgRecFourierStarPU_1_1ComputeStarPUResult.html#a847045cdc394fe93111c6771e4d314ac">ProgRecFourierStarPU::ComputeStarPUResult::volumeData</a></div><div class="ttdeci">std::complex&lt; float &gt; * volumeData</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8h_source.html#l00196">reconstruct_fourier_starpu.h:196</a></div></div>
<div class="ttc" id="classProgRecFourierStarPU_html_af35fae17ab93de476227d590c47024a1"><div class="ttname"><a href="classProgRecFourierStarPU.html#af35fae17ab93de476227d590c47024a1">ProgRecFourierStarPU::initStarPU</a></div><div class="ttdeci">static void initStarPU()</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8cpp_source.html#l00290">reconstruct_fourier_starpu.cpp:290</a></div></div>
<div class="ttc" id="classProgRecFourierMpiStarPU_html_a6cf90a434e8d4f235f74b3e362388756"><div class="ttname"><a href="classProgRecFourierMpiStarPU.html#a6cf90a434e8d4f235f74b3e362388756">ProgRecFourierMpiStarPU::run</a></div><div class="ttdeci">void run() override</div><div class="ttdef"><b>Definition:</b> <a href="mpi__reconstruct__fourier__starpu_8cpp_source.html#l00065">mpi_reconstruct_fourier_starpu.cpp:65</a></div></div>
<div class="ttc" id="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider_html_afae1c2afbc6cd25fa23023d31f503ec2"><div class="ttname"><a href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html#afae1c2afbc6cd25fa23023d31f503ec2">ProgRecFourierMpiStarPU::DistributedBatchProvider::DistributedBatchProvider</a></div><div class="ttdeci">DistributedBatchProvider(const ProgRecFourierMpiStarPU &amp;parent, uint32_t batchCount, int workerCount, int workerRank)</div><div class="ttdef"><b>Definition:</b> <a href="mpi__reconstruct__fourier__starpu_8cpp_source.html#l00284">mpi_reconstruct_fourier_starpu.cpp:284</a></div></div>
<div class="ttc" id="mpi__reconstruct__fourier__starpu_8cpp_html_a98384e652a1855532cc08afc053f8cd0"><div class="ttname"><a href="mpi__reconstruct__fourier__starpu_8cpp.html#a98384e652a1855532cc08afc053f8cd0">LOG_MPI</a></div><div class="ttdeci">#define LOG_MPI(COUT)</div><div class="ttdef"><b>Definition:</b> <a href="mpi__reconstruct__fourier__starpu_8cpp_source.html#l00043">mpi_reconstruct_fourier_starpu.cpp:43</a></div></div>
<div class="ttc" id="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider_html_a148c6721e246a1ad0dcdffc2fbaee24c"><div class="ttname"><a href="structProgRecFourierMpiStarPU_1_1DistributedBatchProvider.html#a148c6721e246a1ad0dcdffc2fbaee24c">ProgRecFourierMpiStarPU::DistributedBatchProvider::batchCompleted</a></div><div class="ttdeci">void batchCompleted() override</div><div class="ttdef"><b>Definition:</b> <a href="mpi__reconstruct__fourier__starpu_8cpp_source.html#l00353">mpi_reconstruct_fourier_starpu.cpp:353</a></div></div>
<div class="ttc" id="classXmippProgram_html_a7b7ddf0836dc1079ea2622e2a420c39c"><div class="ttname"><a href="classXmippProgram.html#a7b7ddf0836dc1079ea2622e2a420c39c">XmippProgram::getIntParam</a></div><div class="ttdeci">int getIntParam(const char *param, int arg=0)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8cpp_source.html#l00351">xmipp_program.cpp:351</a></div></div>
<div class="ttc" id="classProgRecFourierStarPU_html_a07eb734c5301b9f9a9a60b7cf0cb32d3"><div class="ttname"><a href="classProgRecFourierStarPU.html#a07eb734c5301b9f9a9a60b7cf0cb32d3">ProgRecFourierStarPU::params</a></div><div class="ttdeci">struct ProgRecFourierStarPU::Params params</div></div>
<div class="ttc" id="classProgRecFourierStarPU_html_ae9d3895ec5a8187c2b89c91a7572388c"><div class="ttname"><a href="classProgRecFourierStarPU.html#ae9d3895ec5a8187c2b89c91a7572388c">ProgRecFourierStarPU::computeBatchCount</a></div><div class="ttdeci">static uint32_t computeBatchCount(const Params &amp;params, const MetaData &amp;SF)</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8cpp_source.html#l00118">reconstruct_fourier_starpu.cpp:118</a></div></div>
<div class="ttc" id="classXmippProgram_html_aa8d070e9454a1282137facadd3e45a35"><div class="ttname"><a href="classXmippProgram.html#aa8d070e9454a1282137facadd3e45a35">XmippProgram::errorCode</a></div><div class="ttdeci">int errorCode</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8h_source.html#l00078">xmipp_program.h:78</a></div></div>
<div class="ttc" id="classXmippProgram_html_aaeb37f0bac83f5d2a605aaa0e5c4b6ef"><div class="ttname"><a href="classXmippProgram.html#aaeb37f0bac83f5d2a605aaa0e5c4b6ef">XmippProgram::addParamsLine</a></div><div class="ttdeci">void addParamsLine(const String &amp;line)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8cpp_source.html#l00325">xmipp_program.cpp:325</a></div></div>
<div class="ttc" id="classProgRecFourierStarPU_html_a99ccb0ff5310b171d45bb1cb692f56a9"><div class="ttname"><a href="classProgRecFourierStarPU.html#a99ccb0ff5310b171d45bb1cb692f56a9">ProgRecFourierStarPU::fn_out</a></div><div class="ttdeci">FileName fn_out</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8h_source.html#l00051">reconstruct_fourier_starpu.h:51</a></div></div>
<div class="ttc" id="structProgRecFourierStarPU_1_1ComputeConstants_html_a0b0eadc3d609bc6b7e6144911614f39f"><div class="ttname"><a href="structProgRecFourierStarPU_1_1ComputeConstants.html#a0b0eadc3d609bc6b7e6144911614f39f">ProgRecFourierStarPU::ComputeConstants::maxVolumeIndex</a></div><div class="ttdeci">uint32_t maxVolumeIndex</div><div class="ttdef"><b>Definition:</b> <a href="reconstruct__fourier__starpu_8h_source.html#l00111">reconstruct_fourier_starpu.h:111</a></div></div>
<div class="ttc" id="mpi__reconstruct__fourier__starpu_8cpp_html_a41410129650f452feea4408bfa81c28f"><div class="ttname"><a href="mpi__reconstruct__fourier__starpu_8cpp.html#a41410129650f452feea4408bfa81c28f">TAG_MASTER_TO_WORKER</a></div><div class="ttdeci">const int TAG_MASTER_TO_WORKER</div><div class="ttdef"><b>Definition:</b> <a href="mpi__reconstruct__fourier__starpu_8cpp_source.html#l00143">mpi_reconstruct_fourier_starpu.cpp:143</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
