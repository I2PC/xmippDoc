<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Xmipp: Fast_Filters Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xmipp_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Xmipp
   &#160;<span id="projectnumber">v20.07</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classFast__Filters-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Fast_Filters Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for Fast_Filters:</div>
<div class="dyncontent">
<div class="center"><img src="classFast__Filters__inherit__graph.png" border="0" usemap="#Fast__Filters_inherit__map" alt="Inheritance graph"/></div>
<map name="Fast__Filters_inherit__map" id="Fast__Filters_inherit__map">
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for Fast_Filters:</div>
<div class="dyncontent">
<div class="center"><img src="classFast__Filters__coll__graph.png" border="0" usemap="#Fast__Filters_coll__map" alt="Collaboration graph"/></div>
<map name="Fast__Filters_coll__map" id="Fast__Filters_coll__map">
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a0de8201d31b1865dfd75a7ae3d94bac6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFast__Filters.html#a0de8201d31b1865dfd75a7ae3d94bac6">setup</a> (<a class="el" href="xmipp__strings_8h.html#afbeda3fd1bdc8c37d01bdf9f5c8274ff">String</a> arg, ImagePlus imp)</td></tr>
<tr class="separator:a0de8201d31b1865dfd75a7ae3d94bac6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bb1a74550e0434ee3dc11609452cfad"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFast__Filters.html#a1bb1a74550e0434ee3dc11609452cfad">showDialog</a> (ImagePlus imp, <a class="el" href="xmipp__strings_8h.html#afbeda3fd1bdc8c37d01bdf9f5c8274ff">String</a> command, PlugInFilterRunner pfr)</td></tr>
<tr class="separator:a1bb1a74550e0434ee3dc11609452cfad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01650c52a1a8289f81ef0e61977896d7"><td class="memItemLeft" align="right" valign="top">boolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFast__Filters.html#a01650c52a1a8289f81ef0e61977896d7">dialogItemChanged</a> (GenericDialog gd, AWTEvent e)</td></tr>
<tr class="separator:a01650c52a1a8289f81ef0e61977896d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15355a8c15582cabd744a2995d2ea025"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFast__Filters.html#a15355a8c15582cabd744a2995d2ea025">run</a> (ImageProcessor ip)</td></tr>
<tr class="separator:a15355a8c15582cabd744a2995d2ea025"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f6ea2d60cbafdb750b12a271fe81bc2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classFast__Filters.html#a8f6ea2d60cbafdb750b12a271fe81bc2">setNPasses</a> (int nPasses)</td></tr>
<tr class="separator:a8f6ea2d60cbafdb750b12a271fe81bc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A collection of fast filters (mean, min, max, median, background, ...) working on a rectangular n*m or square n*n kernel. Unidirectional filtering can be done with a kernel size of n*0 or 0*n pixels. Apart form the speed, the kernel type is the main difference to the built-in ImageJ Process&gt;Filters, which are working on a circular kernel, see Process&gt;Filters&gt;Show Circular Masks.</p>
<p>"Filter Types":</p><ul>
<li>Mean: Average over n*m pixels, where out-of-image pixels are replaced by nearest border pixel. For large kerner sizes (radii), this gives high weight to the border pixels.</li>
<li>Border-limited mean: Average over n*m pixels; in contrast to most ImageJ filters, out-of-image pixels are not replaced by border pixels but rather the area for averaging is reduced at the border.</li>
<li>Median: For unidirectional filters (i.e., with one of the radii = 0) the pixel is replaced by the median of the pixels within a distance of 8x or y-)radius. For bidirectional filters (i.e., if both x and y radii are &gt;0), a fast and rough approximation to the median in a rectangular surrounding is used: First a median filter is applied in x direction, then in y direction. In contrast to most ImageJ filters, out-of-image pixels are not replaced by border pixels but rather the area for median determination is reduced at the border.</li>
<li>Minimum: Minimum over n*m pixels</li>
<li>Maximum: Maximum over n*m pixels</li>
<li>Eliminate maxima: Runs "minimum" and "maximum" filters in succession. Eliminates maxima smaller than the kernel.</li>
<li>Eliminate minima: Runs "maximum" and "minimum" filters in succession. Eliminates minima smaller than the kernel.</li>
<li>Background from minima: eliminates maxima (see above) and smoothens the result (border-limited mean)</li>
<li>Background from maxima: eliminates minima (see above) and smoothens the result (border-limited mean)</li>
<li>Background from median: runs a median (median approximation for bidirectional filtering, see above), then smoothens the result (border-limited mean)</li>
</ul>
<p>"x Radius" and "y Radius" determine the kernel size of the filters (in pixels, irrespective of any spatial calibration of the image). For each target (output) pixel, the simple operations (mean, min, max) are performed over a neighborhood given by a rectangle of width = 2*xRadius+1 and height = 2*yRadius+1. x Radius = 0 or y Radius=0 results in no filter operation in that direction.</p>
<p>Check "Link x &amp; y" if a square kernel (x Radius = y Radius) is desired.</p>
<p>"Preprocessing" is an operation applied before all others. It can be "none", "smooth" or "median". For unidirectinal filtering (y radius = 0 or x radius = 0), preprocessing is also unidirectional: the kernel size for unidirectional preprocessing is 5x1 or 1x5 pixels. For bidirectional filters (i.e., if both x and y radii are &gt;0), for preprocessing averaging or the (approximated) median runs over a 3x3 pixel kernel. Preprocessing helps to eliminate outliers for the "minimum", "maximum" and related filters.</p>
<p>"Subtract Filtered" does not output the result of the filter operation above, but rather the original (input) image minus the result of the filter operation, plus an offset. With "mean" filters, "Subtract Filtered" results in a high-pass filter; with "median" it highlights outliers. With the "minimum" and "maximum" filters, "Subtract Filtered" is a kind of edge detection, and with the other filters it provides various types of background subtraction. Especially the "Background from minima" and "Background from maxima" filters are suitable for background subtraction in images with particles: <a class="el" href="namespaceMake.html">Make</a> sure that xRadius and yRadius are large enough to eliminate any particles (use preview without "Subtract Filtered", then apply the filter with "Subtract Filtered").</p>
<p>"Offset" is added to the data when subtracting a filtered image from the original one. The offset is needed except for 32-bit float images to keep the result in the range of the image type, e.g. 0-255 for 8-bit grayscale and 8-bit/channel RGB. Use a low value (e.g., 10) for subtracting "background from minima", high values (e.g. 245) for subtracting "background from maxima".</p>
<p>Notes for users:</p><ul>
<li>All operations are performed on raw pixel values, not taking any grayscale calibration into account.</li>
<li>This plugin provides a 'top hat' filter with "Eliminate Maxima" or "Eliminate Minima", and the "Subtract Filtered" option enabled. When using "Background from maxima", set a suitable offset, i.e., 255 for 8-bit and RGB, and the maximum of the image data range for 16-bit images (65535, or, e.g., 4096 if your data are limited to 12 bits).</li>
<li>The top-hat filter is also handy as a fast alternative to filtering 16-bit images with the ImageJ built-in "Subtract Background" command with the traditional algorithm (rolling ball, not sliding paraboloid) and produces similar results (especially for large pixel value ranges), but the "Background from minima" and "Background from maxima" filters usually produce better results (smoother background).</li>
</ul>
<p>Implementation notes:</p><ul>
<li>The plugin handles stack slices in parallel as long as there is enough free memory. This is faster than parallel processing of lines in each image because it also parallelizes the conversion to float.</li>
<li>Creation and destruction of a thread needs about 0.1 msec on a typical year-2011 computer (Intel core i5, Sun Java 1.6.0). This could significantly hamper the performance when processing many slices and creating new threads for each slice (90% of <a class="el" href="classCPU.html">CPU</a> time for thread creation/destruction at 50x50-pixel images!). Thus, small images (&lt;0.1 MPixels) are processed in only one thread.</li>
</ul>
<p>Performance on Intel i5 2.4 GHz, 1067 MHz DDR3, Java 1.6.0_24 for Mac, 4000*4000 pixel float image (data: 'add noise' on blank image), radius 5*5: mean: 0.27 s maximum: 0.31 s pseudo median: 1.45 s</p>
<p>Code by Michael Schmid 2008-11-21 released 2010-04-16 Parallel threads for multi-CPU machines, proper handling of NaN pixels </p>

<p>Definition at line <a class="el" href="Fast__Filters_8java_source.html#l00107">107</a> of file <a class="el" href="Fast__Filters_8java_source.html">Fast_Filters.java</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a01650c52a1a8289f81ef0e61977896d7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">boolean Fast_Filters.dialogItemChanged </td>
          <td>(</td>
          <td class="paramtype">GenericDialog&#160;</td>
          <td class="paramname"><em>gd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AWTEvent&#160;</td>
          <td class="paramname"><em>e</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Fast__Filters_8java_source.html#l00199">199</a> of file <a class="el" href="Fast__Filters_8java_source.html">Fast_Filters.java</a>.</p>
<div class="fragment"><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                                                                   {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        Vector numFields = gd.getNumericFields();</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        TextField xNumField = (TextField)numFields.get(0);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        TextField yNumField = (TextField)numFields.get(1);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        Checkbox linkCheckbox = (Checkbox)gd.getCheckboxes().get(0);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        linkXY = gd.getNextBoolean();</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="keywordflow">if</span> (linkXY &amp;&amp; !xNumField.getText().equals(yNumField.getText())) {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <span class="keywordflow">if</span> (e.getSource() == xNumField  || e.getSource() == linkCheckbox)</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                yNumField.setText(xNumField.getText());</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e.getSource() == yNumField)</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                xNumField.setText(yNumField.getText());</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        type = gd.getNextChoiceIndex();</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        xRadius = (int)gd.getNextNumber();</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        yRadius = (int)gd.getNextNumber();</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        preProcess = gd.getNextChoiceIndex();</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        subtract = gd.getNextBoolean();</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        offset[impType] = gd.getNextNumber();</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordflow">return</span> (!gd.invalidNumber() &amp;&amp; xRadius&gt;=0 &amp;&amp; yRadius&gt;=0 &amp;&amp; xRadius&lt;1000000 &amp;&amp; yRadius&lt;1000000);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    }</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a15355a8c15582cabd744a2995d2ea025"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Fast_Filters.run </td>
          <td>(</td>
          <td class="paramtype">ImageProcessor&#160;</td>
          <td class="paramname"><em>ip</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Fast__Filters_8java_source.html#l00222">222</a> of file <a class="el" href="Fast__Filters_8java_source.html">Fast_Filters.java</a>.</p>
<div class="fragment"><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                                       {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keywordtype">int</span> width = <a class="code" href="namespacePython__Animation.html#a2a7a33c109b139af98d86e4041e25dac">ip</a>.getWidth();</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="keywordtype">int</span> height = <a class="code" href="namespacePython__Animation.html#a2a7a33c109b139af98d86e4041e25dac">ip</a>.getHeight();</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        Rectangle roiRect = <a class="code" href="namespacePython__Animation.html#a2a7a33c109b139af98d86e4041e25dac">ip</a>.getRoi();</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="keywordtype">int</span>[] taskList = taskLists[type];</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="keywordtype">int</span> nTasks = taskList.length;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keywordtype">int</span> extraX = xRadius*(nTasks-1);        <span class="comment">//out-of-roi margin that has to be processed for next steps</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordtype">int</span> extraY = yRadius*nTasks;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="keywordflow">if</span> (preProcess &gt; 0) {</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            extraX += xRadius;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="keywordflow">if</span> (xRadius&gt;0 &amp;&amp; yRadius&gt;0) {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                filterFloat(<a class="code" href="namespacePython__Animation.html#a2a7a33c109b139af98d86e4041e25dac">ip</a>, preProcess, 1, <span class="keyword">true</span>, extraX, extraY+1, maxThreads);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                filterFloat(<a class="code" href="namespacePython__Animation.html#a2a7a33c109b139af98d86e4041e25dac">ip</a>, preProcess, 1, <span class="keyword">false</span>, extraX, extraY, maxThreads);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                extraY++;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (xRadius&gt;0) {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                filterFloat(<a class="code" href="namespacePython__Animation.html#a2a7a33c109b139af98d86e4041e25dac">ip</a>, preProcess, 2, <span class="keyword">true</span>, extraX, extraY, maxThreads);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (yRadius&gt;0) {</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                filterFloat(<a class="code" href="namespacePython__Animation.html#a2a7a33c109b139af98d86e4041e25dac">ip</a>, preProcess, 2, <span class="keyword">false</span>, extraX, extraY, maxThreads);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            }</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        }</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iTask=0; iTask&lt;nTasks; iTask++) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            <span class="keywordflow">if</span> (xRadius&gt;0)</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                filterFloat(<a class="code" href="namespacePython__Animation.html#a2a7a33c109b139af98d86e4041e25dac">ip</a>, taskList[iTask], xRadius, <span class="keyword">true</span>, xRadius*(nTasks-iTask-1), yRadius*(nTasks-iTask), maxThreads);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            <span class="keywordflow">if</span> (yRadius&gt;0)</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                filterFloat(<a class="code" href="namespacePython__Animation.html#a2a7a33c109b139af98d86e4041e25dac">ip</a>, taskList[iTask], yRadius, <span class="keyword">false</span>, xRadius*(nTasks-iTask-1), yRadius*(nTasks-iTask-1), maxThreads);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classThread.html">Thread</a>.currentThread().isInterrupted()) <span class="keywordflow">return</span>; <span class="comment">// interruption for new parameters during preview?</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        }</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">if</span> (subtract) {</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="keywordtype">float</span>[] pixels = (<span class="keywordtype">float</span>[])<a class="code" href="namespacePython__Animation.html#a2a7a33c109b139af98d86e4041e25dac">ip</a>.getPixels();</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <span class="keywordtype">float</span>[] snapPixels = (<span class="keywordtype">float</span>[])<a class="code" href="namespacePython__Animation.html#a2a7a33c109b139af98d86e4041e25dac">ip</a>.getSnapshotPixels();</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            <span class="keywordtype">float</span> fOffset = (float)offset[impType];</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="numerical__recipes_8cpp.html#ad919bbce6f061400a0bc5231a9cd1621">y</a>=roiRect.y; <a class="code" href="numerical__recipes_8cpp.html#ad919bbce6f061400a0bc5231a9cd1621">y</a>&lt;roiRect.y+roiRect.height; <a class="code" href="numerical__recipes_8cpp.html#ad919bbce6f061400a0bc5231a9cd1621">y</a>++)</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="numerical__recipes_8cpp.html#ab81d9253b246f09be9999505d515d517">x</a>=roiRect.x, p=<a class="code" href="numerical__recipes_8cpp.html#ab81d9253b246f09be9999505d515d517">x</a>+<a class="code" href="numerical__recipes_8cpp.html#ad919bbce6f061400a0bc5231a9cd1621">y</a>*width; <a class="code" href="numerical__recipes_8cpp.html#ab81d9253b246f09be9999505d515d517">x</a>&lt;roiRect.x+roiRect.width; <a class="code" href="numerical__recipes_8cpp.html#ab81d9253b246f09be9999505d515d517">x</a>++,p++)</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                    pixels[p] = snapPixels[p] - pixels[p] + fOffset;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classThread.html">Thread</a>.currentThread().isInterrupted()) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="keywordflow">if</span> (roiRect.height!=height || roiRect.width!=width)</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            resetOutOfRoi(<a class="code" href="namespacePython__Animation.html#a2a7a33c109b139af98d86e4041e25dac">ip</a>, extraX, extraY); <span class="comment">// reset out-of-Rectangle pixels above and below roi</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        showProgress(1.0);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div><div class="ttc" id="numerical__recipes_8cpp_html_ad919bbce6f061400a0bc5231a9cd1621"><div class="ttname"><a href="numerical__recipes_8cpp.html#ad919bbce6f061400a0bc5231a9cd1621">y</a></div><div class="ttdeci">static double * y</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l08506">numerical_recipes.cpp:8506</a></div></div>
<div class="ttc" id="namespacePython__Animation_html_a2a7a33c109b139af98d86e4041e25dac"><div class="ttname"><a href="namespacePython__Animation.html#a2a7a33c109b139af98d86e4041e25dac">Python_Animation.ip</a></div><div class="ttdeci">ip</div><div class="ttdef"><b>Definition:</b> <a href="Python__Animation_8py_source.html#l00011">Python_Animation.py:11</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_ab81d9253b246f09be9999505d515d517"><div class="ttname"><a href="numerical__recipes_8cpp.html#ab81d9253b246f09be9999505d515d517">x</a></div><div class="ttdeci">doublereal * x</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02247">numerical_recipes.cpp:2247</a></div></div>
<div class="ttc" id="classThread_html"><div class="ttname"><a href="classThread.html">Thread</a></div><div class="ttdef"><b>Definition:</b> <a href="xmipp__threads_8h_source.html#l00192">xmipp_threads.h:192</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8f6ea2d60cbafdb750b12a271fe81bc2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Fast_Filters.setNPasses </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nPasses</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This method is called by ImageJ to set the number of calls to run(ip) corresponding to 100% of the progress bar </p>

<p>Definition at line <a class="el" href="Fast__Filters_8java_source.html#l00297">297</a> of file <a class="el" href="Fast__Filters_8java_source.html">Fast_Filters.java</a>.</p>
<div class="fragment"><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                                         {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="keywordflow">if</span> (xRadius&gt;0 &amp;&amp; yRadius&gt;0) nPasses *= 2;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        this.nPasses = nPasses * taskLists[type].length;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        pass = 0;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    }</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0de8201d31b1865dfd75a7ae3d94bac6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Fast_Filters.setup </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="xmipp__strings_8h.html#afbeda3fd1bdc8c37d01bdf9f5c8274ff">String</a>&#160;</td>
          <td class="paramname"><em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ImagePlus&#160;</td>
          <td class="paramname"><em>imp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This method is called by ImageJ for initialization. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arg</td><td>Unused here. For plugins in a .jar file this argument string can be specified in the plugins.config file of the .jar archive. </td></tr>
    <tr><td class="paramname">imp</td><td>The ImagePlus containing the image (or stack) to process. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The method returns flags (i.e., a bit mask) specifying the capabilities (supported formats, etc.) and needs of the filter. See PlugInFilter.java and ExtendedPlugInFilter in the ImageJ sources for details. </dd></dl>

<p>Definition at line <a class="el" href="Fast__Filters_8java_source.html#l00158">158</a> of file <a class="el" href="Fast__Filters_8java_source.html">Fast_Filters.java</a>.</p>
<div class="fragment"><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                                                {</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordflow">if</span> (IJ.versionLessThan(<span class="stringliteral">&quot;1.38x&quot;</span>))        <span class="comment">// generates an error message for older versions</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            <span class="keywordflow">return</span> DONE;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">return</span> flags;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1bb1a74550e0434ee3dc11609452cfad"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int Fast_Filters.showDialog </td>
          <td>(</td>
          <td class="paramtype">ImagePlus&#160;</td>
          <td class="paramname"><em>imp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="xmipp__strings_8h.html#afbeda3fd1bdc8c37d01bdf9f5c8274ff">String</a>&#160;</td>
          <td class="paramname"><em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PlugInFilterRunner&#160;</td>
          <td class="paramname"><em>pfr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Fast__Filters_8java_source.html#l00165">165</a> of file <a class="el" href="Fast__Filters_8java_source.html">Fast_Filters.java</a>.</p>
<div class="fragment"><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                                                                                 {</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        impType = <a class="code" href="namespacePython__Animation.html#ad7bc8f5b3fa78a095333aecb0a297772">imp</a>.getType();</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordtype">int</span> digits = (impType == ImagePlus.GRAY32) ? 2 : 0;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        GenericDialog gd = <span class="keyword">new</span> GenericDialog(command+<span class="stringliteral">&quot;...&quot;</span>);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        gd.addChoice(<span class="stringliteral">&quot;Filter Type&quot;</span>, TYPES, TYPES[type]);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        gd.addNumericField(<span class="stringliteral">&quot;x Radius&quot;</span>, xRadius, 0);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        gd.addNumericField(<span class="stringliteral">&quot;y Radius&quot;</span>, yRadius, 0);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        gd.addCheckbox(<span class="stringliteral">&quot;Link x &amp; y&quot;</span>, linkXY);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        gd.addChoice(<span class="stringliteral">&quot;Preprocessing&quot;</span>, PREPROCESSES, PREPROCESSES[preProcess]);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        gd.addCheckbox(<span class="stringliteral">&quot;Subtract Filtered&quot;</span>, subtract);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        gd.addNumericField(<span class="stringliteral">&quot;Offset (subtract only)&quot;</span>, offset[impType], digits);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        gd.addPreviewCheckbox(pfr);             <span class="comment">// passing pfr makes the filter ready for preview</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        gd.addDialogListener(<span class="keyword">this</span>);             <span class="comment">// the DialogItemChanged method will be called on user input</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        gd.showDialog();                        <span class="comment">// display the dialog; preview runs in the background now</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">if</span> (gd.wasCanceled()) <span class="keywordflow">return</span> DONE;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        IJ.register(this.getClass());           <span class="comment">// protect static class variables (filter parameters) from garbage collection</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        Runtime.getRuntime().availableProcessors();</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        flags = IJ.setupDialog(<a class="code" href="namespacePython__Animation.html#ad7bc8f5b3fa78a095333aecb0a297772">imp</a>, flags);     <span class="comment">// ask whether to process all slices of stack (if a stack)</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="comment">// parallel processing of stacks is faster than prallel filtering of lines of one image.</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keywordflow">if</span> ((flags&amp;DOES_STACKS)!=0) {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            <span class="keywordtype">long</span> bytesPerPixelNeeded = impType==ImagePlus.GRAY32 ? 4 : 8; <span class="comment">// for conversion to float and snapshot</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            <span class="keywordtype">long</span> bytesParallelNeeded = <a class="code" href="namespacePython__Animation.html#ad7bc8f5b3fa78a095333aecb0a297772">imp</a>.getWidth()*<a class="code" href="namespacePython__Animation.html#ad7bc8f5b3fa78a095333aecb0a297772">imp</a>.getHeight()*bytesPerPixelNeeded*Prefs.getThreads();</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            <span class="keywordtype">long</span> <a class="code" href="group__MemoryManaging.html#ga0637340b7f5fdc99aad028c493ae42f6">freeMemory</a> = Runtime.getRuntime().freeMemory();</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            <span class="keywordflow">if</span> (freeMemory &gt; bytesParallelNeeded*11/10) { <span class="comment">//enough memory for stack parallelization?</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                flags |= PARALLELIZE_STACKS;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                maxThreads = Math.max((<span class="keywordtype">int</span>)Math.ceil(1.1*maxThreads/<a class="code" href="namespacePython__Animation.html#ad7bc8f5b3fa78a095333aecb0a297772">imp</a>.getStackSize()), 1); <span class="comment">//fewer threads for each image</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            }</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            <span class="comment">//IJ.log(&quot;needed/free=&quot;+(bytesParallelNeeded/(1024L*1024L))+&quot;/&quot;+(freeMemory/(1024L*1024L))+&quot;M&quot;);</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            <span class="comment">//IJ.log(&quot;StackParall=&quot;+((flags&amp;PARALLELIZE_STACKS)!=0)+&quot; maxThreads=&quot;+maxThreads);</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        }</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">return</span> flags;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div><div class="ttc" id="namespacePython__Animation_html_ad7bc8f5b3fa78a095333aecb0a297772"><div class="ttname"><a href="namespacePython__Animation.html#ad7bc8f5b3fa78a095333aecb0a297772">Python_Animation.imp</a></div><div class="ttdeci">imp</div><div class="ttdef"><b>Definition:</b> <a href="Python__Animation_8py_source.html#l00006">Python_Animation.py:6</a></div></div>
<div class="ttc" id="group__MemoryManaging_html_ga0637340b7f5fdc99aad028c493ae42f6"><div class="ttname"><a href="group__MemoryManaging.html#ga0637340b7f5fdc99aad028c493ae42f6">freeMemory</a></div><div class="ttdeci">int freeMemory(void *ptr, size_t memsize)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__memory_8cpp_source.html#l00050">xmipp_memory.cpp:50</a></div></div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>xmippViz/external/imagej/plugins/Filters/<a class="el" href="Fast__Filters_8java_source.html">Fast_Filters.java</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
