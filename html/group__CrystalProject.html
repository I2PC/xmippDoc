<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Xmipp: project_crystal (Project crystals)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xmipp_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Xmipp
   &#160;<span id="projectnumber">v20.07</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">project_crystal (Project crystals)</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCrystal__Projection__Parameters.html">Crystal_Projection_Parameters</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga4f4b4e716de6846ab83a8e9a86b99f1f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CrystalProject.html#ga4f4b4e716de6846ab83a8e9a86b99f1f">project_crystal</a> (<a class="el" href="classPhantom.html">Phantom</a> &amp;phantom, <a class="el" href="classProjection.html">Projection</a> &amp;P, const <a class="el" href="classParametersProjection.html">ParametersProjection</a> &amp;<a class="el" href="mpi__classify__CL2D_8cpp.html#a831c08adbb8230fd6a60f4a130923a19">prm</a>, <a class="el" href="classPROJECT__Side__Info.html">PROJECT_Side_Info</a> &amp;side, const <a class="el" href="classCrystal__Projection__Parameters.html">Crystal_Projection_Parameters</a> &amp;prm_crystal, float rot, float tilt, float psi)</td></tr>
<tr class="separator:ga4f4b4e716de6846ab83a8e9a86b99f1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga61b60c54d9a660dc6cc46d2537c66818"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CrystalProject.html#ga61b60c54d9a660dc6cc46d2537c66818">find_crystal_limits</a> (const <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;proj_corner1, const <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;proj_corner2, const <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;corner1, const <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;corner2, const <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;<a class="el" href="numerical__recipes_8cpp.html#af2a333b1670df64a88d3a2f22210d155">a</a>, const <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;<a class="el" href="numerical__recipes_8cpp.html#af090b2fbbd2916bfb2e493c5162969d6">b</a>, int &amp;iamin, int &amp;iamax, int &amp;ibmin, int &amp;ibmax)</td></tr>
<tr class="separator:ga61b60c54d9a660dc6cc46d2537c66818"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga448fda564f5728e14d69ab63a551b040"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CrystalProject.html#ga448fda564f5728e14d69ab63a551b040">move_following_spiral</a> (<a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;r, const <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;visited)</td></tr>
<tr class="separator:ga448fda564f5728e14d69ab63a551b040"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5be7b257942baac7c2063646f96731a7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CrystalProject.html#ga5be7b257942baac7c2063646f96731a7">fill_cell_positions</a> (<a class="el" href="classProjection.html">Projection</a> &amp;P, <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;aproj, <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;bproj, <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;aprojd, <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;bprojd, <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;corner1, <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;corner2, const <a class="el" href="classCrystal__Projection__Parameters.html">Crystal_Projection_Parameters</a> &amp;prm_crystal, <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;cell_shiftX, <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;cell_shiftY, <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;cell_shiftZ, <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;cell_inside, <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;exp_shifts_matrix_X, <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;exp_shifts_matrix_Y, <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;exp_shifts_matrix_Z)</td></tr>
<tr class="separator:ga5be7b257942baac7c2063646f96731a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8c7d56c41faa027395a0303148da3a52"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CrystalProject.html#ga8c7d56c41faa027395a0303148da3a52">init_shift_matrix</a> (const <a class="el" href="classCrystal__Projection__Parameters.html">Crystal_Projection_Parameters</a> &amp;prm_crystal, <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;cell_inside, <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;exp_shifts_matrix_X, <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;exp_shifts_matrix_Y, <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;exp_shifts_matrix_Z, <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;exp_normal_shifts_matrix_X, <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;exp_normal_shifts_matrix_Y, <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;exp_normal_shifts_matrix_Z, double param_file_scale)</td></tr>
<tr class="separator:ga8c7d56c41faa027395a0303148da3a52"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga5be7b257942baac7c2063646f96731a7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fill_cell_positions </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classProjection.html">Projection</a> &amp;&#160;</td>
          <td class="paramname"><em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>aproj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>bproj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>aprojd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>bprojd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>corner1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>corner2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classCrystal__Projection__Parameters.html">Crystal_Projection_Parameters</a> &amp;&#160;</td>
          <td class="paramname"><em>prm_crystal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>cell_shiftX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>cell_shiftY</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>cell_shiftZ</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>cell_inside</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>exp_shifts_matrix_X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>exp_shifts_matrix_Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>exp_shifts_matrix_Z</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Fill cell positions. This function returns the random shifts corresponding to all cells that can be seen in a projection using the lattice vectors given. It also returns a matrix telling if a lattice combination falls inside the projection or not. You must provide the vectors in the undeformed space (for orthogonal projections), the lattice vectors in the deformed space (if it is not deformed, supply the same as in the undeformed), and the corners of the projection of a single cell. Corners must be the unit cell corners in the deformed space. Output shifts are in the deformed space. </p>

<p>Definition at line <a class="el" href="project__crystal_8cpp_source.html#l00715">715</a> of file <a class="el" href="project__crystal_8cpp_source.html">project_crystal.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;{</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="comment">// Compute crystal limits</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordtype">int</span> iamin, iamax, ibmin, ibmax;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <a class="code" href="group__CrystalProject.html#ga61b60c54d9a660dc6cc46d2537c66818">find_crystal_limits</a>(<a class="code" href="group__Vectors.html#ga97ccb86b4c568b2271da21552034d504">vectorR2</a>(<a class="code" href="group__MultidimensionalArrays.html#gad48b8b757cdd227ab33a016449982592">STARTINGX</a>(P()), <a class="code" href="group__MultidimensionalArrays.html#ga6557f9334712651f0c240ec8bf03a8d8">STARTINGY</a>(P())),</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                        <a class="code" href="group__Vectors.html#ga97ccb86b4c568b2271da21552034d504">vectorR2</a>(<a class="code" href="group__MultidimensionalArrays.html#ga494f0325c3fd49f368cad0e45e6a386a">FINISHINGX</a>(P()), <a class="code" href="group__MultidimensionalArrays.html#gab21d2b58d5f934e687856c15fb59acf5">FINISHINGY</a>(P())),</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                        corner1, corner2, aprojd, bprojd, iamin, iamax, ibmin, ibmax);</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="comment">//#define DEBUG</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    P().printShape();</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    std::cout &lt;&lt; std::endl;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;aprojd=&quot;</span> &lt;&lt; aproj.<a class="code" href="classMatrix1D.html#a8849e36416cde2a57914953a815d4b43">transpose</a>() &lt;&lt; std::endl;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;bprojd=&quot;</span> &lt;&lt; bproj.<a class="code" href="classMatrix1D.html#a8849e36416cde2a57914953a815d4b43">transpose</a>() &lt;&lt; std::endl;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    std::cout &lt;&lt; iamin &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; iamax &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; ibmin &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; ibmax &lt;&lt; std::endl;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="comment">// Compute weight table in the undeformed space</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;double&gt;</a> weight(3, 3);</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#gad48b8b757cdd227ab33a016449982592">STARTINGX</a>(weight) = -1;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#ga6557f9334712651f0c240ec8bf03a8d8">STARTINGY</a>(weight) = -1;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    weight(0, 0) = 0;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    weight(-1, 0) = weight(1, 0) = 1 / aproj.<a class="code" href="classMatrix1D.html#a9ee6afb32720ca26450038def994af96">module</a>();</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    weight(0, -1) = weight(0, 1) = 1 / bproj.<a class="code" href="classMatrix1D.html#a9ee6afb32720ca26450038def994af96">module</a>();</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    weight(-1, 1) = weight(1, -1) = 1 / (aproj - bproj).module();</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    weight(-1, -1) = weight(1, 1) = 1 / (aproj + bproj).module();</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="comment">// Resize all needed matrices</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    cell_shiftX.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>(ibmax - ibmin + 1, iamax - iamin + 1);</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#gad48b8b757cdd227ab33a016449982592">STARTINGX</a>(cell_shiftX) = iamin;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#ga6557f9334712651f0c240ec8bf03a8d8">STARTINGY</a>(cell_shiftX) = ibmin;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    cell_shiftY.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>(cell_shiftX);</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="comment">//in this routine cell_shiftZ is set to zero and nothing else</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    cell_shiftZ.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>(cell_shiftX);</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    cell_inside.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>(ibmax - ibmin + 1, iamax - iamin + 1);</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#gad48b8b757cdd227ab33a016449982592">STARTINGX</a>(cell_inside) = iamin;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#ga6557f9334712651f0c240ec8bf03a8d8">STARTINGY</a>(cell_inside) = ibmin;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="comment">// Visited has got one cell more than the rest in all directions</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;int&gt;</a> visited;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="keywordtype">int</span> visited_size = <a class="code" href="group__Macros.html#gae0a4180e923e3ffca3989e20e441aa3c">XMIPP_MAX</a>(iamax - iamin + 1, ibmax - ibmin + 1) + 2;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    visited.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>(visited_size, visited_size);</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#gad48b8b757cdd227ab33a016449982592">STARTINGX</a>(visited) = iamin - (visited_size - (iamax - iamin + 1) + 1) / 2;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#ga6557f9334712651f0c240ec8bf03a8d8">STARTINGY</a>(visited) = ibmin - (visited_size - (ibmax - ibmin + 1) + 1) / 2;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;weight=&quot;</span> &lt;&lt; weight;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;cell_shiftX shape &quot;</span>;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    cell_shiftX.<a class="code" href="classMultidimArrayBase.html#abc7b530b6ceca036c864f9925332ff5f">printShape</a>();</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    std::cout &lt;&lt; std::endl;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;cell_inside shape &quot;</span>;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    cell_inside.<a class="code" href="classMultidimArrayBase.html#abc7b530b6ceca036c864f9925332ff5f">printShape</a>();</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    std::cout &lt;&lt; std::endl;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;visited shape &quot;</span>;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    visited.printShape();</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    std::cout &lt;&lt; std::endl;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="comment">// Perform the crystal deformation starting in the middle of the</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="comment">// crystal and going in spirals until the four corners are visited</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="comment">// we find one corner</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> r(2), ri(2), sh(2);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    r.initZeros();</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="preprocessor">#define INDEX(r) (int)YY(r),(int)XX(r)</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keywordflow">while</span> (!visited.isCorner(r))</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    {</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        visited(<a class="code" href="project__crystal_8cpp.html#a46f28c1765c21dd72a340293321a3832">INDEX</a>(r)) = <span class="keyword">true</span>;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;   Visiting &quot;</span> &lt;&lt; r.transpose() &lt;&lt; std::endl;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="comment">// Weight is computed in the undeformed space</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="keywordtype">double</span> total_weight = 0;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <span class="keywordtype">double</span> total_shiftX = 0;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="keywordtype">double</span> total_shiftY = 0;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(sh) = -1; <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(sh) &lt;= 1; <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(sh)++)</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(sh) = -1; <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(sh) &lt;= 1; <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(sh)++)</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            {</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                <a class="code" href="group__Vectors.html#ga43b95e9bbf36d0aff1e421a35e113682">V2_PLUS_V2</a>(ri, r, sh);</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                <span class="keywordflow">if</span> (!cell_shiftX.<a class="code" href="classMultidimArrayBase.html#a47caddfc3c8c1425f9eaae5bde699558">outside</a>(ri))</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                {</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                    total_weight += weight(<a class="code" href="project__crystal_8cpp.html#a46f28c1765c21dd72a340293321a3832">INDEX</a>(sh));</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                    total_shiftX += weight(<a class="code" href="project__crystal_8cpp.html#a46f28c1765c21dd72a340293321a3832">INDEX</a>(sh)) * cell_shiftX(<a class="code" href="project__crystal_8cpp.html#a46f28c1765c21dd72a340293321a3832">INDEX</a>(ri));</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                    total_shiftY += weight(<a class="code" href="project__crystal_8cpp.html#a46f28c1765c21dd72a340293321a3832">INDEX</a>(sh)) * cell_shiftY(<a class="code" href="project__crystal_8cpp.html#a46f28c1765c21dd72a340293321a3832">INDEX</a>(ri));</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                }</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            }</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="keywordflow">if</span> (total_weight == 0)</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            total_weight = 1;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <span class="keywordflow">if</span> (!cell_shiftX.<a class="code" href="classMultidimArrayBase.html#a47caddfc3c8c1425f9eaae5bde699558">outside</a>(r))</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        {</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            cell_shiftX(<a class="code" href="project__crystal_8cpp.html#a46f28c1765c21dd72a340293321a3832">INDEX</a>(r)) = <a class="code" href="group__GeneralFunctions.html#gaa9eace3a9deaad3f11f57a37f8787e9b">rnd_gaus</a>(prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#a01809925df18b24e8ee80be9a9bdf7ad">Nshift_avg</a>,</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                                             prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#a254fb1e90467a5177ee4bbbe58754d40">Nshift_dev</a>) + total_shiftX / total_weight;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            cell_shiftY(<a class="code" href="project__crystal_8cpp.html#a46f28c1765c21dd72a340293321a3832">INDEX</a>(r)) = <a class="code" href="group__GeneralFunctions.html#gaa9eace3a9deaad3f11f57a37f8787e9b">rnd_gaus</a>(prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#a01809925df18b24e8ee80be9a9bdf7ad">Nshift_avg</a>,</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                                             prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#a254fb1e90467a5177ee4bbbe58754d40">Nshift_dev</a>) + total_shiftY / total_weight;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        }</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <span class="comment">// Move to next position</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <a class="code" href="group__CrystalProject.html#ga448fda564f5728e14d69ab63a551b040">move_following_spiral</a>(r, visited);</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    }</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Cell shift X without absolute displacements&quot;</span> &lt;&lt; cell_shiftX;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Cell shift Y without absolute displacements&quot;</span> &lt;&lt; cell_shiftY;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="comment">// The previous shifts are relative to the final position, now</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="comment">// express the real final position</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a>(visited)</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    {</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        <span class="keywordflow">if</span> (!cell_shiftX.outside(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>))</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        {</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            <span class="comment">// Move to final position</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            cell_shiftX(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) += <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> * <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(aprojd) + <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> * <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(bprojd);</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            cell_shiftY(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) += <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> * <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(aprojd) + <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> * <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(bprojd);</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            <span class="comment">// Check if there is intersection</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> auxcorner1(2), auxcorner2(2);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(auxcorner1) = <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(corner1) + cell_shiftX(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;            <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(auxcorner1) = <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(corner1) + cell_shiftY(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;            <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(auxcorner2) = <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(corner2) + cell_shiftX(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;            <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(auxcorner2) = <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(corner2) + cell_shiftY(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;            cell_inside(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) =</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                (<a class="code" href="group__Macros.html#gae0a4180e923e3ffca3989e20e441aa3c">XMIPP_MAX</a>(<a class="code" href="group__MultidimensionalArrays.html#ga6557f9334712651f0c240ec8bf03a8d8">STARTINGY</a> (P()),<a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(auxcorner1))&lt;=</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                 <a class="code" href="group__Macros.html#gac9ae6a207f10c821b06a8c0df153a7d5">XMIPP_MIN</a>(<a class="code" href="group__MultidimensionalArrays.html#gab21d2b58d5f934e687856c15fb59acf5">FINISHINGY</a>(P()),<a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(auxcorner2))) &amp;&amp;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;                (<a class="code" href="group__Macros.html#gae0a4180e923e3ffca3989e20e441aa3c">XMIPP_MAX</a>(<a class="code" href="group__MultidimensionalArrays.html#gad48b8b757cdd227ab33a016449982592">STARTINGX</a> (P()),<a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(auxcorner1))&lt;=</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                 <a class="code" href="group__Macros.html#gac9ae6a207f10c821b06a8c0df153a7d5">XMIPP_MIN</a>(<a class="code" href="group__MultidimensionalArrays.html#ga494f0325c3fd49f368cad0e45e6a386a">FINISHINGX</a>(P()),<a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(auxcorner2)));</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            <span class="comment">//TEMPORAL FIX FOR PHANTOM AS BIG AS THE WHOLE CRYSTAL</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            cell_inside(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) = 1;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;            <span class="comment">//ROBERTO</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;(i,j)=(&quot;</span> &lt;&lt; <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;   Projection shape &quot;</span>;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;            P().printShape();</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;            std::cout &lt;&lt; std::endl;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;   AuxCorner1 &quot;</span> &lt;&lt; auxcorner1.transpose() &lt;&lt; std::endl</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;   Origin     &quot;</span> &lt;&lt; cell_shiftX(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, j) &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            &lt;&lt; cell_shiftY(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, j) &lt;&lt; std::endl</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;   AuxCorner2 &quot;</span> &lt;&lt; auxcorner2.transpose() &lt;&lt; std::endl;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;   Inside= &quot;</span> &lt;&lt; cell_inside(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, j) &lt;&lt; std::endl;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        }</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    }</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;}</div><div class="ttc" id="classMatrix1D_html_a8849e36416cde2a57914953a815d4b43"><div class="ttname"><a href="classMatrix1D.html#a8849e36416cde2a57914953a815d4b43">Matrix1D::transpose</a></div><div class="ttdeci">Matrix1D&lt; T &gt; transpose() const </div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l01466">matrix1d.h:1466</a></div></div>
<div class="ttc" id="group__Macros_html_gae0a4180e923e3ffca3989e20e441aa3c"><div class="ttname"><a href="group__Macros.html#gae0a4180e923e3ffca3989e20e441aa3c">XMIPP_MAX</a></div><div class="ttdeci">#define XMIPP_MAX(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00193">xmipp_macros.h:193</a></div></div>
<div class="ttc" id="classMultidimArray_html"><div class="ttname"><a href="classMultidimArray.html">MultidimArray&lt; double &gt;</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga494f0325c3fd49f368cad0e45e6a386a"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga494f0325c3fd49f368cad0e45e6a386a">FINISHINGX</a></div><div class="ttdeci">#define FINISHINGX(v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00065">multidim_array.h:65</a></div></div>
<div class="ttc" id="group__Vectors_html_ga43b95e9bbf36d0aff1e421a35e113682"><div class="ttname"><a href="group__Vectors.html#ga43b95e9bbf36d0aff1e421a35e113682">V2_PLUS_V2</a></div><div class="ttdeci">#define V2_PLUS_V2(a, b, c)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00137">matrix1d.h:137</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">#define i</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02510">numerical_recipes.cpp:2510</a></div></div>
<div class="ttc" id="group__CrystalProject_html_ga61b60c54d9a660dc6cc46d2537c66818"><div class="ttname"><a href="group__CrystalProject.html#ga61b60c54d9a660dc6cc46d2537c66818">find_crystal_limits</a></div><div class="ttdeci">void find_crystal_limits(const Matrix1D&lt; double &gt; &amp;proj_corner1, const Matrix1D&lt; double &gt; &amp;proj_corner2, const Matrix1D&lt; double &gt; &amp;cell_corner1, const Matrix1D&lt; double &gt; &amp;cell_corner2, const Matrix1D&lt; double &gt; &amp;a, const Matrix1D&lt; double &gt; &amp;b, int &amp;iamin, int &amp;iamax, int &amp;ibmin, int &amp;ibmax)</div><div class="ttdef"><b>Definition:</b> <a href="project__crystal_8cpp_source.html#l00499">project_crystal.cpp:499</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_a46f28c1765c21dd72a340293321a3832"><div class="ttname"><a href="project__crystal_8cpp.html#a46f28c1765c21dd72a340293321a3832">INDEX</a></div><div class="ttdeci">#define INDEX(r)</div></div>
<div class="ttc" id="classMultidimArrayBase_html_a47caddfc3c8c1425f9eaae5bde699558"><div class="ttname"><a href="classMultidimArrayBase.html#a47caddfc3c8c1425f9eaae5bde699558">MultidimArrayBase::outside</a></div><div class="ttdeci">bool outside(int k, int i, int j) const </div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l01054">multidim_array.h:1054</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga6557f9334712651f0c240ec8bf03a8d8"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga6557f9334712651f0c240ec8bf03a8d8">STARTINGY</a></div><div class="ttdeci">#define STARTINGY(v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00069">multidim_array.h:69</a></div></div>
<div class="ttc" id="group__Vectors_html_ga7dce99001bf2a5ec705503346b6fec85"><div class="ttname"><a href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a></div><div class="ttdeci">#define XX(v)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00088">matrix1d.h:88</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga7fa7d580ab43d192c7933abd008bc756"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a></div><div class="ttdeci">#define FOR_ALL_ELEMENTS_IN_ARRAY2D(m)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00400">multidim_array.h:400</a></div></div>
<div class="ttc" id="classMultidimArrayBase_html_abc7b530b6ceca036c864f9925332ff5f"><div class="ttname"><a href="classMultidimArrayBase.html#abc7b530b6ceca036c864f9925332ff5f">MultidimArrayBase::printShape</a></div><div class="ttdeci">void printShape(std::ostream &amp;out=std::cout) const </div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8cpp_source.html#l00281">multidim_array.cpp:281</a></div></div>
<div class="ttc" id="classCrystal__Projection__Parameters_html_a254fb1e90467a5177ee4bbbe58754d40"><div class="ttname"><a href="classCrystal__Projection__Parameters.html#a254fb1e90467a5177ee4bbbe58754d40">Crystal_Projection_Parameters::Nshift_dev</a></div><div class="ttdeci">double Nshift_dev</div><div class="ttdoc">Standard deviation of the magnitude shift. </div><div class="ttdef"><b>Definition:</b> <a href="project__crystal_8h_source.html#l00072">project_crystal.h:72</a></div></div>
<div class="ttc" id="group__Vectors_html_ga97ccb86b4c568b2271da21552034d504"><div class="ttname"><a href="group__Vectors.html#ga97ccb86b4c568b2271da21552034d504">vectorR2</a></div><div class="ttdeci">Matrix1D&lt; double &gt; vectorR2(double x, double y)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8cpp_source.html#l00028">matrix1d.cpp:28</a></div></div>
<div class="ttc" id="group__Macros_html_gac9ae6a207f10c821b06a8c0df153a7d5"><div class="ttname"><a href="group__Macros.html#gac9ae6a207f10c821b06a8c0df153a7d5">XMIPP_MIN</a></div><div class="ttdeci">#define XMIPP_MIN(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00181">xmipp_macros.h:181</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_gad48b8b757cdd227ab33a016449982592"><div class="ttname"><a href="group__MultidimensionalArrays.html#gad48b8b757cdd227ab33a016449982592">STARTINGX</a></div><div class="ttdeci">#define STARTINGX(v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00061">multidim_array.h:61</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_aae82a1338cf72eb9a1cc7043f569537e"><div class="ttname"><a href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a></div><div class="ttdeci">#define j</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02510">numerical_recipes.cpp:2510</a></div></div>
<div class="ttc" id="group__Vectors_html_ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f"><div class="ttname"><a href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a></div><div class="ttdeci">#define YY(v)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00096">matrix1d.h:96</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_gab21d2b58d5f934e687856c15fb59acf5"><div class="ttname"><a href="group__MultidimensionalArrays.html#gab21d2b58d5f934e687856c15fb59acf5">FINISHINGY</a></div><div class="ttdeci">#define FINISHINGY(v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00073">multidim_array.h:73</a></div></div>
<div class="ttc" id="group__CrystalProject_html_ga448fda564f5728e14d69ab63a551b040"><div class="ttname"><a href="group__CrystalProject.html#ga448fda564f5728e14d69ab63a551b040">move_following_spiral</a></div><div class="ttdeci">void move_following_spiral(Matrix1D&lt; double &gt; &amp;r, const MultidimArray&lt; int &gt; &amp;visited)</div><div class="ttdef"><b>Definition:</b> <a href="project__crystal_8cpp_source.html#l00589">project_crystal.cpp:589</a></div></div>
<div class="ttc" id="classMatrix1D_html"><div class="ttname"><a href="classMatrix1D.html">Matrix1D&lt; double &gt;</a></div></div>
<div class="ttc" id="classMatrix1D_html_a9ee6afb32720ca26450038def994af96"><div class="ttname"><a href="classMatrix1D.html#a9ee6afb32720ca26450038def994af96">Matrix1D::module</a></div><div class="ttdeci">double module() const </div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l01578">matrix1d.h:1578</a></div></div>
<div class="ttc" id="group__GeneralFunctions_html_gaa9eace3a9deaad3f11f57a37f8787e9b"><div class="ttname"><a href="group__GeneralFunctions.html#gaa9eace3a9deaad3f11f57a37f8787e9b">rnd_gaus</a></div><div class="ttdeci">double rnd_gaus()</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__funcs_8cpp_source.html#l00457">xmipp_funcs.cpp:457</a></div></div>
<div class="ttc" id="classMultidimArray_html_a738eab72b6bd48a98d78745bc24f36bd"><div class="ttname"><a href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">MultidimArray::initZeros</a></div><div class="ttdeci">void initZeros(const MultidimArray&lt; T1 &gt; &amp;op)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l04327">multidim_array.h:4327</a></div></div>
<div class="ttc" id="classCrystal__Projection__Parameters_html_a01809925df18b24e8ee80be9a9bdf7ad"><div class="ttname"><a href="classCrystal__Projection__Parameters.html#a01809925df18b24e8ee80be9a9bdf7ad">Crystal_Projection_Parameters::Nshift_avg</a></div><div class="ttdeci">double Nshift_avg</div><div class="ttdoc">Bias to apply to the magnitude shift. </div><div class="ttdef"><b>Definition:</b> <a href="project__crystal_8h_source.html#l00070">project_crystal.h:70</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga61b60c54d9a660dc6cc46d2537c66818"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void find_crystal_limits </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>proj_corner1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>proj_corner2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>corner1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>corner2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>iamin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>iamax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>ibmin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>ibmax</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Find crystal limits. This function returns imin and imax such that imin*v and imax*v are still inside the projection. v is supposed to be in R2. proj_Corner1 and proj_corner2 are the top-left and right-bottom corners of the space to fit (for instance the projection). a and b are the lattice vectors where the unit cell defined by the two cell corners will be copied. iamin, iamax, ibmin, ibmax are the minimum and maximum indexes that you can use with these lattice vectors, unit cell and projection size such that the unit cell intersects the projection. </p>

<p>Definition at line <a class="el" href="project__crystal_8cpp_source.html#l00499">499</a> of file <a class="el" href="project__crystal_8cpp_source.html">project_crystal.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;{</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordflow">if</span> (a.<a class="code" href="classMatrix1D.html#a9ee6afb32720ca26450038def994af96">module</a>() &lt; <a class="code" href="project__crystal_8cpp.html#ad8e5ae9cfb6f06ef4f3c077db87be114">MIN_MODULE</a> || b.<a class="code" href="classMatrix1D.html#a9ee6afb32720ca26450038def994af96">module</a>() &lt; <a class="code" href="project__crystal_8cpp.html#ad8e5ae9cfb6f06ef4f3c077db87be114">MIN_MODULE</a>)</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <a class="code" href="group__ErrorHandling.html#ga4ab7f9b2fd1ec4b9efcfba0c9b33052c">REPORT_ERROR</a>(<a class="code" href="group__ErrorHandling.html#ggab0df38968e4f03a3f1f6d6df0f31f45aa297d00ca1a4aefa6badbbe0f85dbf9fb">ERR_MATRIX_SIZE</a>, <span class="stringliteral">&quot;find_crystal_limits: one of the lattice vectors is &quot;</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                     <span class="stringliteral">&quot;extremely small&quot;</span>);</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="comment">// Compute area to cover</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="project__crystal_8cpp.html#a94ec8a7a5cf5c289d292aef5777c4c14">x0</a> = <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(proj_corner1) + <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(cell_corner1);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="project__crystal_8cpp.html#a0d9521fd31b2e16413d1b78836953d53">y0</a> = <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(proj_corner1) + <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(cell_corner1);</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="project__crystal_8cpp.html#a8f613ddaea2048e3471a1f4f04ba4b79">xF</a> = <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(proj_corner2) + <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(cell_corner2);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="project__crystal_8cpp.html#a132f3924593d07b0a1f55b3f22e92ba6">yF</a> = <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(proj_corner2) + <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(cell_corner2);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="comment">// Initialize</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <a class="code" href="group__Macros.html#ga0714b7b60ab5b804af1c9b124863178e">SPEED_UP_temps01</a>;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <a class="code" href="classMatrix2D.html">Matrix2D&lt;double&gt;</a> A(2, 2), Ainv(2, 2);</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    A.setCol(0, a);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    A.setCol(1, b);</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <a class="code" href="group__Matrices.html#ga94eb0766edba2c7042e6db51141ce02b">M2x2_INV</a>(Ainv, A);</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="comment">//#define DEBUG</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;A&quot;</span> &lt;&lt; A &lt;&lt;std::endl;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;Ainv&quot;</span> &lt;&lt; Ainv &lt;&lt;std::endl;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="preprocessor">#undef DEBUG</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="comment">// Now express each corner in the a,b coordinate system</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> r(2);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <a class="code" href="group__Vectors.html#gaf35071e3863333ef9ff847bb85615bb4">VECTOR_R2</a>(r, x0, y0);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="comment">//#define DEBUG</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;r&quot;</span> &lt;&lt; r &lt;&lt;std::endl;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="preprocessor">#undef DEBUG</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <a class="code" href="group__Matrices.html#gaec08782c566ba3c8c093b909f562e953">M2x2_BY_V2x1</a>(r, Ainv, r);</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    iamin = <a class="code" href="group__Macros.html#ga2f0eecb0f7856721f56faff8f27b0dc1">FLOOR</a>(<a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(r));</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    iamax = <a class="code" href="group__Macros.html#ga4ec18a98c812ab4d498c8111c193aa17">CEIL</a>(<a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(r));</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    ibmin = <a class="code" href="group__Macros.html#ga2f0eecb0f7856721f56faff8f27b0dc1">FLOOR</a>(<a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(r));</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    ibmax = <a class="code" href="group__Macros.html#ga4ec18a98c812ab4d498c8111c193aa17">CEIL</a>(<a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(r));</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="comment">//#define DEBUG</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;r&quot;</span> &lt;&lt; r &lt;&lt;std::endl;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;Ainv&quot;</span> &lt;&lt; Ainv &lt;&lt;std::endl;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;iamin&quot;</span> &lt;&lt; iamin &lt;&lt;std::endl;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;iamax&quot;</span> &lt;&lt; iamax &lt;&lt;std::endl;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;ibmin&quot;</span> &lt;&lt; ibmin &lt;&lt;std::endl;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;ibmax&quot;</span> &lt;&lt; ibmax &lt;&lt;std::endl;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="preprocessor">#undef DEBUG</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="preprocessor">#define CHANGE_COORDS_AND_CHOOSE_CORNERS2D \</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="preprocessor">    M2x2_BY_V2x1(r,Ainv,r); \</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="preprocessor">    iamin=XMIPP_MIN(FLOOR(XX(r)),iamin); iamax=XMIPP_MAX(CEIL(XX(r)),iamax); \</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="preprocessor">    ibmin=XMIPP_MIN(FLOOR(YY(r)),ibmin); ibmax=XMIPP_MAX(CEIL(YY(r)),ibmax);</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <a class="code" href="group__Vectors.html#gaf35071e3863333ef9ff847bb85615bb4">VECTOR_R2</a>(r, x0, yF);</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <a class="code" href="project__crystal_8cpp.html#aa98b8e03fbbbab905c05a31efea4a839">CHANGE_COORDS_AND_CHOOSE_CORNERS2D</a>;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <a class="code" href="group__Vectors.html#gaf35071e3863333ef9ff847bb85615bb4">VECTOR_R2</a>(r, xF, y0);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <a class="code" href="project__crystal_8cpp.html#aa98b8e03fbbbab905c05a31efea4a839">CHANGE_COORDS_AND_CHOOSE_CORNERS2D</a>;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <a class="code" href="group__Vectors.html#gaf35071e3863333ef9ff847bb85615bb4">VECTOR_R2</a>(r, xF, yF);</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <a class="code" href="project__crystal_8cpp.html#aa98b8e03fbbbab905c05a31efea4a839">CHANGE_COORDS_AND_CHOOSE_CORNERS2D</a>;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;}</div><div class="ttc" id="group__Vectors_html_gaf35071e3863333ef9ff847bb85615bb4"><div class="ttname"><a href="group__Vectors.html#gaf35071e3863333ef9ff847bb85615bb4">VECTOR_R2</a></div><div class="ttdeci">#define VECTOR_R2(v, x, y)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00115">matrix1d.h:115</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_a8f613ddaea2048e3471a1f4f04ba4b79"><div class="ttname"><a href="project__crystal_8cpp.html#a8f613ddaea2048e3471a1f4f04ba4b79">xF</a></div><div class="ttdeci">#define xF</div></div>
<div class="ttc" id="group__ErrorHandling_html_ga4ab7f9b2fd1ec4b9efcfba0c9b33052c"><div class="ttname"><a href="group__ErrorHandling.html#ga4ab7f9b2fd1ec4b9efcfba0c9b33052c">REPORT_ERROR</a></div><div class="ttdeci">#define REPORT_ERROR(nerr, ErrormMsg)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__error_8h_source.html#l00238">xmipp_error.h:238</a></div></div>
<div class="ttc" id="group__ErrorHandling_html_ggab0df38968e4f03a3f1f6d6df0f31f45aa297d00ca1a4aefa6badbbe0f85dbf9fb"><div class="ttname"><a href="group__ErrorHandling.html#ggab0df38968e4f03a3f1f6d6df0f31f45aa297d00ca1a4aefa6badbbe0f85dbf9fb">ERR_MATRIX_SIZE</a></div><div class="ttdoc">Problem with matrix size. </div><div class="ttdef"><b>Definition:</b> <a href="xmipp__error_8h_source.html#l00157">xmipp_error.h:157</a></div></div>
<div class="ttc" id="classMatrix2D_html"><div class="ttname"><a href="classMatrix2D.html">Matrix2D&lt; double &gt;</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_a0d9521fd31b2e16413d1b78836953d53"><div class="ttname"><a href="project__crystal_8cpp.html#a0d9521fd31b2e16413d1b78836953d53">y0</a></div><div class="ttdeci">#define y0</div></div>
<div class="ttc" id="group__Macros_html_ga2f0eecb0f7856721f56faff8f27b0dc1"><div class="ttname"><a href="group__Macros.html#ga2f0eecb0f7856721f56faff8f27b0dc1">FLOOR</a></div><div class="ttdeci">#define FLOOR(x)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00240">xmipp_macros.h:240</a></div></div>
<div class="ttc" id="group__Vectors_html_ga7dce99001bf2a5ec705503346b6fec85"><div class="ttname"><a href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a></div><div class="ttdeci">#define XX(v)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00088">matrix1d.h:88</a></div></div>
<div class="ttc" id="group__Matrices_html_gaec08782c566ba3c8c093b909f562e953"><div class="ttname"><a href="group__Matrices.html#gaec08782c566ba3c8c093b909f562e953">M2x2_BY_V2x1</a></div><div class="ttdeci">#define M2x2_BY_V2x1(a, M, b)</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00226">matrix2d.h:226</a></div></div>
<div class="ttc" id="group__Macros_html_ga4ec18a98c812ab4d498c8111c193aa17"><div class="ttname"><a href="group__Macros.html#ga4ec18a98c812ab4d498c8111c193aa17">CEIL</a></div><div class="ttdeci">#define CEIL(x)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00225">xmipp_macros.h:225</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_ad8e5ae9cfb6f06ef4f3c077db87be114"><div class="ttname"><a href="project__crystal_8cpp.html#ad8e5ae9cfb6f06ef4f3c077db87be114">MIN_MODULE</a></div><div class="ttdeci">#define MIN_MODULE</div><div class="ttdef"><b>Definition:</b> <a href="project__crystal_8cpp_source.html#l00498">project_crystal.cpp:498</a></div></div>
<div class="ttc" id="group__Macros_html_ga0714b7b60ab5b804af1c9b124863178e"><div class="ttname"><a href="group__Macros.html#ga0714b7b60ab5b804af1c9b124863178e">SPEED_UP_temps01</a></div><div class="ttdeci">#define SPEED_UP_temps01</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00398">xmipp_macros.h:398</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_a132f3924593d07b0a1f55b3f22e92ba6"><div class="ttname"><a href="project__crystal_8cpp.html#a132f3924593d07b0a1f55b3f22e92ba6">yF</a></div><div class="ttdeci">#define yF</div></div>
<div class="ttc" id="group__Vectors_html_ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f"><div class="ttname"><a href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a></div><div class="ttdeci">#define YY(v)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00096">matrix1d.h:96</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_aa98b8e03fbbbab905c05a31efea4a839"><div class="ttname"><a href="project__crystal_8cpp.html#aa98b8e03fbbbab905c05a31efea4a839">CHANGE_COORDS_AND_CHOOSE_CORNERS2D</a></div><div class="ttdeci">#define CHANGE_COORDS_AND_CHOOSE_CORNERS2D</div></div>
<div class="ttc" id="classMatrix1D_html"><div class="ttname"><a href="classMatrix1D.html">Matrix1D&lt; double &gt;</a></div></div>
<div class="ttc" id="classMatrix1D_html_a9ee6afb32720ca26450038def994af96"><div class="ttname"><a href="classMatrix1D.html#a9ee6afb32720ca26450038def994af96">Matrix1D::module</a></div><div class="ttdeci">double module() const </div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l01578">matrix1d.h:1578</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_a94ec8a7a5cf5c289d292aef5777c4c14"><div class="ttname"><a href="project__crystal_8cpp.html#a94ec8a7a5cf5c289d292aef5777c4c14">x0</a></div><div class="ttdeci">#define x0</div></div>
<div class="ttc" id="group__Matrices_html_ga94eb0766edba2c7042e6db51141ce02b"><div class="ttname"><a href="group__Matrices.html#ga94eb0766edba2c7042e6db51141ce02b">M2x2_INV</a></div><div class="ttdeci">#define M2x2_INV(Ainv, A)</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00287">matrix2d.h:287</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga8c7d56c41faa027395a0303148da3a52"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_shift_matrix </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCrystal__Projection__Parameters.html">Crystal_Projection_Parameters</a> &amp;&#160;</td>
          <td class="paramname"><em>prm_crystal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>cell_inside</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>exp_shifts_matrix_X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>exp_shifts_matrix_Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>exp_shifts_matrix_Z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>exp_normal_shifts_matrix_X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>exp_normal_shifts_matrix_Y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>exp_normal_shifts_matrix_Z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>param_file_scale</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Fill auxiliary matrix with experimental shifts. the values 3D shifts stored in the doc file DF_shift are transfer to two 2D matrices </p>

<p>Definition at line <a class="el" href="project__crystal_8cpp_source.html#l00879">879</a> of file <a class="el" href="project__crystal_8cpp_source.html">project_crystal.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;{</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <a class="code" href="classMetaData.html">MetaData</a> aux_DF_shift; <span class="comment">//crystal_param is cont</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    aux_DF_shift = prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#a1b44a72fe9c111e3fd953465d17de1f3">DF_shift</a>;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    exp_shifts_matrix_X.<a class="code" href="classMultidimArray.html#a048fe82e79de7fba796cd4e87869ef36">resize</a>(cell_inside);</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    exp_shifts_matrix_X.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>();</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    exp_shifts_matrix_Y.<a class="code" href="classMultidimArray.html#a048fe82e79de7fba796cd4e87869ef36">resize</a>(cell_inside);</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    exp_shifts_matrix_Y.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>();</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    exp_shifts_matrix_Z.<a class="code" href="classMultidimArray.html#a048fe82e79de7fba796cd4e87869ef36">resize</a>(cell_inside);</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    exp_shifts_matrix_Z.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>();</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    exp_normal_shifts_matrix_X.<a class="code" href="classMultidimArray.html#a048fe82e79de7fba796cd4e87869ef36">resize</a>(cell_inside);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    exp_normal_shifts_matrix_X.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>();</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    exp_normal_shifts_matrix_Y.<a class="code" href="classMultidimArray.html#a048fe82e79de7fba796cd4e87869ef36">resize</a>(cell_inside);</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    exp_normal_shifts_matrix_Y.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>();</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    exp_normal_shifts_matrix_Z.<a class="code" href="classMultidimArray.html#a048fe82e79de7fba796cd4e87869ef36">resize</a>(cell_inside);</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    exp_normal_shifts_matrix_Z.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>();</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="comment">//#define DEBUG2</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="preprocessor">#ifdef DEBUG2</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    std::cout &lt;&lt; aux_DF_shift;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;exp_shifts_matrix_X shape&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    exp_shifts_matrix_X.<a class="code" href="classMultidimArrayBase.html#abc7b530b6ceca036c864f9925332ff5f">printShape</a>();</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    std::cout &lt;&lt; std::endl;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="preprocessor">#undef DEBUG2</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="comment">//fill matrix with docfile data</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <a class="code" href="group__MetaData.html#ga85652b971edca3acc93a9f1bef2f17f6">FOR_ALL_OBJECTS_IN_METADATA</a>(aux_DF_shift)</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    {</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        <span class="comment">//Check that we are not outside the matrix</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <span class="keywordtype">int</span> xcell, ycell;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        aux_DF_shift.getValue(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a55ebfb31ac61c854a2a6f627fec80f10">MDL_CRYSTAL_CELLX</a>,xcell,__iter.objId);</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        aux_DF_shift.getValue(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a70b5c4e0728ad6c3929890418638c4c4">MDL_CRYSTAL_CELLY</a>,ycell,__iter.objId);</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        <span class="keywordflow">if</span> (!exp_shifts_matrix_X.<a class="code" href="classMultidimArrayBase.html#a47caddfc3c8c1425f9eaae5bde699558">outside</a>(xcell,ycell))</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        {</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            aux_DF_shift.getValue(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78acb3aa7acca32f4524608635e2e09650e">MDL_SHIFT_X</a>,exp_shifts_matrix_X(ycell, xcell),__iter.objId);</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;            aux_DF_shift.getValue(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78ab00882fc483e9a1a7e6af5829a6afb8e">MDL_SHIFT_Y</a>,exp_shifts_matrix_Y(ycell, xcell),__iter.objId);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            aux_DF_shift.getValue(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78aa66f1aad407cfbd08f582453ffa68c3e">MDL_SHIFT_Z</a>,exp_shifts_matrix_Z(ycell, xcell),__iter.objId);</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;            aux_DF_shift.getValue(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a7ef5ae5b0357874249385d55ee9c1c36">MDL_CRYSTAL_SHIFTX</a>,exp_normal_shifts_matrix_X(ycell, xcell),__iter.objId);</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;            aux_DF_shift.getValue(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a3262b63b69a8aca11f46af6044954ee1">MDL_CRYSTAL_SHIFTY</a>,exp_normal_shifts_matrix_Y(ycell, xcell),__iter.objId);</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            aux_DF_shift.getValue(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a41a7f7435e1e153ab34f970350cd95d3">MDL_CRYSTAL_SHIFTZ</a>,exp_normal_shifts_matrix_Z(ycell, xcell),__iter.objId);</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        }</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    }</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    <span class="comment">//#define DEBUG2</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="preprocessor">#ifdef DEBUG2</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;exp_shifts_matrix_X&quot;</span> &lt;&lt; exp_shifts_matrix_X;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;exp_shifts_matrix_Y&quot;</span> &lt;&lt; exp_shifts_matrix_Y;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;exp_shifts_matrix_Z&quot;</span> &lt;&lt; exp_shifts_matrix_Z;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="preprocessor">#undef DEBUG2</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;}</div><div class="ttc" id="classMultidimArray_html_a048fe82e79de7fba796cd4e87869ef36"><div class="ttname"><a href="classMultidimArray.html#a048fe82e79de7fba796cd4e87869ef36">MultidimArray::resize</a></div><div class="ttdeci">void resize(size_t Ndim, size_t Zdim, size_t Ydim, size_t Xdim, bool copy=true)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l01562">multidim_array.h:1562</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78a70b5c4e0728ad6c3929890418638c4c4"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a70b5c4e0728ad6c3929890418638c4c4">MDL_CRYSTAL_CELLY</a></div><div class="ttdoc">Cell location for crystals. </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00097">metadata_label.h:97</a></div></div>
<div class="ttc" id="classCrystal__Projection__Parameters_html_a1b44a72fe9c111e3fd953465d17de1f3"><div class="ttname"><a href="classCrystal__Projection__Parameters.html#a1b44a72fe9c111e3fd953465d17de1f3">Crystal_Projection_Parameters::DF_shift</a></div><div class="ttdeci">MetaData DF_shift</div><div class="ttdoc">Document File for shifts. Order: H K x_SHIFT y_SHIFT z_SHIFT. </div><div class="ttdef"><b>Definition:</b> <a href="project__crystal_8h_source.html#l00078">project_crystal.h:78</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78acb3aa7acca32f4524608635e2e09650e"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78acb3aa7acca32f4524608635e2e09650e">MDL_SHIFT_X</a></div><div class="ttdoc">Shift for the image in the X axis (double) </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00412">metadata_label.h:412</a></div></div>
<div class="ttc" id="classMetaData_html"><div class="ttname"><a href="classMetaData.html">MetaData</a></div><div class="ttdef"><b>Definition:</b> <a href="metadata_8h_source.html#l00234">metadata.h:234</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78a41a7f7435e1e153ab34f970350cd95d3"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a41a7f7435e1e153ab34f970350cd95d3">MDL_CRYSTAL_SHIFTZ</a></div><div class="ttdoc">Shift for the image in the Z axis (double) for crystals. </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00106">metadata_label.h:106</a></div></div>
<div class="ttc" id="classMultidimArrayBase_html_a47caddfc3c8c1425f9eaae5bde699558"><div class="ttname"><a href="classMultidimArrayBase.html#a47caddfc3c8c1425f9eaae5bde699558">MultidimArrayBase::outside</a></div><div class="ttdeci">bool outside(int k, int i, int j) const </div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l01054">multidim_array.h:1054</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78a3262b63b69a8aca11f46af6044954ee1"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a3262b63b69a8aca11f46af6044954ee1">MDL_CRYSTAL_SHIFTY</a></div><div class="ttdoc">Shift for the image in the Y axis (double) for crystals. </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00105">metadata_label.h:105</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78a7ef5ae5b0357874249385d55ee9c1c36"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a7ef5ae5b0357874249385d55ee9c1c36">MDL_CRYSTAL_SHIFTX</a></div><div class="ttdoc">&lt; Have a crystal projection (bool) </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00104">metadata_label.h:104</a></div></div>
<div class="ttc" id="group__MetaData_html_ga85652b971edca3acc93a9f1bef2f17f6"><div class="ttname"><a href="group__MetaData.html#ga85652b971edca3acc93a9f1bef2f17f6">FOR_ALL_OBJECTS_IN_METADATA</a></div><div class="ttdeci">#define FOR_ALL_OBJECTS_IN_METADATA(__md)</div><div class="ttdef"><b>Definition:</b> <a href="metadata_8h_source.html#l00081">metadata.h:81</a></div></div>
<div class="ttc" id="classMultidimArrayBase_html_abc7b530b6ceca036c864f9925332ff5f"><div class="ttname"><a href="classMultidimArrayBase.html#abc7b530b6ceca036c864f9925332ff5f">MultidimArrayBase::printShape</a></div><div class="ttdeci">void printShape(std::ostream &amp;out=std::cout) const </div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8cpp_source.html#l00281">multidim_array.cpp:281</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78aa66f1aad407cfbd08f582453ffa68c3e"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78aa66f1aad407cfbd08f582453ffa68c3e">MDL_SHIFT_Z</a></div><div class="ttdoc">Shift for the image in the Z axis (double) </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00418">metadata_label.h:418</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78ab00882fc483e9a1a7e6af5829a6afb8e"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78ab00882fc483e9a1a7e6af5829a6afb8e">MDL_SHIFT_Y</a></div><div class="ttdoc">Shift for the image in the Y axis (double) </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00415">metadata_label.h:415</a></div></div>
<div class="ttc" id="classMultidimArray_html_a738eab72b6bd48a98d78745bc24f36bd"><div class="ttname"><a href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">MultidimArray::initZeros</a></div><div class="ttdeci">void initZeros(const MultidimArray&lt; T1 &gt; &amp;op)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l04327">multidim_array.h:4327</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78a55ebfb31ac61c854a2a6f627fec80f10"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a55ebfb31ac61c854a2a6f627fec80f10">MDL_CRYSTAL_CELLX</a></div><div class="ttdoc">Cell location for crystals. </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00096">metadata_label.h:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga448fda564f5728e14d69ab63a551b040"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void move_following_spiral </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classMatrix1D.html">Matrix1D</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>visited</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Move following a spiral. Starting in a given position this function visits a matrix using an spiral like this </p><pre class="fragment">                DCBA
                E329
                F418
                G567
                HIJKL...
</pre><p>r is the actual position in the matrix. </p>

<p>Definition at line <a class="el" href="project__crystal_8cpp_source.html#l00589">589</a> of file <a class="el" href="project__crystal_8cpp_source.html">project_crystal.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;{</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="image__find__center_8cpp.html#a1f47f51cace576c94f6c1c9483d28a8f">r1</a> = 0, <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> = 0, <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> = 0, c1 = 0, c2 = 0, c3 = 0;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="preprocessor">#define x0 STARTINGX(visited)</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="preprocessor">#define y0 STARTINGY(visited)</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="preprocessor">#define xF FINISHINGX(visited)</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="preprocessor">#define yF FINISHINGY(visited)</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="preprocessor">#define i  (int)YY(r)</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="preprocessor">#define j  (int)XX(r)</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="comment">// Compute row and column sums</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; <a class="code" href="project__crystal_8cpp.html#a0d9521fd31b2e16413d1b78836953d53">y0</a> &amp;&amp; <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> &gt; <a class="code" href="project__crystal_8cpp.html#a94ec8a7a5cf5c289d292aef5777c4c14">x0</a>)</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    {</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        r1 += visited(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> - 1, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> - 1);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        c1 += visited(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> - 1, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> - 1);</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    }</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; <a class="code" href="project__crystal_8cpp.html#a0d9521fd31b2e16413d1b78836953d53">y0</a>)</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    {</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        r1 += visited(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> - 1, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        c2 += visited(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> - 1, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    }</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; <a class="code" href="project__crystal_8cpp.html#a0d9521fd31b2e16413d1b78836953d53">y0</a> &amp;&amp; <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> &lt; <a class="code" href="project__crystal_8cpp.html#a8f613ddaea2048e3471a1f4f04ba4b79">xF</a>)</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    {</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        r1 += visited(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> - 1, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> + 1);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        c3 += visited(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> - 1, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> + 1);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> &gt; <a class="code" href="project__crystal_8cpp.html#a94ec8a7a5cf5c289d292aef5777c4c14">x0</a>)</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    {</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> += visited(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>  , <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> - 1);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        c1 += visited(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>  , <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> - 1);</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    }</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> += visited(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>  , <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    c2 += visited(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>  , <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> &lt; <a class="code" href="project__crystal_8cpp.html#a8f613ddaea2048e3471a1f4f04ba4b79">xF</a>)</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    {</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> += visited(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>  , <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> + 1);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        c3 += visited(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>  , <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> + 1);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    }</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="keywordflow">if</span> (i &lt; yF &amp;&amp; j &gt; <a class="code" href="project__crystal_8cpp.html#a94ec8a7a5cf5c289d292aef5777c4c14">x0</a>)</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    {</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> += visited(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> - 1);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        c1 += visited(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> - 1);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    }</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="project__crystal_8cpp.html#a132f3924593d07b0a1f55b3f22e92ba6">yF</a>)</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    {</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> += visited(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        c2 += visited(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    }</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="project__crystal_8cpp.html#a132f3924593d07b0a1f55b3f22e92ba6">yF</a> &amp;&amp; <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> &lt; <a class="code" href="project__crystal_8cpp.html#a8f613ddaea2048e3471a1f4f04ba4b79">xF</a>)</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    {</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> += visited(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> + 1);</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        c3 += visited(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> + 1, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> + 1);</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    }</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    std::cout &lt;&lt; r1 &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    &lt;&lt; c1 &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; c2 &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; c3 &lt;&lt; std::endl;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="comment">// Decide where to go</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordflow">if</span> (r1 == 0 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> == 1 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> == 0 &amp;&amp; c1 == 0 &amp;&amp; c2 == 1 &amp;&amp; c3 == 0)</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    {</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(r)--;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    }</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r1 == 0 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> == 1 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> == 1 &amp;&amp; c1 == 0 &amp;&amp; c2 == 2 &amp;&amp; c3 == 0)</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    {</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(r)--;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    }</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r1 == 0 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> == 2 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> == 1 &amp;&amp; c1 == 0 &amp;&amp; c2 == 1 &amp;&amp; c3 == 2)</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    {</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(r)++;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    }</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r1 == 2 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> == 2 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> == 0 &amp;&amp; c1 == 0 &amp;&amp; c2 == 2 &amp;&amp; c3 == 2)</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    {</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(r)++;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    }</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r1 == 2 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> == 1 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> == 0 &amp;&amp; c1 == 0 &amp;&amp; c2 == 2 &amp;&amp; c3 == 1)</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    {</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(r)++;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    }</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r1 == 2 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> == 2 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> == 0 &amp;&amp; c1 == 2 &amp;&amp; c2 == 2 &amp;&amp; c3 == 0)</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    {</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(r)++;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    }</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r1 == 1 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> == 2 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> == 0 &amp;&amp; c1 == 2 &amp;&amp; c2 == 1 &amp;&amp; c3 == 0)</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    {</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(r)--;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    }</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r1 == 0 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> == 2 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> == 2 &amp;&amp; c1 == 2 &amp;&amp; c2 == 2 &amp;&amp; c3 == 0)</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    {</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(r)--;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    }</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r1 == 0 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> == 1 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> == 2 &amp;&amp; c1 == 1 &amp;&amp; c2 == 2 &amp;&amp; c3 == 0)</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    {</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(r)--;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    }</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r1 == 1 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> == 2 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> == 2 &amp;&amp; c1 == 3 &amp;&amp; c2 == 2 &amp;&amp; c3 == 0)</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    {</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(r)--;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    }</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r1 == 0 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> == 2 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> == 3 &amp;&amp; c1 == 1 &amp;&amp; c2 == 2 &amp;&amp; c3 == 2)</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    {</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(r)--;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    }</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r1 == 0 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> == 2 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> == 2 &amp;&amp; c1 == 0 &amp;&amp; c2 == 2 &amp;&amp; c3 == 2)</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    {</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(r)--;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    }</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r1 == 2 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> == 2 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> == 1 &amp;&amp; c1 == 0 &amp;&amp; c2 == 2 &amp;&amp; c3 == 3)</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    {</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(r)++;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    }</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (r1 == 3 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a> == 2 &amp;&amp; <a class="code" href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a> == 0 &amp;&amp; c1 == 2 &amp;&amp; c2 == 2 &amp;&amp; c3 == 1)</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    {</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(r)++;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    }</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;}</div><div class="ttc" id="project__crystal_8cpp_html_a8f613ddaea2048e3471a1f4f04ba4b79"><div class="ttname"><a href="project__crystal_8cpp.html#a8f613ddaea2048e3471a1f4f04ba4b79">xF</a></div><div class="ttdeci">#define xF</div></div>
<div class="ttc" id="project__crystal_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">#define i</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02510">numerical_recipes.cpp:2510</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_a0d9521fd31b2e16413d1b78836953d53"><div class="ttname"><a href="project__crystal_8cpp.html#a0d9521fd31b2e16413d1b78836953d53">y0</a></div><div class="ttdeci">#define y0</div></div>
<div class="ttc" id="group__Vectors_html_ga7dce99001bf2a5ec705503346b6fec85"><div class="ttname"><a href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a></div><div class="ttdeci">#define XX(v)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00088">matrix1d.h:88</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_a132f3924593d07b0a1f55b3f22e92ba6"><div class="ttname"><a href="project__crystal_8cpp.html#a132f3924593d07b0a1f55b3f22e92ba6">yF</a></div><div class="ttdeci">#define yF</div></div>
<div class="ttc" id="project__crystal_8cpp_html_aae82a1338cf72eb9a1cc7043f569537e"><div class="ttname"><a href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a></div><div class="ttdeci">#define j</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02510">numerical_recipes.cpp:2510</a></div></div>
<div class="ttc" id="group__Vectors_html_ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f"><div class="ttname"><a href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a></div><div class="ttdeci">#define YY(v)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00096">matrix1d.h:96</a></div></div>
<div class="ttc" id="image__find__center_8cpp_html_a328bfdd73958ae7598af7f68947f9077"><div class="ttname"><a href="image__find__center_8cpp.html#a328bfdd73958ae7598af7f68947f9077">r3</a></div><div class="ttdeci">float r3</div><div class="ttdef"><b>Definition:</b> <a href="image__find__center_8cpp_source.html#l00051">image_find_center.cpp:51</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_a94ec8a7a5cf5c289d292aef5777c4c14"><div class="ttname"><a href="project__crystal_8cpp.html#a94ec8a7a5cf5c289d292aef5777c4c14">x0</a></div><div class="ttdeci">#define x0</div></div>
<div class="ttc" id="image__find__center_8cpp_html_ab7a69dabaa7151dae4d7a3998167e2f3"><div class="ttname"><a href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a></div><div class="ttdeci">float r2</div><div class="ttdef"><b>Definition:</b> <a href="image__find__center_8cpp_source.html#l00051">image_find_center.cpp:51</a></div></div>
<div class="ttc" id="image__find__center_8cpp_html_a1f47f51cace576c94f6c1c9483d28a8f"><div class="ttname"><a href="image__find__center_8cpp.html#a1f47f51cace576c94f6c1c9483d28a8f">r1</a></div><div class="ttdeci">float r1</div><div class="ttdef"><b>Definition:</b> <a href="image__find__center_8cpp_source.html#l00051">image_find_center.cpp:51</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga4f4b4e716de6846ab83a8e9a86b99f1f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void project_crystal </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classPhantom.html">Phantom</a> &amp;&#160;</td>
          <td class="paramname"><em>phantom</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classProjection.html">Projection</a> &amp;&#160;</td>
          <td class="paramname"><em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classParametersProjection.html">ParametersProjection</a> &amp;&#160;</td>
          <td class="paramname"><em>prm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classPROJECT__Side__Info.html">PROJECT_Side_Info</a> &amp;&#160;</td>
          <td class="paramname"><em>side</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classCrystal__Projection__Parameters.html">Crystal_Projection_Parameters</a> &amp;&#160;</td>
          <td class="paramname"><em>prm_crystal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>rot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>tilt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>psi</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Project a Mathematical volume as a crystal. </p>

<p>Definition at line <a class="el" href="project__crystal_8cpp_source.html#l00170">170</a> of file <a class="el" href="project__crystal_8cpp_source.html">project_crystal.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;{</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="group__Macros.html#gaf8a261813b559b0adb0417213984a591">SPEED_UP_tempsDouble</a>;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment">//Scale crystal output</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="comment">//   int aux_crystal_Ydim = ROUND(prm_crystal.crystal_Ydim</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="comment">//         *phantom.phantom_scale);</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">//   int aux_crystal_Xdim = ROUND(prm_crystal.crystal_Xdim</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">//                                       *phantom.phantom_scale);</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">// Initialize whole crystal projection</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    P().initZeros(prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#a31d6dedc32af719b19247dd1bfbe389a">crystal_Ydim</a>, prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#af6987ed3a7b0bd986cf5b3166062c554">crystal_Xdim</a>);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    P().setXmippOrigin();</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">// Compute lattice vectors in the projection plane</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    P.<a class="code" href="group__FourierProjection.html#ga38fc7e819f167ed62bf63c13e1058aab">setAngles</a>(rot, tilt, <a class="code" href="namespacealglib.html#a0759579762ef75075769325153538c5b">psi</a>);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> proja = P.<a class="code" href="group__FourierProjection.html#gabef83744f4e0571354f31586fb41d357">euler</a> * prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#adee140dbbc5d47e44f171eabf1af1027">a</a>;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> projb = P.<a class="code" href="group__FourierProjection.html#gabef83744f4e0571354f31586fb41d357">euler</a> * prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#a2809630409a8e77faab557c543988352">b</a>;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// Check if orthogonal projections</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">// (projXdim,0)&#39;=A*aproj</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">// (0,projYdim)&#39;=A*bproj</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="classMatrix2D.html">Matrix2D&lt;double&gt;</a> Ainv, A, D, Dinv, AuxMat, Daux;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">if</span> (prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#a7cd513bc8147f5d8e9fb6181a55c76c0">orthogonal</a>)</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        A.<a class="code" href="classMatrix2D.html#aeedb221b3c316a93de2826d56302bf98">resize</a>(2, 2);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="comment">//        A(0, 0) = YY(projb) * XSIZE(P());</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="comment">//        A(0, 1) = -XX(projb) * XSIZE(P());</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="comment">//        A(1, 0) = -YY(proja) * YSIZE(P());</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="comment">//        A(1, 1) = XX(proja) * YSIZE(P());</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        A(0, 0) =  <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(projb) * prm.<a class="code" href="classParametersProjection.html#a9a3f826c8edd98b9dc4a4da78fc843fd">proj_Xdim</a>;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        A(0, 1) = -<a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(projb) * prm.<a class="code" href="classParametersProjection.html#a9a3f826c8edd98b9dc4a4da78fc843fd">proj_Xdim</a>;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        A(1, 0) = -<a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(proja) * prm.<a class="code" href="classParametersProjection.html#afd34b46e13959a732fd7ac2e541ed854">proj_Ydim</a>;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        A(1, 1) =  <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(proja) * prm.<a class="code" href="classParametersProjection.html#afd34b46e13959a732fd7ac2e541ed854">proj_Ydim</a>;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="keywordtype">double</span> nor = 1 / (<a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(proja) * <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(projb) - <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(projb) * <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(proja));</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <a class="code" href="group__Matrices.html#ga74d7e752302a7af72125514181123234">M2x2_BY_CT</a>(A, A, nor);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        A.<a class="code" href="classMatrix2D.html#aeedb221b3c316a93de2826d56302bf98">resize</a>(3, 3);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        A(2, 2) = 1;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        A.<a class="code" href="classMatrix2D.html#add8d2052c53fcf6689908614f67b9ee6">inv</a>(Ainv);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        AuxMat.<a class="code" href="classMatrix2D.html#aeedb221b3c316a93de2826d56302bf98">resize</a>(3, 3);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="comment">//Matrix with crystal vectors</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="comment">// Delta = (a, b) with a and b crystal column vectors</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        AuxMat(0, 0) = <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#adee140dbbc5d47e44f171eabf1af1027">a</a>);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        AuxMat(0, 1) = <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#adee140dbbc5d47e44f171eabf1af1027">a</a>);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        AuxMat(0, 2) = 0.;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        AuxMat(1, 0) = <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#a2809630409a8e77faab557c543988352">b</a>);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        AuxMat(1, 1) = <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#a2809630409a8e77faab557c543988352">b</a>);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        AuxMat(1, 2) = 0.;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        AuxMat(2, 0) = 0.;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        AuxMat(2, 1) = 0.;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        AuxMat(2, 2) = 1.;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="comment">// Product of Delta(trasposed) and Delta*</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        D.<a class="code" href="classMatrix2D.html#aeedb221b3c316a93de2826d56302bf98">resize</a>(3, 3);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        D(0, 0) = <a class="code" href="group__MultidimensionalArrays.html#ga4b3f38e76847a3fbe3e579610b23ad29">XSIZE</a>(P());</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        D(0, 1) = 0.;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        D(0, 2) = 0.;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        D(1, 0) = 0.;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        D(1, 1) = <a class="code" href="group__MultidimensionalArrays.html#ga93a0591d7e0c8b4ab932b3a45b359650">YSIZE</a>(P());</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        D(1, 2) = 0.;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        D(2, 0) = 0.;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        D(2, 1) = 0.;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        D(2, 2) = 1.;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        Daux = D;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        Daux.<a class="code" href="classMatrix2D.html#add8d2052c53fcf6689908614f67b9ee6">inv</a>(D);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <a class="code" href="group__Matrices.html#ga5b3a2d09ef1f3b774283cc380d6e6a71">M3x3_BY_M3x3</a>(D, AuxMat, D);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        Dinv.<a class="code" href="classMatrix2D.html#aeedb221b3c316a93de2826d56302bf98">resize</a>(3, 3);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        D.<a class="code" href="classMatrix2D.html#add8d2052c53fcf6689908614f67b9ee6">inv</a>(Dinv);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    {</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        A.<a class="code" href="classMatrix2D.html#a1b0afdb4a10ad1857db3db8b64715ba3">initIdentity</a>(3);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        Ainv.<a class="code" href="classMatrix2D.html#a1b0afdb4a10ad1857db3db8b64715ba3">initIdentity</a>(3);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    }</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">//#define DEBUG</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;P shape &quot;</span>;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    P().printShape();</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    std::cout &lt;&lt; std::endl;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;P.euler &quot;</span> &lt;&lt; P.<a class="code" href="group__FourierProjection.html#gabef83744f4e0571354f31586fb41d357">euler</a>;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    std::cout &lt;&lt; std::endl;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;rot= &quot;</span> &lt;&lt; rot &lt;&lt; <span class="stringliteral">&quot; tilt= &quot;</span> &lt;&lt; tilt &lt;&lt; <span class="stringliteral">&quot; psi= &quot;</span> &lt;&lt; <a class="code" href="namespacealglib.html#a0759579762ef75075769325153538c5b">psi</a> &lt;&lt; std::endl;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;a &quot;</span> &lt;&lt; prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#adee140dbbc5d47e44f171eabf1af1027">a</a>.<a class="code" href="classMatrix1D.html#a8849e36416cde2a57914953a815d4b43">transpose</a>() &lt;&lt; std::endl;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;b &quot;</span> &lt;&lt; prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#a2809630409a8e77faab557c543988352">b</a>.<a class="code" href="classMatrix1D.html#a8849e36416cde2a57914953a815d4b43">transpose</a>() &lt;&lt; std::endl;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;proja &quot;</span> &lt;&lt; proja.<a class="code" href="classMatrix1D.html#a8849e36416cde2a57914953a815d4b43">transpose</a>() &lt;&lt; std::endl;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;projb &quot;</span> &lt;&lt; projb.<a class="code" href="classMatrix1D.html#a8849e36416cde2a57914953a815d4b43">transpose</a>() &lt;&lt; std::endl;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;proj_Xdim &quot;</span> &lt;&lt; prm.<a class="code" href="classParametersProjection.html#a9a3f826c8edd98b9dc4a4da78fc843fd">proj_Xdim</a> &lt;&lt; <span class="stringliteral">&quot; proj_Ydim &quot;</span> &lt;&lt; prm.<a class="code" href="classParametersProjection.html#afd34b46e13959a732fd7ac2e541ed854">proj_Ydim</a></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    &lt;&lt; std::endl;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;A\n&quot;</span> &lt;&lt; A &lt;&lt; std::endl;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Ainv\n&quot;</span> &lt;&lt; Ainv &lt;&lt; std::endl;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;D\n&quot;</span> &lt;&lt; D &lt;&lt; std::endl;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Dinv\n&quot;</span> &lt;&lt; Dinv &lt;&lt; std::endl;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment">// Compute aproj and bproj in the deformed projection space</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> aprojd = A * proja;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> bprojd = A * projb;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;aprojd &quot;</span> &lt;&lt; aprojd.<a class="code" href="classMatrix1D.html#a8849e36416cde2a57914953a815d4b43">transpose</a>() &lt;&lt; std::endl;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;bprojd &quot;</span> &lt;&lt; bprojd.<a class="code" href="classMatrix1D.html#a8849e36416cde2a57914953a815d4b43">transpose</a>() &lt;&lt; std::endl;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="comment">// Get rid of all unnecessary components</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <a class="code" href="classMatrix2D.html">Matrix2D&lt;double&gt;</a> A2D = A;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    A2D.<a class="code" href="classMatrix2D.html#aeedb221b3c316a93de2826d56302bf98">resize</a>(2, 2);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    proja.resize(2);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    projb.resize(2);</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    aprojd.<a class="code" href="classMatrix1D.html#a79a482948ae334cbefaef7c7839cd934">resize</a>(2);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    bprojd.<a class="code" href="classMatrix1D.html#a79a482948ae334cbefaef7c7839cd934">resize</a>(2);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">// The unit cell projection size as well</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> corner1(2), corner2(2);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="comment">// First in the compressed space</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(corner1) = <a class="code" href="group__Macros.html#gaf809d730a6aa2f55cd4c3d0251f433a7">FIRST_XMIPP_INDEX</a>(prm.<a class="code" href="classParametersProjection.html#a9a3f826c8edd98b9dc4a4da78fc843fd">proj_Xdim</a>);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(corner1) = <a class="code" href="group__Macros.html#gaf809d730a6aa2f55cd4c3d0251f433a7">FIRST_XMIPP_INDEX</a>(prm.<a class="code" href="classParametersProjection.html#afd34b46e13959a732fd7ac2e541ed854">proj_Ydim</a>);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(corner2) = <a class="code" href="group__Macros.html#ga37ce421600f14de73f7006bf40cc5b3a">LAST_XMIPP_INDEX</a>(prm.<a class="code" href="classParametersProjection.html#a9a3f826c8edd98b9dc4a4da78fc843fd">proj_Xdim</a>);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(corner2) = <a class="code" href="group__Macros.html#ga37ce421600f14de73f7006bf40cc5b3a">LAST_XMIPP_INDEX</a>(prm.<a class="code" href="classParametersProjection.html#afd34b46e13959a732fd7ac2e541ed854">proj_Ydim</a>);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="comment">// Now deform</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;corner1 before deformation &quot;</span> &lt;&lt; corner1.transpose() &lt;&lt; std::endl;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;corner2 before deformation &quot;</span> &lt;&lt; corner2.transpose() &lt;&lt; std::endl;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <a class="code" href="group__Geometry.html#gaf98f879a0edc0a55192481d00e31ae37">rectangle_enclosing</a>(corner1, corner2, A2D, corner1, corner2);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;corner1 after deformation &quot;</span> &lt;&lt; corner1.transpose() &lt;&lt; std::endl;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;corner2 after deformation &quot;</span> &lt;&lt; corner2.transpose() &lt;&lt; std::endl;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;double&gt;</a> cell_shiftX, cell_shiftY, cell_shiftZ;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;int&gt;</a>    cell_inside;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;double&gt;</a> exp_shifts_matrix_X;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;double&gt;</a> exp_shifts_matrix_Y;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;double&gt;</a> exp_shifts_matrix_Z;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;double&gt;</a> exp_normal_shifts_matrix_X;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;double&gt;</a> exp_normal_shifts_matrix_Y;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;double&gt;</a> exp_normal_shifts_matrix_Z;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <a class="code" href="group__CrystalProject.html#ga5be7b257942baac7c2063646f96731a7">fill_cell_positions</a>(P, proja, projb, aprojd, bprojd, corner1, corner2,</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                        prm_crystal, cell_shiftX, cell_shiftY, cell_shiftZ, cell_inside,</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                        exp_shifts_matrix_X, exp_shifts_matrix_Y, exp_shifts_matrix_Z);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="comment">// Fill a table with all exp shifts</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <a class="code" href="group__CrystalProject.html#ga8c7d56c41faa027395a0303148da3a52">init_shift_matrix</a>(prm_crystal, cell_inside, exp_shifts_matrix_X,</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                      exp_shifts_matrix_Y,</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                      exp_shifts_matrix_Z,</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                      exp_normal_shifts_matrix_X,</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                      exp_normal_shifts_matrix_Y,</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                      exp_normal_shifts_matrix_Z,</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                      phantom.<a class="code" href="classPhantom.html#a08e07a6c798f13f5c87488704dd89791">phantom_scale</a>);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">//std::cout &lt;&lt; &quot;prm_crystal : &quot; &lt;&lt; prm_crystal. &lt;&lt; std::endl;</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment">//#define DEBUG</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;prm_crystal &quot;</span>;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    std::cout &lt;&lt; std::endl;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;prm_crystal&quot;</span> &lt;&lt; prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#a1b44a72fe9c111e3fd953465d17de1f3">DF_shift</a> &lt;&lt; std::endl;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;prm_crystal&quot;</span> &lt;&lt; prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#afb9287c719fa4d78707186d104fd3e81">DF_shift_bool</a> &lt;&lt; std::endl;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="preprocessor">#undef DEBUG</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="comment">// Prepare matrices to go from uncompressed space to deformed projection</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <a class="code" href="classMatrix2D.html">Matrix2D&lt;double&gt;</a> AE = A * P.<a class="code" href="group__FourierProjection.html#gabef83744f4e0571354f31586fb41d357">euler</a>;   <span class="comment">// From uncompressed to deformed</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <a class="code" href="classMatrix2D.html">Matrix2D&lt;double&gt;</a> AEinv = AE.<a class="code" href="classMatrix2D.html#add8d2052c53fcf6689908614f67b9ee6">inv</a>(); <span class="comment">// From deformed to uncompressed</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="comment">// add the shifts to the already compute values</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> temp_vect(3);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a>(exp_shifts_matrix_X)</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="comment">//these experimental shift are in phantom</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="comment">//coordinates, not into the projection</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="comment">//plane, so before adding them we need to project</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        temp_vect = AE * <a class="code" href="group__Vectors.html#ga8caf6673fdc30d0b6f4a529cb1f4e3ab">vectorR3</a>(exp_shifts_matrix_X(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>),</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                                  exp_shifts_matrix_Y(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>),</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                                  exp_shifts_matrix_Z(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>));</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        <span class="comment">//#define DEBUG5</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="preprocessor">#ifdef DEBUG5</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0)</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            exp_shifts_matrix_Z(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) = 65;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            exp_shifts_matrix_Z(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) = 0;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        temp_vect = AE * <a class="code" href="group__Vectors.html#ga8caf6673fdc30d0b6f4a529cb1f4e3ab">vectorR3</a>(exp_shifts_matrix_X(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>),</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                                  exp_shifts_matrix_Y(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>),</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                                  exp_shifts_matrix_Z(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>));</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="preprocessor">#undef DEBUG5</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="comment">// Add experimental shiftsy</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        cell_shiftX(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) += <a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(temp_vect);</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        cell_shiftY(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) += <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(temp_vect);</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="comment">//entiendo que x e y deban estar en el plano de la proyeccion</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="comment">//pero Z!!!!!!!!!!!!!!!!!!!</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        cell_shiftZ(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) += <a class="code" href="group__Vectors.html#gab88d1e959fb58c03aa1f04f1e4a7d452">ZZ</a>(temp_vect);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    }</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment">//#define DEBUG</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Cell inside shape &quot;</span>;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    cell_inside.<a class="code" href="classMultidimArrayBase.html#abc7b530b6ceca036c864f9925332ff5f">printShape</a>();</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    std::cout &lt;&lt; std::endl;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Cell inside\n&quot;</span> &lt;&lt; cell_inside &lt;&lt; std::endl;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Cell shiftX\n&quot;</span> &lt;&lt; cell_shiftX &lt;&lt; std::endl;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Cell shiftY\n&quot;</span> &lt;&lt; cell_shiftY &lt;&lt; std::endl;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Cell shiftZ\n&quot;</span> &lt;&lt; cell_shiftZ &lt;&lt; std::endl;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="preprocessor">    #undef DEBUG</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordtype">double</span> density_factor = 1.0;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">if</span> (prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#a7cd513bc8147f5d8e9fb6181a55c76c0">orthogonal</a>)</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    {</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="comment">// Remember to compute de density factor</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> projection_direction(3);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        (P.<a class="code" href="group__FourierProjection.html#gabef83744f4e0571354f31586fb41d357">euler</a>).getCol(2, projection_direction);</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        projection_direction.selfTranspose();</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        density_factor = (projection_direction * Dinv).module();</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;projection_direction&quot;</span> &lt;&lt; projection_direction &lt;&lt; std::endl;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;projection_direction*A&quot;</span> &lt;&lt; projection_direction*A &lt;&lt; std::endl;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    }</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;X proyectado=&quot;</span> &lt;&lt; (AE*<a class="code" href="group__Vectors.html#ga8caf6673fdc30d0b6f4a529cb1f4e3ab">vectorR3</a>(1.0, 0.0, 0.0)).<a class="code" href="primitive__FST_8cpp.html#af9ecdf0e10481a405f601d27aafd8599">transpose</a>() &lt;&lt; std::endl;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Y proyectado=&quot;</span> &lt;&lt; (AE*<a class="code" href="group__Vectors.html#ga8caf6673fdc30d0b6f4a529cb1f4e3ab">vectorR3</a>(0.0, 1.0, 0.0)).<a class="code" href="primitive__FST_8cpp.html#af9ecdf0e10481a405f601d27aafd8599">transpose</a>() &lt;&lt; std::endl;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;P.euler_shape=&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    std::cout &lt;&lt; P.<a class="code" href="group__FourierProjection.html#gabef83744f4e0571354f31586fb41d357">euler</a> &lt;&lt; std::endl;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;P.euler=&quot;</span>      &lt;&lt; P.<a class="code" href="group__FourierProjection.html#gabef83744f4e0571354f31586fb41d357">euler</a> &lt;&lt; std::endl;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;AE=&quot;</span>           &lt;&lt; AE &lt;&lt; std::endl;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;AEinv=&quot;</span>        &lt;&lt; AEinv &lt;&lt; std::endl;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Ainv=&quot;</span>            &lt;&lt; Ainv &lt;&lt; std::endl;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;density_factor=&quot;</span>      &lt;&lt; density_factor &lt;&lt; std::endl;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="comment">// Project all cells</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a>(cell_inside)</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="comment">//      if (cell_inside(i,j) &amp;&amp; rnd_unif(0,1)&lt;prm_crystal.disappearing_th) {</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <a class="code" href="numerical__recipes_8cpp.html#aba441ebef6931295ba1cb63e2cca89a8">if</a> (cell_inside(<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>))</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    {</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="comment">// Shift the phantom</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="comment">// Remind that displacements are defined in the deformed projection</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="comment">// that is why they have to be translated to the Universal</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="comment">// coordinate system</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> cell_shift(3);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <a class="code" href="group__Vectors.html#ga6c6b4d4f88daca5e1d8e171bec3b4af0">VECTOR_R3</a>(cell_shift, cell_shiftX(i, j), cell_shiftY(i, j), cell_shiftZ(i, j));</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="comment">//SHIFT still pending</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="comment">//cell_shift = cell_shift*phantom.phantom_scale;</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;cell_shift on deformed projection plane &quot;</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        &lt;&lt; cell_shift.transpose() &lt;&lt; std::endl;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <a class="code" href="group__Matrices.html#gad159332322d687de886a720422e4b757">M3x3_BY_V3x1</a>(cell_shift, AEinv, cell_shift);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;cell_shift on real space &quot;</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        &lt;&lt; cell_shift.transpose() &lt;&lt; std::endl;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <a class="code" href="classPhantom.html">Phantom</a> aux;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        aux = phantom;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="comment">// Now the cell shift is defined in the uncompressed space</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="comment">// Any phantom in the projection line will give the same shift</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="comment">// in the projection we are interested in the phantom whose center</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="comment">// is in the XYplane</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <span class="comment">// the phantom is mapped into a surface of different shapes (parabole,cosine, etc)</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> normal_vector(3);</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordtype">double</span> alpha, <a class="code" href="namespacealglib.html#a038c39f3bfe0dff667a2cb6bebfed764">beta</a>, <a class="code" href="numerical__recipes_8cpp.html#acf097d43154f3f002dbb9692ce4c55f7">gamma</a>;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <a class="code" href="classMatrix2D.html">Matrix2D&lt;double&gt;</a> angles_matrix, inverse_angles_matrix;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <a class="code" href="classMatrix2D.html">Matrix2D&lt;double&gt;</a> def_cyl_angles_matrix;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <a class="code" href="classMatrix2D.html">Matrix2D&lt;double&gt;</a> cyl_angles_matrix;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="comment">// the phantom is rotated only when there exists a shifts file</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordflow">if</span> (prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#afb9287c719fa4d78707186d104fd3e81">DF_shift_bool</a>)</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        {</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            <span class="comment">// for each (h,k) calculate the normal vector and its corresponding rotation matrix</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            normal_vector(0) = exp_normal_shifts_matrix_X(i, j);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            normal_vector(1) = exp_normal_shifts_matrix_Y(i, j);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            normal_vector(2) = exp_normal_shifts_matrix_Z(i, j);</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            <a class="code" href="group__Geometry.html#gaac7ef13b5115d1ba4eee95784243cd9c">Euler_direction2angles</a>(normal_vector, alpha, beta, gamma);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            gamma = -alpha;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            <a class="code" href="group__Geometry.html#gaf67a2d233e3fbf038d111a91197fa759">Euler_angles2matrix</a>(alpha, beta, gamma, angles_matrix);</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            inverse_angles_matrix = angles_matrix.<a class="code" href="classMatrix2D.html#add8d2052c53fcf6689908614f67b9ee6">inv</a>();</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ii = 0; ii &lt; aux.<a class="code" href="classPhantom.html#ab37a930cd36cd7d25a11da6bb0f3ce7f">VF</a>.size(); ii++)</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                aux.<a class="code" href="classPhantom.html#ab37a930cd36cd7d25a11da6bb0f3ce7f">VF</a>[ii]-&gt;rotate(angles_matrix);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        }</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        cell_shift = cell_shift - <a class="code" href="group__Vectors.html#gab88d1e959fb58c03aa1f04f1e4a7d452">ZZ</a>(cell_shift) / <a class="code" href="group__Vectors.html#gab88d1e959fb58c03aa1f04f1e4a7d452">ZZ</a>(P.<a class="code" href="group__FourierProjection.html#ga532f6713fbe228d3ee30f4d3a2766a20">direction</a>) * P.<a class="code" href="group__FourierProjection.html#ga532f6713fbe228d3ee30f4d3a2766a20">direction</a>;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;cell_shift after moving to ground &quot;</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        &lt;&lt; cell_shift.<a class="code" href="classMatrix1D.html#a8849e36416cde2a57914953a815d4b43">transpose</a>() &lt;&lt; std::endl;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        aux.<a class="code" href="classPhantom.html#a37c522b67cfd1f5552ec6d535c50cf5e">shift</a>(<a class="code" href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a>(cell_shift), <a class="code" href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a>(cell_shift), <a class="code" href="group__Vectors.html#gab88d1e959fb58c03aa1f04f1e4a7d452">ZZ</a>(cell_shift));</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <span class="comment">// Project this phantom</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        aux.<a class="code" href="classPhantom.html#afa9738c948a9df13fdd2bb0f5657793a">project_to</a>(P, AE, prm_crystal.<a class="code" href="classCrystal__Projection__Parameters.html#af0f1b4504898895769aa15b4e3f462ca">disappearing_th</a>);</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <span class="comment">// Multiply by factor</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        P() = P() * density_factor;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="preprocessor">#ifdef DEBUG_MORE</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;After Projecting ...\n&quot;</span> &lt;&lt; aux &lt;&lt; std::endl;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        P.<a class="code" href="classImageBase.html#ae81a8c11a832924c2bda0909882c3168">write</a>(<span class="stringliteral">&quot;inter&quot;</span>);</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;Hit any key\n&quot;</span>;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <span class="keywordtype">char</span> <a class="code" href="numerical__recipes_8cpp.html#ae0323a9039add2978bf5b49550572c7c">c</a>;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        std::cin &gt;&gt; <a class="code" href="numerical__recipes_8cpp.html#ae0323a9039add2978bf5b49550572c7c">c</a>;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    }</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;}</div><div class="ttc" id="classMatrix1D_html_a8849e36416cde2a57914953a815d4b43"><div class="ttname"><a href="classMatrix1D.html#a8849e36416cde2a57914953a815d4b43">Matrix1D::transpose</a></div><div class="ttdeci">Matrix1D&lt; T &gt; transpose() const </div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l01466">matrix1d.h:1466</a></div></div>
<div class="ttc" id="group__Macros_html_gaf8a261813b559b0adb0417213984a591"><div class="ttname"><a href="group__Macros.html#gaf8a261813b559b0adb0417213984a591">SPEED_UP_tempsDouble</a></div><div class="ttdeci">#define SPEED_UP_tempsDouble</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00413">xmipp_macros.h:413</a></div></div>
<div class="ttc" id="classMatrix2D_html_add8d2052c53fcf6689908614f67b9ee6"><div class="ttname"><a href="classMatrix2D.html#add8d2052c53fcf6689908614f67b9ee6">Matrix2D::inv</a></div><div class="ttdeci">void inv(Matrix2D&lt; T &gt; &amp;result) const </div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l01648">matrix2d.h:1648</a></div></div>
<div class="ttc" id="classPhantom_html_a08e07a6c798f13f5c87488704dd89791"><div class="ttname"><a href="classPhantom.html#a08e07a6c798f13f5c87488704dd89791">Phantom::phantom_scale</a></div><div class="ttdeci">double phantom_scale</div><div class="ttdoc">Param file scale. </div><div class="ttdef"><b>Definition:</b> <a href="phantom_8h_source.html#l01410">phantom.h:1410</a></div></div>
<div class="ttc" id="classParametersProjection_html_afd34b46e13959a732fd7ac2e541ed854"><div class="ttname"><a href="classParametersProjection.html#afd34b46e13959a732fd7ac2e541ed854">ParametersProjection::proj_Ydim</a></div><div class="ttdeci">int proj_Ydim</div><div class="ttdoc">Projection Ydim. </div><div class="ttdef"><b>Definition:</b> <a href="project_8h_source.html#l00161">project.h:161</a></div></div>
<div class="ttc" id="classMultidimArray_html"><div class="ttname"><a href="classMultidimArray.html">MultidimArray&lt; double &gt;</a></div></div>
<div class="ttc" id="classCrystal__Projection__Parameters_html_a1b44a72fe9c111e3fd953465d17de1f3"><div class="ttname"><a href="classCrystal__Projection__Parameters.html#a1b44a72fe9c111e3fd953465d17de1f3">Crystal_Projection_Parameters::DF_shift</a></div><div class="ttdeci">MetaData DF_shift</div><div class="ttdoc">Document File for shifts. Order: H K x_SHIFT y_SHIFT z_SHIFT. </div><div class="ttdef"><b>Definition:</b> <a href="project__crystal_8h_source.html#l00078">project_crystal.h:78</a></div></div>
<div class="ttc" id="group__Geometry_html_gaf67a2d233e3fbf038d111a91197fa759"><div class="ttname"><a href="group__Geometry.html#gaf67a2d233e3fbf038d111a91197fa759">Euler_angles2matrix</a></div><div class="ttdeci">void Euler_angles2matrix(T alpha, T beta, T gamma, Matrix2D&lt; T &gt; &amp;A, bool homogeneous)</div><div class="ttdef"><b>Definition:</b> <a href="geometry_8cpp_source.html#l00621">geometry.cpp:621</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_ae0323a9039add2978bf5b49550572c7c"><div class="ttname"><a href="numerical__recipes_8cpp.html#ae0323a9039add2978bf5b49550572c7c">c</a></div><div class="ttdeci">doublereal * c</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02247">numerical_recipes.cpp:2247</a></div></div>
<div class="ttc" id="group__Geometry_html_gaac7ef13b5115d1ba4eee95784243cd9c"><div class="ttname"><a href="group__Geometry.html#gaac7ef13b5115d1ba4eee95784243cd9c">Euler_direction2angles</a></div><div class="ttdeci">void Euler_direction2angles(Matrix1D&lt; double &gt; &amp;v0, double &amp;alpha, double &amp;beta, double &amp;gamma)</div><div class="ttdef"><b>Definition:</b> <a href="geometry_8cpp_source.html#l00743">geometry.cpp:743</a></div></div>
<div class="ttc" id="classCrystal__Projection__Parameters_html_a2809630409a8e77faab557c543988352"><div class="ttname"><a href="classCrystal__Projection__Parameters.html#a2809630409a8e77faab557c543988352">Crystal_Projection_Parameters::b</a></div><div class="ttdeci">Matrix1D&lt; double &gt; b</div><div class="ttdoc">Crustal vector b. </div><div class="ttdef"><b>Definition:</b> <a href="project__crystal_8h_source.html#l00068">project_crystal.h:68</a></div></div>
<div class="ttc" id="namespacealglib_html_a038c39f3bfe0dff667a2cb6bebfed764"><div class="ttname"><a href="namespacealglib.html#a038c39f3bfe0dff667a2cb6bebfed764">alglib::beta</a></div><div class="ttdeci">double beta(const double a, const double b)</div><div class="ttdef"><b>Definition:</b> <a href="specialfunctions_8cpp_source.html#l00962">specialfunctions.cpp:962</a></div></div>
<div class="ttc" id="group__Vectors_html_ga8caf6673fdc30d0b6f4a529cb1f4e3ab"><div class="ttname"><a href="group__Vectors.html#ga8caf6673fdc30d0b6f4a529cb1f4e3ab">vectorR3</a></div><div class="ttdeci">Matrix1D&lt; double &gt; vectorR3(double x, double y, double z)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8cpp_source.html#l00036">matrix1d.cpp:36</a></div></div>
<div class="ttc" id="group__FourierProjection_html_gabef83744f4e0571354f31586fb41d357"><div class="ttname"><a href="group__FourierProjection.html#gabef83744f4e0571354f31586fb41d357">Projection::euler</a></div><div class="ttdeci">Matrix2D&lt; double &gt; euler</div><div class="ttdef"><b>Definition:</b> <a href="fourier__projection_8h_source.html#l00074">fourier_projection.h:74</a></div></div>
<div class="ttc" id="classImageBase_html_ae81a8c11a832924c2bda0909882c3168"><div class="ttname"><a href="classImageBase.html#ae81a8c11a832924c2bda0909882c3168">ImageBase::write</a></div><div class="ttdeci">void write(const FileName &amp;name=&quot;&quot;, size_t select_img=ALL_IMAGES, bool isStack=false, int mode=WRITE_OVERWRITE, CastWriteMode castMode=CW_CAST, int _swapWrite=0)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__image__base_8cpp_source.html#l00210">xmipp_image_base.cpp:210</a></div></div>
<div class="ttc" id="classParametersProjection_html_a9a3f826c8edd98b9dc4a4da78fc843fd"><div class="ttname"><a href="classParametersProjection.html#a9a3f826c8edd98b9dc4a4da78fc843fd">ParametersProjection::proj_Xdim</a></div><div class="ttdeci">int proj_Xdim</div><div class="ttdoc">Projection Xdim. </div><div class="ttdef"><b>Definition:</b> <a href="project_8h_source.html#l00159">project.h:159</a></div></div>
<div class="ttc" id="classCrystal__Projection__Parameters_html_a7cd513bc8147f5d8e9fb6181a55c76c0"><div class="ttname"><a href="classCrystal__Projection__Parameters.html#a7cd513bc8147f5d8e9fb6181a55c76c0">Crystal_Projection_Parameters::orthogonal</a></div><div class="ttdeci">bool orthogonal</div><div class="ttdoc">Orthogonalize projections. </div><div class="ttdef"><b>Definition:</b> <a href="project__crystal_8h_source.html#l00064">project_crystal.h:64</a></div></div>
<div class="ttc" id="classPhantom_html_a37c522b67cfd1f5552ec6d535c50cf5e"><div class="ttname"><a href="classPhantom.html#a37c522b67cfd1f5552ec6d535c50cf5e">Phantom::shift</a></div><div class="ttdeci">void shift(double shiftX, double shiftY, double shiftZ)</div><div class="ttdef"><b>Definition:</b> <a href="phantom_8cpp_source.html#l02544">phantom.cpp:2544</a></div></div>
<div class="ttc" id="classCrystal__Projection__Parameters_html_adee140dbbc5d47e44f171eabf1af1027"><div class="ttname"><a href="classCrystal__Projection__Parameters.html#adee140dbbc5d47e44f171eabf1af1027">Crystal_Projection_Parameters::a</a></div><div class="ttdeci">Matrix1D&lt; double &gt; a</div><div class="ttdoc">Crystal vector a. </div><div class="ttdef"><b>Definition:</b> <a href="project__crystal_8h_source.html#l00066">project_crystal.h:66</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_acf097d43154f3f002dbb9692ce4c55f7"><div class="ttname"><a href="numerical__recipes_8cpp.html#acf097d43154f3f002dbb9692ce4c55f7">gamma</a></div><div class="ttdeci">double * gamma</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l07616">numerical_recipes.cpp:7616</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga4b3f38e76847a3fbe3e579610b23ad29"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga4b3f38e76847a3fbe3e579610b23ad29">XSIZE</a></div><div class="ttdeci">#define XSIZE(v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00101">multidim_array.h:101</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">#define i</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02510">numerical_recipes.cpp:2510</a></div></div>
<div class="ttc" id="classCrystal__Projection__Parameters_html_afb9287c719fa4d78707186d104fd3e81"><div class="ttname"><a href="classCrystal__Projection__Parameters.html#afb9287c719fa4d78707186d104fd3e81">Crystal_Projection_Parameters::DF_shift_bool</a></div><div class="ttdeci">bool DF_shift_bool</div><div class="ttdoc">is doc file with shifts available </div><div class="ttdef"><b>Definition:</b> <a href="project__crystal_8h_source.html#l00080">project_crystal.h:80</a></div></div>
<div class="ttc" id="group__CrystalProject_html_ga5be7b257942baac7c2063646f96731a7"><div class="ttname"><a href="group__CrystalProject.html#ga5be7b257942baac7c2063646f96731a7">fill_cell_positions</a></div><div class="ttdeci">void fill_cell_positions(Projection &amp;P, Matrix1D&lt; double &gt; &amp;aproj, Matrix1D&lt; double &gt; &amp;bproj, Matrix1D&lt; double &gt; &amp;aprojd, Matrix1D&lt; double &gt; &amp;bprojd, Matrix1D&lt; double &gt; &amp;corner1, Matrix1D&lt; double &gt; &amp;corner2, const Crystal_Projection_Parameters &amp;prm_crystal, MultidimArray&lt; double &gt; &amp;cell_shiftX, MultidimArray&lt; double &gt; &amp;cell_shiftY, MultidimArray&lt; double &gt; &amp;cell_shiftZ, MultidimArray&lt; int &gt; &amp;cell_inside, MultidimArray&lt; double &gt; &amp;exp_shifts_matrix_X, MultidimArray&lt; double &gt; &amp;exp_shifts_matrix_Y, MultidimArray&lt; double &gt; &amp;exp_shifts_matrix_Z)</div><div class="ttdef"><b>Definition:</b> <a href="project__crystal_8cpp_source.html#l00715">project_crystal.cpp:715</a></div></div>
<div class="ttc" id="classCrystal__Projection__Parameters_html_af0f1b4504898895769aa15b4e3f462ca"><div class="ttname"><a href="classCrystal__Projection__Parameters.html#af0f1b4504898895769aa15b4e3f462ca">Crystal_Projection_Parameters::disappearing_th</a></div><div class="ttdeci">double disappearing_th</div><div class="ttdoc">Disappearing threshold. </div><div class="ttdef"><b>Definition:</b> <a href="project__crystal_8h_source.html#l00074">project_crystal.h:74</a></div></div>
<div class="ttc" id="classMatrix2D_html"><div class="ttname"><a href="classMatrix2D.html">Matrix2D&lt; double &gt;</a></div></div>
<div class="ttc" id="group__Geometry_html_gaf98f879a0edc0a55192481d00e31ae37"><div class="ttname"><a href="group__Geometry.html#gaf98f879a0edc0a55192481d00e31ae37">rectangle_enclosing</a></div><div class="ttdeci">void rectangle_enclosing(const Matrix1D&lt; double &gt; &amp;v0, const Matrix1D&lt; double &gt; &amp;vF, const Matrix2D&lt; double &gt; &amp;V, Matrix1D&lt; double &gt; &amp;corner1, Matrix1D&lt; double &gt; &amp;corner2)</div><div class="ttdef"><b>Definition:</b> <a href="geometry_8cpp_source.html#l00325">geometry.cpp:325</a></div></div>
<div class="ttc" id="group__Vectors_html_ga7dce99001bf2a5ec705503346b6fec85"><div class="ttname"><a href="group__Vectors.html#ga7dce99001bf2a5ec705503346b6fec85">XX</a></div><div class="ttdeci">#define XX(v)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00088">matrix1d.h:88</a></div></div>
<div class="ttc" id="primitive__FST_8cpp_html_af9ecdf0e10481a405f601d27aafd8599"><div class="ttname"><a href="primitive__FST_8cpp.html#af9ecdf0e10481a405f601d27aafd8599">transpose</a></div><div class="ttdeci">void transpose(double *array, int size)</div><div class="ttdef"><b>Definition:</b> <a href="primitive__FST_8cpp_source.html#l00121">primitive_FST.cpp:121</a></div></div>
<div class="ttc" id="classPhantom_html"><div class="ttname"><a href="classPhantom.html">Phantom</a></div><div class="ttdef"><b>Definition:</b> <a href="phantom_8h_source.html#l01385">phantom.h:1385</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga7fa7d580ab43d192c7933abd008bc756"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a></div><div class="ttdeci">#define FOR_ALL_ELEMENTS_IN_ARRAY2D(m)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00400">multidim_array.h:400</a></div></div>
<div class="ttc" id="group__Matrices_html_ga5b3a2d09ef1f3b774283cc380d6e6a71"><div class="ttname"><a href="group__Matrices.html#ga5b3a2d09ef1f3b774283cc380d6e6a71">M3x3_BY_M3x3</a></div><div class="ttdeci">#define M3x3_BY_M3x3(A, B, C)</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00183">matrix2d.h:183</a></div></div>
<div class="ttc" id="classMatrix1D_html_a79a482948ae334cbefaef7c7839cd934"><div class="ttname"><a href="classMatrix1D.html#a79a482948ae334cbefaef7c7839cd934">Matrix1D::resize</a></div><div class="ttdeci">void resize(size_t Xdim, bool copy=true)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00451">matrix1d.h:451</a></div></div>
<div class="ttc" id="classMultidimArrayBase_html_abc7b530b6ceca036c864f9925332ff5f"><div class="ttname"><a href="classMultidimArrayBase.html#abc7b530b6ceca036c864f9925332ff5f">MultidimArrayBase::printShape</a></div><div class="ttdeci">void printShape(std::ostream &amp;out=std::cout) const </div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8cpp_source.html#l00281">multidim_array.cpp:281</a></div></div>
<div class="ttc" id="classCrystal__Projection__Parameters_html_af6987ed3a7b0bd986cf5b3166062c554"><div class="ttname"><a href="classCrystal__Projection__Parameters.html#af6987ed3a7b0bd986cf5b3166062c554">Crystal_Projection_Parameters::crystal_Xdim</a></div><div class="ttdeci">int crystal_Xdim</div><div class="ttdoc">Crystal X dimension. </div><div class="ttdef"><b>Definition:</b> <a href="project__crystal_8h_source.html#l00060">project_crystal.h:60</a></div></div>
<div class="ttc" id="group__FourierProjection_html_ga532f6713fbe228d3ee30f4d3a2766a20"><div class="ttname"><a href="group__FourierProjection.html#ga532f6713fbe228d3ee30f4d3a2766a20">Projection::direction</a></div><div class="ttdeci">Matrix1D&lt; double &gt; direction</div><div class="ttdef"><b>Definition:</b> <a href="fourier__projection_8h_source.html#l00065">fourier_projection.h:65</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga93a0591d7e0c8b4ab932b3a45b359650"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga93a0591d7e0c8b4ab932b3a45b359650">YSIZE</a></div><div class="ttdeci">#define YSIZE(v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00105">multidim_array.h:105</a></div></div>
<div class="ttc" id="group__Matrices_html_ga74d7e752302a7af72125514181123234"><div class="ttname"><a href="group__Matrices.html#ga74d7e752302a7af72125514181123234">M2x2_BY_CT</a></div><div class="ttdeci">#define M2x2_BY_CT(M2, M1, k)</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00238">matrix2d.h:238</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_aae82a1338cf72eb9a1cc7043f569537e"><div class="ttname"><a href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a></div><div class="ttdeci">#define j</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02510">numerical_recipes.cpp:2510</a></div></div>
<div class="ttc" id="group__Matrices_html_gad159332322d687de886a720422e4b757"><div class="ttname"><a href="group__Matrices.html#gad159332322d687de886a720422e4b757">M3x3_BY_V3x1</a></div><div class="ttdeci">#define M3x3_BY_V3x1(a, M, b)</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00171">matrix2d.h:171</a></div></div>
<div class="ttc" id="group__Vectors_html_ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f"><div class="ttname"><a href="group__Vectors.html#ga8b0ce0c5282ce1bae56cc1f9ed4b6a5f">YY</a></div><div class="ttdeci">#define YY(v)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00096">matrix1d.h:96</a></div></div>
<div class="ttc" id="classCrystal__Projection__Parameters_html_a31d6dedc32af719b19247dd1bfbe389a"><div class="ttname"><a href="classCrystal__Projection__Parameters.html#a31d6dedc32af719b19247dd1bfbe389a">Crystal_Projection_Parameters::crystal_Ydim</a></div><div class="ttdeci">int crystal_Ydim</div><div class="ttdoc">Crystal Y dimension. </div><div class="ttdef"><b>Definition:</b> <a href="project__crystal_8h_source.html#l00062">project_crystal.h:62</a></div></div>
<div class="ttc" id="classMatrix1D_html"><div class="ttname"><a href="classMatrix1D.html">Matrix1D&lt; double &gt;</a></div></div>
<div class="ttc" id="group__Macros_html_gaf809d730a6aa2f55cd4c3d0251f433a7"><div class="ttname"><a href="group__Macros.html#gaf809d730a6aa2f55cd4c3d0251f433a7">FIRST_XMIPP_INDEX</a></div><div class="ttdeci">#define FIRST_XMIPP_INDEX(size)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00439">xmipp_macros.h:439</a></div></div>
<div class="ttc" id="namespacealglib_html_a0759579762ef75075769325153538c5b"><div class="ttname"><a href="namespacealglib.html#a0759579762ef75075769325153538c5b">alglib::psi</a></div><div class="ttdeci">double psi(const double x)</div><div class="ttdef"><b>Definition:</b> <a href="specialfunctions_8cpp_source.html#l02492">specialfunctions.cpp:2492</a></div></div>
<div class="ttc" id="group__Vectors_html_ga6c6b4d4f88daca5e1d8e171bec3b4af0"><div class="ttname"><a href="group__Vectors.html#ga6c6b4d4f88daca5e1d8e171bec3b4af0">VECTOR_R3</a></div><div class="ttdeci">#define VECTOR_R3(v, x, y, z)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00127">matrix1d.h:127</a></div></div>
<div class="ttc" id="group__FourierProjection_html_ga38fc7e819f167ed62bf63c13e1058aab"><div class="ttname"><a href="group__FourierProjection.html#ga38fc7e819f167ed62bf63c13e1058aab">Projection::setAngles</a></div><div class="ttdeci">void setAngles(double _rot, double _tilt, double _psi)</div><div class="ttdef"><b>Definition:</b> <a href="fourier__projection_8cpp_source.html#l00041">fourier_projection.cpp:41</a></div></div>
<div class="ttc" id="group__Macros_html_ga37ce421600f14de73f7006bf40cc5b3a"><div class="ttname"><a href="group__Macros.html#ga37ce421600f14de73f7006bf40cc5b3a">LAST_XMIPP_INDEX</a></div><div class="ttdeci">#define LAST_XMIPP_INDEX(size)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00448">xmipp_macros.h:448</a></div></div>
<div class="ttc" id="group__Vectors_html_gab88d1e959fb58c03aa1f04f1e4a7d452"><div class="ttname"><a href="group__Vectors.html#gab88d1e959fb58c03aa1f04f1e4a7d452">ZZ</a></div><div class="ttdeci">#define ZZ(v)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l00104">matrix1d.h:104</a></div></div>
<div class="ttc" id="classMatrix2D_html_aeedb221b3c316a93de2826d56302bf98"><div class="ttname"><a href="classMatrix2D.html#aeedb221b3c316a93de2826d56302bf98">Matrix2D::resize</a></div><div class="ttdeci">void resize(size_t Ydim, size_t Xdim, bool noCopy=false)</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00588">matrix2d.h:588</a></div></div>
<div class="ttc" id="group__CrystalProject_html_ga8c7d56c41faa027395a0303148da3a52"><div class="ttname"><a href="group__CrystalProject.html#ga8c7d56c41faa027395a0303148da3a52">init_shift_matrix</a></div><div class="ttdeci">void init_shift_matrix(const Crystal_Projection_Parameters &amp;prm_crystal, MultidimArray&lt; int &gt; &amp;cell_inside, MultidimArray&lt; double &gt; &amp;exp_shifts_matrix_X, MultidimArray&lt; double &gt; &amp;exp_shifts_matrix_Y, MultidimArray&lt; double &gt; &amp;exp_shifts_matrix_Z, MultidimArray&lt; double &gt; &amp;exp_normal_shifts_matrix_X, MultidimArray&lt; double &gt; &amp;exp_normal_shifts_matrix_Y, MultidimArray&lt; double &gt; &amp;exp_normal_shifts_matrix_Z, double phantom_scale)</div><div class="ttdef"><b>Definition:</b> <a href="project__crystal_8cpp_source.html#l00879">project_crystal.cpp:879</a></div></div>
<div class="ttc" id="classMatrix2D_html_a1b0afdb4a10ad1857db3db8b64715ba3"><div class="ttname"><a href="classMatrix2D.html#a1b0afdb4a10ad1857db3db8b64715ba3">Matrix2D::initIdentity</a></div><div class="ttdeci">void initIdentity()</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00835">matrix2d.h:835</a></div></div>
<div class="ttc" id="classPhantom_html_ab37a930cd36cd7d25a11da6bb0f3ce7f"><div class="ttname"><a href="classPhantom.html#ab37a930cd36cd7d25a11da6bb0f3ce7f">Phantom::VF</a></div><div class="ttdeci">std::vector&lt; Feature * &gt; VF</div><div class="ttdoc">List with the features. </div><div class="ttdef"><b>Definition:</b> <a href="phantom_8h_source.html#l01413">phantom.h:1413</a></div></div>
<div class="ttc" id="classPhantom_html_afa9738c948a9df13fdd2bb0f5657793a"><div class="ttname"><a href="classPhantom.html#afa9738c948a9df13fdd2bb0f5657793a">Phantom::project_to</a></div><div class="ttdeci">void project_to(Projection &amp;P, int Ydim, int Xdim, double rot, double tilt, double psi, const Matrix2D&lt; double &gt; *A=NULL) const </div><div class="ttdef"><b>Definition:</b> <a href="phantom_8cpp_source.html#l02576">phantom.cpp:2576</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_aba441ebef6931295ba1cb63e2cca89a8"><div class="ttname"><a href="numerical__recipes_8cpp.html#aba441ebef6931295ba1cb63e2cca89a8">if</a></div><div class="ttdeci">if(fabs(c[*nmax+*nmax *c_dim1])==0.e0)</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02296">numerical_recipes.cpp:2296</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
