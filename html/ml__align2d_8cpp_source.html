<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Xmipp: /home/yunior/Yunior/Projects/Scipion/COSS/xmipp-bundle/src/xmipp/libraries/reconstruction/ml_align2d.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xmipp_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Xmipp
   &#160;<span id="projectnumber">v20.07</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_dbce2b2c1291334a9ade6207c7a262fa.html">xmipp-bundle</a></li><li class="navelem"><a class="el" href="dir_5ca4f3e8e51f1e22c724fe6427eb943c.html">src</a></li><li class="navelem"><a class="el" href="dir_51a4fe91bde3feaf0f23bad87d0144e4.html">xmipp</a></li><li class="navelem"><a class="el" href="dir_c1f8b3d1b5354b6c120dfc6668096234.html">libraries</a></li><li class="navelem"><a class="el" href="dir_36a774f45692ae2527792ff0fdfc392f.html">reconstruction</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ml_align2d.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ml__align2d_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/***************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Authors:    Sjors Scheres           scheres@cnb.csic.es (2007)</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * Unidad de Bioinformatica del Centro Nacional de Biotecnologia , CSIC</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * This program is free software; you can redistribute it and/or modify</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * it under the terms of the GNU General Public License as published by</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * (at your option) any later version.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * This program is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * GNU General Public License for more details.</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * along with this program; if not, write to the Free Software</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * 02111-1307  USA</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> *  All comments concerning this program package may be sent to the</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> *  e-mail address &#39;xmipp@cnb.uam.es&#39;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> ***************************************************************************/</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ml__align2d_8h.html">ml_align2d.h</a>&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">//#define DEBUG_JM</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">//Mutex for each thread update sums</span></div><div class="line"><a name="l00029"></a><span class="lineno"><a class="line" href="ml__align2d_8cpp.html#a8c04d9a53742f1b981c80dd88aa430a1">   29</a></span>&#160;pthread_mutex_t <a class="code" href="ml__align2d_8cpp.html#a8c04d9a53742f1b981c80dd88aa430a1">update_mutex</a> =</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    PTHREAD_MUTEX_INITIALIZER;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">//Mutex for each thread get next refno</span></div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="ml__align2d_8cpp.html#a434e4700cbd673d587cedf170679ab1f">   32</a></span>&#160;pthread_mutex_t <a class="code" href="ml__align2d_8cpp.html#a434e4700cbd673d587cedf170679ab1f">refno_mutex</a> =</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    PTHREAD_MUTEX_INITIALIZER;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">// Constructor</span></div><div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="classProgML2D.html#a94e915acbf71212e430b234cdc5482b7">   36</a></span>&#160;<a class="code" href="classProgML2D.html#a94e915acbf71212e430b234cdc5482b7">ProgML2D::ProgML2D</a>()</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;{</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a963af5cdb6f63d876c147c24fbf8452e">do_ML3D</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a1e429b25f696eba0bb30a316517f0b31">refs_per_class</a> = 1;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;}</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="classProgML2D.html#a03314f1aa1a39bb98bdb0873d7eef331">   43</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a03314f1aa1a39bb98bdb0873d7eef331">ProgML2D::defineParams</a>()</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;{</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="classXmippProgram.html#a4f396af57519ec443b4656176eb962bf">addUsageLine</a>(<span class="stringliteral">&quot;Perform (multi-reference) 2D-alignment using a maximum-likelihood (ML) target function.&quot;</span>);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <a class="code" href="classXmippProgram.html#a4f396af57519ec443b4656176eb962bf">addUsageLine</a>(<span class="stringliteral">&quot;+Our recommended way of performing ML alignment is to introduce as little bias in the initial reference(s) as possible.&quot;</span>);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="classXmippProgram.html#a4f396af57519ec443b4656176eb962bf">addUsageLine</a>(<span class="stringliteral">&quot;+This can be done by calculting average images of random subsets of the (unaligned!) input experimental images, using the --nref option.&quot;</span>);</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="classXmippProgram.html#a4f396af57519ec443b4656176eb962bf">addUsageLine</a>(<span class="stringliteral">&quot;+Note that the estimates for the standard deviation in the noise and in the origin offsets are re-estimated every iteration,&quot;</span>);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="classXmippProgram.html#a4f396af57519ec443b4656176eb962bf">addUsageLine</a>(<span class="stringliteral">&quot;+so that the initial values should not matter too much, as long as they are \&quot;reasonable\&quot;. For Xmipp-normalized images,&quot;</span>);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="classXmippProgram.html#a4f396af57519ec443b4656176eb962bf">addUsageLine</a>(<span class="stringliteral">&quot;+the standard deviation in the noise can be assumed to be 1. For reasonably centered particles the default value of 3 for&quot;</span>);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="classXmippProgram.html#a4f396af57519ec443b4656176eb962bf">addUsageLine</a>(<span class="stringliteral">&quot;+the offsets should do the job.&quot;</span>);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="classXmippProgram.html#a4f396af57519ec443b4656176eb962bf">addUsageLine</a>(<span class="stringliteral">&quot;+&quot;</span>);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="classXmippProgram.html#a4f396af57519ec443b4656176eb962bf">addUsageLine</a>(<span class="stringliteral">&quot;+The output of the program consists of the refined reference images (weighted averages over all experimental images).&quot;</span>);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="classXmippProgram.html#a4f396af57519ec443b4656176eb962bf">addUsageLine</a>(<span class="stringliteral">&quot;+The experimental images are not altered at all. In terms of the ML approach, optimal transformations and references for&quot;</span>);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="classXmippProgram.html#a4f396af57519ec443b4656176eb962bf">addUsageLine</a>(<span class="stringliteral">&quot;+each image do not play the same role as in the conventional cross-correlation (or least-sqaures) approach. This program&quot;</span>);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="classXmippProgram.html#a4f396af57519ec443b4656176eb962bf">addUsageLine</a>(<span class="stringliteral">&quot;+can also be used for reference-free 2D-alignment using only a single reference: just supply =--nref 1= .&quot;</span>);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <a class="code" href="classXmippProgram.html#a4f396af57519ec443b4656176eb962bf">addUsageLine</a>(<span class="stringliteral">&quot;+Although the calculations can be rather time-consuming (especially for many, large experimental images and a large number of references),&quot;</span>);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="classXmippProgram.html#a4f396af57519ec443b4656176eb962bf">addUsageLine</a>(<span class="stringliteral">&quot;+we strongly recommend to let the calculations converge. In our experience this takes in the order of 10-100 iterations, depending on the&quot;</span>);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <a class="code" href="classXmippProgram.html#a4f396af57519ec443b4656176eb962bf">addUsageLine</a>(<span class="stringliteral">&quot;+number images, the amount of noise, etc. The default stopping criterium has yielded satisfactory results in our experience. A parallel &quot;</span>);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <a class="code" href="classXmippProgram.html#a4f396af57519ec443b4656176eb962bf">addUsageLine</a>(<span class="stringliteral">&quot;+version of this program has been implemented.&quot;</span>);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <a class="code" href="classXmippProgram.html#a78cb844dedc5e8f4de8320c9a7c8d0a2">addSeeAlsoLine</a>(<span class="stringliteral">&quot;mpi_ml_align2d&quot;</span>);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="classML2DBaseProgram.html#ac20210a2ca026ff1831be53bd25fe561">defineBasicParams</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a8c1341b893fa1371ebf8fea3255d3e41">defineAdditionalParams</a>(<span class="keyword">this</span>, <span class="stringliteral">&quot;==+ Additional options ==&quot;</span>);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a5bfd3f7250efeda01483917e5382b857">defineHiddenParams</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <a class="code" href="classXmippProgram.html#a4b8f0a6e1bd09e4dbf56a412101e905e">addExampleLine</a>(<span class="stringliteral">&quot;A typical use of this program is:&quot;</span>, <span class="keyword">false</span>);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="classXmippProgram.html#a4b8f0a6e1bd09e4dbf56a412101e905e">addExampleLine</a>(<span class="stringliteral">&quot;xmipp_ml_align2d -i input/images_some.stk --ref input/seeds2.stk --oroot output/ml2d --fast --mirror&quot;</span>);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;}</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">// Read arguments ==========================================================</span></div><div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="classProgML2D.html#adbc31a919b1e6b554a3201ad8aca9fec">   73</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#adbc31a919b1e6b554a3201ad8aca9fec">ProgML2D::readParams</a>()</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;{</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// Generate new command line for restart procedure</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a62698e9d68c10fa72db6deb1d3fc6794">cline</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordtype">int</span> argc2 = 0;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordtype">char</span> ** argv2 = NULL;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordtype">double</span> restart_noise=0, restart_offset=0;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="classFileName.html">FileName</a> restart_imgmd, restart_refmd;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordtype">int</span> restart_iter=0, restart_seed=0;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classML2DBaseProgram.html#a963af5cdb6f63d876c147c24fbf8452e">do_ML3D</a>  &amp;&amp; <a class="code" href="classXmippProgram.html#a1a27c450de95c55d122be23e3fe89ac1">checkParam</a>(<span class="stringliteral">&quot;--restart&quot;</span>))</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="comment">//TODO-------- Think later -----------</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <a class="code" href="group__ErrorHandling.html#ga4ab7f9b2fd1ec4b9efcfba0c9b33052c">REPORT_ERROR</a>(<a class="code" href="group__ErrorHandling.html#ggab0df38968e4f03a3f1f6d6df0f31f45aa5bed3f42a08e195b307cf8622e913327">ERR_NOT_IMPLEMENTED</a>, <span class="stringliteral">&quot;Not implemented restart in ml2d for now&quot;</span>);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="comment">//        do_restart = true;</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="comment">//        MetaData MDrestart;</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="comment">//        char *copy  = NULL;</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="comment">//        MDrestart.read(getParam(&quot;-restart&quot;));</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="comment">//        cline = MDrestart.getComment();</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="comment">//        MDrestart.getValue(MDL_SIGMANOISE, restart_noise);</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="comment">//        MDrestart.getValue(MDL_SIGMAOFFSET, restart_offset);</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <span class="comment">//        MDrestart.getValue(MDL_IMGMD, restart_imgmd);</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="comment">//        MDrestart.getValue(MDL_REFMD, restart_refmd);</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="comment">//        MDrestart.getValue(MDL_ITER, restart_iter);</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="comment">//        MDrestart.getValue(MDL_RANDOMSEED, restart_seed);</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="comment">//        generateCommandLine(cline, argc2, argv2, copy);</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="comment">//        //Take argument from the restarting command line</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="comment">//        progDef-&gt;read(argc2, argv2);</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    }</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="comment">// no restart, just copy argc to argc2 and argv to argv2</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a4f7d61fca21cd29df3119a200b9a4bd3">do_restart</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="classXmippProgram.html#a8659f9e603143c1788360f0eeb01e589">argc</a>; <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a62698e9d68c10fa72db6deb1d3fc6794">cline</a> = <a class="code" href="classML2DBaseProgram.html#a62698e9d68c10fa72db6deb1d3fc6794">cline</a> + (<a class="code" href="xmipp__strings_8h.html#afbeda3fd1bdc8c37d01bdf9f5c8274ff">String</a>) <a class="code" href="classXmippProgram.html#af2f60708934c302e1289c5405109dd45">argv</a>[<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>] + <span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    }</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a> = <a class="code" href="classXmippProgram.html#a7b7ddf0836dc1079ea2622e2a420c39c">getIntParam</a>(<span class="stringliteral">&quot;--nref&quot;</span>);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a9544695d9d0054d6e75d62f227bee889">fn_ref</a> = <a class="code" href="classXmippProgram.html#a5d9e1f008822effa47814c59e9a3c797">getParam</a>(<span class="stringliteral">&quot;--ref&quot;</span>);</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a4e593a9112ddcc0256bc9b72213cdb3b">fn_img</a> = <a class="code" href="classXmippProgram.html#a5d9e1f008822effa47814c59e9a3c797">getParam</a>(<span class="stringliteral">&quot;-i&quot;</span>);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <a class="code" href="classML2DBaseProgram.html#adfab8933f95443ac6d909a9b206b3fa8">fn_root</a> = <a class="code" href="classXmippProgram.html#a5d9e1f008822effa47814c59e9a3c797">getParam</a>(<span class="stringliteral">&quot;--oroot&quot;</span>);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <a class="code" href="classML2DBaseProgram.html#aae259850c9b209a3ff3cbcc7799e2742">psi_step</a> = <a class="code" href="classXmippProgram.html#a552e1ea4a84576d9149b965d9edb6277">getDoubleParam</a>(<span class="stringliteral">&quot;--psi_step&quot;</span>);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a027f02ad68a63785c0ef49fa1b9db759">Niter</a> = <a class="code" href="classXmippProgram.html#a7b7ddf0836dc1079ea2622e2a420c39c">getIntParam</a>(<span class="stringliteral">&quot;--iter&quot;</span>);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">//Fixed values for the 3D case</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a963af5cdb6f63d876c147c24fbf8452e">do_ML3D</a>)</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a495926025de4de5360efd7266377cc2c">istart</a> = 1;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a47f7cd87d5f078979db61864b4f6d55f">fast_mode</a> = <a class="code" href="classML2DBaseProgram.html#a5597237821521e53baea8549f16a8d55">save_mem2</a> = <a class="code" href="classML2DBaseProgram.html#ad9b9535e1774d805e5bbee89dee0f4b5">do_mirror</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    }</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    {</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="comment">//istart = getIntParam(&quot;--istart&quot;);</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a495926025de4de5360efd7266377cc2c">istart</a> = 1;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <a class="code" href="classML2DBaseProgram.html#ad9b9535e1774d805e5bbee89dee0f4b5">do_mirror</a> = <a class="code" href="classXmippProgram.html#a1a27c450de95c55d122be23e3fe89ac1">checkParam</a>(<span class="stringliteral">&quot;--mirror&quot;</span>);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a5597237821521e53baea8549f16a8d55">save_mem2</a> = <a class="code" href="classXmippProgram.html#a1a27c450de95c55d122be23e3fe89ac1">checkParam</a>(<span class="stringliteral">&quot;--save_memB&quot;</span>);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a47f7cd87d5f078979db61864b4f6d55f">fast_mode</a> = <a class="code" href="classXmippProgram.html#a1a27c450de95c55d122be23e3fe89ac1">checkParam</a>(<span class="stringliteral">&quot;--fast&quot;</span>);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#aa1281d05277a75579f9adb3b19304a7b">sigma_noise</a> = <a class="code" href="classXmippProgram.html#a552e1ea4a84576d9149b965d9edb6277">getDoubleParam</a>(<span class="stringliteral">&quot;--noise&quot;</span>);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ee9d8ba6b21965a4fd84a8987c0b76e">sigma_offset</a> = <a class="code" href="classXmippProgram.html#a552e1ea4a84576d9149b965d9edb6277">getDoubleParam</a>(<span class="stringliteral">&quot;--offset&quot;</span>);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a909478a47c338d181693f9421ecb4bd3">eps</a> = <a class="code" href="classXmippProgram.html#a552e1ea4a84576d9149b965d9edb6277">getDoubleParam</a>(<span class="stringliteral">&quot;--eps&quot;</span>);</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <a class="code" href="classML2DBaseProgram.html#abf6ec880b915a0887a9e0a864c3ff467">fn_frac</a> = <a class="code" href="classXmippProgram.html#a5d9e1f008822effa47814c59e9a3c797">getParam</a>(<span class="stringliteral">&quot;--frac&quot;</span>);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a6f89b87041906702ae5c30638bd2762c">fix_fractions</a> = <a class="code" href="classXmippProgram.html#a1a27c450de95c55d122be23e3fe89ac1">checkParam</a>(<span class="stringliteral">&quot;--fix_fractions&quot;</span>);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a3c0fde6f9005eec528cc1f703019719c">fix_sigma_offset</a> = <a class="code" href="classXmippProgram.html#a1a27c450de95c55d122be23e3fe89ac1">checkParam</a>(<span class="stringliteral">&quot;--fix_sigma_offset&quot;</span>);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a4646a8113c64d86101389cb4f373bca3">fix_sigma_noise</a> = <a class="code" href="classXmippProgram.html#a1a27c450de95c55d122be23e3fe89ac1">checkParam</a>(<span class="stringliteral">&quot;--fix_sigma_noise&quot;</span>);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a67faef1c7bbe1544c7f51e4d4fa0e833">C_fast</a> = <a class="code" href="classXmippProgram.html#a552e1ea4a84576d9149b965d9edb6277">getDoubleParam</a>(<span class="stringliteral">&quot;-C&quot;</span>);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <a class="code" href="classML2DBaseProgram.html#ad640e8275de5576531913f2e9ed1628d">save_mem1</a> = <a class="code" href="classXmippProgram.html#a1a27c450de95c55d122be23e3fe89ac1">checkParam</a>(<span class="stringliteral">&quot;--save_memA&quot;</span>);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <a class="code" href="classML2DBaseProgram.html#ab4ef26e8db432f9c366375915204f0d7">zero_offsets</a> = <a class="code" href="classXmippProgram.html#a1a27c450de95c55d122be23e3fe89ac1">checkParam</a>(<span class="stringliteral">&quot;--zero_offsets&quot;</span>);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ba63ac8129e521abfeaeaee3bb4c38d">do_student</a> = <a class="code" href="classXmippProgram.html#a1a27c450de95c55d122be23e3fe89ac1">checkParam</a>(<span class="stringliteral">&quot;--student&quot;</span>);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a8671946de2e241de54a47e2822989ca1">df</a> = <a class="code" href="classXmippProgram.html#a552e1ea4a84576d9149b965d9edb6277">getDoubleParam</a>(<span class="stringliteral">&quot;--student&quot;</span>);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">do_norm</a> = <a class="code" href="classXmippProgram.html#a1a27c450de95c55d122be23e3fe89ac1">checkParam</a>(<span class="stringliteral">&quot;--norm&quot;</span>);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">// Number of threads</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <a class="code" href="classML2DBaseProgram.html#af249c63e39331ba0e4dfbcd39cafdce9">threads</a> = <a class="code" href="classXmippProgram.html#a7b7ddf0836dc1079ea2622e2a420c39c">getIntParam</a>(<span class="stringliteral">&quot;--thr&quot;</span>);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">//testing the thread load in refno</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="classProgML2D.html#a38a613cb2ebb88a3e8ed436f6743b15b">refno_load_param</a> = <a class="code" href="classXmippProgram.html#a7b7ddf0836dc1079ea2622e2a420c39c">getIntParam</a>(<span class="stringliteral">&quot;--load&quot;</span>);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">// Hidden arguments</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a1b904ff65f4ee4b5bbcfd31f79753b5f">fn_scratch</a> = <a class="code" href="group__Arguments.html#ga42227a0d5306b2b82e58b1952ab35976">getParameter</a>(argc2, (<span class="keyword">const</span> <span class="keywordtype">char</span> **)argv2, <span class="stringliteral">&quot;--scratch&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="classXmippProgram.html#a0130b89f1f5431b03ef161d7e231bd48">debug</a> = <a class="code" href="classXmippProgram.html#a7b7ddf0836dc1079ea2622e2a420c39c">getIntParam</a>(<span class="stringliteral">&quot;--debug&quot;</span>);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a2b62f72135dd8b84c77a5c26203c7e19">do_student_sigma_trick</a> = !<a class="code" href="classXmippProgram.html#a1a27c450de95c55d122be23e3fe89ac1">checkParam</a>(<span class="stringliteral">&quot;--no_sigma_trick&quot;</span>);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a0bff1f1ebc6ee583b1b6f4f2d55ec3ae">trymindiff_factor</a> = <a class="code" href="classXmippProgram.html#a552e1ea4a84576d9149b965d9edb6277">getDoubleParam</a>(<span class="stringliteral">&quot;--trymindiff_factor&quot;</span>);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">// Random seed to use for image randomization and creation</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="comment">// of initial references and blocks order</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="comment">// could be passed for restart or for debugging</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <a class="code" href="classXmippProgram.html#a51ae38ef10274f8f7c6c02ab2a67a28c">seed</a> = <a class="code" href="classXmippProgram.html#a7b7ddf0836dc1079ea2622e2a420c39c">getIntParam</a>(<span class="stringliteral">&quot;--random_seed&quot;</span>);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classXmippProgram.html#a51ae38ef10274f8f7c6c02ab2a67a28c">seed</a> == -1)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <a class="code" href="classXmippProgram.html#a51ae38ef10274f8f7c6c02ab2a67a28c">seed</a> = time(NULL);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="classML2DBaseProgram.html#a4f7d61fca21cd29df3119a200b9a4bd3">do_restart</a> &amp;&amp; <a class="code" href="classXmippProgram.html#aed62cfe3c074e69076bf348fc101a717">verbose</a>)</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;WARNING: *** Using a non random seed and not in restarting ***&quot;</span> &lt;&lt;std::endl;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="comment">// Only for interaction with refine3d:</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a4ca3328df09f636935d22b5b946a3704">search_rot</a> = <a class="code" href="classXmippProgram.html#a552e1ea4a84576d9149b965d9edb6277">getDoubleParam</a>(<span class="stringliteral">&quot;--search_rot&quot;</span>);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">//IEM stuff</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a7b0d716eb64a885e060bd3d380fe83be">blocks</a> = <a class="code" href="classXmippProgram.html#a7b7ddf0836dc1079ea2622e2a420c39c">getIntParam</a>(<span class="stringliteral">&quot;--iem&quot;</span>);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">// Now reset some stuff for restart</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a4f7d61fca21cd29df3119a200b9a4bd3">do_restart</a>)</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    {</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a4e593a9112ddcc0256bc9b72213cdb3b">fn_img</a> = restart_imgmd;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a9544695d9d0054d6e75d62f227bee889">fn_ref</a> = restart_refmd;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a> = 0; <span class="comment">// Just to be sure (not strictly necessary)</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#aa1281d05277a75579f9adb3b19304a7b">sigma_noise</a> = restart_noise;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ee9d8ba6b21965a4fd84a8987c0b76e">sigma_offset</a> = restart_offset;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <a class="code" href="classXmippProgram.html#a51ae38ef10274f8f7c6c02ab2a67a28c">seed</a> = restart_seed;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a495926025de4de5360efd7266377cc2c">istart</a> = restart_iter + 1;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a> = 1;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    }</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <a class="code" href="classProgML2D.html#a1cea5bc589a8f97575862d7521f0fc1e">no_iem</a> = <a class="code" href="classXmippProgram.html#a1a27c450de95c55d122be23e3fe89ac1">checkParam</a>(<span class="stringliteral">&quot;--no_iem&quot;</span>);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="comment">//std::cerr &lt;&lt; &quot;DEBUG_JM: exiting after readParams...&quot; &lt;&lt;std::endl;</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">//exit(1);</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;}</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">// Show ====================================================================</span></div><div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="classProgML2D.html#a1c25285ac94df07073424f8bd59ec401">  194</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a1c25285ac94df07073424f8bd59ec401">ProgML2D::show</a>()</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;{</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classXmippProgram.html#aed62cfe3c074e69076bf348fc101a717">verbose</a>)</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    {</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="comment">// To screen</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classML2DBaseProgram.html#a963af5cdb6f63d876c147c24fbf8452e">do_ML3D</a>)</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            std::cout</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; -----------------------------------------------------------------&quot;</span> &lt;&lt; std::endl</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; | Read more about this program in the following publications:   |&quot;</span> &lt;&lt; std::endl</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; |  Scheres ea. (2005) J.Mol.Biol. 348(1), 139-49                |&quot;</span> &lt;&lt; std::endl</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; |  Scheres ea. (2005) Bioinform. 21(suppl.2), ii243-4   (-fast) |&quot;</span> &lt;&lt; std::endl</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; |                                                               |&quot;</span>&lt;&lt;  std::endl</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; |  *** Please cite them if this program is of use to you! ***   |&quot;</span>&lt;&lt;  std::endl</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            &lt;&lt; <span class="stringliteral">&quot; -----------------------------------------------------------------&quot;</span>&lt;&lt;  std::endl;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        }</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        std::cout    &lt;&lt; <span class="stringliteral">&quot;--&gt; Maximum-likelihood multi-reference refinement &quot;</span> &lt;&lt; std::endl</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        &lt;&lt; <a class="code" href="group__StringUtilities.html#gaa405c9a5b808e428554e540028085dd3">formatString</a>(<span class="stringliteral">&quot;  Input images            : %s (%lu)\n&quot;</span>, <a class="code" href="classML2DBaseProgram.html#a4e593a9112ddcc0256bc9b72213cdb3b">fn_img</a>.c_str(), <a class="code" href="classML2DBaseProgram.html#a55332f697c74f72635ae850439407645">nr_images_global</a>);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a9544695d9d0054d6e75d62f227bee889">fn_ref</a> != <span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            std::cout &lt;&lt; <a class="code" href="group__StringUtilities.html#gaa405c9a5b808e428554e540028085dd3">formatString</a>(<span class="stringliteral">&quot;  Reference image(s)      : %s (%d)\n&quot;</span>, <a class="code" href="classML2DBaseProgram.html#a9544695d9d0054d6e75d62f227bee889">fn_ref</a>.c_str(), <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a> &gt; 1)</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;  Reference expanding factor   : &quot;</span> &lt;&lt; <a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a> &lt;&lt; std::endl;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;  Number of references:   : &quot;</span> &lt;&lt; <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a> * <a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a> &lt;&lt; std::endl;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        std::cout</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;  Output rootname         : &quot;</span> &lt;&lt; <a class="code" href="classML2DBaseProgram.html#adfab8933f95443ac6d909a9b206b3fa8">fn_root</a> &lt;&lt; std::endl</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;  Stopping criterium      : &quot;</span> &lt;&lt; <a class="code" href="classML2DBaseProgram.html#a909478a47c338d181693f9421ecb4bd3">eps</a> &lt;&lt; std::endl</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;  Initial sigma noise     : &quot;</span> &lt;&lt; <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#aa1281d05277a75579f9adb3b19304a7b">sigma_noise</a> &lt;&lt; std::endl</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;  Initial sigma offset    : &quot;</span> &lt;&lt; <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ee9d8ba6b21965a4fd84a8987c0b76e">sigma_offset</a> &lt;&lt; std::endl</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;  Psi sampling interval   : &quot;</span> &lt;&lt; <a class="code" href="classML2DBaseProgram.html#aae259850c9b209a3ff3cbcc7799e2742">psi_step</a> &lt;&lt; std::endl</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        &lt;&lt; <span class="stringliteral">&quot;  Check mirrors           : &quot;</span> &lt;&lt; (<a class="code" href="classML2DBaseProgram.html#ad9b9535e1774d805e5bbee89dee0f4b5">do_mirror</a> ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>) &lt;&lt; std::endl;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classML2DBaseProgram.html#abf6ec880b915a0887a9e0a864c3ff467">fn_frac</a>.empty())</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;  Initial model fractions : &quot;</span> &lt;&lt; <a class="code" href="classML2DBaseProgram.html#abf6ec880b915a0887a9e0a864c3ff467">fn_frac</a> &lt;&lt; std::endl;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a47f7cd87d5f078979db61864b4f6d55f">fast_mode</a>)</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;  -&gt; Use fast, reduced search-space approach with C = &quot;</span> &lt;&lt; <a class="code" href="classML2DBaseProgram.html#a67faef1c7bbe1544c7f51e4d4fa0e833">C_fast</a> &lt;&lt; std::endl;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#ab4ef26e8db432f9c366375915204f0d7">zero_offsets</a>)</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                std::cout &lt;&lt; <span class="stringliteral">&quot;    + Start from all-zero translations&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        }</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a4ca3328df09f636935d22b5b946a3704">search_rot</a> &lt; 180.)</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            std::cout &lt;&lt; <a class="code" href="group__StringUtilities.html#gaa405c9a5b808e428554e540028085dd3">formatString</a>(<span class="stringliteral">&quot;    + Limit orientational search to +/- %f degrees&quot;</span>, <a class="code" href="classML2DBaseProgram.html#a4ca3328df09f636935d22b5b946a3704">search_rot</a>) &lt;&lt; std::endl;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#ad640e8275de5576531913f2e9ed1628d">save_mem1</a>)</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;  -&gt; Save_memory A: recalculate real-space rotations in -fast&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5597237821521e53baea8549f16a8d55">save_mem2</a>)</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;  -&gt; Save_memory B: limit translations to 3 sigma_offset &quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a6f89b87041906702ae5c30638bd2762c">fix_fractions</a>)</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;  -&gt; Do not update estimates of model fractions.&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a3c0fde6f9005eec528cc1f703019719c">fix_sigma_offset</a>)</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;  -&gt; Do not update sigma-estimate of origin offsets.&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a4646a8113c64d86101389cb4f373bca3">fix_sigma_noise</a>)</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;  -&gt; Do not update sigma-estimate of noise.&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ba63ac8129e521abfeaeaee3bb4c38d">do_student</a>)</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        {</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;  -&gt; Use t-student distribution with df = &quot;</span> &lt;&lt; <a class="code" href="classML2DBaseProgram.html#a8671946de2e241de54a47e2822989ca1">df</a> &lt;&lt; std::endl;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a2b62f72135dd8b84c77a5c26203c7e19">do_student_sigma_trick</a>)</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                std::cout &lt;&lt; <span class="stringliteral">&quot;  -&gt; Use sigma-trick for t-student distributions&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">do_norm</a>)</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;  -&gt; Refine normalization for each experimental image&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#af249c63e39331ba0e4dfbcd39cafdce9">threads</a> &gt; 1)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;  -&gt; Using &quot;</span> &lt;&lt; <a class="code" href="classML2DBaseProgram.html#af249c63e39331ba0e4dfbcd39cafdce9">threads</a> &lt;&lt; <span class="stringliteral">&quot; parallel threads&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a7b0d716eb64a885e060bd3d380fe83be">blocks</a> &gt; 1)</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;  -&gt; Doing IEM with &quot;</span> &lt;&lt; <a class="code" href="classML2DBaseProgram.html#a7b0d716eb64a885e060bd3d380fe83be">blocks</a> &lt;&lt; <span class="stringliteral">&quot; blocks&quot;</span> &lt;&lt;std::endl;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot; -----------------------------------------------------------------&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    }</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;}</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno"><a class="line" href="classProgML2D.html#a0ffe94562ea23e1ac3676de859b454dc">  279</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a0ffe94562ea23e1ac3676de859b454dc">ProgML2D::printModel</a>(<span class="keyword">const</span> <a class="code" href="xmipp__strings_8h.html#afbeda3fd1bdc8c37d01bdf9f5c8274ff">String</a> &amp;msg, <span class="keyword">const</span> <a class="code" href="classModelML2D.html">ModelML2D</a> &amp; <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>)</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;{</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;================&gt; &quot;</span> &lt;&lt; msg &lt;&lt; std::endl;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    model.<a class="code" href="classModelML2D.html#acbf810e559c0ac21117558f703b603ff">print</a>();</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;}</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">//#define LOG(str)</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">// Trying to merge produceSideInfo 1 y 2</span></div><div class="line"><a name="l00288"></a><span class="lineno"><a class="line" href="classProgML2D.html#ad27429da545246b2d9d953e99fca0a4a">  288</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#ad27429da545246b2d9d953e99fca0a4a">ProgML2D::produceSideInfo</a>()</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;{</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="mpi__write__test_8cpp.html#a158a8c64f24645c7478298399825737f">LOG</a>(<span class="stringliteral">&quot;      ProgML2D::produceSideInfo: start&quot;</span>);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="comment">// Read selfile with experimental images</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="comment">// and set some global variables</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <a class="code" href="mpi__write__test_8cpp.html#a158a8c64f24645c7478298399825737f">LOG</a>(<span class="stringliteral">&quot;      ProgML2D::produceSideInfo: reading MDimg&quot;</span>);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#ab7f8d43d77647ade923e6cd63eafdd03">read</a>(<a class="code" href="classML2DBaseProgram.html#a4e593a9112ddcc0256bc9b72213cdb3b">fn_img</a>);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="comment">// Remove disabled images</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#a55651d0806335c55622838d62b8068b5">removeDisabled</a>();</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a55332f697c74f72635ae850439407645">nr_images_global</a> = <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#ad844b6a5655be4205e4bb03ab6372562">size</a>();</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">// By default set myFirst and myLast equal to 0 and N</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">// respectively, this should be changed when using MPI</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="comment">// by calling setWorkingImages before produceSideInfo2</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a791b7cb014db4297f7772becd1daa287">myFirstImg</a> = 0;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a3c0b6cb5428a40ae95864f5c45c50940">myLastImg</a> = <a class="code" href="classML2DBaseProgram.html#a55332f697c74f72635ae850439407645">nr_images_global</a> - 1;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">//Initialize blocks</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a3db6d60cc8179ba2a57c55cf7d5ba362">current_block</a> = 0;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment">// Create a vector of objectIDs, which may be randomized later on</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#a1a76384897857d639447524ff2f14ab3">findObjects</a>(<a class="code" href="classML2DBaseProgram.html#a3464cb9938eb4cf849b7c8bbb354734f">img_id</a>);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="comment">// Get original image size</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="xmipp__funcs_8cpp.html#a6b2ac43eac850ac39594e8a5f5aa42fe">idum</a>, idumLong;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="mpi__write__test_8cpp.html#a158a8c64f24645c7478298399825737f">LOG</a>(<span class="stringliteral">&quot;      ProgML2D::produceSideInfo: setting dimensions&quot;</span>);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <a class="code" href="group__MetaDataExtension.html#gac0be4f4f5a50390ff4939b437170e700">getImageSize</a>(<a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>, <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>, idum, idum, idumLong);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a975642ba000f15ba72f4a5c833205f92">dim</a> = <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a90e6ce499655b4566e17e32102a905c4">hdim</a> = <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a> / 2;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a997e2be4af206a96283a2f73cfacdcfe">dim2</a> = <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a> * <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a790a55bd210ce856bfbbd8853c6789df">ddim2</a> = (double) <a class="code" href="classML2DBaseProgram.html#a997e2be4af206a96283a2f73cfacdcfe">dim2</a>;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordtype">double</span> sigma_noise2 = <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#aa1281d05277a75579f9adb3b19304a7b">sigma_noise</a> * <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#aa1281d05277a75579f9adb3b19304a7b">sigma_noise</a>;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ba63ac8129e521abfeaeaee3bb4c38d">do_student</a>)</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    {</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a3106e12c5756e90d770df3708307258d">df2</a> = -(<a class="code" href="classML2DBaseProgram.html#a8671946de2e241de54a47e2822989ca1">df</a> + <a class="code" href="classML2DBaseProgram.html#a790a55bd210ce856bfbbd8853c6789df">ddim2</a>) / 2.;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a3169a7f52fce4768757155f99b12fa84">dfsigma2</a> = <a class="code" href="classML2DBaseProgram.html#a8671946de2e241de54a47e2822989ca1">df</a> * sigma_noise2;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    }</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a9544695d9d0054d6e75d62f227bee889">fn_ref</a>.empty())</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    {</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="comment">//generate an initial reference just by averaging the experimental images</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <a class="code" href="mpi__write__test_8cpp.html#a158a8c64f24645c7478298399825737f">LOG</a>(<span class="stringliteral">&quot;      ProgML2D::produceSideInfo: generate an initial reference just by averaging the experimental images&quot;</span>);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <a class="code" href="classFileName.html">FileName</a> fn_tmp;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <a class="code" href="classImage.html">Image&lt;double&gt;</a> img, avg(dim, dim);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        avg().initZeros();</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        avg().setXmippOrigin();</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <a class="code" href="group__MetaData.html#ga85652b971edca3acc93a9f1bef2f17f6">FOR_ALL_OBJECTS_IN_METADATA</a>(<a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>)</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        {</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#a2239fbb7e492654f1e2866ab27492a5d">getValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78af4298cfa617e6143f021d0d7956a7f70">MDL_IMAGE</a>, fn_tmp, __iter.objId);</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            img.<a class="code" href="classImageBase.html#a88636b7a7bd4e0e454877e691ee2da84">read</a>(fn_tmp);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            img().setXmippOrigin();</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            avg() += img();</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        }</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        avg() /= <a class="code" href="classML2DBaseProgram.html#a55332f697c74f72635ae850439407645">nr_images_global</a>;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#aa1c0b1d7d95d9939d5cdb9ee4c923006">setNRef</a>(1);</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a29baa2fb66177265cb0de6d027ea454a">Iref</a>[0] = avg;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a9544695d9d0054d6e75d62f227bee889">fn_ref</a> = <a class="code" href="classML2DBaseProgram.html#adfab8933f95443ac6d909a9b206b3fa8">fn_root</a> + <span class="stringliteral">&quot;_images_average.xmp&quot;</span>;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        avg.<a class="code" href="classImageBase.html#ae81a8c11a832924c2bda0909882c3168">write</a>(<a class="code" href="classML2DBaseProgram.html#a9544695d9d0054d6e75d62f227bee889">fn_ref</a>);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="comment">// Print some output to screen</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <a class="code" href="mpi__write__test_8cpp.html#a158a8c64f24645c7478298399825737f">LOG</a>(<span class="stringliteral">&quot;      ProgML2D::produceSideInfo show&quot;</span>);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <a class="code" href="classProgML2D.html#a1c25285ac94df07073424f8bd59ec401">show</a>();</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <a class="code" href="mpi__write__test_8cpp.html#a158a8c64f24645c7478298399825737f">LOG</a>(<span class="stringliteral">&quot;      ProgML2D::produceSideInfo end&quot;</span>);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;}</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div><div class="line"><a name="l00355"></a><span class="lineno"><a class="line" href="classProgML2D.html#ad72b32e1b0e8d1038ca0b96165ac3868">  355</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#ad72b32e1b0e8d1038ca0b96165ac3868">ProgML2D::produceSideInfo2</a>()</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;{</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <a class="code" href="classImage.html">Image&lt;double&gt;</a> img;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <a class="code" href="classFileName.html">FileName</a> fn_tmp;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="comment">// Read in all reference images in memory</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>.<a class="code" href="classMetaData.html#ab7f8d43d77647ade923e6cd63eafdd03">read</a>(<a class="code" href="classML2DBaseProgram.html#a9544695d9d0054d6e75d62f227bee889">fn_ref</a>);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>.<a class="code" href="classMetaData.html#a55651d0806335c55622838d62b8068b5">removeDisabled</a>();</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#aa1c0b1d7d95d9939d5cdb9ee4c923006">setNRef</a>(<a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>.<a class="code" href="classMetaData.html#ad844b6a5655be4205e4bb03ab6372562">size</a>());</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordtype">int</span> refno = 0;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordtype">double</span> fraction = (double) 1./ <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordtype">double</span> weight = fraction * (<span class="keywordtype">double</span>) <a class="code" href="classML2DBaseProgram.html#a55332f697c74f72635ae850439407645">nr_images_global</a>;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordtype">double</span> rot = 0., tilt = 0.;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <a class="code" href="group__MetaData.html#ga85652b971edca3acc93a9f1bef2f17f6">FOR_ALL_OBJECTS_IN_METADATA</a>(<a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>)</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    {</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>.<a class="code" href="classMetaData.html#a2239fbb7e492654f1e2866ab27492a5d">getValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78af4298cfa617e6143f021d0d7956a7f70">MDL_IMAGE</a>, fn_tmp, __iter.objId);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>.<a class="code" href="classMetaData.html#a2239fbb7e492654f1e2866ab27492a5d">getValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a59fffce298c0f99a1d592544d3d39a08">MDL_ANGLE_ROT</a>, rot, __iter.objId);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>.<a class="code" href="classMetaData.html#a2239fbb7e492654f1e2866ab27492a5d">getValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78ac15f836e18a2035d2923ecf76c6e8c7f">MDL_ANGLE_TILT</a>, rot, __iter.objId);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        img.<a class="code" href="classImageBase.html#a88636b7a7bd4e0e454877e691ee2da84">read</a>(fn_tmp);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        img.<a class="code" href="classImageBase.html#a8ea0cabc10eb710a8a997aa19bfb71a1">setEulerAngles</a>(rot, tilt, 0.);</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        img().setXmippOrigin();</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        img.<a class="code" href="classImageBase.html#ad19263dd187d5a29fc6ed889ba299097">setWeight</a>(weight);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a29baa2fb66177265cb0de6d027ea454a">Iref</a>[refno] = img;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="comment">//model.WsumMref[refno] = img;</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <span class="comment">// Default start is all equal model fractions</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a9623e75d2dcf944d1fa02a53fe851cd0">alpha_k</a>[refno] = fraction;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="comment">//model.WsumMref[refno]() *= weight;</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="comment">// Default start is half-half mirrored images</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#aae60b45954a007f5f9b95ae73c637205">mirror_fraction</a>[refno] = (<a class="code" href="classML2DBaseProgram.html#ad9b9535e1774d805e5bbee89dee0f4b5">do_mirror</a> ? 0.5 : 0.);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        ++refno;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    }</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a950eaf7e71168d33294c20a7b3efa94b">setNumberOfLocalImages</a>();</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="comment">// prepare masks for rotated references</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <a class="code" href="classProgML2D.html#a8408a3dd090f5a67ffb34a209d48ce02">mask</a>.<a class="code" href="classMultidimArray.html#a048fe82e79de7fba796cd4e87869ef36">resize</a>(<a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>, <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>);</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <a class="code" href="classProgML2D.html#a8408a3dd090f5a67ffb34a209d48ce02">mask</a>.<a class="code" href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">setXmippOrigin</a>();</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <a class="code" href="group__Masks.html#ga1f835f6611a65877b172c170a555f869">BinaryCircularMask</a>(<a class="code" href="classProgML2D.html#a8408a3dd090f5a67ffb34a209d48ce02">mask</a>, <a class="code" href="classML2DBaseProgram.html#a90e6ce499655b4566e17e32102a905c4">hdim</a>, <a class="code" href="group__Masks.html#gacca4111ca94cf58386ec048e31865962">INNER_MASK</a>);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <a class="code" href="classProgML2D.html#ad2908f9cced8aa5456025a8dcda6e6f1">omask</a>.<a class="code" href="classMultidimArray.html#a048fe82e79de7fba796cd4e87869ef36">resize</a>(<a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>, <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <a class="code" href="classProgML2D.html#ad2908f9cced8aa5456025a8dcda6e6f1">omask</a>.<a class="code" href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">setXmippOrigin</a>();</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <a class="code" href="group__Masks.html#ga1f835f6611a65877b172c170a555f869">BinaryCircularMask</a>(<a class="code" href="classProgML2D.html#ad2908f9cced8aa5456025a8dcda6e6f1">omask</a>, <a class="code" href="classML2DBaseProgram.html#a90e6ce499655b4566e17e32102a905c4">hdim</a>, <a class="code" href="group__Masks.html#gadbf06cdc74e0428f1578bde31368cea1">OUTSIDE_MASK</a>);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="comment">// Construct matrices for 0, 90, 180 &amp; 270 degree flipping and mirrors</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a08dc75912c3b5bf4be88e88a81cf23fa">initSamplingStuff</a>();</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="comment">// Set sigdim, i.e. the number of pixels that will be considered in the translations</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <a class="code" href="classProgML2D.html#a58c7e5ee272eb1e83531df902e67064d">sigdim</a> = 2 * (size_t)ceil(<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ee9d8ba6b21965a4fd84a8987c0b76e">sigma_offset</a> * (<a class="code" href="classML2DBaseProgram.html#a5597237821521e53baea8549f16a8d55">save_mem2</a> ? 3 : 6));</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    ++<a class="code" href="classProgML2D.html#a58c7e5ee272eb1e83531df902e67064d">sigdim</a>; <span class="comment">// (to get uneven number)</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <a class="code" href="classProgML2D.html#a58c7e5ee272eb1e83531df902e67064d">sigdim</a> = <a class="code" href="group__Macros.html#gac9ae6a207f10c821b06a8c0df153a7d5">XMIPP_MIN</a>(<a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>, <a class="code" href="classProgML2D.html#a58c7e5ee272eb1e83531df902e67064d">sigdim</a>);</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="comment">//Some vectors and matrixes initialization</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keywordtype">int</span> num_output_refs = <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a> * <a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a>;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="comment">//std::cerr &lt;&lt; &quot;DEBUG_JM: num_output_refs: &quot; &lt;&lt; num_output_refs &lt;&lt; std::endl;</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <a class="code" href="classProgML2D.html#ae2342cb5f821a8f8d90d103b543c1083">refw</a>.resize(num_output_refs);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <a class="code" href="classProgML2D.html#ae0bda101c64aff966641b35d19c6f910">refw2</a>.resize(num_output_refs);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <a class="code" href="classProgML2D.html#a709602bc38cda149337eb088b00bcdca">refwsc2</a>.resize(num_output_refs);</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <a class="code" href="classProgML2D.html#ae0c18214588873b98a6ea20daabdd924">refw_mirror</a>.resize(num_output_refs);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <a class="code" href="classProgML2D.html#aac2d16debfdf2fe8866e3f444ed8a697">sumw_refpsi</a>.resize(num_output_refs * <a class="code" href="classML2DBaseProgram.html#a976dc404489a0c66af2800f0f73e76c7">nr_psi</a>);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <a class="code" href="classProgML2D.html#a161f40ee3ca8ea86269a02026cda6040">A2</a>.resize(num_output_refs);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <a class="code" href="classProgML2D.html#a1df4cb7668c8de81e5f012be633c4b10">fref</a>.resize(num_output_refs * nr_psi);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <a class="code" href="classProgML2D.html#a28206f5adc9ded7be742b51a9fa39c18">mref</a>.resize(num_output_refs * nr_psi);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <a class="code" href="classProgML2D.html#ab3401ed5e2fdaef29418db09181b706d">wsum_Mref</a>.resize(num_output_refs);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <a class="code" href="classProgML2D.html#ac5e5c4cf86a9dad9ac604abf2aaa94cf">mysumimgs</a>.resize(num_output_refs * nr_psi);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <a class="code" href="classML2DBaseProgram.html#aa53d160970e65511ba3f5d89db29b651">Iold</a>.resize(num_output_refs);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a47f7cd87d5f078979db61864b4f6d55f">fast_mode</a>)</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    {</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keywordtype">int</span> mysize = num_output_refs * (<a class="code" href="classML2DBaseProgram.html#ad9b9535e1774d805e5bbee89dee0f4b5">do_mirror</a> ? 2 : 1);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        <span class="comment">//if (do_mirror)</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <span class="comment">//    mysize *= 2;</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        <a class="code" href="classProgML2D.html#a9d11e4c518188bc47da9cfe4094871db">ioptx_ref</a>.resize(mysize);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <a class="code" href="classProgML2D.html#a4535601aac7b6d868dd078b14cf8e6e6">iopty_ref</a>.resize(mysize);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <a class="code" href="classProgML2D.html#a529bf5af816c32545f791c54b0d656eb">ioptflip_ref</a>.resize(mysize);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    }</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <a class="code" href="classML2DBaseProgram.html#af9a692726fabc472f521d3e6ecaf432d">randomizeImagesOrder</a>();</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="comment">// Initialize trymindiff for all images</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a2d35db214957b6a4d00b411e8a63a554">imgs_optrefno</a>.clear();</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <a class="code" href="classML2DBaseProgram.html#adf6efe79d6a17ff818c2f06d11e7b7b0">imgs_trymindiff</a>.clear();</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <a class="code" href="classML2DBaseProgram.html#ab7caa861fcd7c5a139c0a0825c1abbe0">imgs_scale</a>.clear();</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <a class="code" href="classML2DBaseProgram.html#ae32011b5a8251cbaaf3b5e28933b9806">imgs_bgmean</a>.clear();</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <a class="code" href="classML2DBaseProgram.html#adb224115e7f853ead371caf7a3767fa4">imgs_offsets</a>.clear();</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a2d817d670cd567d427da30fad46f5592">imgs_oldphi</a>.clear();</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <a class="code" href="classML2DBaseProgram.html#ae0d684b9bbe78bfa5ed5ad2610dc4fbe">imgs_oldtheta</a>.clear();</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#afb7a89515e4d8891cbc47b9b32857eb1">scale</a>.clear();</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">do_norm</a>)</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    {</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a90f80f69b900eb15f9300560d50286ca">average_scale</a> = 1.;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> refno = 0; refno &lt; <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>; refno++)</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        {</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#afb7a89515e4d8891cbc47b9b32857eb1">scale</a>.push_back(1.);</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        }</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    }</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="comment">// Initialize imgs_offsets vectors</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    std::vector&lt;double&gt; Vdum;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keywordtype">double</span> offx = (<a class="code" href="classML2DBaseProgram.html#ab4ef26e8db432f9c366375915204f0d7">zero_offsets</a> ? 0. : -999);</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="xmipp__funcs_8cpp.html#a6b2ac43eac850ac39594e8a5f5aa42fe">idum</a> = (<a class="code" href="classML2DBaseProgram.html#ad9b9535e1774d805e5bbee89dee0f4b5">do_mirror</a> ? 4 : 2) * <a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a> * <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <a class="code" href="ml2d_8h.html#a63b804f3c807ffe0259b3ee45cb19693">FOR_ALL_LOCAL_IMAGES</a>()</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    {</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a2d35db214957b6a4d00b411e8a63a554">imgs_optrefno</a>.push_back(0);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <a class="code" href="classML2DBaseProgram.html#adf6efe79d6a17ff818c2f06d11e7b7b0">imgs_trymindiff</a>.push_back(-1.);</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <a class="code" href="classML2DBaseProgram.html#adb224115e7f853ead371caf7a3767fa4">imgs_offsets</a>.push_back(Vdum);</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> refno = 0; refno &lt; <a class="code" href="xmipp__funcs_8cpp.html#a6b2ac43eac850ac39594e8a5f5aa42fe">idum</a>; refno++)</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            <a class="code" href="classML2DBaseProgram.html#adb224115e7f853ead371caf7a3767fa4">imgs_offsets</a>[<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>].push_back(offx);</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        }</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">do_norm</a>)</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            <span class="comment">// Initialize scale and bgmean for all images</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <span class="comment">// (for now initialize to 1 and 0, below also include doc)</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            <a class="code" href="classML2DBaseProgram.html#ae32011b5a8251cbaaf3b5e28933b9806">imgs_bgmean</a>.push_back(0.);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            <a class="code" href="classML2DBaseProgram.html#ab7caa861fcd7c5a139c0a0825c1abbe0">imgs_scale</a>.push_back(1.);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        }</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a549ca4cda193eb449087f9a316c61f20">limit_rot</a>)</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        {</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            <span class="comment">// For limited orientational search: initialize imgs_oldphi &amp; imgs_oldtheta to -999.</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a2d817d670cd567d427da30fad46f5592">imgs_oldphi</a>.push_back(-999.);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            <a class="code" href="classML2DBaseProgram.html#ae0d684b9bbe78bfa5ed5ad2610dc4fbe">imgs_oldtheta</a>.push_back(-999.);</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        }</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    }</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="comment">//TODO: THINK RESTART LATER, NOW NOT WORKING</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a4f7d61fca21cd29df3119a200b9a4bd3">do_restart</a>)</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    {</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <a class="code" href="group__ErrorHandling.html#ga4ab7f9b2fd1ec4b9efcfba0c9b33052c">REPORT_ERROR</a>(<a class="code" href="group__ErrorHandling.html#ggab0df38968e4f03a3f1f6d6df0f31f45aa5bed3f42a08e195b307cf8622e913327">ERR_NOT_IMPLEMENTED</a>, <span class="stringliteral">&quot;Restart option not implement yet in ml2d&quot;</span>);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <span class="comment">// Read optimal image-parameters</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;        <span class="comment">//        FOR_ALL_LOCAL_IMAGES()</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <span class="comment">//        {</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <span class="comment">//            if (limit_rot)</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="comment">//            {</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <span class="comment">//                MDimg.getValue(MDL_ANGLE_ROT, imgs_oldphi[IMG_LOCAL_INDEX]);</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="comment">//                MDimg.getValue(MDL_ANGLE_TILT, imgs_oldtheta[IMG_LOCAL_INDEX]);</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="comment">//            }</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="comment">//            if (zero_offsets)</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="comment">//            {</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="comment">//                idum = (do_mirror ? 2 : 1) * model.n_ref;</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="comment">//                double xx, yy;</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="comment">//                MDimg.getValue(MDL_SHIFT_X, xx);</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <span class="comment">//                MDimg.getValue(MDL_SHIFT_X, yy);</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="comment">//                for (int refno = 0; refno &lt; idum; refno++)</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="comment">//                {</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="comment">//                    imgs_offsets[IMG_LOCAL_INDEX][2 * refno] = xx;</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="comment">//                    imgs_offsets[IMG_LOCAL_INDEX][2 * refno + 1] = yy;</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="comment">//                }</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="comment">//            }</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <span class="comment">//            if (model.do_norm)</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="comment">//            {</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <span class="comment">//                MDimg.getValue(MDL_BGMEAN, imgs_bgmean[IMG_LOCAL_INDEX]);</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="comment">//                MDimg.getValue(MDL_INTSCALE, imgs_scale[IMG_LOCAL_INDEX]);</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="comment">//            }</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="comment">//        }</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="comment">//        // read Model parameters</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="comment">//        int refno = 0;</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="comment">//        FOR_ALL_OBJECTS_IN_METADATA(MDref)</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <span class="comment">//        {</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="comment">//            MDref.getValue(MDL_MODELFRAC, model.alpha_k[refno]);</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <span class="comment">//            if (do_mirror)</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="comment">//                MDref.getValue(MDL_MIRRORFRAC,</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="comment">//                               model.mirror_fraction[refno]);</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="comment">//            if (model.do_norm)</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="comment">//                MDref.getValue(MDL_INTSCALE, model.scale[refno]);</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="comment">//            refno++;</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="comment">//        }</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    }</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="comment">// Call the first iteration 0 if generating initial references from random subsets</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a> &gt; 1)</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    {</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a495926025de4de5360efd7266377cc2c">istart</a> = <a class="code" href="ml__align2d_8h.html#a72aa83bdfba00606d1d7db206111a5a9">SPECIAL_ITER</a>;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="comment">//Expand MDref because it will be re-used in writeOutputFiles</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <a class="code" href="classMetaData.html">MetaData</a> MDaux(<a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>);</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> group = 1; group &lt; <a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a>; ++group)</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        {</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            <a class="code" href="group__MetaData.html#ga85652b971edca3acc93a9f1bef2f17f6">FOR_ALL_OBJECTS_IN_METADATA</a>(MDaux)</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            {</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                MDaux.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a1ffc2c5a3f3bfe6187db33cc1859aa9f">MDL_REF3D</a>, group + 1, __iter.objId);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            }</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>.<a class="code" href="classMetaData.html#a01b7a1fe1f922a26349b10901ad6a3d2">unionAll</a>(MDaux);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        }</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="comment">//std::cerr &lt;&lt; &quot;DEBUG_JM: MDref: &quot; &lt;&lt; std::endl;</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="comment">//MDref.write(std::cerr);</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    }</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="comment">//--------Setup for Docfile -----------</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a0ddfa227d1aec7fcfd31cb2c23ec3d0f">docfiledata</a>.<a class="code" href="classMultidimArray.html#a048fe82e79de7fba796cd4e87869ef36">resize</a>(<a class="code" href="classML2DBaseProgram.html#ac53bad3c2339d92ebbda4ba5abe7aa57">nr_images_local</a>, <a class="code" href="ml2d_8h.html#a119f8d4cc2bfa19d21093a7694874226">DATALINELENGTH</a>);</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;}<span class="comment">//close function produceSideInfo</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment">// Calculate probability density function of all in-plane transformations phi</span></div><div class="line"><a name="l00553"></a><span class="lineno"><a class="line" href="classProgML2D.html#a2cf96ff3fc13f9f4593ff1ba0eb3c8d6">  553</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a2cf96ff3fc13f9f4593ff1ba0eb3c8d6">ProgML2D::calculatePdfInplane</a>()</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;{</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;Entering calculatePdfInplane&quot;</span> &lt;&lt;std::endl;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="numerical__recipes_8cpp.html#ab81d9253b246f09be9999505d515d517">x</a>, <a class="code" href="numerical__recipes_8cpp.html#ad919bbce6f061400a0bc5231a9cd1621">y</a>, <a class="code" href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a>, pdfpix, sum;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a6f44905656bc9d5a5bb57dea399cd18e">P_phi</a>.<a class="code" href="classMultidimArray.html#a048fe82e79de7fba796cd4e87869ef36">resize</a>(<a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>, <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>);</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a6f44905656bc9d5a5bb57dea399cd18e">P_phi</a>.<a class="code" href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">setXmippOrigin</a>();</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a394058da00920fa8e21edd9cf95cd49c">Mr2</a>.<a class="code" href="classMultidimArray.html#a048fe82e79de7fba796cd4e87869ef36">resize</a>(<a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>, <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a394058da00920fa8e21edd9cf95cd49c">Mr2</a>.<a class="code" href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">setXmippOrigin</a>();</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    sum = 0.;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordtype">double</span> _2sigma_offset2 = 2 * <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ee9d8ba6b21965a4fd84a8987c0b76e">sigma_offset</a> * <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ee9d8ba6b21965a4fd84a8987c0b76e">sigma_offset</a>;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordtype">double</span> _sigma_offset_denominator =  2 * <a class="code" href="tools_8h.html#a598a3330b3c21701223ee0ca14316eca">PI</a> * <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ee9d8ba6b21965a4fd84a8987c0b76e">sigma_offset</a> * <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ee9d8ba6b21965a4fd84a8987c0b76e">sigma_offset</a> * <a class="code" href="classML2DBaseProgram.html#a976dc404489a0c66af2800f0f73e76c7">nr_psi</a> * <a class="code" href="classML2DBaseProgram.html#abe104a9ef312f6d857b008188e5dfbea">nr_nomirror_flips</a>;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a>(<a class="code" href="classML2DBaseProgram.html#a6f44905656bc9d5a5bb57dea399cd18e">P_phi</a>)</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    {</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        x = (double) <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        y = (double) <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        r2 = x * x + y * <a class="code" href="numerical__recipes_8cpp.html#ad919bbce6f061400a0bc5231a9cd1621">y</a>;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ee9d8ba6b21965a4fd84a8987c0b76e">sigma_offset</a> &gt; 0.)</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        {</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            pdfpix = exp(-r2 / _2sigma_offset2);</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            pdfpix /= _sigma_offset_denominator;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        }</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        {</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> == 0 &amp;&amp; <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0)</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                pdfpix = 1.;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                pdfpix = 0.;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        }</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(<a class="code" href="classML2DBaseProgram.html#a6f44905656bc9d5a5bb57dea399cd18e">P_phi</a>, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) = pdfpix;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(<a class="code" href="classML2DBaseProgram.html#a394058da00920fa8e21edd9cf95cd49c">Mr2</a>, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) = (double) r2;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        sum += pdfpix;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    }</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="comment">// Normalization</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a6f44905656bc9d5a5bb57dea399cd18e">P_phi</a> /= sum;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;Leaving calculatePdfInplane&quot;</span> &lt;&lt;std::endl;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;}</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">// Rotate reference for all models and rotations and fill Fref vectors =============</span></div><div class="line"><a name="l00603"></a><span class="lineno"><a class="line" href="classProgML2D.html#ae2e77769eb2149319d7f136f9f45b42a">  603</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#ae2e77769eb2149319d7f136f9f45b42a">ProgML2D::rotateReference</a>()</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;{</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    std::cerr&lt;&lt;<span class="stringliteral">&quot;entering rotateReference&quot;</span>&lt;&lt;std::endl;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <a class="code" href="classProgML2D.html#a481fb6a97fef42aa5a9e2b56ce6d1cb8">awakeThreads</a>(<a class="code" href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34a392205928268f198ad445de1e9924612">TH_RR_REFNO</a>, 0, <a class="code" href="classProgML2D.html#a38a613cb2ebb88a3e8ed436f6743b15b">refno_load_param</a>);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    std::cerr&lt;&lt;<span class="stringliteral">&quot;leaving rotateReference&quot;</span>&lt;&lt;std::endl;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;}</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">// Collect all rotations and sum to update Iref() for all models ==========</span></div><div class="line"><a name="l00618"></a><span class="lineno"><a class="line" href="classProgML2D.html#a93b28ad122ffdbf8bb7fcd54e8540f8e">  618</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a93b28ad122ffdbf8bb7fcd54e8540f8e">ProgML2D::reverseRotateReference</a>()</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;{</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    std::cerr&lt;&lt;<span class="stringliteral">&quot;entering reverseRotateReference&quot;</span>&lt;&lt;std::endl;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <a class="code" href="classProgML2D.html#a481fb6a97fef42aa5a9e2b56ce6d1cb8">awakeThreads</a>(<a class="code" href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34a5a2bb3ae4005099790c981dd00c7403b">TH_RRR_REFNO</a>, 0, <a class="code" href="classProgML2D.html#a38a613cb2ebb88a3e8ed436f6743b15b">refno_load_param</a>);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    std::cerr&lt;&lt;<span class="stringliteral">&quot;leaving reverseRotateReference&quot;</span>&lt;&lt;std::endl;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;}</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div><div class="line"><a name="l00634"></a><span class="lineno"><a class="line" href="classProgML2D.html#a0ad1678e8cea8efa9d00630274c96971">  634</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a0ad1678e8cea8efa9d00630274c96971">ProgML2D::preselectLimitedDirections</a>(<span class="keywordtype">double</span> &amp;phi, <span class="keywordtype">double</span> &amp;<a class="code" href="numerical__recipes_8cpp.html#aca81c35c21e3a5f7f3a8d24504e76664">theta</a>)</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;{</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordtype">double</span> phi_ref, theta_ref, angle, angle2;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> <a class="code" href="numerical__recipes_8cpp.html#a6277e2a7446059985dc9bcf0a4ac1a8f">u</a>, v;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <a class="code" href="classProgML2D.html#af3ba3c5330db20cf897a5b83ce26ff69">pdf_directions</a>.clear();</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <a class="code" href="classProgML2D.html#af3ba3c5330db20cf897a5b83ce26ff69">pdf_directions</a>.resize(<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>);</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> refno = 0; refno &lt; <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>; refno++)</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    {</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classML2DBaseProgram.html#a549ca4cda193eb449087f9a316c61f20">limit_rot</a> || (phi == -999. &amp;&amp; theta == -999.))</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            <a class="code" href="classProgML2D.html#af3ba3c5330db20cf897a5b83ce26ff69">pdf_directions</a>[refno] = 1.;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        {</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            phi_ref = <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a29baa2fb66177265cb0de6d027ea454a">Iref</a>[refno].rot();</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            theta_ref = <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a29baa2fb66177265cb0de6d027ea454a">Iref</a>[refno].tilt();</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            <a class="code" href="group__Geometry.html#gac0a39b9536b704ecb1c9e44436796b2b">Euler_direction</a>(phi, theta, 0., u);</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;            <a class="code" href="group__Geometry.html#gac0a39b9536b704ecb1c9e44436796b2b">Euler_direction</a>(phi_ref, theta_ref, 0., v);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;            u.<a class="code" href="classMatrix1D.html#a4afb1b4e8a8132a53b985e5fa7da6e30">selfNormalize</a>();</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;            v.<a class="code" href="classMatrix1D.html#a4afb1b4e8a8132a53b985e5fa7da6e30">selfNormalize</a>();</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            angle = <a class="code" href="group__Macros.html#ga18b5ff2c19b69c072069398c7a5520cd">RAD2DEG</a>(acos(<a class="code" href="group__Vectors.html#ga5d2bc77c327154906885f1ebedc8d787">dotProduct</a>(u, v)));</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;            angle = fabs(<a class="code" href="group__Macros.html#ga25935c2309abe02cff60809c4d7d9b9e">realWRAP</a>(angle, -180, 180));</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            <span class="comment">// also check mirror</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            angle2 = 180. + angle;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;            angle2 = fabs(<a class="code" href="group__Macros.html#ga25935c2309abe02cff60809c4d7d9b9e">realWRAP</a>(angle2, -180, 180));</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            angle = <a class="code" href="group__Macros.html#gac9ae6a207f10c821b06a8c0df153a7d5">XMIPP_MIN</a>(angle, angle2);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            <span class="keywordflow">if</span> (fabs(angle) &gt; <a class="code" href="classML2DBaseProgram.html#a4ca3328df09f636935d22b5b946a3704">search_rot</a>)</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                <a class="code" href="classProgML2D.html#af3ba3c5330db20cf897a5b83ce26ff69">pdf_directions</a>[refno] = 0.;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                <a class="code" href="classProgML2D.html#af3ba3c5330db20cf897a5b83ce26ff69">pdf_directions</a>[refno] = 1.;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        }</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    }</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;}</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment">// Pre-selection of significant refno and ipsi, based on current optimal translation =======</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno"><a class="line" href="classProgML2D.html#a44b08930042f8d64a74eb588f6401408">  674</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a44b08930042f8d64a74eb588f6401408">ProgML2D::preselectFastSignificant</a>()</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;{</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    std::cerr&lt;&lt;<span class="stringliteral">&quot;entering preselectFastSignificant&quot;</span>&lt;&lt;std::endl;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="comment">// Initialize Msignificant to all zeros</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="comment">// TODO: check whether this is strictly necessary? Probably not...</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <a class="code" href="classProgML2D.html#a75cc3fc6713d2e0b3952a5ee1078014a">Msignificant</a>.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>();</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <a class="code" href="classProgML2D.html#a01d866b9a9c4b54dabe1b05266c3acd6">pfs_mindiff</a> = 99.e99;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <a class="code" href="classProgML2D.html#ae9bc9d23d569122e31bf8925a1910559">pfs_maxweight</a>.<a class="code" href="classMultidimArray.html#ac0efebfb32ab4e37cf33efca3349aa9b">resizeNoCopy</a>((<a class="code" href="classML2DBaseProgram.html#ad9b9535e1774d805e5bbee89dee0f4b5">do_mirror</a> ? 2 : 1), <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>);</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <a class="code" href="classProgML2D.html#ae9bc9d23d569122e31bf8925a1910559">pfs_maxweight</a>.<a class="code" href="classMultidimArray.html#a239f45b043ed7715dec4d44ceef74dce">initConstant</a>(-99.e99);</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <a class="code" href="classProgML2D.html#a0af09c8aabc38a238206b9551ceedb24">pfs_weight</a>.<a class="code" href="classMultidimArray.html#ac0efebfb32ab4e37cf33efca3349aa9b">resizeNoCopy</a>(<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>, <a class="code" href="classML2DBaseProgram.html#a976dc404489a0c66af2800f0f73e76c7">nr_psi</a> * <a class="code" href="classML2DBaseProgram.html#a715ad0eb7ac0ce476faf1623fedea1a8">nr_flip</a>);</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <a class="code" href="classProgML2D.html#a0af09c8aabc38a238206b9551ceedb24">pfs_weight</a>.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>();</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <a class="code" href="classProgML2D.html#aafe0bad5c89da244357a8a98000c7179">pfs_count</a> = <a class="code" href="classML2DBaseProgram.html#af249c63e39331ba0e4dfbcd39cafdce9">threads</a>;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <a class="code" href="classProgML2D.html#a481fb6a97fef42aa5a9e2b56ce6d1cb8">awakeThreads</a>(<a class="code" href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34a1a6e11e088b022a7ab94b8438b4b0843">TH_PFS_REFNO</a>, 0, <a class="code" href="classProgML2D.html#a38a613cb2ebb88a3e8ed436f6743b15b">refno_load_param</a>);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    std::cerr&lt;&lt;<span class="stringliteral">&quot;leaving preselectFastSignificant&quot;</span>&lt;&lt;std::endl;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;}</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">// Maximum Likelihood calculation for one image ============================================</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">// Integration over all translation, given  model and in-plane rotation</span></div><div class="line"><a name="l00700"></a><span class="lineno"><a class="line" href="classProgML2D.html#a16a298494284883677c3848d109ca8ca">  700</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a16a298494284883677c3848d109ca8ca">ProgML2D::expectationSingleImage</a>(<a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> &amp;opt_offsets)</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;{</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="preprocessor">#ifdef TIMING</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    timer.tic(ESI_E1);</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;double&gt;</a> Maux, Mweight;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;std::complex&lt;double&gt;</a> &gt; Faux;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keywordtype">double</span> my_mindiff;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordtype">bool</span> is_ok_trymindiff = <span class="keyword">false</span>;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="keywordtype">double</span> sigma_noise2 = <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#aa1281d05277a75579f9adb3b19304a7b">sigma_noise</a> * <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#aa1281d05277a75579f9adb3b19304a7b">sigma_noise</a>;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <a class="code" href="classFourierTransformer.html">FourierTransformer</a> local_transformer;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <a class="code" href="classProgML2D.html#a982205d6bc2ceb791f1abd3fbb1388bf">ioptx</a> = <a class="code" href="classProgML2D.html#a6f1b8e425483f7b4f97e68e4eb6233fd">iopty</a> = 0;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="comment">// Update sigdim, i.e. the number of pixels that will be considered in the translations</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <a class="code" href="classProgML2D.html#a58c7e5ee272eb1e83531df902e67064d">sigdim</a> = 2 * <a class="code" href="group__Macros.html#ga4ec18a98c812ab4d498c8111c193aa17">CEIL</a>(<a class="code" href="group__Macros.html#gae0a4180e923e3ffca3989e20e441aa3c">XMIPP_MAX</a>(1,<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ee9d8ba6b21965a4fd84a8987c0b76e">sigma_offset</a>) * (<a class="code" href="classML2DBaseProgram.html#a5597237821521e53baea8549f16a8d55">save_mem2</a> ? 3 : 6));</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <a class="code" href="classProgML2D.html#a58c7e5ee272eb1e83531df902e67064d">sigdim</a>++; <span class="comment">// (to get uneven number)</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <a class="code" href="classProgML2D.html#a58c7e5ee272eb1e83531df902e67064d">sigdim</a> = <a class="code" href="group__Macros.html#gac9ae6a207f10c821b06a8c0df153a7d5">XMIPP_MIN</a>(<a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>, <a class="code" href="classProgML2D.html#a58c7e5ee272eb1e83531df902e67064d">sigdim</a>);</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="comment">// Setup matrices</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    Maux.<a class="code" href="classMultidimArray.html#a048fe82e79de7fba796cd4e87869ef36">resize</a>(<a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>, <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>);</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    Maux.<a class="code" href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">setXmippOrigin</a>();</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    Mweight.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>(<a class="code" href="classProgML2D.html#a58c7e5ee272eb1e83531df902e67064d">sigdim</a>, <a class="code" href="classProgML2D.html#a58c7e5ee272eb1e83531df902e67064d">sigdim</a>);</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    Mweight.<a class="code" href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">setXmippOrigin</a>();</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">do_norm</a>)</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <a class="code" href="classProgML2D.html#a89fc3cde7847bf0bb39ea52add1d4490">opt_scale</a> = 1.;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="comment">// precalculate all flipped versions of the image</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <a class="code" href="classProgML2D.html#a2725bcb11d4abfd956448b2384ec9dfe">Fimg_flip</a>.clear();</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iflip = 0; iflip &lt; <a class="code" href="classML2DBaseProgram.html#a715ad0eb7ac0ce476faf1623fedea1a8">nr_flip</a>; iflip++)</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    {</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        Maux.<a class="code" href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">setXmippOrigin</a>();</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        <a class="code" href="group__GeometricalTransformations.html#ga3cc15e5dda7c58b9cacb7eee440d6bdc">applyGeometry</a>(<a class="code" href="group__GeometricalTransformations.html#gac645eb9a88619ee6f5e14c557ab8ef62">LINEAR</a>, Maux, <a class="code" href="classProgML2D.html#ad45f8eab09da7787c7e8e5e86883a40a">Mimg</a>, <a class="code" href="classML2DBaseProgram.html#a879e423db0331279b0421e881b73be57">F</a>[iflip], <a class="code" href="transformations_8h.html#a855436c9d0ed5174df8917d5239d7597">IS_INV</a>, <a class="code" href="transformations_8h.html#a43c1de45dbd91827a260224c9c40221b">WRAP</a>);</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        local_transformer.<a class="code" href="classFourierTransformer.html#abfdc5699d3c579a26bba39ec679b5adc">FourierTransform</a>(Maux, Faux, <span class="keyword">false</span>);</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">do_norm</a>)</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(Faux,0,0) -= <a class="code" href="classProgML2D.html#aef35426c0860ea497a0fc71c9eb2bcbf">bgmean</a>;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <a class="code" href="classProgML2D.html#a2725bcb11d4abfd956448b2384ec9dfe">Fimg_flip</a>.push_back(Faux);</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    }</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="comment">// The real stuff: loop over all references, rotations and translations</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keywordtype">int</span> redo_counter = 0;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="preprocessor">#ifdef TIMING</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    timer.toc(ESI_E1);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="comment">//timer.tic(&quot;WHILE_&quot;);</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="keywordflow">while</span> (!is_ok_trymindiff)</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    {</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        <span class="comment">// Initialize mindiff, weighted sums and maxweights</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        <a class="code" href="classProgML2D.html#a990c57b68223b7deafe042cb9cd2efa8">mindiff</a> = 99.e99;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <a class="code" href="classProgML2D.html#ae91cfc8d366159cc5479418582e9825c">wsum_corr</a> = <a class="code" href="classProgML2D.html#af1c07651bc4491471be58d1e3cf11413">wsum_offset</a> = <a class="code" href="classProgML2D.html#abed951212bbcfa436954ad4f77575887">wsum_sc</a> = <a class="code" href="classProgML2D.html#adfb316a4df09eaf3a645d97e49f102f4">wsum_sc2</a> = 0.;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <a class="code" href="classProgML2D.html#aeef0f8238948edd17db1e4652bbd18ac">maxweight</a> = <a class="code" href="classProgML2D.html#a571bb2f7bac698c48cfbea17c9c12170">maxweight2</a> = <a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a> = <a class="code" href="classProgML2D.html#a4bafa5bbd30eedca53d94d6317be28ef">sum_refw2</a> = 0.;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <a class="code" href="classProgML2D.html#a481fb6a97fef42aa5a9e2b56ce6d1cb8">awakeThreads</a>(<a class="code" href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34a0baa34fa9ce901319175045df8e1aa0f">TH_ESI_REFNO</a>, <a class="code" href="classProgML2D.html#a2a7c59d85856b342e74ffd326e1a5765">opt_refno</a>, <a class="code" href="classProgML2D.html#a38a613cb2ebb88a3e8ed436f6743b15b">refno_load_param</a>);</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        <span class="comment">// Now check whether our trymindiff was OK.</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <span class="comment">// The limit of the exp-function lies around</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <span class="comment">// exp(700)=1.01423e+304, exp(800)=inf; exp(-700) = 9.85968e-305; exp(-88) = 0</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <span class="comment">// Use 500 to be on the save side?</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__Macros.html#ga996f7be338ccb40d1a2a5abc1ad61759">ABS</a>((<a class="code" href="classProgML2D.html#a990c57b68223b7deafe042cb9cd2efa8">mindiff</a> - <a class="code" href="classProgML2D.html#a8056b29f3479fde75215466ab904f6bd">trymindiff</a>) / sigma_noise2) &gt; 500.)</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            <span class="comment">//force always redo to use real mindiff for check about LL problem</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            <span class="comment">//if (redo_counter==0)</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        {</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            <span class="comment">// Re-do whole calculation now with the real mindiff</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            <a class="code" href="classProgML2D.html#a8056b29f3479fde75215466ab904f6bd">trymindiff</a> = <a class="code" href="classProgML2D.html#a990c57b68223b7deafe042cb9cd2efa8">mindiff</a>;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            redo_counter++;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            <span class="comment">// On iteration 0 images that will go to references other than first</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            <span class="comment">// will store optimus references but not yet expanded number of references</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a20e2b948711e3e66894740b99e8cf017">iter</a> == 0)</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                <a class="code" href="classProgML2D.html#a2a7c59d85856b342e74ffd326e1a5765">opt_refno</a> = (<a class="code" href="classProgML2D.html#a2a7c59d85856b342e74ffd326e1a5765">opt_refno</a> % <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>);</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            <span class="comment">// Never re-do more than once!</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            <span class="keywordflow">if</span> (redo_counter &gt; 1)</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                <a class="code" href="group__ErrorHandling.html#ga4ab7f9b2fd1ec4b9efcfba0c9b33052c">REPORT_ERROR</a>(<a class="code" href="group__ErrorHandling.html#ggab0df38968e4f03a3f1f6d6df0f31f45aad02217f52cd3ac70b89edec020dd25c0">ERR_VALUE_INCORRECT</a>, <span class="stringliteral">&quot;ml_align2d BUG% redo_counter &gt; 1&quot;</span>);</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        }</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        {</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            is_ok_trymindiff = <span class="keyword">true</span>;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            my_mindiff = <a class="code" href="classProgML2D.html#a8056b29f3479fde75215466ab904f6bd">trymindiff</a>;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            <a class="code" href="classProgML2D.html#a8056b29f3479fde75215466ab904f6bd">trymindiff</a> = <a class="code" href="classProgML2D.html#a990c57b68223b7deafe042cb9cd2efa8">mindiff</a>;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        }</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    }<span class="comment">//close while</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <a class="code" href="classProgML2D.html#ae79f14fb1780011236766b2b6cb9748d">fracweight</a> = <a class="code" href="classProgML2D.html#aeef0f8238948edd17db1e4652bbd18ac">maxweight</a> / <a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a>;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <a class="code" href="classProgML2D.html#abed951212bbcfa436954ad4f77575887">wsum_sc</a> /= <a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a>;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <a class="code" href="classProgML2D.html#adfb316a4df09eaf3a645d97e49f102f4">wsum_sc2</a> /= <a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a>;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="comment">// Calculate optimal transformation parameters</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <a class="code" href="classProgML2D.html#ad46ab7ada3d4a4cf173ccd5871a005af">opt_psi</a> = -<a class="code" href="classML2DBaseProgram.html#aae259850c9b209a3ff3cbcc7799e2742">psi_step</a> * (<a class="code" href="classProgML2D.html#a1be87962ea76cdc3641b99d8e4d6c4eb">iopt_flip</a> * <a class="code" href="classML2DBaseProgram.html#a976dc404489a0c66af2800f0f73e76c7">nr_psi</a> + <a class="code" href="classProgML2D.html#a40a5d7f99135a4219f867273e3a704fe">iopt_psi</a>) - <a class="code" href="ml2d_8h.html#a6b49ded9ade4e2a8b65b16670db60486">SMALLANGLE</a>;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    opt_offsets(0) = -(double) <a class="code" href="classProgML2D.html#a982205d6bc2ceb791f1abd3fbb1388bf">ioptx</a> * <a class="code" href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a>(<a class="code" href="classML2DBaseProgram.html#a879e423db0331279b0421e881b73be57">F</a>[<a class="code" href="classProgML2D.html#a1be87962ea76cdc3641b99d8e4d6c4eb">iopt_flip</a>], 0, 0)</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                     - (double) <a class="code" href="classProgML2D.html#a6f1b8e425483f7b4f97e68e4eb6233fd">iopty</a> * <a class="code" href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a>(<a class="code" href="classML2DBaseProgram.html#a879e423db0331279b0421e881b73be57">F</a>[iopt_flip], 0, 1);</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    opt_offsets(1) = -(double) <a class="code" href="classProgML2D.html#a982205d6bc2ceb791f1abd3fbb1388bf">ioptx</a> * <a class="code" href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a>(<a class="code" href="classML2DBaseProgram.html#a879e423db0331279b0421e881b73be57">F</a>[iopt_flip], 1, 0)</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                     - (double) <a class="code" href="classProgML2D.html#a6f1b8e425483f7b4f97e68e4eb6233fd">iopty</a> * <a class="code" href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a>(<a class="code" href="classML2DBaseProgram.html#a879e423db0331279b0421e881b73be57">F</a>[iopt_flip], 1, 1);</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="comment">// Update normalization parameters</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">do_norm</a>)</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    {</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        <span class="comment">// 1. Calculate optimal setting of Mimg</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        <a class="code" href="classMultidimArray.html">MultidimArray&lt;double&gt;</a> Maux2 = <a class="code" href="classProgML2D.html#ad45f8eab09da7787c7e8e5e86883a40a">Mimg</a>;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <a class="code" href="group__GeometricalTransformations.html#gae9f9e35557a7659baf5a1bdbe62e3afc">selfTranslate</a>(<a class="code" href="group__GeometricalTransformations.html#gac645eb9a88619ee6f5e14c557ab8ef62">LINEAR</a>, Maux2, opt_offsets, <span class="keyword">true</span>);</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        <a class="code" href="group__GeometricalTransformations.html#ga22035972f95a4f2bf79416b5ebf9d44e">selfApplyGeometry</a>(<a class="code" href="group__GeometricalTransformations.html#gac645eb9a88619ee6f5e14c557ab8ef62">LINEAR</a>, Maux2, <a class="code" href="classML2DBaseProgram.html#a879e423db0331279b0421e881b73be57">F</a>[iopt_flip], <a class="code" href="transformations_8h.html#a855436c9d0ed5174df8917d5239d7597">IS_INV</a>, <a class="code" href="transformations_8h.html#a43c1de45dbd91827a260224c9c40221b">WRAP</a>);</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="comment">// 2. Calculate optimal setting of Mref</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <span class="keywordtype">int</span> refnoipsi = (<a class="code" href="classProgML2D.html#a2a7c59d85856b342e74ffd326e1a5765">opt_refno</a> % <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>) * <a class="code" href="classML2DBaseProgram.html#a976dc404489a0c66af2800f0f73e76c7">nr_psi</a> + <a class="code" href="classProgML2D.html#a40a5d7f99135a4219f867273e3a704fe">iopt_psi</a>;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <a class="code" href="group__MultidimensionalArrays.html#ga4e8db4e5757ca2f6e233d0a1eec7ff1c">FOR_ALL_DIRECT_ELEMENTS_IN_ARRAY2D</a>(Faux)</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        {</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(Faux,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) = <a class="code" href="namespacealglib.html#a0fe83df1d04b0270f8cfaf97114082ff">conj</a>(<a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(<a class="code" href="classProgML2D.html#a1df4cb7668c8de81e5f012be633c4b10">fref</a>[refnoipsi],<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>));</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(Faux,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) *= <a class="code" href="classProgML2D.html#a89fc3cde7847bf0bb39ea52add1d4490">opt_scale</a>;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        }</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        <span class="comment">// Still take input from Faux and leave output in Maux</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        local_transformer.<a class="code" href="classFourierTransformer.html#a1c8297f634bb4f9d1235f6c4fa33d7e5">inverseFourierTransform</a>();</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        Maux2 = Maux2 - Maux;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classXmippProgram.html#a0130b89f1f5431b03ef161d7e231bd48">debug</a> == 12)</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        {</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            std::cout &lt;&lt; std::endl;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;scale= &quot;</span> &lt;&lt; <a class="code" href="classProgML2D.html#a89fc3cde7847bf0bb39ea52add1d4490">opt_scale</a> &lt;&lt; <span class="stringliteral">&quot; changes to &quot;</span> &lt;&lt; <a class="code" href="classProgML2D.html#abed951212bbcfa436954ad4f77575887">wsum_sc</a></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;            / <a class="code" href="classProgML2D.html#adfb316a4df09eaf3a645d97e49f102f4">wsum_sc2</a> &lt;&lt; std::endl;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot;bgmean= &quot;</span> &lt;&lt; <a class="code" href="classProgML2D.html#aef35426c0860ea497a0fc71c9eb2bcbf">bgmean</a> &lt;&lt; <span class="stringliteral">&quot; changes to &quot;</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;            &lt;&lt; Maux2.<a class="code" href="classMultidimArray.html#ac03a790d43ff768b7cc7f8cd6d3038ad">computeAvg</a>() &lt;&lt; std::endl;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        }</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <span class="comment">// non-ML update of bgmean (this is much cheaper than true-ML update...)</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <a class="code" href="classProgML2D.html#a6640cdcf273f2031dc8dc1e28de8b81f">old_bgmean</a> = <a class="code" href="classProgML2D.html#aef35426c0860ea497a0fc71c9eb2bcbf">bgmean</a>;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        <a class="code" href="classProgML2D.html#aef35426c0860ea497a0fc71c9eb2bcbf">bgmean</a> = Maux2.<a class="code" href="classMultidimArray.html#ac03a790d43ff768b7cc7f8cd6d3038ad">computeAvg</a>();</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <span class="comment">// ML-update of opt_scale</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <a class="code" href="classProgML2D.html#a89fc3cde7847bf0bb39ea52add1d4490">opt_scale</a> = <a class="code" href="classProgML2D.html#abed951212bbcfa436954ad4f77575887">wsum_sc</a> / <a class="code" href="classProgML2D.html#adfb316a4df09eaf3a645d97e49f102f4">wsum_sc2</a>;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    }</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="preprocessor">#ifdef TIMING</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    timer.toc(ESI_E5);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    timer.tic(ESI_E6TH);</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="comment">// Update all global weighted sums after division by sum_refw</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <a class="code" href="classProgML2D.html#aeba68b5ab11453cdd8685b63eb122628">wsum_sigma_noise</a> += (2 * <a class="code" href="classProgML2D.html#ae91cfc8d366159cc5479418582e9825c">wsum_corr</a> / <a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a>);</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <a class="code" href="classProgML2D.html#aacbe058d87287adbc0e5ee76f5ad317c">wsum_sigma_offset</a> += (<a class="code" href="classProgML2D.html#af1c07651bc4491471be58d1e3cf11413">wsum_offset</a> / <a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a>);</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <a class="code" href="classProgML2D.html#a60a40d22a1ca28a0ff4af54f0c83af08">sumfracweight</a> += <a class="code" href="classProgML2D.html#ae79f14fb1780011236766b2b6cb9748d">fracweight</a>;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="comment">//    std::cerr &lt;&lt; &quot;-------------------- wsum_corr: &quot; &lt;&lt; wsum_corr &lt;&lt; std::endl;</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="comment">//    std::cerr &lt;&lt; &quot;-------------------- sum_refw: &quot; &lt;&lt; sum_refw &lt;&lt; std::endl;</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="comment">//    std::cerr &lt;&lt; std::endl &lt;&lt; &quot;-------------------- wsum_sigma_offset: &quot; &lt;&lt; wsum_sigma_offset &lt;&lt; std::endl;</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="comment">//    std::cerr &lt;&lt; &quot;-------------------- wsum_sigma_noise: &quot; &lt;&lt; wsum_sigma_noise &lt;&lt; std::endl &lt;&lt; std::endl;</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="comment">//    if (wsum_sigma_noise &lt; 0)</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="comment">//    {</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="comment">//      std::cerr &lt;&lt; &quot;Negative wsum_sigma_noise....exiting&quot;  &lt;&lt;std::endl;</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <span class="comment">//      exit(1);</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    <span class="comment">//    }</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <a class="code" href="classProgML2D.html#a481fb6a97fef42aa5a9e2b56ce6d1cb8">awakeThreads</a>(<a class="code" href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34ada8af5b01ff37af5c23dedecb93d25c0">TH_ESI_UPDATE_REFNO</a>, 0, <a class="code" href="classProgML2D.html#a38a613cb2ebb88a3e8ed436f6743b15b">refno_load_param</a>);</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ba63ac8129e521abfeaeaee3bb4c38d">do_student</a>)</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <span class="comment">// 1st term: log(refw_i)</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <span class="comment">// 2nd term: for subtracting mindiff</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        <span class="comment">// 3rd term: for (sqrt(2pi)*sigma_noise)^-1 term in formula (12) Sigworth (1998)</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        <a class="code" href="classProgML2D.html#a44961c5dba5a171972ac35969663c398">dLL</a> = <a class="code" href="image__operate_8cpp.html#a0994f8f1ab050711112683b89fb90b0b">log</a>(<a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a>) - my_mindiff / sigma_noise2 - <a class="code" href="classML2DBaseProgram.html#a790a55bd210ce856bfbbd8853c6789df">ddim2</a> * <a class="code" href="image__operate_8cpp.html#a0994f8f1ab050711112683b89fb90b0b">log</a>(<a class="code" href="image__operate_8cpp.html#aba02a4405b44e10470c7af98477800a9">sqrt</a>(2.</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                * <a class="code" href="tools_8h.html#a598a3330b3c21701223ee0ca14316eca">PI</a> * sigma_noise2));</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        <span class="comment">// 1st term: log(refw_i)</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        <span class="comment">// 2nd term: for dividing by (1 + 2. * mindiff/dfsigma2)^df2</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        <span class="comment">// 3rd term: for sigma-dependent normalization term in t-student distribution</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        <span class="comment">// 4th&amp;5th terms: gamma functions in t-distribution</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        <a class="code" href="classProgML2D.html#a44961c5dba5a171972ac35969663c398">dLL</a> = <a class="code" href="image__operate_8cpp.html#a0994f8f1ab050711112683b89fb90b0b">log</a>(<a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a>) + <a class="code" href="classML2DBaseProgram.html#a3106e12c5756e90d770df3708307258d">df2</a> * <a class="code" href="image__operate_8cpp.html#a0994f8f1ab050711112683b89fb90b0b">log</a>(1. + (2. * my_mindiff / <a class="code" href="classML2DBaseProgram.html#a3169a7f52fce4768757155f99b12fa84">dfsigma2</a>))</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;              - <a class="code" href="classML2DBaseProgram.html#a790a55bd210ce856bfbbd8853c6789df">ddim2</a> * <a class="code" href="image__operate_8cpp.html#a0994f8f1ab050711112683b89fb90b0b">log</a>(<a class="code" href="image__operate_8cpp.html#aba02a4405b44e10470c7af98477800a9">sqrt</a>(<a class="code" href="tools_8h.html#a598a3330b3c21701223ee0ca14316eca">PI</a> * <a class="code" href="classML2DBaseProgram.html#a8671946de2e241de54a47e2822989ca1">df</a> * sigma_noise2)) + <a class="code" href="numerical__recipes_8cpp.html#ae01374ddda83bc2216ba9df9c76d9995">gammln</a>(-<a class="code" href="classML2DBaseProgram.html#a3106e12c5756e90d770df3708307258d">df2</a>)</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;              - <a class="code" href="numerical__recipes_8cpp.html#ae01374ddda83bc2216ba9df9c76d9995">gammln</a>(<a class="code" href="classML2DBaseProgram.html#a8671946de2e241de54a47e2822989ca1">df</a> / 2.);</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="comment">//#define DEBUG_JM1</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="preprocessor">#ifdef DEBUG_JM1</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    <span class="comment">//if (iter&gt;1)</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    {</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="comment">//static std::ios::openmode mode = std::ios::out|std::ios::trunc;</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="comment">//std::ofstream log;</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <span class="comment">//FileName fn = fn_root + (current_image % 2 == 0 ? &quot;_images.even&quot; : &quot;_images.odd&quot;);</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        <span class="comment">//log.open(fn.c_str(), mode);</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        <span class="comment">//std::cerr &lt;&lt; &quot;    IMAGE &quot; &lt;&lt; current_image &lt;&lt; &quot;-----------------------------&gt;&gt;&gt;&quot; &lt;&lt; std::endl;</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;-----------------------------&gt;&gt;&gt;&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;                             dLL: &quot;</span> &lt;&lt; <a class="code" href="classProgML2D.html#a44961c5dba5a171972ac35969663c398">dLL</a> &lt;&lt; std::endl;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;                        sum_refw: &quot;</span> &lt;&lt; <a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a> &lt;&lt; std::endl;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;                      my_mindiff: &quot;</span> &lt;&lt; my_mindiff &lt;&lt; std::endl;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;                    sigma_noise2: &quot;</span> &lt;&lt; sigma_noise2 &lt;&lt; std::endl;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;                           ddim2: &quot;</span> &lt;&lt; <a class="code" href="classML2DBaseProgram.html#a790a55bd210ce856bfbbd8853c6789df">ddim2</a> &lt;&lt; std::endl;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        <span class="comment">//std::cerr &lt;&lt; &quot;                        dfsigma2: &quot; &lt;&lt; dfsigma2 &lt;&lt; std::endl;</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;                       wsum_corr: &quot;</span> &lt;&lt; <a class="code" href="classProgML2D.html#ae91cfc8d366159cc5479418582e9825c">wsum_corr</a> &lt;&lt; std::endl;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;                     wsum_offset: &quot;</span> &lt;&lt; <a class="code" href="classProgML2D.html#af1c07651bc4491471be58d1e3cf11413">wsum_offset</a> &lt;&lt; std::endl;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <span class="comment">//        std::cerr &lt;&lt; &quot;                            refw: &quot;;</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <span class="comment">//        for (int refno = 0; refno &lt; model.n_ref; ++refno)</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="comment">//            std::cerr &lt;&lt; std::setw(15) &lt;&lt; refw[refno];</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="comment">//        std::cerr&lt;&lt; std::endl;</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <span class="comment">//        std::cerr &lt;&lt; &quot;                     refw_mirror: &quot;;</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="comment">//        for (int refno = 0; refno &lt; model.n_ref; ++refno)</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <span class="comment">//            std::cerr &lt;&lt; std::setw(15) &lt;&lt; refw_mirror[refno];</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <span class="comment">//        std::cerr&lt;&lt; std::endl;</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        <span class="comment">//        log.close();</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        <span class="comment">//        mode = std::ios::out|std::ios::app;</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    }</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="preprocessor">#undef DEBUG_JM1</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <a class="code" href="classProgML2D.html#ad26cadbfd0dfbaab4b1c19a5f2c9c939">LL</a> += <a class="code" href="classProgML2D.html#a44961c5dba5a171972ac35969663c398">dLL</a>;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="preprocessor">#ifdef TIMING</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    timer.toc(ESI_E6TH);</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;}<span class="comment">//close function expectationSingleImage</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno"><a class="line" href="classProgML2D.html#a5c5cb7838e5d82a38634252e0a470b21">  929</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a5c5cb7838e5d82a38634252e0a470b21">ProgML2D::createThreads</a>()</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;{</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="comment">//Initialize some variables for using for threads</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    <a class="code" href="classProgML2D.html#aa975456b33d5133bcc002c29d6a9da20">th_ids</a> = <span class="keyword">new</span> pthread_t[<a class="code" href="classML2DBaseProgram.html#af249c63e39331ba0e4dfbcd39cafdce9">threads</a>];</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <a class="code" href="classProgML2D.html#acc9ce2f79942c7bb7ac5edf22a7b8826">threads_d</a> = <span class="keyword">new</span> <a class="code" href="structstructThreadTasks.html">structThreadTasks</a>[<a class="code" href="classML2DBaseProgram.html#af249c63e39331ba0e4dfbcd39cafdce9">threads</a>];</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    <a class="code" href="group__Threads.html#ga3c4dbe1b06c40927ef9cb8be71b366e8">barrier_init</a>(&amp;<a class="code" href="classProgML2D.html#a3fdd8612a9d5a2e5e687fa33b0925f27">barrier</a>, <a class="code" href="classML2DBaseProgram.html#af249c63e39331ba0e4dfbcd39cafdce9">threads</a> + 1);</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <a class="code" href="group__Threads.html#ga3c4dbe1b06c40927ef9cb8be71b366e8">barrier_init</a>(&amp;<a class="code" href="classProgML2D.html#a5ff1bd818e33945055fb5ed67379cacd">barrier2</a>, <a class="code" href="classML2DBaseProgram.html#af249c63e39331ba0e4dfbcd39cafdce9">threads</a> + 1);</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <a class="code" href="group__Threads.html#ga3c4dbe1b06c40927ef9cb8be71b366e8">barrier_init</a>(&amp;<a class="code" href="classProgML2D.html#af4bf8cc040f12a2a38d278a0539117cf">barrier3</a>, <a class="code" href="classML2DBaseProgram.html#af249c63e39331ba0e4dfbcd39cafdce9">threads</a>);<span class="comment">//Main thread will not wait here</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; <a class="code" href="classML2DBaseProgram.html#af249c63e39331ba0e4dfbcd39cafdce9">threads</a>; <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    {</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        <a class="code" href="classProgML2D.html#acc9ce2f79942c7bb7ac5edf22a7b8826">threads_d</a>[<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="structstructThreadTasks.html#ad02867e5644724dbb49bf0dcf0bd5901">thread_id</a> = <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        <a class="code" href="classProgML2D.html#acc9ce2f79942c7bb7ac5edf22a7b8826">threads_d</a>[<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="structstructThreadTasks.html#af02b96b72e4d115cf3bd22146db1c261">prm</a> = <span class="keyword">this</span>;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        <span class="keywordtype">int</span> result = pthread_create((<a class="code" href="classProgML2D.html#aa975456b33d5133bcc002c29d6a9da20">th_ids</a> + <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>), NULL, <a class="code" href="ml__align2d_8cpp.html#a25b0a1c7379cd817732735a0fc7f267d">doThreadsTasks</a>,</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                                    (<span class="keywordtype">void</span> *) (<a class="code" href="classProgML2D.html#acc9ce2f79942c7bb7ac5edf22a7b8826">threads_d</a> + <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <span class="keywordflow">if</span> (result != 0)</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        {</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;            <a class="code" href="group__ErrorHandling.html#ga4ab7f9b2fd1ec4b9efcfba0c9b33052c">REPORT_ERROR</a>(<a class="code" href="group__ErrorHandling.html#ggab0df38968e4f03a3f1f6d6df0f31f45aa6183f94fdaa94dc490d796dad0814b78">ERR_THREADS_NOTINIT</a>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        }</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    }</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;}<span class="comment">//close function createThreads</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;</div><div class="line"><a name="l00958"></a><span class="lineno"><a class="line" href="classProgML2D.html#a0a5dc92e82fd69f9058becc96b9066b2">  958</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a0a5dc92e82fd69f9058becc96b9066b2">ProgML2D::destroyThreads</a>()</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;{</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <a class="code" href="classProgML2D.html#a8c569527c10ddd6d1a9cf09f440da081">threadTask</a> = <a class="code" href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34adb6dfa9d4fd7acfbba0ca98a7627750c">TH_EXIT</a>;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <a class="code" href="group__Threads.html#ga99a3a59fba69ac42cf6fb51df0dc5b64">barrier_wait</a>(&amp;<a class="code" href="classProgML2D.html#a3fdd8612a9d5a2e5e687fa33b0925f27">barrier</a>);</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="keyword">delete</span>[] <a class="code" href="classProgML2D.html#aa975456b33d5133bcc002c29d6a9da20">th_ids</a>;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keyword">delete</span>[] <a class="code" href="classProgML2D.html#acc9ce2f79942c7bb7ac5edf22a7b8826">threads_d</a>;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;}</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div><div class="line"><a name="l00967"></a><span class="lineno"><a class="line" href="ml__align2d_8h.html#a25b0a1c7379cd817732735a0fc7f267d">  967</a></span>&#160;<span class="keywordtype">void</span> * <a class="code" href="ml__align2d_8cpp.html#a25b0a1c7379cd817732735a0fc7f267d">doThreadsTasks</a>(<span class="keywordtype">void</span> * data)</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;{</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <a class="code" href="structstructThreadTasks.html">structThreadTasks</a> * thread_data = (<a class="code" href="structstructThreadTasks.html">structThreadTasks</a> *) data;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <a class="code" href="classProgML2D.html">ProgML2D</a> * <a class="code" href="mpi__classify__CL2D_8cpp.html#a831c08adbb8230fd6a60f4a130923a19">prm</a> = thread_data-&gt;<a class="code" href="structstructThreadTasks.html#af02b96b72e4d115cf3bd22146db1c261">prm</a>;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <a class="code" href="structmybarrier__t.html">barrier_t</a> &amp; <a class="code" href="classProgML2D.html#a3fdd8612a9d5a2e5e687fa33b0925f27">barrier</a> = prm-&gt;<a class="code" href="classProgML2D.html#a3fdd8612a9d5a2e5e687fa33b0925f27">barrier</a>;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <a class="code" href="structmybarrier__t.html">barrier_t</a> &amp; <a class="code" href="classProgML2D.html#a5ff1bd818e33945055fb5ed67379cacd">barrier2</a> = prm-&gt;<a class="code" href="classProgML2D.html#a5ff1bd818e33945055fb5ed67379cacd">barrier2</a>;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="comment">//Loop until the threadTask become TH_EXIT</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    <span class="keywordflow">do</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    {</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        <span class="comment">//Wait until main threads order to start</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        <span class="comment">//debug_print(&quot;Waiting on barrier, th &quot;, thread_id);</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        <a class="code" href="group__Threads.html#ga99a3a59fba69ac42cf6fb51df0dc5b64">barrier_wait</a>(&amp;barrier);</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        <span class="comment">//Check task to do</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        <span class="keywordflow">switch</span> (prm-&gt;<a class="code" href="classProgML2D.html#a8c569527c10ddd6d1a9cf09f440da081">threadTask</a>)</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        {</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34a1a6e11e088b022a7ab94b8438b4b0843">TH_PFS_REFNO</a>:</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;            prm-&gt;<a class="code" href="classProgML2D.html#abeb29fd2474be31882bf38ba7d1ddb02">doThreadPreselectFastSignificantRefno</a>();</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34a0baa34fa9ce901319175045df8e1aa0f">TH_ESI_REFNO</a>:</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;            prm-&gt;<a class="code" href="classProgML2D.html#ad9f83e25ef28d8febe54e4930ce418a5">doThreadExpectationSingleImageRefno</a>();</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34ada8af5b01ff37af5c23dedecb93d25c0">TH_ESI_UPDATE_REFNO</a>:</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;            prm-&gt;<a class="code" href="classProgML2D.html#a0ce68be471d505dc112d1fedef5e3092">doThreadESIUpdateRefno</a>();</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34a392205928268f198ad445de1e9924612">TH_RR_REFNO</a>:</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;            prm-&gt;<a class="code" href="classProgML2D.html#a1ae2970adffcee179223e27c6b8f7c5e">doThreadRotateReferenceRefno</a>();</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34a5a2bb3ae4005099790c981dd00c7403b">TH_RRR_REFNO</a>:</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;            prm-&gt;<a class="code" href="classProgML2D.html#a33abac49bbbe75a56fd9ac1a928151a1">doThreadReverseRotateReferenceRefno</a>();</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34adb6dfa9d4fd7acfbba0ca98a7627750c">TH_EXIT</a>:</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            pthread_exit(NULL);</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        }</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        <a class="code" href="group__Threads.html#ga99a3a59fba69ac42cf6fb51df0dc5b64">barrier_wait</a>(&amp;barrier2);</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    }</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <span class="keywordflow">while</span> (1);</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;}<span class="comment">//close function doThreadsTasks</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"><a class="line" href="classProgML2D.html#a60c80f44651c3b41e31d779d0cd2945f"> 1026</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classProgML2D.html#a60c80f44651c3b41e31d779d0cd2945f">ProgML2D::getThreadRefnoJob</a>(<span class="keywordtype">int</span> &amp;refno)</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;{</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <span class="keywordtype">int</span> load = 0;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    pthread_mutex_lock(&amp;<a class="code" href="ml__align2d_8cpp.html#a434e4700cbd673d587cedf170679ab1f">refno_mutex</a>);</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classProgML2D.html#aebc66055676b2ac6f6f0995eaefb0efb">refno_count</a> &lt; <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>)</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    {</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        load = <a class="code" href="group__Macros.html#gac9ae6a207f10c821b06a8c0df153a7d5">XMIPP_MIN</a>(<a class="code" href="classProgML2D.html#aafc61ce3cafabb12bbad05faf3f4b46e">refno_load</a>, <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a> - <a class="code" href="classProgML2D.html#aebc66055676b2ac6f6f0995eaefb0efb">refno_count</a>);</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        refno = <a class="code" href="classProgML2D.html#a9dd356894e80f8d88e81c6ae6315afcf">refno_index</a>;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        <a class="code" href="classProgML2D.html#a9dd356894e80f8d88e81c6ae6315afcf">refno_index</a> = (<a class="code" href="classProgML2D.html#a9dd356894e80f8d88e81c6ae6315afcf">refno_index</a> + load) % <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;        <a class="code" href="classProgML2D.html#aebc66055676b2ac6f6f0995eaefb0efb">refno_count</a> += load;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;    }</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    pthread_mutex_unlock(&amp;<a class="code" href="ml__align2d_8cpp.html#a434e4700cbd673d587cedf170679ab1f">refno_mutex</a>);</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="keywordflow">return</span> load;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;}<span class="comment">//close function getThreadRefnoJob</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div><div class="line"><a name="l01046"></a><span class="lineno"><a class="line" href="classProgML2D.html#a481fb6a97fef42aa5a9e2b56ce6d1cb8"> 1046</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a481fb6a97fef42aa5a9e2b56ce6d1cb8">ProgML2D::awakeThreads</a>(<a class="code" href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34">ThreadTask</a> task, <span class="keywordtype">int</span> start_refno, <span class="keywordtype">int</span> load)</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;{</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <a class="code" href="classProgML2D.html#a8c569527c10ddd6d1a9cf09f440da081">threadTask</a> = task;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    <a class="code" href="classProgML2D.html#a9dd356894e80f8d88e81c6ae6315afcf">refno_index</a> = start_refno;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <a class="code" href="classProgML2D.html#aebc66055676b2ac6f6f0995eaefb0efb">refno_count</a> = 0;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <a class="code" href="classProgML2D.html#aafc61ce3cafabb12bbad05faf3f4b46e">refno_load</a> = load;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    <a class="code" href="group__Threads.html#ga99a3a59fba69ac42cf6fb51df0dc5b64">barrier_wait</a>(&amp;<a class="code" href="classProgML2D.html#a3fdd8612a9d5a2e5e687fa33b0925f27">barrier</a>);</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <span class="comment">//Wait until done</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <a class="code" href="group__Threads.html#ga99a3a59fba69ac42cf6fb51df0dc5b64">barrier_wait</a>(&amp;<a class="code" href="classProgML2D.html#a5ff1bd818e33945055fb5ed67379cacd">barrier2</a>);</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;}<span class="comment">//close function awakeThreads</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;</div><div class="line"><a name="l01058"></a><span class="lineno"><a class="line" href="classProgML2D.html#a1ae2970adffcee179223e27c6b8f7c5e"> 1058</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a1ae2970adffcee179223e27c6b8f7c5e">ProgML2D::doThreadRotateReferenceRefno</a>()</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;{</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;entering doThreadRotateReference &quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="keywordtype">double</span> AA, stdAA=0., <a class="code" href="namespacealglib.html#a0759579762ef75075769325153538c5b">psi</a>, dum, avg;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;double&gt;</a> Maux(<a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>, <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>);</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;std::complex&lt;double&gt;</a> &gt; Faux;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <a class="code" href="classFourierTransformer.html">FourierTransformer</a> local_transformer;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="keywordtype">int</span> refnoipsi;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    Maux.<a class="code" href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">setXmippOrigin</a>();</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <a class="code" href="ml__align2d_8h.html#ad12cf04e6cd4aa26363fd70ae35905ed">FOR_ALL_THREAD_REFNO</a>()</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    {</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        <a class="code" href="group__Masks.html#ga5bd552c32d3d6b6abd6ddf18677cf647">computeStats_within_binary_mask</a>(<a class="code" href="classProgML2D.html#ad2908f9cced8aa5456025a8dcda6e6f1">omask</a>, <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a29baa2fb66177265cb0de6d027ea454a">Iref</a>[refno](), dum,</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;                                        dum, avg, dum);</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ipsi = 0; ipsi &lt; <a class="code" href="classML2DBaseProgram.html#a976dc404489a0c66af2800f0f73e76c7">nr_psi</a>; ipsi++)</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        {</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;            refnoipsi = refno * nr_psi + ipsi;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            <span class="comment">// Add arbitrary number (small_angle) to avoid 0-degree rotation (lacking interpolation)</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            <a class="code" href="namespacealglib.html#a0759579762ef75075769325153538c5b">psi</a> = (double) (ipsi * <a class="code" href="classML2DBaseProgram.html#a2ab21717291173f3155a2e4006137167">psi_max</a> / nr_psi) + <a class="code" href="ml2d_8h.html#a6b49ded9ade4e2a8b65b16670db60486">SMALLANGLE</a>;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            <a class="code" href="classification_2pca_8cpp.html#ae5e08c2a7a15204653d0fdaabbc890ac">rotate</a>(<a class="code" href="group__GeometricalTransformations.html#gab8a49d8335f45ebd2ba7d86d98322bc0">BSPLINE3</a>, Maux, <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a29baa2fb66177265cb0de6d027ea454a">Iref</a>[refno](), -<a class="code" href="namespacealglib.html#a0759579762ef75075769325153538c5b">psi</a>, <span class="charliteral">&#39;Z&#39;</span>, <a class="code" href="transformations_8h.html#a43c1de45dbd91827a260224c9c40221b">WRAP</a>);</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            <a class="code" href="group__Masks.html#gadf8e3471e09288a8c320d1d900695c21">apply_binary_mask</a>(<a class="code" href="classProgML2D.html#a8408a3dd090f5a67ffb34a209d48ce02">mask</a>, Maux, Maux, avg);</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            <span class="comment">// Normalize the magnitude of the rotated references to 1st rot of that ref</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;            <span class="comment">// This is necessary because interpolation due to rotation can lead to lower overall Fref</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;            <span class="comment">// This would result in lower probabilities for those rotations</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            AA = Maux.<a class="code" href="classMultidimArray.html#ae9f104cb09328048ed9aa7aec03c792c">sum2</a>();</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            <span class="keywordflow">if</span> (ipsi == 0)</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            {</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                stdAA = AA;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                <a class="code" href="classProgML2D.html#a161f40ee3ca8ea86269a02026cda6040">A2</a>[refno] = AA;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;            }</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            <span class="keywordflow">if</span> (AA &gt; 0)</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                Maux *= <a class="code" href="image__operate_8cpp.html#aba02a4405b44e10470c7af98477800a9">sqrt</a>(stdAA / AA);</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a47f7cd87d5f078979db61864b4f6d55f">fast_mode</a>)</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                <a class="code" href="classProgML2D.html#a28206f5adc9ded7be742b51a9fa39c18">mref</a>[refnoipsi] = Maux;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;            <span class="comment">// Do the forward FFT</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;            local_transformer.<a class="code" href="classFourierTransformer.html#abfdc5699d3c579a26bba39ec679b5adc">FourierTransform</a>(Maux, Faux, <span class="keyword">false</span>);</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#ga4e8db4e5757ca2f6e233d0a1eec7ff1c">FOR_ALL_DIRECT_ELEMENTS_IN_ARRAY2D</a>(Faux)</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;            {</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(Faux, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) = <a class="code" href="namespacealglib.html#a0fe83df1d04b0270f8cfaf97114082ff">conj</a>(<a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(Faux, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>));</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;            }</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;            <a class="code" href="classProgML2D.html#a1df4cb7668c8de81e5f012be633c4b10">fref</a>[refnoipsi] = Faux;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        }</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        <span class="comment">// If we don&#39;t use save_mem1 Iref[refno] is useless from here on</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        <span class="comment">//FIXME: Segmentation fault with blocks</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        <span class="comment">//if (!save_mem1)</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        <span class="comment">//    model.Iref[refno]().resize(0, 0);</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    }<span class="comment">//close while</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;}<span class="comment">//close function doThreadRotateReferenceRefno</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;</div><div class="line"><a name="l01119"></a><span class="lineno"><a class="line" href="classProgML2D.html#a33abac49bbbe75a56fd9ac1a928151a1"> 1119</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a33abac49bbbe75a56fd9ac1a928151a1">ProgML2D::doThreadReverseRotateReferenceRefno</a>()</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;{</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="namespacealglib.html#a0759579762ef75075769325153538c5b">psi</a>, dum, avg;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;double&gt;</a> Maux(<a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>, <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>), Maux2(<a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>, <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>), Maux3(<a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>, <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>);</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;std::complex&lt;double&gt;</a> &gt; Faux;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <a class="code" href="classFourierTransformer.html">FourierTransformer</a> local_transformer;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    Maux.setXmippOrigin();</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    Maux2.setXmippOrigin();</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    Maux3.<a class="code" href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">setXmippOrigin</a>();</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <a class="code" href="ml__align2d_8h.html#ad12cf04e6cd4aa26363fd70ae35905ed">FOR_ALL_THREAD_REFNO</a>()</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    {</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        Maux.initZeros();</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;        <a class="code" href="classProgML2D.html#ab3401ed5e2fdaef29418db09181b706d">wsum_Mref</a>[refno] = Maux;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ipsi = 0; ipsi &lt; <a class="code" href="classML2DBaseProgram.html#a976dc404489a0c66af2800f0f73e76c7">nr_psi</a>; ipsi++)</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;        {</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;            <span class="comment">// Add arbitrary number to avoid 0-degree rotation without interpolation effects</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;            psi = (double) (ipsi * <a class="code" href="classML2DBaseProgram.html#a2ab21717291173f3155a2e4006137167">psi_max</a> / nr_psi) + <a class="code" href="ml2d_8h.html#a6b49ded9ade4e2a8b65b16670db60486">SMALLANGLE</a>;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;            <span class="keywordtype">int</span> refnoipsi = refno * nr_psi + ipsi;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;            <span class="comment">// Do the backward FFT</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;            <span class="comment">// The construction with Faux and Maux3 should perhaps not be necessary,</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;            <span class="comment">// but I am having irreproducible segmentation faults for the iFFT</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;            Faux = <a class="code" href="classProgML2D.html#a2eddbf01d350e8ab9974d5e1654f383a">wsumimgs</a>[refnoipsi];</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;            local_transformer.<a class="code" href="classFourierTransformer.html#a1c8297f634bb4f9d1235f6c4fa33d7e5">inverseFourierTransform</a>(Faux, Maux);</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;            Maux3 = Maux;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;            <span class="comment">//CenterFFT(Maux3, true);</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;            <a class="code" href="group__Fourier.html#ga615e066e3016d55d63fd5f9b5cb4836b">centerFFT2</a>(Maux3);</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;            <a class="code" href="group__Masks.html#ga5bd552c32d3d6b6abd6ddf18677cf647">computeStats_within_binary_mask</a>(<a class="code" href="classProgML2D.html#ad2908f9cced8aa5456025a8dcda6e6f1">omask</a>, Maux3, dum, dum, avg, dum);</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;            <a class="code" href="classification_2pca_8cpp.html#ae5e08c2a7a15204653d0fdaabbc890ac">rotate</a>(<a class="code" href="group__GeometricalTransformations.html#gab8a49d8335f45ebd2ba7d86d98322bc0">BSPLINE3</a>, Maux2, Maux3, psi, <span class="charliteral">&#39;Z&#39;</span>, <a class="code" href="transformations_8h.html#a43c1de45dbd91827a260224c9c40221b">WRAP</a>);</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;            <a class="code" href="group__Masks.html#gadf8e3471e09288a8c320d1d900695c21">apply_binary_mask</a>(<a class="code" href="classProgML2D.html#a8408a3dd090f5a67ffb34a209d48ce02">mask</a>, Maux2, Maux2, avg);</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;            <a class="code" href="classProgML2D.html#ab3401ed5e2fdaef29418db09181b706d">wsum_Mref</a>[refno] += Maux2;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        }</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    }<span class="comment">//close while refno</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;}<span class="comment">//close function doThreadReverseRotateReference</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;</div><div class="line"><a name="l01159"></a><span class="lineno"><a class="line" href="ml__align2d_8cpp.html#a911e59592bd1aa3d7f6bf57b60af5a0e"> 1159</a></span>&#160;<span class="preprocessor">#define IIFLIP (imirror * nr_nomirror_flips + iflip)</span></div><div class="line"><a name="l01160"></a><span class="lineno"><a class="line" href="ml__align2d_8cpp.html#a767d758968c96231c2fb0efd5c20c3c2"> 1160</a></span>&#160;<span class="preprocessor">#define IROT (IIFLIP * nr_psi + ipsi)</span></div><div class="line"><a name="l01161"></a><span class="lineno"><a class="line" href="ml__align2d_8cpp.html#a3343bd513d3d0333159523d85bf0e4a4"> 1161</a></span>&#160;<span class="preprocessor">#define IREFMIR ()</span></div><div class="line"><a name="l01162"></a><span class="lineno"><a class="line" href="ml__align2d_8cpp.html#ac2523bb35f42a8e134775400b70ae47d"> 1162</a></span>&#160;<span class="preprocessor">#define WEIGHT (dAij(pfs_weight, refno, IROT))</span></div><div class="line"><a name="l01163"></a><span class="lineno"><a class="line" href="ml__align2d_8cpp.html#a943995a7bf30da3587664920856533ab"> 1163</a></span>&#160;<span class="preprocessor">#define MAX_WEIGHT (dAij(pfs_maxweight, imirror, refno))</span></div><div class="line"><a name="l01164"></a><span class="lineno"><a class="line" href="ml__align2d_8cpp.html#aa5a923caf811bcd65e2b95bce6a609e4"> 1164</a></span>&#160;<span class="preprocessor">#define MSIGNIFICANT (dAij(Msignificant, refno, IROT))</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;</div><div class="line"><a name="l01166"></a><span class="lineno"><a class="line" href="classProgML2D.html#abeb29fd2474be31882bf38ba7d1ddb02"> 1166</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#abeb29fd2474be31882bf38ba7d1ddb02">ProgML2D::doThreadPreselectFastSignificantRefno</a>()</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;{</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;double&gt;</a> Mtrans, Mflip;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="keywordtype">double</span> ropt, aux, diff, pdf, fracpdf;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="keywordtype">double</span> A2_plus_Xi2;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="keywordtype">int</span> irefmir;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> trans(2);</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="keywordtype">double</span> local_mindiff;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="keywordtype">double</span> sigma_noise2 = <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#aa1281d05277a75579f9adb3b19304a7b">sigma_noise</a> * <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#aa1281d05277a75579f9adb3b19304a7b">sigma_noise</a>;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <span class="keywordtype">int</span> nr_mirror = (<a class="code" href="classML2DBaseProgram.html#ad9b9535e1774d805e5bbee89dee0f4b5">do_mirror</a>) ? 2 : 1;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    Mtrans.<a class="code" href="classMultidimArray.html#a048fe82e79de7fba796cd4e87869ef36">resize</a>(<a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>, <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>);</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    Mtrans.<a class="code" href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">setXmippOrigin</a>();</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    Mflip.<a class="code" href="classMultidimArray.html#a048fe82e79de7fba796cd4e87869ef36">resize</a>(<a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>, <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>);</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    Mflip.<a class="code" href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">setXmippOrigin</a>();</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    local_mindiff = 99.e99;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <span class="comment">// A. Translate image and calculate probabilities for every rotation</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    <a class="code" href="ml__align2d_8h.html#ad12cf04e6cd4aa26363fd70ae35905ed">FOR_ALL_THREAD_REFNO</a>()</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    {</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classML2DBaseProgram.html#a549ca4cda193eb449087f9a316c61f20">limit_rot</a> || <a class="code" href="classProgML2D.html#af3ba3c5330db20cf897a5b83ce26ff69">pdf_directions</a>[refno] &gt; 0.)</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;        {</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;            A2_plus_Xi2 = 0.5 * (<a class="code" href="classProgML2D.html#a161f40ee3ca8ea86269a02026cda6040">A2</a>[refno] + <a class="code" href="classProgML2D.html#a665c986d28b896e593f1623b7389dc03">Xi2</a>);</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> imirror = 0; imirror &lt; nr_mirror; imirror++)</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;            {</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;                irefmir = imirror * <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a> + refno;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                <span class="comment">// Get optimal offsets</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                trans(0) = <a class="code" href="classProgML2D.html#a3ee54e92214ba139048b67204d33812a">allref_offsets</a>[2 * irefmir];</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                trans(1) = <a class="code" href="classProgML2D.html#a3ee54e92214ba139048b67204d33812a">allref_offsets</a>[2 * irefmir + 1];</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                ropt = <a class="code" href="image__operate_8cpp.html#aba02a4405b44e10470c7af98477800a9">sqrt</a>(trans(0) * trans(0) + trans(1) * trans(1));</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;                <span class="comment">// Do not trust optimal offsets if they are larger than 3*sigma_offset:</span></div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;                <span class="keywordflow">if</span> (ropt &gt; 3 * <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ee9d8ba6b21965a4fd84a8987c0b76e">sigma_offset</a>)</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;                {</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;                    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iflip = 0; iflip &lt; <a class="code" href="classML2DBaseProgram.html#abe104a9ef312f6d857b008188e5dfbea">nr_nomirror_flips</a>; iflip++)</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;                        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ipsi = 0; ipsi &lt; <a class="code" href="classML2DBaseProgram.html#a976dc404489a0c66af2800f0f73e76c7">nr_psi</a>; ipsi++)</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;                            <a class="code" href="ml__align2d_8cpp.html#aa5a923caf811bcd65e2b95bce6a609e4">MSIGNIFICANT</a> = 1;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;                }</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;                {</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;                    <a class="code" href="lib__pwk_8cpp.html#a1b33162134537b4be1f614f7e8094d35">translate</a>(<a class="code" href="group__GeometricalTransformations.html#gac645eb9a88619ee6f5e14c557ab8ef62">LINEAR</a>, Mtrans, <a class="code" href="classProgML2D.html#ad45f8eab09da7787c7e8e5e86883a40a">Mimg</a>, trans, <span class="keyword">true</span>);</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;                    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iflip = 0; iflip &lt; <a class="code" href="classML2DBaseProgram.html#abe104a9ef312f6d857b008188e5dfbea">nr_nomirror_flips</a>; iflip++)</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;                    {</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;                        <a class="code" href="group__GeometricalTransformations.html#ga3cc15e5dda7c58b9cacb7eee440d6bdc">applyGeometry</a>(<a class="code" href="group__GeometricalTransformations.html#gac645eb9a88619ee6f5e14c557ab8ef62">LINEAR</a>, Mflip, Mtrans, <a class="code" href="classML2DBaseProgram.html#a879e423db0331279b0421e881b73be57">F</a>[<a class="code" href="ml__align2d_8cpp.html#a911e59592bd1aa3d7f6bf57b60af5a0e">IIFLIP</a>], <a class="code" href="transformations_8h.html#a855436c9d0ed5174df8917d5239d7597">IS_INV</a>, <a class="code" href="transformations_8h.html#a43c1de45dbd91827a260224c9c40221b">WRAP</a>);</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ipsi = 0; ipsi &lt; <a class="code" href="classML2DBaseProgram.html#a976dc404489a0c66af2800f0f73e76c7">nr_psi</a>; ipsi++)</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                        {</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                            diff = A2_plus_Xi2;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;                            <a class="code" href="classMultidimArray.html">MultidimArray&lt;double&gt;</a> &amp;mref_ref = <a class="code" href="classProgML2D.html#a28206f5adc9ded7be742b51a9fa39c18">mref</a>[refno*nr_psi + ipsi];</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;                            <a class="code" href="group__MultidimensionalArrays.html#gad60a440a5ba86f9f7f40cf4a23682500">FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY</a>(Mflip)</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                            {</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                                diff -= <a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(Mflip, <a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) * <a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(mref_ref, <a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                            }</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                            <a class="code" href="ml__align2d_8cpp.html#ac2523bb35f42a8e134775400b70ae47d">WEIGHT</a> = diff;</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                            <span class="keywordflow">if</span> (diff &lt; local_mindiff)</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;                                local_mindiff = diff;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                        }</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;                    }</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                }<span class="comment">//close else if ropt &gt; ...</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;            }<span class="comment">//close for imirror</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;        }<span class="comment">//close if !limit_rot ...</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    }<span class="comment">//close for_all refno</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    pthread_mutex_lock(&amp;<a class="code" href="ml__align2d_8cpp.html#a8c04d9a53742f1b981c80dd88aa430a1">update_mutex</a>);</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <a class="code" href="classProgML2D.html#a01d866b9a9c4b54dabe1b05266c3acd6">pfs_mindiff</a> = <a class="code" href="group__Macros.html#gac9ae6a207f10c821b06a8c0df153a7d5">XMIPP_MIN</a>(<a class="code" href="classProgML2D.html#a01d866b9a9c4b54dabe1b05266c3acd6">pfs_mindiff</a>, local_mindiff);</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    <a class="code" href="classProgML2D.html#a9dd356894e80f8d88e81c6ae6315afcf">refno_index</a> = <a class="code" href="classProgML2D.html#aebc66055676b2ac6f6f0995eaefb0efb">refno_count</a> = 0;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    pthread_mutex_unlock(&amp;<a class="code" href="ml__align2d_8cpp.html#a8c04d9a53742f1b981c80dd88aa430a1">update_mutex</a>);</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    <a class="code" href="group__Threads.html#ga99a3a59fba69ac42cf6fb51df0dc5b64">barrier_wait</a>(&amp;<a class="code" href="classProgML2D.html#af4bf8cc040f12a2a38d278a0539117cf">barrier3</a>);</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    local_mindiff = <a class="code" href="classProgML2D.html#a01d866b9a9c4b54dabe1b05266c3acd6">pfs_mindiff</a>;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    <span class="comment">// B. Now that we have local_mindiff, calculate the weights</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <a class="code" href="ml__align2d_8h.html#a6e103bfffafe8ad89cbaf0d80a01cc96">FOR_ALL_THREAD_REFNO_NODECL</a>()</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    {</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classML2DBaseProgram.html#a549ca4cda193eb449087f9a316c61f20">limit_rot</a> || <a class="code" href="classProgML2D.html#af3ba3c5330db20cf897a5b83ce26ff69">pdf_directions</a>[refno] &gt; 0.)</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        {</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> imirror = 0; imirror &lt; nr_mirror; imirror++)</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;            {</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;                irefmir = imirror * <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a> + refno;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                <span class="comment">// Get optimal offsets</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;                trans(0) = <a class="code" href="classProgML2D.html#a3ee54e92214ba139048b67204d33812a">allref_offsets</a>[2 * irefmir];</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;                trans(1) = <a class="code" href="classProgML2D.html#a3ee54e92214ba139048b67204d33812a">allref_offsets</a>[2 * irefmir + 1];</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iflip = 0; iflip &lt; <a class="code" href="classML2DBaseProgram.html#abe104a9ef312f6d857b008188e5dfbea">nr_nomirror_flips</a>; iflip++)</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ipsi = 0; ipsi &lt; <a class="code" href="classML2DBaseProgram.html#a976dc404489a0c66af2800f0f73e76c7">nr_psi</a>; ipsi++)</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                    {</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;                        <span class="keywordflow">if</span> (!<a class="code" href="ml__align2d_8cpp.html#aa5a923caf811bcd65e2b95bce6a609e4">MSIGNIFICANT</a>)</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;                        {</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;                            fracpdf = <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a9623e75d2dcf944d1fa02a53fe851cd0">alpha_k</a>[refno] *</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;                                      (imirror ? <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#aae60b45954a007f5f9b95ae73c637205">mirror_fraction</a>[refno] : (1.- <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#aae60b45954a007f5f9b95ae73c637205">mirror_fraction</a>[refno]));</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;                            pdf = fracpdf * <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(<a class="code" href="classML2DBaseProgram.html#a6f44905656bc9d5a5bb57dea399cd18e">P_phi</a>, (<span class="keywordtype">int</span>)trans(1), (<span class="keywordtype">int</span>)trans(0));</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                            <span class="keywordflow">if</span> (!<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ba63ac8129e521abfeaeaee3bb4c38d">do_student</a>)</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;                            {</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                                <span class="comment">// normal distribution</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;                                aux = (<a class="code" href="ml__align2d_8cpp.html#ac2523bb35f42a8e134775400b70ae47d">WEIGHT</a> - local_mindiff) / sigma_noise2;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;                                <span class="comment">// next line because of numerical precision of exp-function</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;                                <a class="code" href="ml__align2d_8cpp.html#ac2523bb35f42a8e134775400b70ae47d">WEIGHT</a> = (aux &gt; 1000. ? 0. : exp(-aux) * pdf);</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;                            }</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;                            <span class="keywordflow">else</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;                            {</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;                                <span class="comment">// t-student distribution</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;                                aux = (<a class="code" href="classML2DBaseProgram.html#a3169a7f52fce4768757155f99b12fa84">dfsigma2</a> + 2. * <a class="code" href="ml__align2d_8cpp.html#ac2523bb35f42a8e134775400b70ae47d">WEIGHT</a>) / (<a class="code" href="classML2DBaseProgram.html#a3169a7f52fce4768757155f99b12fa84">dfsigma2</a> + 2. * local_mindiff);</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;                                <a class="code" href="ml__align2d_8cpp.html#ac2523bb35f42a8e134775400b70ae47d">WEIGHT</a> = pow(aux, <a class="code" href="classML2DBaseProgram.html#a3106e12c5756e90d770df3708307258d">df2</a>) * pdf;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;                            }</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="ml__align2d_8cpp.html#ac2523bb35f42a8e134775400b70ae47d">WEIGHT</a> &gt; <a class="code" href="ml__align2d_8cpp.html#a943995a7bf30da3587664920856533ab">MAX_WEIGHT</a>)</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;                                <a class="code" href="ml__align2d_8cpp.html#a943995a7bf30da3587664920856533ab">MAX_WEIGHT</a> = <a class="code" href="ml__align2d_8cpp.html#ac2523bb35f42a8e134775400b70ae47d">WEIGHT</a>;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;                        }</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;                    } <span class="comment">// close ipsi</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="comment"></span>                <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iflip = 0; iflip &lt; <a class="code" href="classML2DBaseProgram.html#abe104a9ef312f6d857b008188e5dfbea">nr_nomirror_flips</a>; iflip++)</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;                    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ipsi = 0; ipsi &lt; <a class="code" href="classML2DBaseProgram.html#a976dc404489a0c66af2800f0f73e76c7">nr_psi</a>; ipsi++)</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;                        <span class="keywordflow">if</span> (!<a class="code" href="ml__align2d_8cpp.html#aa5a923caf811bcd65e2b95bce6a609e4">MSIGNIFICANT</a>)</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;                            <a class="code" href="ml__align2d_8cpp.html#aa5a923caf811bcd65e2b95bce6a609e4">MSIGNIFICANT</a> = (<a class="code" href="ml__align2d_8cpp.html#ac2523bb35f42a8e134775400b70ae47d">WEIGHT</a> &gt;= <a class="code" href="classML2DBaseProgram.html#a67faef1c7bbe1544c7f51e4d4fa0e833">C_fast</a> * <a class="code" href="ml__align2d_8cpp.html#a943995a7bf30da3587664920856533ab">MAX_WEIGHT</a>) ? 1 : 0;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;            }<span class="comment">//close for imirror</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        } <span class="comment">//endif limit_rot and pdf_directions</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    } <span class="comment">//end for_all refno</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;}<span class="comment">//close function doThreadPreselectFastSignificantRefno</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div><div class="line"><a name="l01287"></a><span class="lineno"><a class="line" href="classProgML2D.html#ad9f83e25ef28d8febe54e4930ce418a5"> 1287</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#ad9f83e25ef28d8febe54e4930ce418a5">ProgML2D::doThreadExpectationSingleImageRefno</a>()</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;{</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <span class="keywordtype">double</span> diff;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <span class="keywordtype">double</span> aux, pdf, fracpdf, A2_plus_Xi2;</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    <span class="keywordtype">double</span> weight, stored_weight, weight2, my_maxweight;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    <span class="keywordtype">double</span> my_sumweight, my_sumstoredweight, ref_scale = 1.;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="keywordtype">int</span> irot, output_irefmir, refnoipsi, output_refnoipsi;</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <span class="comment">//Some local variables to store partial sums of global sums variables</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="keywordtype">double</span> local_mindiff, local_wsum_corr, local_wsum_offset, maxw_ref;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    <span class="keywordtype">double</span> local_wsum_sc, local_wsum_sc2, local_maxweight, local_maxweight2=0.0;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    <span class="keywordtype">double</span> sigma_noise2 = <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#aa1281d05277a75579f9adb3b19304a7b">sigma_noise</a> * <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#aa1281d05277a75579f9adb3b19304a7b">sigma_noise</a>;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <span class="keywordtype">int</span> local_iopty=0, local_ioptx=0, local_iopt_psi=0, local_iopt_flip=0,</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    local_opt_refno=0;</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;double&gt;</a> Maux, Mweight;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;std::complex&lt;double&gt;</a> &gt; Faux, Fzero(<a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>, <a class="code" href="classML2DBaseProgram.html#a90e6ce499655b4566e17e32102a905c4">hdim</a> + 1);</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    <a class="code" href="classFourierTransformer.html">FourierTransformer</a> local_transformer;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    <span class="comment">// Setup matrices</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    Maux.<a class="code" href="classMultidimArray.html#a048fe82e79de7fba796cd4e87869ef36">resize</a>(<a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>, <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>);</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    Maux.<a class="code" href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">setXmippOrigin</a>();</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    Mweight.<a class="code" href="classMultidimArray.html#a048fe82e79de7fba796cd4e87869ef36">resize</a>(<a class="code" href="classProgML2D.html#a58c7e5ee272eb1e83531df902e67064d">sigdim</a>, <a class="code" href="classProgML2D.html#a58c7e5ee272eb1e83531df902e67064d">sigdim</a>);</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    Mweight.<a class="code" href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">setXmippOrigin</a>();</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    Fzero.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>();</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    local_transformer.<a class="code" href="classFourierTransformer.html#a18bc840c781555b742d0185fb20925bf">setReal</a>(Maux);</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    local_transformer.<a class="code" href="classFourierTransformer.html#a6335c9c01f240a8edf3b363cef43248b">getFourierAlias</a>(Faux);</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    <span class="comment">// Start the loop over all refno at old_optrefno (=opt_refno from the previous iteration).</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    <span class="comment">// This will speed-up things because we will find Pmax probably right away,</span></div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    <span class="comment">// and this will make the if-statement that checks SIGNIFICANT_WEIGHT_LOW</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="comment">// effective right from the start</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="comment">//std::cerr &lt;&lt; &quot;DEBUG_JM: doThreadExpectationSingleImageRefno: &quot; &lt;&lt; std::endl;</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    <a class="code" href="ml__align2d_8h.html#ad12cf04e6cd4aa26363fd70ae35905ed">FOR_ALL_THREAD_REFNO</a>()</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    {</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;        <span class="keywordtype">int</span> output_refno = <a class="code" href="classProgML2D.html#ae750407f07cf8ad2b23ff8a7ef640e5e">mygroup</a> * <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a> + refno;</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        <span class="comment">//        std::cerr &lt;&lt; &quot;DEBUG_JM:           refno: &quot; &lt;&lt; refno &lt;&lt; std::endl;</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;        <span class="comment">//        std::cerr &lt;&lt; &quot;DEBUG_JM:     model.n_ref: &quot; &lt;&lt;    model.n_ref &lt;&lt; std::endl;</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;        <span class="comment">//        std::cerr &lt;&lt; &quot;DEBUG_JM:    output_refno: &quot; &lt;&lt;    output_refno &lt;&lt; std::endl;</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;        <a class="code" href="classProgML2D.html#ae2342cb5f821a8f8d90d103b543c1083">refw</a>[output_refno] = <a class="code" href="classProgML2D.html#ae0bda101c64aff966641b35d19c6f910">refw2</a>[output_refno] = <a class="code" href="classProgML2D.html#ae0c18214588873b98a6ea20daabdd924">refw_mirror</a>[output_refno] = 0.;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;        local_maxweight = -99.e99;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;        local_mindiff = 99.e99;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        local_wsum_sc = local_wsum_sc2 = local_wsum_corr = local_wsum_offset = 0;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        <span class="comment">// Initialize my weighted sums</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ipsi = 0; ipsi &lt; <a class="code" href="classML2DBaseProgram.html#a976dc404489a0c66af2800f0f73e76c7">nr_psi</a>; ipsi++)</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        {</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;            output_refnoipsi = output_refno * nr_psi + ipsi;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;            <a class="code" href="classProgML2D.html#ac5e5c4cf86a9dad9ac604abf2aaa94cf">mysumimgs</a>[output_refnoipsi] = Fzero;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;            <a class="code" href="classProgML2D.html#aac2d16debfdf2fe8866e3f444ed8a697">sumw_refpsi</a>[output_refnoipsi] = 0.;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;        }</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        <span class="comment">// This if is for limited rotation options</span></div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classML2DBaseProgram.html#a549ca4cda193eb449087f9a316c61f20">limit_rot</a> || <a class="code" href="classProgML2D.html#af3ba3c5330db20cf897a5b83ce26ff69">pdf_directions</a>[refno] &gt; 0.)</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;        {</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">do_norm</a>)</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;                ref_scale = <a class="code" href="classProgML2D.html#a89fc3cde7847bf0bb39ea52add1d4490">opt_scale</a> / <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#afb7a89515e4d8891cbc47b9b32857eb1">scale</a>[refno];</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;            A2_plus_Xi2 = 0.5 * (ref_scale * ref_scale * <a class="code" href="classProgML2D.html#a161f40ee3ca8ea86269a02026cda6040">A2</a>[refno] + <a class="code" href="classProgML2D.html#a665c986d28b896e593f1623b7389dc03">Xi2</a>);</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;            maxw_ref = -99.e99;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> iflip = 0; iflip &lt; <a class="code" href="classML2DBaseProgram.html#a715ad0eb7ac0ce476faf1623fedea1a8">nr_flip</a>; iflip++)</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;            {</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                <span class="keywordflow">if</span> (iflip == <a class="code" href="classML2DBaseProgram.html#abe104a9ef312f6d857b008188e5dfbea">nr_nomirror_flips</a>)</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                    maxw_ref = -99.e99;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ipsi = 0; ipsi &lt; <a class="code" href="classML2DBaseProgram.html#a976dc404489a0c66af2800f0f73e76c7">nr_psi</a>; ipsi++)</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;                {</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;                    refnoipsi = refno * nr_psi + ipsi;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                    output_refnoipsi = output_refno * nr_psi + ipsi;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;                    irot = iflip * nr_psi + ipsi;</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;                    output_irefmir  = (int)<a class="code" href="cuda__basic__math_8h.html#a2065eb145275f878c1d045c9f3fb1cc7">floor</a>(iflip / <a class="code" href="classML2DBaseProgram.html#abe104a9ef312f6d857b008188e5dfbea">nr_nomirror_flips</a>)</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                                      * <a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a> * <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a> + refno;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;                    <span class="comment">//#define DEBUG_JM2</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="preprocessor">#ifdef DEBUG_JM2</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a20e2b948711e3e66894740b99e8cf017">iter</a> &gt; 1)</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;                    {</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;                        std::cerr &lt;&lt; <a class="code" href="classML2DBaseProgram.html#a20e2b948711e3e66894740b99e8cf017">iter</a> &lt;&lt; <span class="stringliteral">&quot; iflip, ipsi, refno, irot: &quot;</span> &lt;&lt; iflip &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; ipsi &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; refno &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; irot &lt;&lt; std::endl;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                        std::cerr &lt;&lt; <a class="code" href="classML2DBaseProgram.html#a20e2b948711e3e66894740b99e8cf017">iter</a> &lt;&lt; <span class="stringliteral">&quot; A2_plus_Xi2: &quot;</span> &lt;&lt; A2_plus_Xi2 &lt;&lt; std::endl;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                        std::cerr &lt;&lt; <span class="stringliteral">&quot;dAij(Msignificant): &quot;</span> &lt;&lt; <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(<a class="code" href="classProgML2D.html#a75cc3fc6713d2e0b3952a5ee1078014a">Msignificant</a>, refno, irot) &lt;&lt; std::endl;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;                    }</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;                    <span class="comment">// This if is the speed-up caused by the -fast options</span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(<a class="code" href="classProgML2D.html#a75cc3fc6713d2e0b3952a5ee1078014a">Msignificant</a>, refno, irot))</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;                    {</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;                        <span class="keywordflow">if</span> (iflip &lt; <a class="code" href="classML2DBaseProgram.html#abe104a9ef312f6d857b008188e5dfbea">nr_nomirror_flips</a>)</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;                            fracpdf = <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a9623e75d2dcf944d1fa02a53fe851cd0">alpha_k</a>[refno] * (1. - <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#aae60b45954a007f5f9b95ae73c637205">mirror_fraction</a>[refno]);</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;                        <span class="keywordflow">else</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;                            fracpdf = <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a9623e75d2dcf944d1fa02a53fe851cd0">alpha_k</a>[refno] * <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#aae60b45954a007f5f9b95ae73c637205">mirror_fraction</a>[refno];</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;                        <span class="comment">// A. Backward FFT to calculate weights in real-space</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;                        <span class="comment">//Set this references to avoid indexing inside the heavy loop</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;                        <span class="comment">//MultidimArray&lt;std::complex&lt;double&gt; &gt; &amp; Fimg_flip_aux = Fimg_flip[iflip];</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;                        Faux = <a class="code" href="classProgML2D.html#a2725bcb11d4abfd956448b2384ec9dfe">Fimg_flip</a>[iflip];</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;                        <a class="code" href="classMultidimArray.html">MultidimArray&lt;std::complex&lt;double&gt;</a> &gt; &amp; fref_aux = <a class="code" href="classProgML2D.html#a1df4cb7668c8de81e5f012be633c4b10">fref</a>[refnoipsi];</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;                        <a class="code" href="group__MultidimensionalArrays.html#gad60a440a5ba86f9f7f40cf4a23682500">FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY</a>(Faux)</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;                        {</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;                            <a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(Faux, <a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) *= <a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(fref_aux, <a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;                        }</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;                        <span class="comment">// Takes the input from Faux, and leaves the output in Maux</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;                        local_transformer.<a class="code" href="classFourierTransformer.html#a1c8297f634bb4f9d1235f6c4fa33d7e5">inverseFourierTransform</a>();</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;                        <span class="comment">//CenterFFT(Maux, true);</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;                        <a class="code" href="group__Fourier.html#ga615e066e3016d55d63fd5f9b5cb4836b">centerFFT2</a>(Maux);</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="preprocessor">#ifdef DEBUG_JM2</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a20e2b948711e3e66894740b99e8cf017">iter</a> &gt; 1)</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;                            std::cerr</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;                            &lt;&lt; <span class="stringliteral">&quot;Maux: &quot;</span> &lt;&lt;  std::endl &lt;&lt; Maux</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;                            &lt;&lt; <span class="stringliteral">&quot;Fimg_flip[iflip]&quot;</span> &lt;&lt;  std::endl&lt;&lt; <a class="code" href="classProgML2D.html#a2725bcb11d4abfd956448b2384ec9dfe">Fimg_flip</a>[iflip]</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;                            &lt;&lt; <span class="stringliteral">&quot;fref[refnoipsi]&quot;</span> &lt;&lt;  std::endl&lt;&lt; <a class="code" href="classProgML2D.html#a1df4cb7668c8de81e5f012be633c4b10">fref</a>[refnoipsi] &lt;&lt; std::endl;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;                        <span class="comment">// B. Calculate weights for each pixel within sigdim (Mweight)</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;                        my_sumweight = my_sumstoredweight = my_maxweight = 0.;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;                        <a class="code" href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a>(Mweight)</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;                        {</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;                            diff = A2_plus_Xi2 - ref_scale * <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(Maux, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) * <a class="code" href="classML2DBaseProgram.html#a790a55bd210ce856bfbbd8853c6789df">ddim2</a>;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;                            pdf = fracpdf * <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(<a class="code" href="classML2DBaseProgram.html#a6f44905656bc9d5a5bb57dea399cd18e">P_phi</a>, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="preprocessor">#ifdef DEBUG_JM2</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a20e2b948711e3e66894740b99e8cf017">iter</a> &gt;= 2 &amp;&amp; <a class="code" href="classML2DBaseProgram.html#ab31f295dfdeb52bada9f0ca819c8fb29">current_image</a> == <a class="code" href="classML2DBaseProgram.html#a791b7cb014db4297f7772becd1daa287">myFirstImg</a>)</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;                                std::cerr &lt;&lt; <span class="stringliteral">&quot;---------------------------------------&quot;</span> &lt;&lt; std::endl</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;                                &lt;&lt; <span class="stringliteral">&quot;   pdf &quot;</span> &lt;&lt; pdf &lt;&lt; std::endl</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;                                &lt;&lt; <span class="stringliteral">&quot;   A2_plus_Xi2 &quot;</span> &lt;&lt; A2_plus_Xi2 &lt;&lt; std::endl</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;                                &lt;&lt; <span class="stringliteral">&quot;   A2D_ELEM(Maux, i, j) &quot;</span> &lt;&lt; <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(Maux, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) &lt;&lt; std::endl</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;                                &lt;&lt; <span class="stringliteral">&quot;   ref_scale &quot;</span> &lt;&lt; ref_scale &lt;&lt; std::endl</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;                                &lt;&lt; <span class="stringliteral">&quot;   ddim2 &quot;</span> &lt;&lt; ddim2 &lt;&lt; std::endl</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;                                &lt;&lt; <span class="stringliteral">&quot;diff &quot;</span> &lt;&lt; diff &lt;&lt; std::endl</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;                                &lt;&lt; <span class="stringliteral">&quot;trymindiff &quot;</span> &lt;&lt; <a class="code" href="classProgML2D.html#a8056b29f3479fde75215466ab904f6bd">trymindiff</a> &lt;&lt; std::endl</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;                                &lt;&lt; <span class="stringliteral">&quot;sigma_noise2 &quot;</span> &lt;&lt; sigma_noise2 &lt;&lt; std::endl;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;                            <span class="keywordflow">if</span> (!<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ba63ac8129e521abfeaeaee3bb4c38d">do_student</a>)</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;                            {</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;                                <span class="comment">// Normal distribution</span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;                                aux = (diff - <a class="code" href="classProgML2D.html#a8056b29f3479fde75215466ab904f6bd">trymindiff</a>) / sigma_noise2;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;                                <span class="comment">// next line because of numerical precision of exp-function</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;                                weight = (aux &gt; 1000.) ? 0. : exp(-aux) * pdf;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;                                <span class="comment">//#define DEBUG_JM2</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="preprocessor">#ifdef DEBUG_JM2</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;                                <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a20e2b948711e3e66894740b99e8cf017">iter</a> &gt;=2 &amp;&amp; <a class="code" href="classML2DBaseProgram.html#ab31f295dfdeb52bada9f0ca819c8fb29">current_image</a> == <a class="code" href="classML2DBaseProgram.html#a791b7cb014db4297f7772becd1daa287">myFirstImg</a> &amp;&amp; pdf &gt; 0)</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;                                    std::cerr &lt;&lt; <span class="stringliteral">&quot;aux = (diff - trymindiff) / sigma_noise2: &quot;</span> &lt;&lt; aux &lt;&lt; std::endl</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;                                    &lt;&lt; <span class="stringliteral">&quot;weight: &quot;</span> &lt;&lt; weight &lt;&lt; std::endl;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="preprocessor">#undef DEBUG_JM2</span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;                                <span class="comment">// store weight</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;                                <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(Mweight, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) = stored_weight = weight;</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;                                <span class="comment">// calculate weighted sum of (X-A)^2 for sigma_noise update</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;                                local_wsum_corr += weight * diff;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;                            }</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;                            <span class="keywordflow">else</span></div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;                            {</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;                                <span class="comment">// t-student distribution</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;                                <span class="comment">// pdf = (1 + diff2/sigma2*df)^df2</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;                                <span class="comment">// Correcting for mindiff:</span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;                                <span class="comment">// pdfc = (1 + diff2/sigma2*df)^df2 / (1 + mindiff/sigma2*df)^df2</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;                                <span class="comment">//      = ( (1 + diff2/sigma2*df)/(1 + mindiff/sigma2*df) )^df2</span></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;                                <span class="comment">//      = ( (sigma2*df + diff2) / (sigma2*df + mindiff) )^df2</span></div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;                                <span class="comment">// Extra factor two because we saved 0.5*diff2!!</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;                                aux = (<a class="code" href="classML2DBaseProgram.html#a3169a7f52fce4768757155f99b12fa84">dfsigma2</a> + 2. * diff)</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;                                      / (<a class="code" href="classML2DBaseProgram.html#a3169a7f52fce4768757155f99b12fa84">dfsigma2</a> + 2. * <a class="code" href="classProgML2D.html#a8056b29f3479fde75215466ab904f6bd">trymindiff</a>);</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;                                weight = pow(aux, <a class="code" href="classML2DBaseProgram.html#a3106e12c5756e90d770df3708307258d">df2</a>) * pdf;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;                                <span class="comment">// Calculate extra weight acc. to Eq (10) Wang et al.</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;                                <span class="comment">// Patt. Recognition Lett. 25, 701-710 (2004)</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;                                weight2 = (<a class="code" href="classML2DBaseProgram.html#a8671946de2e241de54a47e2822989ca1">df</a> + <a class="code" href="classML2DBaseProgram.html#a790a55bd210ce856bfbbd8853c6789df">ddim2</a>) / (<a class="code" href="classML2DBaseProgram.html#a8671946de2e241de54a47e2822989ca1">df</a> + (2. * diff / sigma_noise2));</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;                                <span class="comment">// Store probability weights</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;                                stored_weight = weight * weight2;</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;                                <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(Mweight, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) = stored_weight;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;                                <span class="comment">// calculate weighted sum of (X-A)^2 for sigma_noise update</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;                                local_wsum_corr += stored_weight * diff;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;                                <a class="code" href="classProgML2D.html#ae0bda101c64aff966641b35d19c6f910">refw2</a>[output_refno] += stored_weight;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;                            }</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;                            local_mindiff = <a class="code" href="group__Macros.html#gac9ae6a207f10c821b06a8c0df153a7d5">XMIPP_MIN</a>(local_mindiff, diff);</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;                            <span class="comment">// Accumulate sum weights for this (my) matrix</span></div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;                            my_sumweight += weight;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;                            my_sumstoredweight += stored_weight;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;                            <span class="comment">// calculated weighted sum of offsets as well</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;                            local_wsum_offset += weight * <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(<a class="code" href="classML2DBaseProgram.html#a394058da00920fa8e21edd9cf95cd49c">Mr2</a>, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">do_norm</a>)</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;                            {</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;                                <span class="comment">// weighted sum of Sum_j ( X_ij*A_kj )</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;                                local_wsum_sc += stored_weight * (A2_plus_Xi2 - diff) / ref_scale;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;                                <span class="comment">// weighted sum of Sum_j ( A_kj*A_kj )</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;                                local_wsum_sc2 += stored_weight * <a class="code" href="classProgML2D.html#a161f40ee3ca8ea86269a02026cda6040">A2</a>[refno];</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;                            }</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;                            <span class="comment">// keep track of optimal parameters</span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;                            my_maxweight = <a class="code" href="group__Macros.html#gae0a4180e923e3ffca3989e20e441aa3c">XMIPP_MAX</a>(my_maxweight, weight);</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;                            <span class="keywordflow">if</span> (weight &gt; local_maxweight)</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;                            {</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;                                <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ba63ac8129e521abfeaeaee3bb4c38d">do_student</a>)</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;                                    local_maxweight2 = weight2;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;                                local_maxweight = weight;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;                                local_iopty = <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;                                local_ioptx = <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;                                local_iopt_psi = ipsi;</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;                                local_iopt_flip = iflip;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;                                local_opt_refno = output_refno;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;                            }</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a47f7cd87d5f078979db61864b4f6d55f">fast_mode</a> &amp;&amp; weight &gt; maxw_ref)</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;                            {</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;                                maxw_ref = weight;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;                                <a class="code" href="classProgML2D.html#a4535601aac7b6d868dd078b14cf8e6e6">iopty_ref</a>[output_irefmir] = <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;                                <a class="code" href="classProgML2D.html#a9d11e4c518188bc47da9cfe4094871db">ioptx_ref</a>[output_irefmir] = <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;                                <a class="code" href="classProgML2D.html#a529bf5af816c32545f791c54b0d656eb">ioptflip_ref</a>[output_irefmir] = iflip;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;                            }</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;                        } <span class="comment">// close for over all elements in Mweight</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="preprocessor">#ifdef DEBUG_JM3</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a20e2b948711e3e66894740b99e8cf017">iter</a> == 3 &amp;&amp; refno==0)</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;                        {</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;                            std::cerr &lt;&lt; Mweight &lt;&lt; std::endl;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;                            std::cerr &lt;&lt; <span class="stringliteral">&quot;maxweight: &quot;</span> &lt;&lt; my_maxweight &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; my_sumstoredweight &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; my_sumweight &lt;&lt; std::endl;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;                            exit(1);</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;                        }</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;                        <span class="comment">// C. only for significant settings, store weighted sums</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;                        <span class="keywordflow">if</span> (my_maxweight &gt; <a class="code" href="ml2d_8h.html#a12d43bb17e6532367f74d92c2f08ef73">SIGNIFICANT_WEIGHT_LOW</a> * <a class="code" href="classProgML2D.html#aeef0f8238948edd17db1e4652bbd18ac">maxweight</a>)</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;                        {</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;                            <a class="code" href="classProgML2D.html#aac2d16debfdf2fe8866e3f444ed8a697">sumw_refpsi</a>[output_refno * nr_psi + ipsi] += my_sumstoredweight;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;                            <span class="keywordflow">if</span> (iflip &lt; <a class="code" href="classML2DBaseProgram.html#abe104a9ef312f6d857b008188e5dfbea">nr_nomirror_flips</a>)</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;                                <a class="code" href="classProgML2D.html#ae2342cb5f821a8f8d90d103b543c1083">refw</a>[output_refno] += my_sumweight;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;                            <span class="keywordflow">else</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;                                <a class="code" href="classProgML2D.html#ae0c18214588873b98a6ea20daabdd924">refw_mirror</a>[output_refno] += my_sumweight;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;                            <span class="comment">// Back from smaller Mweight to original size of Maux</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;                            Maux.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>();</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;                            <a class="code" href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a>(Mweight)</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;                            {</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;                                <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(Maux, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) = <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(Mweight, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;                            }</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;                            <span class="comment">// Use forward FFT in convolution theorem again</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;                            <span class="comment">// Takes the input from Maux and leaves it in Faux</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;                            local_transformer.<a class="code" href="classFourierTransformer.html#abfdc5699d3c579a26bba39ec679b5adc">FourierTransform</a>();</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;                            <a class="code" href="classMultidimArray.html">MultidimArray&lt; std::complex&lt;double&gt;</a> &gt; &amp;mysumimgs_ref = <a class="code" href="classProgML2D.html#ac5e5c4cf86a9dad9ac604abf2aaa94cf">mysumimgs</a>[output_refnoipsi];</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;                            <a class="code" href="classMultidimArray.html">MultidimArray&lt; std::complex&lt;double&gt;</a> &gt; &amp;Fimg_flip_ref = <a class="code" href="classProgML2D.html#a2725bcb11d4abfd956448b2384ec9dfe">Fimg_flip</a>[iflip];</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;                            <a class="code" href="group__MultidimensionalArrays.html#gad60a440a5ba86f9f7f40cf4a23682500">FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY</a>(Faux)</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;                            {</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;                                <a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(mysumimgs_ref, <a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) +=</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;                                    <a class="code" href="namespacealglib.html#a0fe83df1d04b0270f8cfaf97114082ff">conj</a>(<a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(Faux,<a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>)) * <a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(Fimg_flip_ref,<a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;                            }</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;                        }</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;                    } <span class="comment">// close if Msignificant</span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;                } <span class="comment">// close for ipsi</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;            } <span class="comment">// close for iflip</span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;        } <span class="comment">// close if pdf_directions</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;        pthread_mutex_lock(&amp;<a class="code" href="ml__align2d_8cpp.html#a8c04d9a53742f1b981c80dd88aa430a1">update_mutex</a>);</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;        <span class="comment">//Update maxweight</span></div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        <span class="keywordflow">if</span> (local_maxweight &gt; <a class="code" href="classProgML2D.html#aeef0f8238948edd17db1e4652bbd18ac">maxweight</a>)</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;        {</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;            <a class="code" href="classProgML2D.html#aeef0f8238948edd17db1e4652bbd18ac">maxweight</a> = local_maxweight;</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ba63ac8129e521abfeaeaee3bb4c38d">do_student</a>)</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;                <a class="code" href="classProgML2D.html#a571bb2f7bac698c48cfbea17c9c12170">maxweight2</a> = local_maxweight2;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;                <a class="code" href="classProgML2D.html#a571bb2f7bac698c48cfbea17c9c12170">maxweight2</a>=0.;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;            <a class="code" href="classProgML2D.html#a6f1b8e425483f7b4f97e68e4eb6233fd">iopty</a> = local_iopty;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;            <a class="code" href="classProgML2D.html#a982205d6bc2ceb791f1abd3fbb1388bf">ioptx</a> = local_ioptx;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;            <a class="code" href="classProgML2D.html#a40a5d7f99135a4219f867273e3a704fe">iopt_psi</a> = local_iopt_psi;</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;            <a class="code" href="classProgML2D.html#a1be87962ea76cdc3641b99d8e4d6c4eb">iopt_flip</a> = local_iopt_flip;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;            <a class="code" href="classProgML2D.html#a2a7c59d85856b342e74ffd326e1a5765">opt_refno</a> = local_opt_refno;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;        }</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        <span class="comment">//Update sums</span></div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;        <a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a> += <a class="code" href="classProgML2D.html#ae2342cb5f821a8f8d90d103b543c1083">refw</a>[output_refno] + <a class="code" href="classProgML2D.html#ae0c18214588873b98a6ea20daabdd924">refw_mirror</a>[output_refno];</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;        <a class="code" href="classProgML2D.html#af1c07651bc4491471be58d1e3cf11413">wsum_offset</a> += local_wsum_offset;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;        <a class="code" href="classProgML2D.html#ae91cfc8d366159cc5479418582e9825c">wsum_corr</a> += local_wsum_corr;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;        <a class="code" href="classProgML2D.html#a990c57b68223b7deafe042cb9cd2efa8">mindiff</a> = <a class="code" href="group__Macros.html#gac9ae6a207f10c821b06a8c0df153a7d5">XMIPP_MIN</a>(<a class="code" href="classProgML2D.html#a990c57b68223b7deafe042cb9cd2efa8">mindiff</a>, local_mindiff);</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">do_norm</a>)</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;        {</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;            <a class="code" href="classProgML2D.html#abed951212bbcfa436954ad4f77575887">wsum_sc</a> += local_wsum_sc;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;            <a class="code" href="classProgML2D.html#adfb316a4df09eaf3a645d97e49f102f4">wsum_sc2</a> += local_wsum_sc2;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;        }</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;        pthread_mutex_unlock(&amp;<a class="code" href="ml__align2d_8cpp.html#a8c04d9a53742f1b981c80dd88aa430a1">update_mutex</a>);</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;        <span class="comment">//Ask for next job</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    } <span class="comment">// close while refno</span></div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="preprocessor">#define DP(x) &lt;&lt; std::setw(15) &lt;&lt; x</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    <span class="comment">//#define DEBUG_JM</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;<span class="preprocessor">#ifdef DEBUG_JM</span></div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a20e2b948711e3e66894740b99e8cf017">iter</a> &gt; 1)</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    {</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;DEBUG_JM: ====== iter: &quot;</span> &lt;&lt; <a class="code" href="classML2DBaseProgram.html#a20e2b948711e3e66894740b99e8cf017">iter</a> &lt;&lt; <span class="stringliteral">&quot;======= block: &quot;</span> &lt;&lt; <a class="code" href="classML2DBaseProgram.html#a3db6d60cc8179ba2a57c55cf7d5ba362">current_block</a> &lt;&lt; std::endl;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        std::cerr &lt;&lt; <a class="code" href="group__StringUtilities.html#gaa405c9a5b808e428554e540028085dd3">formatString</a>(<span class="stringliteral">&quot;====&gt; img: %lu\n&quot;</span>, <a class="code" href="classML2DBaseProgram.html#ab31f295dfdeb52bada9f0ca819c8fb29">current_image</a>);</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;Xi2: &quot;</span> &lt;&lt; <a class="code" href="classProgML2D.html#a665c986d28b896e593f1623b7389dc03">Xi2</a> &lt;&lt; std::endl;</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;sum_refw: &quot;</span> &lt;&lt; <a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a> &lt;&lt; std::endl;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;        std::cerr <a class="code" href="ml__align2d_8cpp.html#ad318491593a53b4c93f2cd401c2ec199">DP</a>(<span class="stringliteral">&quot;A2&quot;</span>) <a class="code" href="ml__align2d_8cpp.html#ad318491593a53b4c93f2cd401c2ec199">DP</a>(<span class="stringliteral">&quot;refw&quot;</span>) <a class="code" href="ml__align2d_8cpp.html#ad318491593a53b4c93f2cd401c2ec199">DP</a>(<span class="stringliteral">&quot;refw_mirror&quot;</span>) &lt;&lt; std::endl;</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> refno = 0; refno &lt; <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>; ++refno)</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;            std::cerr <a class="code" href="ml__align2d_8cpp.html#ad318491593a53b4c93f2cd401c2ec199">DP</a>(<a class="code" href="classProgML2D.html#a161f40ee3ca8ea86269a02026cda6040">A2</a>[refno]) <a class="code" href="ml__align2d_8cpp.html#ad318491593a53b4c93f2cd401c2ec199">DP</a>(<a class="code" href="classProgML2D.html#ae2342cb5f821a8f8d90d103b543c1083">refw</a>[refno]) <a class="code" href="ml__align2d_8cpp.html#ad318491593a53b4c93f2cd401c2ec199">DP</a>(<a class="code" href="classProgML2D.html#ae0c18214588873b98a6ea20daabdd924">refw_mirror</a>[refno]) &lt;&lt; std::endl;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;        <span class="comment">//                        std::cerr &lt;&lt; &quot;local_wsum_corr: &quot; &lt;&lt; local_wsum_corr &lt;&lt; std::endl;</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;        <span class="comment">//                        std::cerr &lt;&lt; &quot;wsum_corr: &quot; &lt;&lt; wsum_corr &lt;&lt; std::endl;</span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a20e2b948711e3e66894740b99e8cf017">iter</a> &gt; 2)</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        {</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;            std::cerr &lt;&lt; <span class="stringliteral">&quot;DEBUG_JM: ..............EXITING....................: &quot;</span>  &lt;&lt; std::endl;</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;            exit(1);</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;        }</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    }</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;<span class="preprocessor">#undef DEBUG_JM</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;}<span class="comment">//close function doThreadExpectationSingleImage</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;</div><div class="line"><a name="l01616"></a><span class="lineno"><a class="line" href="classProgML2D.html#a0ce68be471d505dc112d1fedef5e3092"> 1616</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a0ce68be471d505dc112d1fedef5e3092">ProgML2D::doThreadESIUpdateRefno</a>()</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;{</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    <span class="keywordtype">double</span> scale_dim2_sumw = (<a class="code" href="classProgML2D.html#a89fc3cde7847bf0bb39ea52add1d4490">opt_scale</a> * <a class="code" href="classML2DBaseProgram.html#a790a55bd210ce856bfbbd8853c6789df">ddim2</a>) / <a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a>;</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    <span class="keywordtype">int</span> num_refs = <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a> * <a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a>;</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    <a class="code" href="ml__align2d_8h.html#ad12cf04e6cd4aa26363fd70ae35905ed">FOR_ALL_THREAD_REFNO</a>()</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;    {</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;        <span class="keywordtype">int</span> output_refno = <a class="code" href="classProgML2D.html#ae750407f07cf8ad2b23ff8a7ef640e5e">mygroup</a> * <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a> + refno;</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a47f7cd87d5f078979db61864b4f6d55f">fast_mode</a>)</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;        {</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> group = 0; group &lt; <a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a>; group++)</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;            {</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                <span class="keywordtype">int</span> group_refno = group * <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a> + refno;</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;                <span class="comment">// Update optimal offsets for refno (and its mirror)</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;                <a class="code" href="classProgML2D.html#a3ee54e92214ba139048b67204d33812a">allref_offsets</a>[2 * group_refno] = -(double) <a class="code" href="classProgML2D.html#a9d11e4c518188bc47da9cfe4094871db">ioptx_ref</a>[output_refno]</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;                                                  * <a class="code" href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a>(<a class="code" href="classML2DBaseProgram.html#a879e423db0331279b0421e881b73be57">F</a>[<a class="code" href="classProgML2D.html#a529bf5af816c32545f791c54b0d656eb">ioptflip_ref</a>[output_refno]], 0, 0)</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;                                                  - (double) <a class="code" href="classProgML2D.html#a4535601aac7b6d868dd078b14cf8e6e6">iopty_ref</a>[output_refno]</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;                                                  * <a class="code" href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a>(<a class="code" href="classML2DBaseProgram.html#a879e423db0331279b0421e881b73be57">F</a>[<a class="code" href="classProgML2D.html#a529bf5af816c32545f791c54b0d656eb">ioptflip_ref</a>[output_refno]], 0, 1);</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;                <a class="code" href="classProgML2D.html#a3ee54e92214ba139048b67204d33812a">allref_offsets</a>[2 * group_refno + 1] = -(double) <a class="code" href="classProgML2D.html#a9d11e4c518188bc47da9cfe4094871db">ioptx_ref</a>[output_refno]</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;                                                      * <a class="code" href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a>(<a class="code" href="classML2DBaseProgram.html#a879e423db0331279b0421e881b73be57">F</a>[<a class="code" href="classProgML2D.html#a529bf5af816c32545f791c54b0d656eb">ioptflip_ref</a>[output_refno]], 1, 0)</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;                                                      - (double) <a class="code" href="classProgML2D.html#a4535601aac7b6d868dd078b14cf8e6e6">iopty_ref</a>[output_refno]</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;                                                      * <a class="code" href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a>(<a class="code" href="classML2DBaseProgram.html#a879e423db0331279b0421e881b73be57">F</a>[<a class="code" href="classProgML2D.html#a529bf5af816c32545f791c54b0d656eb">ioptflip_ref</a>[output_refno]], 1, 1);</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#ad9b9535e1774d805e5bbee89dee0f4b5">do_mirror</a>)</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;                {</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;                    <a class="code" href="classProgML2D.html#a3ee54e92214ba139048b67204d33812a">allref_offsets</a>[2 * (num_refs + group_refno)]</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;                    = -(<span class="keywordtype">double</span>) <a class="code" href="classProgML2D.html#a9d11e4c518188bc47da9cfe4094871db">ioptx_ref</a>[num_refs + output_refno]</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;                      * <a class="code" href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a>(<a class="code" href="classML2DBaseProgram.html#a879e423db0331279b0421e881b73be57">F</a>[<a class="code" href="classProgML2D.html#a529bf5af816c32545f791c54b0d656eb">ioptflip_ref</a>[num_refs + output_refno]], 0, 0)</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;                      - (double) <a class="code" href="classProgML2D.html#a4535601aac7b6d868dd078b14cf8e6e6">iopty_ref</a>[num_refs + output_refno]</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;                      * <a class="code" href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a>(<a class="code" href="classML2DBaseProgram.html#a879e423db0331279b0421e881b73be57">F</a>[<a class="code" href="classProgML2D.html#a529bf5af816c32545f791c54b0d656eb">ioptflip_ref</a>[num_refs + output_refno]], 0, 1);</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;                    <a class="code" href="classProgML2D.html#a3ee54e92214ba139048b67204d33812a">allref_offsets</a>[2 * (num_refs + group_refno) + 1]</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;                    = -(<span class="keywordtype">double</span>) <a class="code" href="classProgML2D.html#a9d11e4c518188bc47da9cfe4094871db">ioptx_ref</a>[num_refs + output_refno]</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;                      * <a class="code" href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a>(<a class="code" href="classML2DBaseProgram.html#a879e423db0331279b0421e881b73be57">F</a>[<a class="code" href="classProgML2D.html#a529bf5af816c32545f791c54b0d656eb">ioptflip_ref</a>[num_refs + output_refno]], 1, 0)</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;                      - (double) <a class="code" href="classProgML2D.html#a4535601aac7b6d868dd078b14cf8e6e6">iopty_ref</a>[num_refs + output_refno]</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;                      * <a class="code" href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a>(<a class="code" href="classML2DBaseProgram.html#a879e423db0331279b0421e881b73be57">F</a>[<a class="code" href="classProgML2D.html#a529bf5af816c32545f791c54b0d656eb">ioptflip_ref</a>[num_refs + output_refno]], 1, 1);</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;                }</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;            }</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        }</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classML2DBaseProgram.html#a549ca4cda193eb449087f9a316c61f20">limit_rot</a> || <a class="code" href="classProgML2D.html#af3ba3c5330db20cf897a5b83ce26ff69">pdf_directions</a>[refno] &gt; 0.)</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        {</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;            <a class="code" href="classProgML2D.html#a89e864cc35899d6440890ad75efcbc1b">sumw</a>[output_refno] += (<a class="code" href="classProgML2D.html#ae2342cb5f821a8f8d90d103b543c1083">refw</a>[output_refno] + <a class="code" href="classProgML2D.html#ae0c18214588873b98a6ea20daabdd924">refw_mirror</a>[output_refno]) / <a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a>;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;            <a class="code" href="classProgML2D.html#a278477791b8743ce9578d57154e937da">sumw2</a>[output_refno] += <a class="code" href="classProgML2D.html#ae0bda101c64aff966641b35d19c6f910">refw2</a>[output_refno] / <a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a>;</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;            <a class="code" href="classProgML2D.html#a7932acbd1ae193f532fc47df46f3d775">sumw_mirror</a>[output_refno] += <a class="code" href="classProgML2D.html#ae0c18214588873b98a6ea20daabdd924">refw_mirror</a>[output_refno] / <a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a>;</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ba63ac8129e521abfeaeaee3bb4c38d">do_student</a>)</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;            {</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;                <a class="code" href="classProgML2D.html#ac86ae3f69ec448da39d9a662827dbf6a">sumwsc</a>[output_refno] += <a class="code" href="classProgML2D.html#ae0bda101c64aff966641b35d19c6f910">refw2</a>[output_refno] * (<a class="code" href="classProgML2D.html#a89fc3cde7847bf0bb39ea52add1d4490">opt_scale</a>) / <a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a>;</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;                <a class="code" href="classProgML2D.html#a1a99543c55fc5620370113ded2ae8301">sumwsc2</a>[output_refno] += <a class="code" href="classProgML2D.html#ae0bda101c64aff966641b35d19c6f910">refw2</a>[output_refno] * (<a class="code" href="classProgML2D.html#a89fc3cde7847bf0bb39ea52add1d4490">opt_scale</a> * <a class="code" href="classProgML2D.html#a89fc3cde7847bf0bb39ea52add1d4490">opt_scale</a>)</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;                                         / <a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a>;</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;            }</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;            {</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;                <a class="code" href="classProgML2D.html#ac86ae3f69ec448da39d9a662827dbf6a">sumwsc</a>[output_refno] += (<a class="code" href="classProgML2D.html#ae2342cb5f821a8f8d90d103b543c1083">refw</a>[output_refno] + <a class="code" href="classProgML2D.html#ae0c18214588873b98a6ea20daabdd924">refw_mirror</a>[output_refno])</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;                                        * (<a class="code" href="classProgML2D.html#a89fc3cde7847bf0bb39ea52add1d4490">opt_scale</a>) / <a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a>;</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                <a class="code" href="classProgML2D.html#a1a99543c55fc5620370113ded2ae8301">sumwsc2</a>[output_refno] += (<a class="code" href="classProgML2D.html#ae2342cb5f821a8f8d90d103b543c1083">refw</a>[output_refno] + <a class="code" href="classProgML2D.html#ae0c18214588873b98a6ea20daabdd924">refw_mirror</a>[output_refno])</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;                                         * (<a class="code" href="classProgML2D.html#a89fc3cde7847bf0bb39ea52add1d4490">opt_scale</a> * <a class="code" href="classProgML2D.html#a89fc3cde7847bf0bb39ea52add1d4490">opt_scale</a>) / <a class="code" href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">sum_refw</a>;</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;            }</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;            std::complex&lt;double&gt; cscale_dim2_sumw=scale_dim2_sumw;</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ipsi = 0; ipsi &lt; <a class="code" href="classML2DBaseProgram.html#a976dc404489a0c66af2800f0f73e76c7">nr_psi</a>; ipsi++)</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;            {</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;                <span class="keywordtype">int</span> refnoipsi = output_refno * nr_psi + ipsi;</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;                <span class="comment">// Correct weighted sum of images for new bgmean (only first element=origin in Fimg)</span></div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">do_norm</a>)</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;                    <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(<a class="code" href="classProgML2D.html#ac5e5c4cf86a9dad9ac604abf2aaa94cf">mysumimgs</a>[refnoipsi],0,0) -= <a class="code" href="classProgML2D.html#aac2d16debfdf2fe8866e3f444ed8a697">sumw_refpsi</a>[refnoipsi] * (<a class="code" href="classProgML2D.html#aef35426c0860ea497a0fc71c9eb2bcbf">bgmean</a> - <a class="code" href="classProgML2D.html#a6640cdcf273f2031dc8dc1e28de8b81f">old_bgmean</a>) / <a class="code" href="classML2DBaseProgram.html#a790a55bd210ce856bfbbd8853c6789df">ddim2</a>;</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;                <span class="comment">// Sum mysumimgs to the global weighted sum</span></div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;                <a class="code" href="classProgML2D.html#a2eddbf01d350e8ab9974d5e1654f383a">wsumimgs</a>[refnoipsi] += (cscale_dim2_sumw * <a class="code" href="classProgML2D.html#ac5e5c4cf86a9dad9ac604abf2aaa94cf">mysumimgs</a>[refnoipsi]);</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;            }</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;        }</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    }<span class="comment">//close while refno</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;}<span class="comment">//close function doThreadESIUpdateRefno</span></div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;</div><div class="line"><a name="l01693"></a><span class="lineno"><a class="line" href="classProgML2D.html#a2038e3b1923671ed4c6c293da2339b24"> 1693</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a2038e3b1923671ed4c6c293da2339b24">ProgML2D::iteration</a>()</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;{</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classML2DBaseProgram.html#a3db6d60cc8179ba2a57c55cf7d5ba362">current_block</a> = 0; <a class="code" href="classML2DBaseProgram.html#a3db6d60cc8179ba2a57c55cf7d5ba362">current_block</a> &lt; <a class="code" href="classML2DBaseProgram.html#a7b0d716eb64a885e060bd3d380fe83be">blocks</a>; <a class="code" href="classML2DBaseProgram.html#a3db6d60cc8179ba2a57c55cf7d5ba362">current_block</a>++)</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    {</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        <span class="comment">// Integrate over all images</span></div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;        <a class="code" href="classProgML2D.html#aee7b9878dfa5d8e714e00b6f4c91e845">expectation</a>();</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;        <span class="comment">//Maximize the model</span></div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;        <a class="code" href="classProgML2D.html#a329b42f3d96b8366df10fa3bf093ac7d">maximization</a>();</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    }<span class="comment">//close for blocks</span></div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;}</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;</div><div class="line"><a name="l01705"></a><span class="lineno"><a class="line" href="classProgML2D.html#aee7b9878dfa5d8e714e00b6f4c91e845"> 1705</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#aee7b9878dfa5d8e714e00b6f4c91e845">ProgML2D::expectation</a>()</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;{</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;std::complex&lt;double&gt;</a> &gt; Fdzero(<a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>, <a class="code" href="classML2DBaseProgram.html#a90e6ce499655b4566e17e32102a905c4">hdim</a> + 1);</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    <span class="keywordtype">int</span> num_output_refs = <a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a> * <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    <a class="code" href="mpi__write__test_8cpp.html#a158a8c64f24645c7478298399825737f">LOG</a>(<span class="stringliteral">&quot;      ProgML2D::expectation BEGIN&quot;</span>);</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    std::cerr&lt;&lt;<span class="stringliteral">&quot;entering expectation&quot;</span>&lt;&lt;std::endl;</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;<span class="preprocessor">#ifdef TIMING</span></div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    timer.tic(E_RR);</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    <a class="code" href="classProgML2D.html#ae2e77769eb2149319d7f136f9f45b42a">rotateReference</a>();</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;<span class="preprocessor">#ifdef TIMING</span></div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    timer.toc(E_RR);</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    timer.tic(E_PRE);</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    <span class="comment">// Pre-calculate pdf of all in-plane transformations</span></div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    <a class="code" href="classProgML2D.html#a2cf96ff3fc13f9f4593ff1ba0eb3c8d6">calculatePdfInplane</a>();</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;    <span class="comment">// Initialize weighted sums</span></div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    <a class="code" href="classProgML2D.html#ad26cadbfd0dfbaab4b1c19a5f2c9c939">LL</a> = 0.;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    <a class="code" href="classProgML2D.html#a2eddbf01d350e8ab9974d5e1654f383a">wsumimgs</a>.clear();</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    <a class="code" href="classProgML2D.html#a89e864cc35899d6440890ad75efcbc1b">sumw</a>.assign(num_output_refs, 0.);</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    <a class="code" href="classProgML2D.html#a278477791b8743ce9578d57154e937da">sumw2</a>.assign(num_output_refs, 0.);</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;    <a class="code" href="classProgML2D.html#ac86ae3f69ec448da39d9a662827dbf6a">sumwsc</a>.assign(num_output_refs, 0.);</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;    <a class="code" href="classProgML2D.html#a1a99543c55fc5620370113ded2ae8301">sumwsc2</a>.assign(num_output_refs, 0.);</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;    <a class="code" href="classProgML2D.html#a7932acbd1ae193f532fc47df46f3d775">sumw_mirror</a>.assign(num_output_refs, 0.);</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;    <a class="code" href="classProgML2D.html#aeba68b5ab11453cdd8685b63eb122628">wsum_sigma_noise</a> = 0.;</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    <a class="code" href="classProgML2D.html#aacbe058d87287adbc0e5ee76f5ad317c">wsum_sigma_offset</a> = 0.;</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;    <a class="code" href="classProgML2D.html#a60a40d22a1ca28a0ff4af54f0c83af08">sumfracweight</a> = 0.;</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    Fdzero.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>();</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    <a class="code" href="classProgML2D.html#a2eddbf01d350e8ab9974d5e1654f383a">wsumimgs</a>.assign(num_output_refs * <a class="code" href="classML2DBaseProgram.html#a976dc404489a0c66af2800f0f73e76c7">nr_psi</a>, Fdzero);</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    <span class="comment">// Local variables of old threadExpectationSingleImage</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;    <a class="code" href="classImage.html">Image&lt;double&gt;</a> img;</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    <a class="code" href="classFileName.html">FileName</a> <a class="code" href="classML2DBaseProgram.html#a4e593a9112ddcc0256bc9b72213cdb3b">fn_img</a>, fn_tkrans;</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> opt_offsets(2);</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <span class="keywordtype">double</span> old_phi = -999., old_theta = -999.;</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    <span class="keywordtype">double</span> opt_flip;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <span class="comment">//Some initializations</span></div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    <a class="code" href="classProgML2D.html#a89fc3cde7847bf0bb39ea52add1d4490">opt_scale</a> = 1., <a class="code" href="classProgML2D.html#aef35426c0860ea497a0fc71c9eb2bcbf">bgmean</a> = 0.;</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    <a class="code" href="classProgML2D.html#a75cc3fc6713d2e0b3952a5ee1078014a">Msignificant</a>.<a class="code" href="classMultidimArray.html#ac0efebfb32ab4e37cf33efca3349aa9b">resizeNoCopy</a>(<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>, nr_psi * <a class="code" href="classML2DBaseProgram.html#a715ad0eb7ac0ce476faf1623fedea1a8">nr_flip</a>);</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">size_t</span> img_done;</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a3db6d60cc8179ba2a57c55cf7d5ba362">current_block</a> == 0) <span class="comment">//when not iem current block is always 0</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    {</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;        <a class="code" href="classXmippProgram.html#aea0549c1e40215ee12b1abc36648b39a">initProgress</a>(<a class="code" href="classML2DBaseProgram.html#ac53bad3c2339d92ebbda4ba5abe7aa57">nr_images_local</a>);</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;        img_done = 0;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    }</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    <a class="code" href="xmipp__strings_8h.html#afbeda3fd1bdc8c37d01bdf9f5c8274ff">String</a> _msg = <a class="code" href="group__StringUtilities.html#gaa405c9a5b808e428554e540028085dd3">formatString</a>(<span class="stringliteral">&quot;Images: %lu, first: %lu, last: %lu&quot;</span>, <a class="code" href="classML2DBaseProgram.html#ac53bad3c2339d92ebbda4ba5abe7aa57">nr_images_local</a>, <a class="code" href="classML2DBaseProgram.html#a791b7cb014db4297f7772becd1daa287">myFirstImg</a>, <a class="code" href="classML2DBaseProgram.html#a3c0b6cb5428a40ae95864f5c45c50940">myLastImg</a>);</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <a class="code" href="mpi__write__test_8cpp.html#a158a8c64f24645c7478298399825737f">LOG</a>(_msg.c_str());</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="comment">//std::cerr &lt;&lt; &quot;-----xmipp_current: Expectation, iter &quot; &lt;&lt; iter &lt;&lt; &quot;-------&quot; &lt;&lt; std::endl;</span></div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    <span class="comment">//for (int imgno = 0, img_done = 0; imgno &lt; nn; imgno++)</span></div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    <span class="comment">// Loop over all images</span></div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    <a class="code" href="ml2d_8h.html#a63b804f3c807ffe0259b3ee45cb19693">FOR_ALL_LOCAL_IMAGES</a>()</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;    {</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ml2d_8h.html#a66509066803c374815e854e570539582">IMG_BLOCK</a>(imgno) == <a class="code" href="classML2DBaseProgram.html#a3db6d60cc8179ba2a57c55cf7d5ba362">current_block</a>)</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;        {</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;            <a class="code" href="classML2DBaseProgram.html#ab31f295dfdeb52bada9f0ca819c8fb29">current_image</a> = imgno;</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;            <span class="comment">//std::cerr &lt;&lt; &quot;\n ======&gt;&gt;&gt; imgno: &quot; &lt;&lt; imgno &lt;&lt; std::endl;</span></div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;            <a class="code" href="classProgML2D.html#ae750407f07cf8ad2b23ff8a7ef640e5e">mygroup</a> = (<a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a> &gt; 1) ? <a class="code" href="group__GeneralFunctions.html#ga194d394b419778ebd11c83b43a213310">divide_equally_group</a>(<a class="code" href="classML2DBaseProgram.html#a55332f697c74f72635ae850439407645">nr_images_global</a>, <a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a>, imgno) : 0;</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#a2239fbb7e492654f1e2866ab27492a5d">getValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78af4298cfa617e6143f021d0d7956a7f70">MDL_IMAGE</a>, fn_img, <a class="code" href="classML2DBaseProgram.html#a3464cb9938eb4cf849b7c8bbb354734f">img_id</a>[imgno]);</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;            img.<a class="code" href="classImageBase.html#a88636b7a7bd4e0e454877e691ee2da84">read</a>(fn_img);</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;            img().setXmippOrigin();</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;            <a class="code" href="classProgML2D.html#a665c986d28b896e593f1623b7389dc03">Xi2</a> = img().sum2();</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;            <a class="code" href="classProgML2D.html#ad45f8eab09da7787c7e8e5e86883a40a">Mimg</a> = img();</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;            <span class="comment">//#define DEBUG_JM1</span></div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="preprocessor">#ifdef DEBUG_JM1</span></div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;            <span class="comment">//if (iter &gt;= 2 &amp;&amp; current_image == myFirstImg)</span></div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;            printf(<span class="stringliteral">&quot;   ====================&gt;&gt;&gt; Iter: %02d Image: %06lu: \n&quot;</span>, <a class="code" href="classML2DBaseProgram.html#a20e2b948711e3e66894740b99e8cf017">iter</a>, imgno);</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;            printf(<span class="stringliteral">&quot;                                     fn_img: %s&quot;</span>, fn_img.c_str());</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;            <span class="comment">//printf(&quot;                                    mygroup: %d&quot;, mygroup);</span></div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;<span class="preprocessor">#undef DEBUG_JM1</span></div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;            <span class="comment">// These two parameters speed up expectationSingleImage</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;            <a class="code" href="classProgML2D.html#a2a7c59d85856b342e74ffd326e1a5765">opt_refno</a> = <a class="code" href="classML2DBaseProgram.html#a2d35db214957b6a4d00b411e8a63a554">imgs_optrefno</a>[<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>];</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;            <a class="code" href="classProgML2D.html#a8056b29f3479fde75215466ab904f6bd">trymindiff</a> = <a class="code" href="classML2DBaseProgram.html#adf6efe79d6a17ff818c2f06d11e7b7b0">imgs_trymindiff</a>[<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>];</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classProgML2D.html#a8056b29f3479fde75215466ab904f6bd">trymindiff</a> &lt; 0.)</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;                <span class="comment">// 90% of Xi2 may be a good idea (factor half because 0.5*diff is calculated)</span></div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;                <a class="code" href="classProgML2D.html#a8056b29f3479fde75215466ab904f6bd">trymindiff</a> = <a class="code" href="classML2DBaseProgram.html#a0bff1f1ebc6ee583b1b6f4f2d55ec3ae">trymindiff_factor</a> * 0.5 * <a class="code" href="classProgML2D.html#a665c986d28b896e593f1623b7389dc03">Xi2</a>;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">do_norm</a>)</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;            {</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;                <a class="code" href="classProgML2D.html#aef35426c0860ea497a0fc71c9eb2bcbf">bgmean</a> = <a class="code" href="classML2DBaseProgram.html#ae32011b5a8251cbaaf3b5e28933b9806">imgs_bgmean</a>[<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>];</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;                <a class="code" href="classProgML2D.html#a89fc3cde7847bf0bb39ea52add1d4490">opt_scale</a> = <a class="code" href="classML2DBaseProgram.html#ab7caa861fcd7c5a139c0a0825c1abbe0">imgs_scale</a>[<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>];</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;            }</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;            <span class="comment">// Get optimal offsets for all references</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a47f7cd87d5f078979db61864b4f6d55f">fast_mode</a>)</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;            {</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;                <a class="code" href="classProgML2D.html#a3ee54e92214ba139048b67204d33812a">allref_offsets</a> = <a class="code" href="classML2DBaseProgram.html#adb224115e7f853ead371caf7a3767fa4">imgs_offsets</a>[<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>];</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;            }</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;            <span class="comment">// Read optimal orientations from memory</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a549ca4cda193eb449087f9a316c61f20">limit_rot</a>)</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;            {</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;                old_phi = <a class="code" href="classML2DBaseProgram.html#a2d817d670cd567d427da30fad46f5592">imgs_oldphi</a>[<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>];</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;                old_theta = <a class="code" href="classML2DBaseProgram.html#ae0d684b9bbe78bfa5ed5ad2610dc4fbe">imgs_oldtheta</a>[<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>];</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;            }</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;            <span class="comment">// For limited orientational search: preselect relevant directions</span></div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;            <a class="code" href="classProgML2D.html#a0ad1678e8cea8efa9d00630274c96971">preselectLimitedDirections</a>(old_phi, old_theta);</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;            <span class="comment">// Use a maximum-likelihood target function in real space</span></div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;            <span class="comment">// with complete or reduced-space translational searches (-fast)</span></div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a47f7cd87d5f078979db61864b4f6d55f">fast_mode</a>)</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;                <a class="code" href="classProgML2D.html#a44b08930042f8d64a74eb588f6401408">preselectFastSignificant</a>();</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;                <a class="code" href="classProgML2D.html#a75cc3fc6713d2e0b3952a5ee1078014a">Msignificant</a>.<a class="code" href="classMultidimArray.html#a239f45b043ed7715dec4d44ceef74dce">initConstant</a>(1);</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;            <a class="code" href="classProgML2D.html#a16a298494284883677c3848d109ca8ca">expectationSingleImage</a>(opt_offsets);</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;            <span class="comment">// Write optimal offsets for all references to disc</span></div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a47f7cd87d5f078979db61864b4f6d55f">fast_mode</a>)</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;            {</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;                <a class="code" href="classML2DBaseProgram.html#adb224115e7f853ead371caf7a3767fa4">imgs_offsets</a>[<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>] = <a class="code" href="classProgML2D.html#a3ee54e92214ba139048b67204d33812a">allref_offsets</a>;</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;            }</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;            <span class="comment">// Store mindiff for next iteration</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;            <a class="code" href="classML2DBaseProgram.html#adf6efe79d6a17ff818c2f06d11e7b7b0">imgs_trymindiff</a>[<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>] = <a class="code" href="classProgML2D.html#a8056b29f3479fde75215466ab904f6bd">trymindiff</a>;</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;            <span class="comment">// Store opt_refno for next iteration</span></div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a2d35db214957b6a4d00b411e8a63a554">imgs_optrefno</a>[<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>] = <a class="code" href="classProgML2D.html#a2a7c59d85856b342e74ffd326e1a5765">opt_refno</a>;</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;            <span class="comment">// Store optimal phi and theta in memory</span></div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a549ca4cda193eb449087f9a316c61f20">limit_rot</a>)</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;            {</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;                <a class="code" href="classML2DBaseProgram.html#a2d817d670cd567d427da30fad46f5592">imgs_oldphi</a>[<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>] = <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a29baa2fb66177265cb0de6d027ea454a">Iref</a>[opt_refno % <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>].rot();</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;                <a class="code" href="classML2DBaseProgram.html#ae0d684b9bbe78bfa5ed5ad2610dc4fbe">imgs_oldtheta</a>[<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>] = <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a29baa2fb66177265cb0de6d027ea454a">Iref</a>[opt_refno % <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>].tilt();</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;            }</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;            <span class="comment">// Store optimal normalization parameters in memory</span></div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">do_norm</a>)</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;            {</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;                <a class="code" href="classML2DBaseProgram.html#ab7caa861fcd7c5a139c0a0825c1abbe0">imgs_scale</a>[<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>] = <a class="code" href="classProgML2D.html#a89fc3cde7847bf0bb39ea52add1d4490">opt_scale</a>;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;                <a class="code" href="classML2DBaseProgram.html#ae32011b5a8251cbaaf3b5e28933b9806">imgs_bgmean</a>[<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>] = <a class="code" href="classProgML2D.html#aef35426c0860ea497a0fc71c9eb2bcbf">bgmean</a>;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;            }</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;            <span class="comment">// Output docfile</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;            opt_flip = 0.;</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;            <span class="keywordflow">if</span> (-<a class="code" href="classProgML2D.html#ad46ab7ada3d4a4cf173ccd5871a005af">opt_psi</a> &gt; 360.)</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;            {</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;                <a class="code" href="classProgML2D.html#ad46ab7ada3d4a4cf173ccd5871a005af">opt_psi</a> += 360.;</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;                opt_flip = 1.;</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;            }</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(<a class="code" href="classML2DBaseProgram.html#a0ddfa227d1aec7fcfd31cb2c23ec3d0f">docfiledata</a>,<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>,0)</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;            = <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a29baa2fb66177265cb0de6d027ea454a">Iref</a>[opt_refno % <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>].rot(); <span class="comment">// rot</span></div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(<a class="code" href="classML2DBaseProgram.html#a0ddfa227d1aec7fcfd31cb2c23ec3d0f">docfiledata</a>,<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>,1)</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;            = <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a29baa2fb66177265cb0de6d027ea454a">Iref</a>[opt_refno % <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>].tilt(); <span class="comment">// tilt</span></div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(<a class="code" href="classML2DBaseProgram.html#a0ddfa227d1aec7fcfd31cb2c23ec3d0f">docfiledata</a>,<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>,2) = <a class="code" href="classProgML2D.html#ad46ab7ada3d4a4cf173ccd5871a005af">opt_psi</a> + 360.; <span class="comment">// psi</span></div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(<a class="code" href="classML2DBaseProgram.html#a0ddfa227d1aec7fcfd31cb2c23ec3d0f">docfiledata</a>,<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>,3) = opt_offsets(0); <span class="comment">// Xoff</span></div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(<a class="code" href="classML2DBaseProgram.html#a0ddfa227d1aec7fcfd31cb2c23ec3d0f">docfiledata</a>,<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>,4) = opt_offsets(1); <span class="comment">// Yoff</span></div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(<a class="code" href="classML2DBaseProgram.html#a0ddfa227d1aec7fcfd31cb2c23ec3d0f">docfiledata</a>,<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>,5) = (double) (opt_refno + 1); <span class="comment">// Ref</span></div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(<a class="code" href="classML2DBaseProgram.html#a0ddfa227d1aec7fcfd31cb2c23ec3d0f">docfiledata</a>,<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>,6) = opt_flip; <span class="comment">// Mirror</span></div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(<a class="code" href="classML2DBaseProgram.html#a0ddfa227d1aec7fcfd31cb2c23ec3d0f">docfiledata</a>,<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>,7) = <a class="code" href="classProgML2D.html#ae79f14fb1780011236766b2b6cb9748d">fracweight</a>; <span class="comment">// P_max/P_tot</span></div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(<a class="code" href="classML2DBaseProgram.html#a0ddfa227d1aec7fcfd31cb2c23ec3d0f">docfiledata</a>,<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>,8) = <a class="code" href="classProgML2D.html#a44961c5dba5a171972ac35969663c398">dLL</a>; <span class="comment">// log-likelihood</span></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">do_norm</a>)</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;            {</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;                <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(<a class="code" href="classML2DBaseProgram.html#a0ddfa227d1aec7fcfd31cb2c23ec3d0f">docfiledata</a>,<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>,9) = <a class="code" href="classProgML2D.html#aef35426c0860ea497a0fc71c9eb2bcbf">bgmean</a>; <span class="comment">// background mean</span></div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;                <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(<a class="code" href="classML2DBaseProgram.html#a0ddfa227d1aec7fcfd31cb2c23ec3d0f">docfiledata</a>,<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>,10) = <a class="code" href="classProgML2D.html#a89fc3cde7847bf0bb39ea52add1d4490">opt_scale</a>; <span class="comment">// image scale</span></div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;            }</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ba63ac8129e521abfeaeaee3bb4c38d">do_student</a>)</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;            {</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;                <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(<a class="code" href="classML2DBaseProgram.html#a0ddfa227d1aec7fcfd31cb2c23ec3d0f">docfiledata</a>,<a class="code" href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a>,11) = <a class="code" href="classProgML2D.html#a571bb2f7bac698c48cfbea17c9c12170">maxweight2</a>; <span class="comment">// Robustness weight</span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;            }</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;            <span class="comment">//Report progress and increment the images done</span></div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;            <a class="code" href="classXmippProgram.html#a074c10cbbaa660749bbc2778592a54c4">setProgress</a>(++img_done);</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;            <span class="comment">//#define DEBUG_JM1</span></div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="preprocessor">#ifdef DEBUG_JM1</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;            <span class="comment">//            {</span></div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;            <span class="comment">//              //std::cerr &lt;&lt; &quot;---------------------- DEBUG_JM: current_image: &quot; &lt;&lt; current_image &lt;&lt; std::endl;</span></div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;            std::cerr &lt;&lt; <span class="stringliteral">&quot;                              LL: &quot;</span> &lt;&lt; <a class="code" href="classProgML2D.html#ad26cadbfd0dfbaab4b1c19a5f2c9c939">LL</a> &lt;&lt; std::endl;</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;            std::cerr &lt;&lt; <span class="stringliteral">&quot;                wsum_sigma_noise: &quot;</span> &lt;&lt; <a class="code" href="classProgML2D.html#aeba68b5ab11453cdd8685b63eb122628">wsum_sigma_noise</a> &lt;&lt; std::endl;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;            std::cerr &lt;&lt; <span class="stringliteral">&quot;               wsum_sigma_offset: &quot;</span> &lt;&lt; <a class="code" href="classProgML2D.html#aacbe058d87287adbc0e5ee76f5ad317c">wsum_sigma_offset</a> &lt;&lt; std::endl;</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;            std::cerr &lt;&lt; <span class="stringliteral">&quot;                   sumfracweight: &quot;</span> &lt;&lt; <a class="code" href="classProgML2D.html#a60a40d22a1ca28a0ff4af54f0c83af08">sumfracweight</a> &lt;&lt; std::endl;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;            <span class="comment">//            }</span></div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;<span class="preprocessor">#undef DEBUG_JM1</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;        }<span class="comment">//close if current_block, also close of for all images</span></div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    }<span class="comment">//close for all images</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a3db6d60cc8179ba2a57c55cf7d5ba362">current_block</a> == (<a class="code" href="classML2DBaseProgram.html#a7b0d716eb64a885e060bd3d380fe83be">blocks</a> - 1))</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        <a class="code" href="classXmippProgram.html#aef9f1a6f495c898cb12eac9a7922a84c">endProgress</a>();</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    <span class="comment">//Changes temporally the model n_ref for the</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    <span class="comment">//refno loop, but not yet n_ref because in iem</span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    <span class="comment">//isn&#39;t yet the end of iteration</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a> *= <a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a>;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;    <span class="comment">// Rotate back and calculate weighted sums</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;    <a class="code" href="classProgML2D.html#a93b28ad122ffdbf8bb7fcd54e8540f8e">reverseRotateReference</a>();</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    <span class="comment">//Restore back the model.n_ref</span></div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;    <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a> /= <a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a>;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    <a class="code" href="mpi__write__test_8cpp.html#a158a8c64f24645c7478298399825737f">LOG</a>(<span class="stringliteral">&quot;      ProgML2D::expectation END&quot;</span>);</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;}<span class="comment">//function expectation</span></div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;<span class="comment">// Update all model parameters</span></div><div class="line"><a name="l01925"></a><span class="lineno"><a class="line" href="classProgML2D.html#a7a34a95a363891be46e76baa27975ce9"> 1925</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a7a34a95a363891be46e76baa27975ce9">ProgML2D::maximizeModel</a>(<a class="code" href="classModelML2D.html">ModelML2D</a> &amp;local_model)</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;{</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;    std::cerr&lt;&lt;<span class="stringliteral">&quot;entering maximization&quot;</span>&lt;&lt;std::endl;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    <a class="code" href="classMatrix1D.html">Matrix1D&lt;double&gt;</a> rmean_sigma2, rmean_signal2;</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    <a class="code" href="classMatrix1D.html">Matrix1D&lt;int&gt;</a> center(2), radial_count;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;std::complex&lt;double&gt;</a> &gt; Faux, Faux2;</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;double&gt;</a> Maux;</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    <a class="code" href="classFileName.html">FileName</a> fn_tmp;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    <span class="comment">// After iteration 0, factor_nref will ALWAYS be one</span></div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a> &gt; 1)</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    {</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;        <span class="keywordtype">int</span> old_refno = local_model.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>;</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;        local_model.<a class="code" href="classModelML2D.html#aa1c0b1d7d95d9939d5cdb9ee4c923006">setNRef</a>(local_model.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a> * <a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a>);</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;        <span class="comment">// Now also expand the Iref vector to contains factor_nref times more images</span></div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;        <span class="comment">// Make sure that headers are the same by using = assignments</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> group = 1; group &lt; <a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a>; group++)</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;        {</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> refno = 0; refno &lt; old_refno; refno++)</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;            {</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;                local_model.<a class="code" href="classModelML2D.html#a29baa2fb66177265cb0de6d027ea454a">Iref</a>[group * old_refno + refno] = local_model.<a class="code" href="classModelML2D.html#a29baa2fb66177265cb0de6d027ea454a">Iref</a>[refno];</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;            }</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;        }</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    }</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    <span class="comment">// Update the reference images</span></div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;    local_model.<a class="code" href="classModelML2D.html#a33e5549c691cfd65ca3480f4388b577f">sumw_allrefs</a> = 0.;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;    local_model.<a class="code" href="classModelML2D.html#a0645b5054c9b62af329b87f79ad256d8">sumw_allrefs2</a> = 0.;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    <span class="comment">//#define ASSIGN(var) if (var &gt; SIGNIFICANT_WEIGHT_LOW) local_model.var = var</span></div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;<span class="preprocessor">#define ASSIGN(var) local_model.var = var</span></div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;    <a class="code" href="ml__align2d_8cpp.html#ad7ec30f41bf25bb8e5554d39539ea758">ASSIGN</a>(<a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>);</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    <a class="code" href="ml__align2d_8cpp.html#ad7ec30f41bf25bb8e5554d39539ea758">ASSIGN</a>(<a class="code" href="classProgML2D.html#a60a40d22a1ca28a0ff4af54f0c83af08">sumfracweight</a>);</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    local_model.<a class="code" href="classModelML2D.html#a4900080e2b29004e5044765fe76ee81b">LL</a> = <a class="code" href="classProgML2D.html#ad26cadbfd0dfbaab4b1c19a5f2c9c939">LL</a>;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;    <span class="comment">// Update sigma of the origin offsets</span></div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classML2DBaseProgram.html#a3c0fde6f9005eec528cc1f703019719c">fix_sigma_offset</a>)</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;        <a class="code" href="ml__align2d_8cpp.html#ad7ec30f41bf25bb8e5554d39539ea758">ASSIGN</a>(<a class="code" href="classProgML2D.html#aacbe058d87287adbc0e5ee76f5ad317c">wsum_sigma_offset</a>);</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;    <span class="comment">// Update the noise parameters</span></div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classML2DBaseProgram.html#a4646a8113c64d86101389cb4f373bca3">fix_sigma_noise</a>)</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;        <a class="code" href="ml__align2d_8cpp.html#ad7ec30f41bf25bb8e5554d39539ea758">ASSIGN</a>(<a class="code" href="classProgML2D.html#aeba68b5ab11453cdd8685b63eb122628">wsum_sigma_noise</a>);</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> refno = 0; refno &lt; local_model.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>; refno++)</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;    {</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;        <span class="keywordtype">double</span> weight = <a class="code" href="classProgML2D.html#a89e864cc35899d6440890ad75efcbc1b">sumw</a>[refno];</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;        <span class="keywordflow">if</span> (weight &gt; 0.)</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        {</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;            <span class="keywordflow">if</span> (local_model.<a class="code" href="classModelML2D.html#a8ba63ac8129e521abfeaeaee3bb4c38d">do_student</a>)</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;            {</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;                weight = <a class="code" href="classProgML2D.html#a278477791b8743ce9578d57154e937da">sumw2</a>[refno];</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;                local_model.<a class="code" href="classModelML2D.html#a0645b5054c9b62af329b87f79ad256d8">sumw_allrefs2</a> += <a class="code" href="classProgML2D.html#a278477791b8743ce9578d57154e937da">sumw2</a>[refno];</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;            }</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;            <span class="keywordtype">double</span> avg, stddev, <a class="code" href="image__operate_8cpp.html#afbbd36781c10524238c70745c6f6f35d">min</a>, <a class="code" href="image__operate_8cpp.html#ac5474a01d203d14c046620266b2f1954">max</a>;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;            <a class="code" href="classProgML2D.html#ab3401ed5e2fdaef29418db09181b706d">wsum_Mref</a>[refno].computeStats(avg, stddev, min, max);</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;            <span class="comment">//std::cerr &lt;&lt; formatString(&quot;DEBUG_JM: avg %f, stddev %f, min %f, max %f&quot;, avg, stddev, min, max) &lt;&lt;std::endl;</span></div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;            local_model.<a class="code" href="classModelML2D.html#ab7d8a52f604b05bd0c078e639d6799b4">WsumMref</a>[refno]() = <a class="code" href="classProgML2D.html#ab3401ed5e2fdaef29418db09181b706d">wsum_Mref</a>[refno];</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;            <span class="comment">//local_model.Iref[refno]() *= 1/weight;//fixme: sumwsc2[refno];</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;            local_model.<a class="code" href="classModelML2D.html#a33e5549c691cfd65ca3480f4388b577f">sumw_allrefs</a> += <a class="code" href="classProgML2D.html#a89e864cc35899d6440890ad75efcbc1b">sumw</a>[refno];</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;            local_model.<a class="code" href="classModelML2D.html#ab7d8a52f604b05bd0c078e639d6799b4">WsumMref</a>[refno].setWeight(weight);</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;        }</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;        {</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;            local_model.<a class="code" href="classModelML2D.html#ab7d8a52f604b05bd0c078e639d6799b4">WsumMref</a>[refno].setWeight(0.);</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;            local_model.<a class="code" href="classModelML2D.html#ab7d8a52f604b05bd0c078e639d6799b4">WsumMref</a>[refno]().initZeros(<a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>, <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>);</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;            local_model.<a class="code" href="classModelML2D.html#ab7d8a52f604b05bd0c078e639d6799b4">WsumMref</a>[refno]().setXmippOrigin();</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;        }</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;        <span class="comment">// Adjust average scale (nr_classes will be smaller than model.n_ref for the 3D case!)</span></div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;        <span class="keywordflow">if</span> (local_model.<a class="code" href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">do_norm</a>)</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;            <a class="code" href="ml__align2d_8cpp.html#ad7ec30f41bf25bb8e5554d39539ea758">ASSIGN</a>(<a class="code" href="classProgML2D.html#ac86ae3f69ec448da39d9a662827dbf6a">sumwsc</a>[refno]);</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="classML2DBaseProgram.html#a6f89b87041906702ae5c30638bd2762c">fix_fractions</a>)</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;            <a class="code" href="ml__align2d_8cpp.html#ad7ec30f41bf25bb8e5554d39539ea758">ASSIGN</a>(<a class="code" href="classProgML2D.html#a7932acbd1ae193f532fc47df46f3d775">sumw_mirror</a>[refno]);</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;    }</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;    std::cerr&lt;&lt;<span class="stringliteral">&quot;leaving maximization&quot;</span>&lt;&lt;std::endl;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;}<span class="comment">//close function maximization</span></div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;</div><div class="line"><a name="l02015"></a><span class="lineno"><a class="line" href="classProgML2D.html#a329b42f3d96b8366df10fa3bf093ac7d"> 2015</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a329b42f3d96b8366df10fa3bf093ac7d">ProgML2D::maximization</a>()</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;{</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    <a class="code" href="mpi__write__test_8cpp.html#a158a8c64f24645c7478298399825737f">LOG</a>(<span class="stringliteral">&quot;   ProgML2D::maximization BEGIN&quot;</span>);</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a7b0d716eb64a885e060bd3d380fe83be">blocks</a> == 1) <span class="comment">//ie not IEM, normal maximization</span></div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    {</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;        <a class="code" href="classProgML2D.html#a7a34a95a363891be46e76baa27975ce9">maximizeModel</a>(<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>);</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a4254afe4781725aea4fce57e60a29ac4">update</a>();</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;        <span class="comment">// After iteration 0, factor_nref will ALWAYS be one</span></div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a> = 1;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    }</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    <span class="keywordflow">else</span> <span class="comment">//do IEM</span></div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;    {</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;        <span class="keywordtype">bool</span> special_first = (!<a class="code" href="classML2DBaseProgram.html#a4f7d61fca21cd29df3119a200b9a4bd3">do_restart</a> &amp;&amp; <a class="code" href="classML2DBaseProgram.html#a20e2b948711e3e66894740b99e8cf017">iter</a> == <a class="code" href="classML2DBaseProgram.html#a495926025de4de5360efd7266377cc2c">istart</a>);</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;        <a class="code" href="classModelML2D.html">ModelML2D</a> block_model(<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">n_ref</a>);</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;        <a class="code" href="mpi__write__test_8cpp.html#a158a8c64f24645c7478298399825737f">LOG</a>(<span class="stringliteral">&quot;      ProgML2D::maximization:   readModel and substractModel&quot;</span>);</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;        <span class="keywordflow">if</span> (!special_first)</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;        {</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;            <a class="code" href="classProgML2D.html#a54ffedea6c7c61f2e1ae50052dc07ce6">readModel</a>(block_model, <a class="code" href="classML2DBaseProgram.html#a3db6d60cc8179ba2a57c55cf7d5ba362">current_block</a>);</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#ab68333f3574c0098dd6caf51cfefc571">substractModel</a>(block_model);</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;        }</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;        <a class="code" href="mpi__write__test_8cpp.html#a158a8c64f24645c7478298399825737f">LOG</a>(<span class="stringliteral">&quot;      ProgML2D::maximization:   maximizeModel&quot;</span>);</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;        <a class="code" href="classProgML2D.html#a7a34a95a363891be46e76baa27975ce9">maximizeModel</a>(block_model);</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;        <a class="code" href="mpi__write__test_8cpp.html#a158a8c64f24645c7478298399825737f">LOG</a>(<span class="stringliteral">&quot;      ProgML2D::maximization:   maximizeModel&quot;</span>);</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;        <a class="code" href="classProgML2D.html#a06a09c39a7e10416a588d9cacb42fb87">writeOutputFiles</a>(block_model, <a class="code" href="ml2d_8h.html#a4e0517338e6c4a31a2addafc06d4f3a3a95f19e9cdaad9d8da56495e668998343">OUT_BLOCK</a>);</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;        <a class="code" href="mpi__write__test_8cpp.html#a158a8c64f24645c7478298399825737f">LOG</a>(<span class="stringliteral">&quot;      ProgML2D::maximization:   addModels&quot;</span>);</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;        <span class="keywordflow">if</span> (!special_first)</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;        {</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a3278f0162a362cbf3ddb48df1c0e832e">addModel</a>(block_model);</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a4254afe4781725aea4fce57e60a29ac4">update</a>();</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;        }</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a3db6d60cc8179ba2a57c55cf7d5ba362">current_block</a> == <a class="code" href="classML2DBaseProgram.html#a7b0d716eb64a885e060bd3d380fe83be">blocks</a> - 1) <span class="comment">//last block</span></div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;        {</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="classML2DBaseProgram.html#a3db6d60cc8179ba2a57c55cf7d5ba362">current_block</a> = 0; <a class="code" href="classML2DBaseProgram.html#a3db6d60cc8179ba2a57c55cf7d5ba362">current_block</a> &lt; <a class="code" href="classML2DBaseProgram.html#a7b0d716eb64a885e060bd3d380fe83be">blocks</a>; <a class="code" href="classML2DBaseProgram.html#a3db6d60cc8179ba2a57c55cf7d5ba362">current_block</a>++)</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;            {</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;                <a class="code" href="classProgML2D.html#a54ffedea6c7c61f2e1ae50052dc07ce6">readModel</a>(block_model, <a class="code" href="classML2DBaseProgram.html#a3db6d60cc8179ba2a57c55cf7d5ba362">current_block</a>);</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a3db6d60cc8179ba2a57c55cf7d5ba362">current_block</a> == 0)</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;                    <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a> = block_model;</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;                    <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a3278f0162a362cbf3ddb48df1c0e832e">addModel</a>(block_model);</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;            }</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a4254afe4781725aea4fce57e60a29ac4">update</a>();</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;            <span class="comment">//printModel(&quot;GLOBAL model: after addition and update: &quot;, model);</span></div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;            <span class="comment">// After iteration 0, factor_nref will ALWAYS be one</span></div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">factor_nref</a> = 1;</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;            <span class="comment">//restore the value of current block</span></div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;            --<a class="code" href="classML2DBaseProgram.html#a3db6d60cc8179ba2a57c55cf7d5ba362">current_block</a>;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        }</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;    }</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">do_norm</a>)</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;        <a class="code" href="classProgML2D.html#aa36f14d7a179db98ac4ee1dae1bba998">correctScaleAverage</a>();</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;    <a class="code" href="mpi__write__test_8cpp.html#a158a8c64f24645c7478298399825737f">LOG</a>(<span class="stringliteral">&quot;      ProgML2D::maximization END&quot;</span>);</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    <span class="comment">//    static int times = 0;</span></div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;    <span class="comment">//    if (times &gt; 1)</span></div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;    <span class="comment">//      exit(1);</span></div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    <span class="comment">//    ++times;</span></div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;}<span class="comment">//close function maximizationBlocks</span></div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;</div><div class="line"><a name="l02077"></a><span class="lineno"><a class="line" href="classProgML2D.html#aa36f14d7a179db98ac4ee1dae1bba998"> 2077</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#aa36f14d7a179db98ac4ee1dae1bba998">ProgML2D::correctScaleAverage</a>()</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;{</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;    <span class="comment">//FIXME: This function needs re-implementation for the do_norm parameter</span></div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;    <span class="comment">//now the ref3d comes in metadata, refs_per_class can be avoided</span></div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    <span class="comment">//    int iclass, nr_classes = ROUND(model.n_ref / refs_per_class);</span></div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;    <span class="comment">//    std::vector&lt;double&gt; wsum_scale(nr_classes), sumw_scale(nr_classes);</span></div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    <span class="comment">//    ldiv_t temp;</span></div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;    <span class="comment">//    average_scale = 0.;</span></div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;    <span class="comment">//    for (int refno = 0; refno &lt; model.n_ref; refno++)</span></div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;    <span class="comment">//    {</span></div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;    <span class="comment">//        average_scale += model.getSumwsc(refno);</span></div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;    <span class="comment">//        temp = ldiv(refno, refs_per_class);</span></div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;    <span class="comment">//        iclass = ROUND(temp.quot);</span></div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;    <span class="comment">//        wsum_scale[iclass] += model.getSumwsc(refno);</span></div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    <span class="comment">//        sumw_scale[iclass] += model.getSumw(refno);</span></div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    <span class="comment">//    }</span></div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;    <span class="comment">//    for (int refno = 0; refno &lt; model.n_ref; refno++)</span></div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;    <span class="comment">//    {</span></div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;    <span class="comment">//        temp = ldiv(refno, refs_per_class);</span></div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;    <span class="comment">//        iclass = ROUND(temp.quot);</span></div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;    <span class="comment">//        if (sumw_scale[iclass] &gt; 0.)</span></div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;    <span class="comment">//        {</span></div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;    <span class="comment">//            model.scale[refno] = wsum_scale[iclass] / sumw_scale[iclass];</span></div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;    <span class="comment">//            model.WsumMref[refno]() *= model.scale[refno];</span></div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;    <span class="comment">//        }</span></div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;    <span class="comment">//        else</span></div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    <span class="comment">//        {</span></div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;    <span class="comment">//            model.scale[refno] = 1.;</span></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;    <span class="comment">//        }</span></div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;    <span class="comment">//    }</span></div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;    <span class="comment">//    average_scale /= model.sumw_allrefs;</span></div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;}<span class="comment">//close function correctScaleAverage</span></div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;</div><div class="line"><a name="l02112"></a><span class="lineno"><a class="line" href="classProgML2D.html#a3bff9124dba630d9c37622c7f53d86e9"> 2112</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a3bff9124dba630d9c37622c7f53d86e9">ProgML2D::addPartialDocfileData</a>(<span class="keyword">const</span> <a class="code" href="classMultidimArray.html">MultidimArray&lt;double&gt;</a> &amp;data,</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;                                     <span class="keywordtype">size_t</span> <a class="code" href="numerical__recipes_8cpp.html#acaec38248b66cfba849985072bd311f6">first</a>, <span class="keywordtype">size_t</span> last)</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;{</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;Entering addPartialDocfileData&quot;</span> &lt;&lt;std::endl;</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> imgno = first; imgno &lt;= last; imgno++)</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;    {</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;        <span class="keywordtype">size_t</span> <a class="code" href="numerical__recipes_8cpp.html#ad2289c67cc7ca1c54d70d173b37d8820">index</a> = imgno - <a class="code" href="numerical__recipes_8cpp.html#acaec38248b66cfba849985072bd311f6">first</a>;</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;        <span class="keywordtype">size_t</span> <span class="keywordtype">id</span> = <a class="code" href="classML2DBaseProgram.html#a3464cb9938eb4cf849b7c8bbb354734f">img_id</a>[imgno];</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a963af5cdb6f63d876c147c24fbf8452e">do_ML3D</a>)</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;        {</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a59fffce298c0f99a1d592544d3d39a08">MDL_ANGLE_ROT</a>, <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(data, index, 0), <span class="keywordtype">id</span>);</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78ac15f836e18a2035d2923ecf76c6e8c7f">MDL_ANGLE_TILT</a>, <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(data, index, 1), <span class="keywordtype">id</span>);</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;        }</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;        <span class="comment">//Here we change the sign of the angle becase in the code</span></div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;        <span class="comment">//is represent the rotation of the reference and we want</span></div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;        <span class="comment">//to store the rotation of the image</span></div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="namespacealglib.html#a0759579762ef75075769325153538c5b">psi</a> = -<a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(data, index, 2);</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a114e3414dd216e4308946a016b5cc46f">MDL_ANGLE_PSI</a>, psi, <span class="keywordtype">id</span>);</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78acb3aa7acca32f4524608635e2e09650e">MDL_SHIFT_X</a>, <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(data, index, 3), <span class="keywordtype">id</span>);</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78ab00882fc483e9a1a7e6af5829a6afb8e">MDL_SHIFT_Y</a>, <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(data, index, 4), <span class="keywordtype">id</span>);</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a3637da3214664c45458ae3e56a92c88e">MDL_REF</a>, (<span class="keywordtype">int</span>)<a class="code" href="namespacealglib.html#a43452b10ffe26174e5d328a6ceb5fa9a">round</a>(<a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(data, index, 5)), <span class="keywordtype">id</span>);</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#ad9b9535e1774d805e5bbee89dee0f4b5">do_mirror</a>)</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;        {</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78af6495a877b8c80b9c45b8156b406b183">MDL_FLIP</a>, <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(data, index, 6) != 0., <span class="keywordtype">id</span>);</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;        }</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78ad8a81df6271e91f540f943bf8ef0d192">MDL_PMAX</a>, <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(data, index, 7), <span class="keywordtype">id</span>);</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78afdd72c29a4e9b5f719e1dadfd823ac78">MDL_LL</a>, <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(data, index, 8), <span class="keywordtype">id</span>);</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">do_norm</a>)</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;        {</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78aae8fbada7502a20a4d465a68f27848ac">MDL_BGMEAN</a>, <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(data, index, 9), <span class="keywordtype">id</span>);</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a29c393fe6e00aa337783865f8694b0af">MDL_INTSCALE</a>, <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(data, index, 10), <span class="keywordtype">id</span>);</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;        }</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>.<a class="code" href="classModelML2D.html#a8ba63ac8129e521abfeaeaee3bb4c38d">do_student</a>)</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;        {</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78af25c0f56fca98fcdd37f613ba2c61de3">MDL_WROBUST</a>, <a class="code" href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a>(data, index, 11), <span class="keywordtype">id</span>);</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;        }</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;    }</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;Leaving addPartialDocfileData&quot;</span> &lt;&lt;std::endl;</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;}<span class="comment">//close function addDocfileData</span></div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;<span class="comment">//Some macros</span></div><div class="line"><a name="l02159"></a><span class="lineno"><a class="line" href="ml__align2d_8cpp.html#afed153190a447433ca6679468f1cb504"> 2159</a></span>&#160;<span class="preprocessor">#define ITER_PREFIX &quot;iter&quot;//formatString(&quot;iter%06d&quot;, iter)</span></div><div class="line"><a name="l02160"></a><span class="lineno"><a class="line" href="ml__align2d_8cpp.html#a5a69a7732375f012c400341ac95d3bc2"> 2160</a></span>&#160;<span class="preprocessor">#define FINAL_PREFIX &quot;final&quot;</span></div><div class="line"><a name="l02161"></a><span class="lineno"><a class="line" href="ml__align2d_8cpp.html#a841d8cef268a511f6cdf4e9a944c2b32"> 2161</a></span>&#160;<span class="preprocessor">#define IS_FINAL outputType == OUT_FINAL</span></div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;</div><div class="line"><a name="l02163"></a><span class="lineno"><a class="line" href="classProgML2D.html#a06a09c39a7e10416a588d9cacb42fb87"> 2163</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a06a09c39a7e10416a588d9cacb42fb87">ProgML2D::writeOutputFiles</a>(<span class="keyword">const</span> <a class="code" href="classModelML2D.html">ModelML2D</a> &amp;<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>, <a class="code" href="ml2d_8h.html#a4e0517338e6c4a31a2addafc06d4f3a3">OutputType</a> outputType)</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;{</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;    <a class="code" href="classFileName.html">FileName</a> fn_tmp, fn_prefix, fn_base;</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;    <a class="code" href="classImage.html">Image&lt;double&gt;</a> Itmp;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    <a class="code" href="classMetaData.html">MetaData</a> MDo;</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;    <span class="keywordtype">bool</span> write_img_xmd = <span class="keyword">true</span>, write_refs_log = <span class="keyword">true</span>, write_conv = !<a class="code" href="classML2DBaseProgram.html#a963af5cdb6f63d876c147c24fbf8452e">do_ML3D</a>;</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;    <span class="keywordtype">bool</span> write_norm = model.<a class="code" href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">do_norm</a>;</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#a20e2b948711e3e66894740b99e8cf017">iter</a> == 0)</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;        write_conv = <span class="keyword">false</span>;</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;    <span class="comment">//By default write down the parameters</span></div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;    std::vector&lt;Image&lt;double&gt; &gt; <span class="keyword">const</span> * ptrImages = &amp;(model.<a class="code" href="classModelML2D.html#a29baa2fb66177265cb0de6d027ea454a">Iref</a>);</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;    std::vector&lt;double&gt; <span class="keyword">const</span> * ptrMirror = &amp;(model.<a class="code" href="classModelML2D.html#aae60b45954a007f5f9b95ae73c637205">mirror_fraction</a>);</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;    <span class="keywordtype">double</span> avePmax = model.<a class="code" href="classModelML2D.html#ab7380ee8c8f0621acf0c49b43c0e0578">avePmax</a>;</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;    <span class="keywordtype">double</span> sigma_noise = model.<a class="code" href="classModelML2D.html#aa1281d05277a75579f9adb3b19304a7b">sigma_noise</a>;</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    <span class="keywordtype">double</span> sigma_offset = model.<a class="code" href="classModelML2D.html#a8ee9d8ba6b21965a4fd84a8987c0b76e">sigma_offset</a>;</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    <span class="keywordflow">switch</span> (outputType)</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;    {</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ml2d_8h.html#a4e0517338e6c4a31a2addafc06d4f3a3a95f19e9cdaad9d8da56495e668998343">OUT_BLOCK</a>:</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;        write_img_xmd = <span class="keyword">false</span>;</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;        write_conv = <span class="keyword">false</span>;</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;        <span class="comment">// Sjors 18may2010: why not write scales in blocks? We need this now, don&#39;t we?</span></div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;        <span class="comment">//write_norm = false;</span></div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;        fn_prefix = <a class="code" href="group__StringUtilities.html#gaa405c9a5b808e428554e540028085dd3">formatString</a>(<span class="stringliteral">&quot;block%03d&quot;</span>, <a class="code" href="classML2DBaseProgram.html#a3db6d60cc8179ba2a57c55cf7d5ba362">current_block</a> + 1);</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;        <span class="comment">// For blocks we will write out the summations instead of parameters</span></div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;        ptrImages = &amp;(model.<a class="code" href="classModelML2D.html#ab7d8a52f604b05bd0c078e639d6799b4">WsumMref</a>);</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;        ptrMirror = &amp;(model.<a class="code" href="classModelML2D.html#ad96c07a510bde15050c4862c41df0318">sumw_mirror</a>);</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;        avePmax = model.<a class="code" href="classModelML2D.html#ae003e31cd7f8e88de554157e5b8a62f5">sumfracweight</a>;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;        sigma_noise = model.<a class="code" href="classModelML2D.html#a8ef40e1e3d8cd33a2b424346ccd69346">wsum_sigma_noise</a>;</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;        sigma_offset = model.<a class="code" href="classModelML2D.html#a5b67cc654d1cbdbd89e72251cf8a7110">wsum_sigma_offset</a>;</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ml2d_8h.html#a4e0517338e6c4a31a2addafc06d4f3a3aaf0fce4b419a64beac8ea79227577e27">OUT_ITER</a>:</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;        <span class="comment">//fn_base = getBaseName(&quot;_it&quot;, iter);</span></div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;        fn_prefix = <a class="code" href="ml__align2d_8cpp.html#afed153190a447433ca6679468f1cb504">ITER_PREFIX</a>;</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ml2d_8h.html#a4e0517338e6c4a31a2addafc06d4f3a3a6fd70d363102c21d4574856dc09395b8">OUT_FINAL</a>:</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;        <span class="comment">//fn_base = fn_root;</span></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;        fn_prefix = <a class="code" href="ml__align2d_8cpp.html#a5a69a7732375f012c400341ac95d3bc2">FINAL_PREFIX</a>;</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ml2d_8h.html#a4e0517338e6c4a31a2addafc06d4f3a3a89efaab8334ac6cb11c69e69f3cf30d4">OUT_IMGS</a>:</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;        <span class="comment">//std::cerr &lt;&lt; &quot;OUT_IMGS&quot; &lt;&lt;std::endl;</span></div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;        write_refs_log = <span class="keyword">false</span>;</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;        <span class="comment">//fn_base = getBaseName(&quot;_it&quot;, iter);</span></div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;        fn_prefix = <a class="code" href="ml__align2d_8cpp.html#afed153190a447433ca6679468f1cb504">ITER_PREFIX</a>;</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="ml2d_8h.html#a4e0517338e6c4a31a2addafc06d4f3a3a2de4bf60bbff3a00593fa0db7834c71a">OUT_REFS</a>:</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;        <span class="comment">//std::cerr &lt;&lt; &quot;OUT_REFS&quot; &lt;&lt;std::endl;</span></div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;        <a class="code" href="mpi__write__test_8cpp.html#a158a8c64f24645c7478298399825737f">LOG</a>(<span class="stringliteral">&quot;OUT_REFS&quot;</span>);</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;        write_img_xmd = <span class="keyword">false</span>;</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;        write_conv = <span class="keyword">false</span>;</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;        <span class="comment">//fn_base = getBaseName(&quot;_it&quot;, iter);</span></div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;        fn_prefix = <a class="code" href="ml__align2d_8cpp.html#afed153190a447433ca6679468f1cb504">ITER_PREFIX</a>;</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;    }</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;    fn_base = (fn_prefix == <a class="code" href="ml__align2d_8cpp.html#afed153190a447433ca6679468f1cb504">ITER_PREFIX</a>) ? <span class="comment">//All intermediate iteration files should go to &quot;extra&quot; folder</span></div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;              <a class="code" href="group__MLalign2D.html#ga37dd4c436766acd586ca95f773236000">getIterExtraPath</a>(<a class="code" href="classML2DBaseProgram.html#adfab8933f95443ac6d909a9b206b3fa8">fn_root</a>, <a class="code" href="classML2DBaseProgram.html#a20e2b948711e3e66894740b99e8cf017">iter</a>) : <a class="code" href="classML2DBaseProgram.html#adfab8933f95443ac6d909a9b206b3fa8">fn_root</a>;</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;    <span class="keywordflow">if</span> (write_img_xmd)</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;    {</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;        <span class="comment">//static WriteModeMetaData mode = MD_OVERWRITE;</span></div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;        <span class="comment">//Write image metadata, for each iteration a new block will be written</span></div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;        fn_tmp = <a class="code" href="ml2d_8h.html#a110de41c02a5f818c5a698293cf0b9e8">FN_IMAGES_MD</a>(fn_base);</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>.<a class="code" href="classMetaData.html#a163fee49247af4f55802e8480503b342">write</a>(fn_tmp);</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;        <span class="comment">//        if (fn_prefix == ITER_PREFIX)</span></div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;        <span class="comment">//            fn_tmp = formatString(&quot;iter%06d@%s_iter_images.xmd&quot;, iter, rootStr);</span></div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;        <span class="comment">//        else</span></div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;        <span class="comment">//            fn_tmp = formatString(&quot;%s_%s_images.xmd&quot;, rootStr, prefixStr);</span></div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;        <span class="comment">//MDimg.write(fn_tmp, mode);</span></div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;        <span class="comment">//mode = MD_APPEND;</span></div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;    }</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;    <span class="keywordflow">if</span> (write_refs_log)</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;    {</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;        <span class="comment">// Write out current reference images and fill sel &amp; log-file</span></div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;        <span class="comment">// Re-use the MDref metadata that was read in produceSideInfo2</span></div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;        <span class="comment">// This way. MDL_ANGLE_ROT, MDL_ANGLE_TILT, MDL_REF etc are treated ok for do_ML3D</span></div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;        <span class="keywordtype">int</span> refno = 0;</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;        <span class="keywordtype">size_t</span> objId;</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;        <span class="keywordtype">int</span> select_img;</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;        <span class="keywordtype">double</span> weight;</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;        <span class="keywordtype">size_t</span> count;</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;        fn_tmp = <a class="code" href="ml2d_8h.html#a705c821075be62861b850210b9157c3d">FN_CLASSES_STK</a>(fn_base);</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;        <span class="comment">//        if (fn_prefix == ITER_PREFIX)</span></div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;        <span class="comment">//            fn_tmp = formatString(&quot;%s_iter%06d_refs.stk&quot;, rootStr, iter);</span></div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;        <span class="comment">//        else</span></div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;        <span class="comment">//            fn_tmp = formatString(&quot;%s_%s_refs.stk&quot;, rootStr, prefixStr);</span></div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;        <a class="code" href="group__MetaData.html#ga85652b971edca3acc93a9f1bef2f17f6">FOR_ALL_OBJECTS_IN_METADATA</a>(<a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>)</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;        {</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;            objId = __iter.objId;</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;            select_img = refno + 1;</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;            <span class="comment">//Itmp = model.Iref[refno];</span></div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;            <span class="comment">//std::cerr &lt;&lt; &quot;DEBUG_JM: refno: &quot; &lt;&lt; refno &lt;&lt; std::endl;</span></div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;            Itmp = (*ptrImages)[refno];</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;            <span class="comment">//std::cerr &lt;&lt; &quot;DEBUG_JM: fn_tmp: &quot; &lt;&lt; fn_tmp &lt;&lt; std::endl;</span></div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;            <span class="comment">//std::cerr &lt;&lt; &quot;DEBUG_JM: select_img: &quot; &lt;&lt; select_img &lt;&lt; std::endl;</span></div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;            Itmp.<a class="code" href="classImageBase.html#ae81a8c11a832924c2bda0909882c3168">write</a>(fn_tmp, select_img, <span class="keyword">true</span>, <a class="code" href="group__Images.html#gga61d23b393fdc35f2f0e30a1ed566c76da52fde2ebf77ef5a26e9e7722880039c8">WRITE_REPLACE</a>);</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;            <span class="comment">//MDref.setValue(MDL_ITER, iter, objId);//write out iteration number</span></div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a3637da3214664c45458ae3e56a92c88e">MDL_REF</a>, select_img, objId); <span class="comment">//Also write reference number</span></div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78af4298cfa617e6143f021d0d7956a7f70">MDL_IMAGE</a>, <a class="code" href="group__StringUtilities.html#gaa405c9a5b808e428554e540028085dd3">formatString</a>(<span class="stringliteral">&quot;%06d@%s&quot;</span>, select_img, fn_tmp.c_str()), objId);</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78adc4c6714fd11379df071ebe8a442c30d">MDL_ENABLED</a>, 1, objId);</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;            weight = model.<a class="code" href="classModelML2D.html#ab7d8a52f604b05bd0c078e639d6799b4">WsumMref</a>[refno].weight();</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a8807f4c926a3e980249df162c9ff0bdf">MDL_WEIGHT</a>, weight, objId);</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;            count = <a class="code" href="group__Macros.html#gacd66e8cacf954c3bc3bba81d09425a12">ROUND</a>(weight);</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;            <a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a9d13c72718d18011b83425689e4d6e59">MDL_CLASS_COUNT</a>, count, objId);</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#ad9b9535e1774d805e5bbee89dee0f4b5">do_mirror</a>)</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;                <a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a0704d0153add5aa8abcf3e82bb174ebc">MDL_MIRRORFRAC</a>, (*ptrMirror)[refno], objId);</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;            <span class="keywordflow">if</span> (write_conv)</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;                <a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a94561c5c01993bb73d33426fdfcc9338">MDL_SIGNALCHANGE</a>, <a class="code" href="classML2DBaseProgram.html#a3b21e31f64ae12053ef1192ef39e309e">conv</a>[refno]*1000, objId);</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;            <span class="keywordflow">if</span> (write_norm)</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;                <a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a29c393fe6e00aa337783865f8694b0af">MDL_INTSCALE</a>, model.<a class="code" href="classModelML2D.html#afb7a89515e4d8891cbc47b9b32857eb1">scale</a>[refno], objId);</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;            ++refno;</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;        }</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;        <span class="comment">//fn_tmp.copyFile(formatString(&quot;%s_output_block%d.stk&quot;, fn_tmp.c_str(), current_block));</span></div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;        <span class="comment">//        fn_tmp = formatString(&quot;%s_%s&quot;, rootStr, prefixStr);</span></div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;        <span class="comment">//        FileName fn_ref = fn_tmp + &quot;_refs.xmd&quot;;</span></div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;        <span class="comment">//        if (!fn_prefix.contains(&quot;block&quot;))</span></div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;        <span class="comment">//            fn_ref = formatString(&quot;iter%06d@%s&quot;, iter, fn_ref.c_str());</span></div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;        <span class="comment">//        MDref.write(fn_ref, mode);</span></div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;        fn_tmp = <a class="code" href="ml2d_8h.html#a8ef0c472d79a03426c3c02f8777ef3c3">FN_CLASSES_MD</a>(fn_base);</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;        <a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>.<a class="code" href="classMetaData.html#a163fee49247af4f55802e8480503b342">write</a>(fn_tmp);</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;        <span class="keywordflow">if</span> (outputType == <a class="code" href="ml2d_8h.html#a4e0517338e6c4a31a2addafc06d4f3a3a2de4bf60bbff3a00593fa0db7834c71a">OUT_REFS</a>)</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;          <a class="code" href="classML2DBaseProgram.html#ac3eac3d0fb4000223088846bee6bcb0b">outRefsMd</a> = fn_tmp;</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;        <span class="comment">// Write out log-file</span></div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;        <a class="code" href="classMetaData.html">MetaData</a> mdLog;</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;        objId = mdLog.<a class="code" href="classMetaData.html#acd6018636eda733443f3df6c61978faa">addObject</a>();</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;        mdLog.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78abbbbb24eaf2b80e9a7ed50bd6075e833">MDL_ITER</a>, <a class="code" href="classML2DBaseProgram.html#a20e2b948711e3e66894740b99e8cf017">iter</a>, objId);</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;        mdLog.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78afdd72c29a4e9b5f719e1dadfd823ac78">MDL_LL</a>, model.<a class="code" href="classModelML2D.html#a4900080e2b29004e5044765fe76ee81b">LL</a>, objId);</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;        mdLog.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78ad8a81df6271e91f540f943bf8ef0d192">MDL_PMAX</a>, avePmax, objId);</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;        mdLog.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78af9ccf0b3cc12d07722d11549151d21f0">MDL_SIGMANOISE</a>, sigma_noise, objId);</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;        mdLog.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a44d2f7bdda1efb37f9218b2ac4eb8a2c">MDL_SIGMAOFFSET</a>, sigma_offset, objId);</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;        mdLog.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a31de7898d23a11e9b1b2ba4cc816d365">MDL_RANDOMSEED</a>, <a class="code" href="classXmippProgram.html#a51ae38ef10274f8f7c6c02ab2a67a28c">seed</a>, objId);</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;        <span class="keywordflow">if</span> (write_norm)</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;            mdLog.<a class="code" href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">setValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a29c393fe6e00aa337783865f8694b0af">MDL_INTSCALE</a>, <a class="code" href="classML2DBaseProgram.html#a90f80f69b900eb15f9300560d50286ca">average_scale</a>, objId);</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;        mdLog.<a class="code" href="classMetaData.html#a163fee49247af4f55802e8480503b342">write</a>(<a class="code" href="ml2d_8h.html#a108b3141800d641ccdbab77acd07a7e1">FN_LOGS_MD</a>(fn_base), <a class="code" href="group__MetaData.html#ggaf446b6aff4a8c034231bfa3e1484bc47ae658bd63b5c203ea5e350a42881a57ca">MD_APPEND</a>);</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;        <span class="keywordflow">if</span> (write_img_xmd)</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;        {</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;            <a class="code" href="classMetaData.html">MetaData</a> mdImgs;</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;            <span class="keywordtype">size_t</span> <a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = <a class="code" href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">MDref</a>.<a class="code" href="classMetaData.html#ad844b6a5655be4205e4bb03ab6372562">size</a>();</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ref = 1; ref &lt;= <a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>; ++ref)</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;            {</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;                mdImgs.<a class="code" href="classMetaData.html#a94973ba346a77cdb9aaf44fe65b2dd3c">importObjects</a>(<a class="code" href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">MDimg</a>, <a class="code" href="classMDValueEQ.html">MDValueEQ</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a3637da3214664c45458ae3e56a92c88e">MDL_REF</a>, (<span class="keywordtype">int</span>)ref));</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;                mdImgs.<a class="code" href="classMetaData.html#a163fee49247af4f55802e8480503b342">write</a>(<a class="code" href="ml2d_8h.html#a5478fca9f7c1fc0b3c861cee24fa73a6">FN_CLASS_IMAGES_MD</a>(fn_base, ref), <a class="code" href="group__MetaData.html#ggaf446b6aff4a8c034231bfa3e1484bc47ae658bd63b5c203ea5e350a42881a57ca">MD_APPEND</a>);</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;            }</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;        }</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;        <span class="comment">//        if (fn_prefix.contains(&quot;block&quot;) || mode == MD_OVERWRITE)</span></div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;        <span class="comment">//            mdLog.write(fn_tmp);</span></div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;        <span class="comment">//        else</span></div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;        <span class="comment">//            mdLog.append(fn_tmp);</span></div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;        <span class="comment">//        mode = MD_APPEND;</span></div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;    }</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;}<span class="comment">//close function writeModel</span></div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;</div><div class="line"><a name="l02330"></a><span class="lineno"><a class="line" href="classProgML2D.html#a54ffedea6c7c61f2e1ae50052dc07ce6"> 2330</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classProgML2D.html#a54ffedea6c7c61f2e1ae50052dc07ce6">ProgML2D::readModel</a>(<a class="code" href="classModelML2D.html">ModelML2D</a> &amp;<a class="code" href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">model</a>, <span class="keywordtype">int</span> block)</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;{</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;    <span class="comment">// First read general model parameters from _log.xmd</span></div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;    <a class="code" href="classFileName.html">FileName</a> fn_base = <a class="code" href="group__StringUtilities.html#gaa405c9a5b808e428554e540028085dd3">formatString</a>(<span class="stringliteral">&quot;%s_block%03d&quot;</span>, <a class="code" href="classML2DBaseProgram.html#adfab8933f95443ac6d909a9b206b3fa8">fn_root</a>.c_str(), (block + 1));</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;    <a class="code" href="classMetaData.html">MetaData</a> MDi;</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;    MDi.<a class="code" href="classMetaData.html#ab7f8d43d77647ade923e6cd63eafdd03">read</a>(fn_base + <span class="stringliteral">&quot;_logs.xmd&quot;</span>);</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;    model.<a class="code" href="classModelML2D.html#a975642ba000f15ba72f4a5c833205f92">dim</a> = <a class="code" href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">dim</a>;</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;    <span class="keywordtype">size_t</span> <span class="keywordtype">id</span> = MDi.<a class="code" href="classMetaData.html#a9f88f42faff8bfbc1952c50e2a6ffc42">firstObject</a>();</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;    MDi.<a class="code" href="classMetaData.html#a2239fbb7e492654f1e2866ab27492a5d">getValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78afdd72c29a4e9b5f719e1dadfd823ac78">MDL_LL</a>, model.<a class="code" href="classModelML2D.html#a4900080e2b29004e5044765fe76ee81b">LL</a>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;    MDi.<a class="code" href="classMetaData.html#a2239fbb7e492654f1e2866ab27492a5d">getValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78ad8a81df6271e91f540f943bf8ef0d192">MDL_PMAX</a>, model.<a class="code" href="classModelML2D.html#ae003e31cd7f8e88de554157e5b8a62f5">sumfracweight</a>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;    MDi.<a class="code" href="classMetaData.html#a2239fbb7e492654f1e2866ab27492a5d">getValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78af9ccf0b3cc12d07722d11549151d21f0">MDL_SIGMANOISE</a>, model.<a class="code" href="classModelML2D.html#a8ef40e1e3d8cd33a2b424346ccd69346">wsum_sigma_noise</a>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;    MDi.<a class="code" href="classMetaData.html#a2239fbb7e492654f1e2866ab27492a5d">getValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a44d2f7bdda1efb37f9218b2ac4eb8a2c">MDL_SIGMAOFFSET</a>, model.<a class="code" href="classModelML2D.html#a5b67cc654d1cbdbd89e72251cf8a7110">wsum_sigma_offset</a>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;    <span class="comment">//Then read reference model parameters from _ref.xmd</span></div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    <a class="code" href="classFileName.html">FileName</a> <a class="code" href="classML2DBaseProgram.html#a4e593a9112ddcc0256bc9b72213cdb3b">fn_img</a>;</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;    <a class="code" href="classImage.html">Image&lt;double&gt;</a> img;</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;    MDi.<a class="code" href="classMetaData.html#a7c80f24121d6c01ff3c9ec939a17e542">clear</a>();</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;    MDi.<a class="code" href="classMetaData.html#ab7f8d43d77647ade923e6cd63eafdd03">read</a>(fn_base + <span class="stringliteral">&quot;_refs.xmd&quot;</span>);</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;    <span class="keywordtype">int</span> refno = 0;</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;    <span class="keywordtype">double</span> weight = 0;</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    model.<a class="code" href="classModelML2D.html#a33e5549c691cfd65ca3480f4388b577f">sumw_allrefs</a> = 0.;</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;    <a class="code" href="group__MetaData.html#ga85652b971edca3acc93a9f1bef2f17f6">FOR_ALL_OBJECTS_IN_METADATA</a>(MDi)</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;    {</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;        <span class="keywordtype">id</span> = __iter.objId;</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;        MDi.<a class="code" href="classMetaData.html#a2239fbb7e492654f1e2866ab27492a5d">getValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78af4298cfa617e6143f021d0d7956a7f70">MDL_IMAGE</a>, fn_img, <span class="keywordtype">id</span>);</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;        img.<a class="code" href="classImageBase.html#a88636b7a7bd4e0e454877e691ee2da84">read</a>(fn_img);</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;        img().setXmippOrigin();</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;        model.<a class="code" href="classModelML2D.html#ab7d8a52f604b05bd0c078e639d6799b4">WsumMref</a>[refno] = img;</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;        MDi.<a class="code" href="classMetaData.html#a2239fbb7e492654f1e2866ab27492a5d">getValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a8807f4c926a3e980249df162c9ff0bdf">MDL_WEIGHT</a>, weight, <span class="keywordtype">id</span>);</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;        model.<a class="code" href="classModelML2D.html#ab7d8a52f604b05bd0c078e639d6799b4">WsumMref</a>[refno].setWeight(weight);</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;        model.<a class="code" href="classModelML2D.html#a33e5549c691cfd65ca3480f4388b577f">sumw_allrefs</a> += weight;</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;        model.<a class="code" href="classModelML2D.html#ad96c07a510bde15050c4862c41df0318">sumw_mirror</a>[refno] = 0.;</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classML2DBaseProgram.html#ad9b9535e1774d805e5bbee89dee0f4b5">do_mirror</a>)</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;            MDi.<a class="code" href="classMetaData.html#a2239fbb7e492654f1e2866ab27492a5d">getValue</a>(<a class="code" href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a0704d0153add5aa8abcf3e82bb174ebc">MDL_MIRRORFRAC</a>, model.<a class="code" href="classModelML2D.html#ad96c07a510bde15050c4862c41df0318">sumw_mirror</a>[refno], <span class="keywordtype">id</span>);</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;        refno++;</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;    }</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;}<span class="comment">//close function readModel</span></div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;</div><div class="line"><a name="l02370"></a><span class="lineno"><a class="line" href="classProgML2D.html#aa5d75659fd752108984bd946431828ba"> 2370</a></span>&#160;<a class="code" href="classFileName.html">FileName</a> <a class="code" href="classProgML2D.html#aa5d75659fd752108984bd946431828ba">ProgML2D::getBaseName</a>(<a class="code" href="xmipp__strings_8h.html#afbeda3fd1bdc8c37d01bdf9f5c8274ff">String</a> suffix, <span class="keywordtype">int</span> number)</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;{</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;    <a class="code" href="classFileName.html">FileName</a> fn_base = <a class="code" href="classML2DBaseProgram.html#adfab8933f95443ac6d909a9b206b3fa8">fn_root</a> + suffix;</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;    <span class="keywordflow">if</span> (number &gt;= 0)</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;        fn_base.<a class="code" href="classFileName.html#ab10d5ada0f956aef14ae171f12587d56">compose</a>(fn_base, number, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;    <span class="keywordflow">return</span> fn_base;</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;}</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;</div><div class="ttc" id="classProgML2D_html_a60c80f44651c3b41e31d779d0cd2945f"><div class="ttname"><a href="classProgML2D.html#a60c80f44651c3b41e31d779d0cd2945f">ProgML2D::getThreadRefnoJob</a></div><div class="ttdeci">int getThreadRefnoJob(int &amp;refno)</div><div class="ttdoc">Assign refno jobs to threads. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l01026">ml_align2d.cpp:1026</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a976dc404489a0c66af2800f0f73e76c7"><div class="ttname"><a href="classML2DBaseProgram.html#a976dc404489a0c66af2800f0f73e76c7">ML2DBaseProgram::nr_psi</a></div><div class="ttdeci">size_t nr_psi</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00154">ml2d.h:154</a></div></div>
<div class="ttc" id="group__GeometricalTransformations_html_ga22035972f95a4f2bf79416b5ebf9d44e"><div class="ttname"><a href="group__GeometricalTransformations.html#ga22035972f95a4f2bf79416b5ebf9d44e">selfApplyGeometry</a></div><div class="ttdeci">void selfApplyGeometry(int Splinedegree, MultidimArray&lt; std::complex&lt; double &gt; &gt; &amp;V1, const Matrix2D&lt; double &gt; &amp;A, bool inv, bool wrap, std::complex&lt; double &gt; outside)</div><div class="ttdef"><b>Definition:</b> <a href="transformations_8cpp_source.html#l00553">transformations.cpp:553</a></div></div>
<div class="ttc" id="group__Threads_html_ga3c4dbe1b06c40927ef9cb8be71b366e8"><div class="ttname"><a href="group__Threads.html#ga3c4dbe1b06c40927ef9cb8be71b366e8">barrier_init</a></div><div class="ttdeci">int barrier_init(barrier_t *barrier, int needed)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__threads_8cpp_source.html#l00366">xmipp_threads.cpp:366</a></div></div>
<div class="ttc" id="classProgML2D_html_a8c569527c10ddd6d1a9cf09f440da081"><div class="ttname"><a href="classProgML2D.html#a8c569527c10ddd6d1a9cf09f440da081">ProgML2D::threadTask</a></div><div class="ttdeci">int threadTask</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00067">ml_align2d.h:67</a></div></div>
<div class="ttc" id="classProgML2D_html_a0ffe94562ea23e1ac3676de859b454dc"><div class="ttname"><a href="classProgML2D.html#a0ffe94562ea23e1ac3676de859b454dc">ProgML2D::printModel</a></div><div class="ttdeci">virtual void printModel(const String &amp;msg, const ModelML2D &amp;model)</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l00279">ml_align2d.cpp:279</a></div></div>
<div class="ttc" id="classMetaData_html_a163fee49247af4f55802e8480503b342"><div class="ttname"><a href="classMetaData.html#a163fee49247af4f55802e8480503b342">MetaData::write</a></div><div class="ttdeci">void write(const FileName &amp;outFile, WriteModeMetaData mode=MD_OVERWRITE) const </div><div class="ttdef"><b>Definition:</b> <a href="metadata_8cpp_source.html#l00907">metadata.cpp:907</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78afdd72c29a4e9b5f719e1dadfd823ac78"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78afdd72c29a4e9b5f719e1dadfd823ac78">MDL_LL</a></div><div class="ttdoc">contribution of an image to log-likelihood value </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00258">metadata_label.h:258</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a3464cb9938eb4cf849b7c8bbb354734f"><div class="ttname"><a href="classML2DBaseProgram.html#a3464cb9938eb4cf849b7c8bbb354734f">ML2DBaseProgram::img_id</a></div><div class="ttdeci">std::vector&lt; size_t &gt; img_id</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00232">ml2d.h:232</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a790a55bd210ce856bfbbd8853c6789df"><div class="ttname"><a href="classML2DBaseProgram.html#a790a55bd210ce856bfbbd8853c6789df">ML2DBaseProgram::ddim2</a></div><div class="ttdeci">double ddim2</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00152">ml2d.h:152</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a1e429b25f696eba0bb30a316517f0b31"><div class="ttname"><a href="classML2DBaseProgram.html#a1e429b25f696eba0bb30a316517f0b31">ML2DBaseProgram::refs_per_class</a></div><div class="ttdeci">int refs_per_class</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00217">ml2d.h:217</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78a59fffce298c0f99a1d592544d3d39a08"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a59fffce298c0f99a1d592544d3d39a08">MDL_ANGLE_ROT</a></div><div class="ttdoc">Rotation angle of an image (double,degrees) </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00057">metadata_label.h:57</a></div></div>
<div class="ttc" id="ml2d_8h_html_a4e0517338e6c4a31a2addafc06d4f3a3a2de4bf60bbff3a00593fa0db7834c71a"><div class="ttname"><a href="ml2d_8h.html#a4e0517338e6c4a31a2addafc06d4f3a3a2de4bf60bbff3a00593fa0db7834c71a">OUT_REFS</a></div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00076">ml2d.h:76</a></div></div>
<div class="ttc" id="image__operate_8cpp_html_afbbd36781c10524238c70745c6f6f35d"><div class="ttname"><a href="image__operate_8cpp.html#afbbd36781c10524238c70745c6f6f35d">min</a></div><div class="ttdeci">void min(Image&lt; double &gt; &amp;op1, const Image&lt; double &gt; &amp;op2)</div><div class="ttdef"><b>Definition:</b> <a href="image__operate_8cpp_source.html#l00115">image_operate.cpp:115</a></div></div>
<div class="ttc" id="classProgML2D_html_a0ad1678e8cea8efa9d00630274c96971"><div class="ttname"><a href="classProgML2D.html#a0ad1678e8cea8efa9d00630274c96971">ProgML2D::preselectLimitedDirections</a></div><div class="ttdeci">void preselectLimitedDirections(double &amp;phi, double &amp;theta)</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l00634">ml_align2d.cpp:634</a></div></div>
<div class="ttc" id="ml2d_8h_html_a4e0517338e6c4a31a2addafc06d4f3a3aaf0fce4b419a64beac8ea79227577e27"><div class="ttname"><a href="ml2d_8h.html#a4e0517338e6c4a31a2addafc06d4f3a3aaf0fce4b419a64beac8ea79227577e27">OUT_ITER</a></div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00076">ml2d.h:76</a></div></div>
<div class="ttc" id="classProgML2D_html_a3bff9124dba630d9c37622c7f53d86e9"><div class="ttname"><a href="classProgML2D.html#a3bff9124dba630d9c37622c7f53d86e9">ProgML2D::addPartialDocfileData</a></div><div class="ttdeci">virtual void addPartialDocfileData(const MultidimArray&lt; double &gt; &amp;data, size_t first, size_t last)</div><div class="ttdoc">Add docfiledata to docfile. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l02112">ml_align2d.cpp:2112</a></div></div>
<div class="ttc" id="classMultidimArray_html_a048fe82e79de7fba796cd4e87869ef36"><div class="ttname"><a href="classMultidimArray.html#a048fe82e79de7fba796cd4e87869ef36">MultidimArray::resize</a></div><div class="ttdeci">void resize(size_t Ndim, size_t Zdim, size_t Ydim, size_t Xdim, bool copy=true)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l01562">multidim_array.h:1562</a></div></div>
<div class="ttc" id="group__Macros_html_gae0a4180e923e3ffca3989e20e441aa3c"><div class="ttname"><a href="group__Macros.html#gae0a4180e923e3ffca3989e20e441aa3c">XMIPP_MAX</a></div><div class="ttdeci">#define XMIPP_MAX(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00193">xmipp_macros.h:193</a></div></div>
<div class="ttc" id="ml__align2d_8cpp_html_a5a69a7732375f012c400341ac95d3bc2"><div class="ttname"><a href="ml__align2d_8cpp.html#a5a69a7732375f012c400341ac95d3bc2">FINAL_PREFIX</a></div><div class="ttdeci">#define FINAL_PREFIX</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l02160">ml_align2d.cpp:2160</a></div></div>
<div class="ttc" id="classProgML2D_html_a5ff1bd818e33945055fb5ed67379cacd"><div class="ttname"><a href="classProgML2D.html#a5ff1bd818e33945055fb5ed67379cacd">ProgML2D::barrier2</a></div><div class="ttdeci">barrier_t barrier2</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00068">ml_align2d.h:68</a></div></div>
<div class="ttc" id="classProgML2D_html_a89fc3cde7847bf0bb39ea52add1d4490"><div class="ttname"><a href="classProgML2D.html#a89fc3cde7847bf0bb39ea52add1d4490">ProgML2D::opt_scale</a></div><div class="ttdeci">double opt_scale</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00085">ml_align2d.h:85</a></div></div>
<div class="ttc" id="group__Images_html_gga61d23b393fdc35f2f0e30a1ed566c76da52fde2ebf77ef5a26e9e7722880039c8"><div class="ttname"><a href="group__Images.html#gga61d23b393fdc35f2f0e30a1ed566c76da52fde2ebf77ef5a26e9e7722880039c8">WRITE_REPLACE</a></div><div class="ttdef"><b>Definition:</b> <a href="xmipp__image__base_8h_source.html#l00068">xmipp_image_base.h:68</a></div></div>
<div class="ttc" id="group__ErrorHandling_html_ggab0df38968e4f03a3f1f6d6df0f31f45aa5bed3f42a08e195b307cf8622e913327"><div class="ttname"><a href="group__ErrorHandling.html#ggab0df38968e4f03a3f1f6d6df0f31f45aa5bed3f42a08e195b307cf8622e913327">ERR_NOT_IMPLEMENTED</a></div><div class="ttdoc">Case or algorithm not implemented yet. </div><div class="ttdef"><b>Definition:</b> <a href="xmipp__error_8h_source.html#l00182">xmipp_error.h:182</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga9cf9c3a95f2270982504fd5e40133864"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a></div><div class="ttdeci">#define A2D_ELEM(v, i, j)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00364">multidim_array.h:364</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a715ad0eb7ac0ce476faf1623fedea1a8"><div class="ttname"><a href="classML2DBaseProgram.html#a715ad0eb7ac0ce476faf1623fedea1a8">ML2DBaseProgram::nr_flip</a></div><div class="ttdeci">size_t nr_flip</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00156">ml2d.h:156</a></div></div>
<div class="ttc" id="namespacealglib_html_a0fe83df1d04b0270f8cfaf97114082ff"><div class="ttname"><a href="namespacealglib.html#a0fe83df1d04b0270f8cfaf97114082ff">alglib::conj</a></div><div class="ttdeci">alglib::complex conj(const alglib::complex &amp;z)</div><div class="ttdef"><b>Definition:</b> <a href="ap_8cpp_source.html#l04988">ap.cpp:4988</a></div></div>
<div class="ttc" id="classProgML2D_html_a44961c5dba5a171972ac35969663c398"><div class="ttname"><a href="classProgML2D.html#a44961c5dba5a171972ac35969663c398">ProgML2D::dLL</a></div><div class="ttdeci">double dLL</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00086">ml_align2d.h:86</a></div></div>
<div class="ttc" id="classXmippProgram_html_a552e1ea4a84576d9149b965d9edb6277"><div class="ttname"><a href="classXmippProgram.html#a552e1ea4a84576d9149b965d9edb6277">XmippProgram::getDoubleParam</a></div><div class="ttdeci">double getDoubleParam(const char *param, int arg=0)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8cpp_source.html#l00397">xmipp_program.cpp:397</a></div></div>
<div class="ttc" id="cuda__basic__math_8h_html_a2065eb145275f878c1d045c9f3fb1cc7"><div class="ttname"><a href="cuda__basic__math_8h.html#a2065eb145275f878c1d045c9f3fb1cc7">floor</a></div><div class="ttdeci">__host__ __device__ float2 floor(const float2 v)</div><div class="ttdef"><b>Definition:</b> <a href="cuda__basic__math_8h_source.html#l00175">cuda_basic_math.h:175</a></div></div>
<div class="ttc" id="classProgML2D_html_a6640cdcf273f2031dc8dc1e28de8b81f"><div class="ttname"><a href="classProgML2D.html#a6640cdcf273f2031dc8dc1e28de8b81f">ProgML2D::old_bgmean</a></div><div class="ttdeci">double old_bgmean</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00093">ml_align2d.h:93</a></div></div>
<div class="ttc" id="classMultidimArray_html"><div class="ttname"><a href="classMultidimArray.html">MultidimArray&lt; double &gt;</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_ab4ef26e8db432f9c366375915204f0d7"><div class="ttname"><a href="classML2DBaseProgram.html#ab4ef26e8db432f9c366375915204f0d7">ML2DBaseProgram::zero_offsets</a></div><div class="ttdeci">bool zero_offsets</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00186">ml2d.h:186</a></div></div>
<div class="ttc" id="classFourierTransformer_html_a1c8297f634bb4f9d1235f6c4fa33d7e5"><div class="ttname"><a href="classFourierTransformer.html#a1c8297f634bb4f9d1235f6c4fa33d7e5">FourierTransformer::inverseFourierTransform</a></div><div class="ttdeci">void inverseFourierTransform()</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__fftw_8cpp_source.html#l00329">xmipp_fftw.cpp:329</a></div></div>
<div class="ttc" id="classModelML2D_html_a4900080e2b29004e5044765fe76ee81b"><div class="ttname"><a href="classModelML2D.html#a4900080e2b29004e5044765fe76ee81b">ModelML2D::LL</a></div><div class="ttdeci">double LL</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00099">ml2d.h:99</a></div></div>
<div class="ttc" id="classProgML2D_html_abed951212bbcfa436954ad4f77575887"><div class="ttname"><a href="classProgML2D.html#abed951212bbcfa436954ad4f77575887">ProgML2D::wsum_sc</a></div><div class="ttdeci">double wsum_sc</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00093">ml_align2d.h:93</a></div></div>
<div class="ttc" id="classMetaData_html_a7c80f24121d6c01ff3c9ec939a17e542"><div class="ttname"><a href="classMetaData.html#a7c80f24121d6c01ff3c9ec939a17e542">MetaData::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdef"><b>Definition:</b> <a href="metadata_8cpp_source.html#l00131">metadata.cpp:131</a></div></div>
<div class="ttc" id="group__ErrorHandling_html_ga4ab7f9b2fd1ec4b9efcfba0c9b33052c"><div class="ttname"><a href="group__ErrorHandling.html#ga4ab7f9b2fd1ec4b9efcfba0c9b33052c">REPORT_ERROR</a></div><div class="ttdeci">#define REPORT_ERROR(nerr, ErrormMsg)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__error_8h_source.html#l00238">xmipp_error.h:238</a></div></div>
<div class="ttc" id="ml2d_8h_html_a63b804f3c807ffe0259b3ee45cb19693"><div class="ttname"><a href="ml2d_8h.html#a63b804f3c807ffe0259b3ee45cb19693">FOR_ALL_LOCAL_IMAGES</a></div><div class="ttdeci">#define FOR_ALL_LOCAL_IMAGES()</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00064">ml2d.h:64</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a20e2b948711e3e66894740b99e8cf017"><div class="ttname"><a href="classML2DBaseProgram.html#a20e2b948711e3e66894740b99e8cf017">ML2DBaseProgram::iter</a></div><div class="ttdeci">int iter</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00147">ml2d.h:147</a></div></div>
<div class="ttc" id="group__Masks_html_gadf8e3471e09288a8c320d1d900695c21"><div class="ttname"><a href="group__Masks.html#gadf8e3471e09288a8c320d1d900695c21">apply_binary_mask</a></div><div class="ttdeci">void apply_binary_mask(const MultidimArray&lt; int &gt; &amp;mask, const MultidimArray&lt; T &gt; &amp;m_in, MultidimArray&lt; T &gt; &amp;m_out, T subs_val=(T) 0)</div><div class="ttdef"><b>Definition:</b> <a href="mask_8h_source.html#l00862">mask.h:862</a></div></div>
<div class="ttc" id="classProgML2D_html_ad45f8eab09da7787c7e8e5e86883a40a"><div class="ttname"><a href="classProgML2D.html#ad45f8eab09da7787c7e8e5e86883a40a">ProgML2D::Mimg</a></div><div class="ttdeci">MultidimArray&lt; double &gt; Mimg</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00078">ml_align2d.h:78</a></div></div>
<div class="ttc" id="classProgML2D_html"><div class="ttname"><a href="classProgML2D.html">ProgML2D</a></div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00059">ml_align2d.h:59</a></div></div>
<div class="ttc" id="classProgML2D_html_a7932acbd1ae193f532fc47df46f3d775"><div class="ttname"><a href="classProgML2D.html#a7932acbd1ae193f532fc47df46f3d775">ProgML2D::sumw_mirror</a></div><div class="ttdeci">std::vector&lt; double &gt; sumw_mirror</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00075">ml_align2d.h:75</a></div></div>
<div class="ttc" id="group__Geometry_html_gac0a39b9536b704ecb1c9e44436796b2b"><div class="ttname"><a href="group__Geometry.html#gac0a39b9536b704ecb1c9e44436796b2b">Euler_direction</a></div><div class="ttdeci">void Euler_direction(double alpha, double beta, double gamma, Matrix1D&lt; double &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="geometry_8cpp_source.html#l00718">geometry.cpp:718</a></div></div>
<div class="ttc" id="classMultidimArray_html_ac0efebfb32ab4e37cf33efca3349aa9b"><div class="ttname"><a href="classMultidimArray.html#ac0efebfb32ab4e37cf33efca3349aa9b">MultidimArray::resizeNoCopy</a></div><div class="ttdeci">void resizeNoCopy(const MultidimArray&lt; T1 &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l01702">multidim_array.h:1702</a></div></div>
<div class="ttc" id="classProgML2D_html_a58c7e5ee272eb1e83531df902e67064d"><div class="ttname"><a href="classProgML2D.html#a58c7e5ee272eb1e83531df902e67064d">ProgML2D::sigdim</a></div><div class="ttdeci">size_t sigdim</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00095">ml_align2d.h:95</a></div></div>
<div class="ttc" id="classProgML2D_html_a4535601aac7b6d868dd078b14cf8e6e6"><div class="ttname"><a href="classProgML2D.html#a4535601aac7b6d868dd078b14cf8e6e6">ProgML2D::iopty_ref</a></div><div class="ttdeci">std::vector&lt; int &gt; iopty_ref</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00097">ml_align2d.h:97</a></div></div>
<div class="ttc" id="classProgML2D_html_a01d866b9a9c4b54dabe1b05266c3acd6"><div class="ttname"><a href="classProgML2D.html#a01d866b9a9c4b54dabe1b05266c3acd6">ProgML2D::pfs_mindiff</a></div><div class="ttdeci">double pfs_mindiff</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00099">ml_align2d.h:99</a></div></div>
<div class="ttc" id="classProgML2D_html_aacbe058d87287adbc0e5ee76f5ad317c"><div class="ttname"><a href="classProgML2D.html#aacbe058d87287adbc0e5ee76f5ad317c">ProgML2D::wsum_sigma_offset</a></div><div class="ttdeci">double wsum_sigma_offset</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00074">ml_align2d.h:74</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a394058da00920fa8e21edd9cf95cd49c"><div class="ttname"><a href="classML2DBaseProgram.html#a394058da00920fa8e21edd9cf95cd49c">ML2DBaseProgram::Mr2</a></div><div class="ttdeci">MultidimArray&lt; double &gt; Mr2</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00178">ml2d.h:178</a></div></div>
<div class="ttc" id="image__operate_8cpp_html_aba02a4405b44e10470c7af98477800a9"><div class="ttname"><a href="image__operate_8cpp.html#aba02a4405b44e10470c7af98477800a9">sqrt</a></div><div class="ttdeci">void sqrt(Image&lt; double &gt; &amp;op)</div><div class="ttdef"><b>Definition:</b> <a href="image__operate_8cpp_source.html#l00207">image_operate.cpp:207</a></div></div>
<div class="ttc" id="classProgML2D_html_a94e915acbf71212e430b234cdc5482b7"><div class="ttname"><a href="classProgML2D.html#a94e915acbf71212e430b234cdc5482b7">ProgML2D::ProgML2D</a></div><div class="ttdeci">ProgML2D()</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l00036">ml_align2d.cpp:36</a></div></div>
<div class="ttc" id="group__Masks_html_ga1f835f6611a65877b172c170a555f869"><div class="ttname"><a href="group__Masks.html#ga1f835f6611a65877b172c170a555f869">BinaryCircularMask</a></div><div class="ttdeci">void BinaryCircularMask(MultidimArray&lt; int &gt; &amp;mask, double radius, int mode, double x0, double y0, double z0)</div><div class="ttdef"><b>Definition:</b> <a href="mask_8cpp_source.html#l00189">mask.cpp:189</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a3db6d60cc8179ba2a57c55cf7d5ba362"><div class="ttname"><a href="classML2DBaseProgram.html#a3db6d60cc8179ba2a57c55cf7d5ba362">ML2DBaseProgram::current_block</a></div><div class="ttdeci">size_t current_block</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00229">ml2d.h:229</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a3169a7f52fce4768757155f99b12fa84"><div class="ttname"><a href="classML2DBaseProgram.html#a3169a7f52fce4768757155f99b12fa84">ML2DBaseProgram::dfsigma2</a></div><div class="ttdeci">double dfsigma2</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00204">ml2d.h:204</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78a94561c5c01993bb73d33426fdfcc9338"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a94561c5c01993bb73d33426fdfcc9338">MDL_SIGNALCHANGE</a></div><div class="ttdoc">Signal change for an image. </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00424">metadata_label.h:424</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a5578230b3fb9e054c437e187cb0ad5d3"><div class="ttname"><a href="classML2DBaseProgram.html#a5578230b3fb9e054c437e187cb0ad5d3">ML2DBaseProgram::model</a></div><div class="ttdeci">ModelML2D model</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00224">ml2d.h:224</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78ac15f836e18a2035d2923ecf76c6e8c7f"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78ac15f836e18a2035d2923ecf76c6e8c7f">MDL_ANGLE_TILT</a></div><div class="ttdoc">Tilting angle of an image (double,degrees) </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00060">metadata_label.h:60</a></div></div>
<div class="ttc" id="classProgML2D_html_a5c5cb7838e5d82a38634252e0a470b21"><div class="ttname"><a href="classProgML2D.html#a5c5cb7838e5d82a38634252e0a470b21">ProgML2D::createThreads</a></div><div class="ttdeci">void createThreads()</div><div class="ttdoc">Create working threads. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l00929">ml_align2d.cpp:929</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_ad919bbce6f061400a0bc5231a9cd1621"><div class="ttname"><a href="numerical__recipes_8cpp.html#ad919bbce6f061400a0bc5231a9cd1621">y</a></div><div class="ttdeci">static double * y</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l08506">numerical_recipes.cpp:8506</a></div></div>
<div class="ttc" id="classProgML2D_html_a9d11e4c518188bc47da9cfe4094871db"><div class="ttname"><a href="classProgML2D.html#a9d11e4c518188bc47da9cfe4094871db">ProgML2D::ioptx_ref</a></div><div class="ttdeci">std::vector&lt; int &gt; ioptx_ref</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00097">ml_align2d.h:97</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a6f89b87041906702ae5c30638bd2762c"><div class="ttname"><a href="classML2DBaseProgram.html#a6f89b87041906702ae5c30638bd2762c">ML2DBaseProgram::fix_fractions</a></div><div class="ttdeci">bool fix_fractions</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00139">ml2d.h:139</a></div></div>
<div class="ttc" id="classProgML2D_html_a9218f5deb288c01f5fdb02d56ed9ccbe"><div class="ttname"><a href="classProgML2D.html#a9218f5deb288c01f5fdb02d56ed9ccbe">ProgML2D::sum_refw</a></div><div class="ttdeci">double sum_refw</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00092">ml_align2d.h:92</a></div></div>
<div class="ttc" id="ml2d_8h_html_a66509066803c374815e854e570539582"><div class="ttname"><a href="ml2d_8h.html#a66509066803c374815e854e570539582">IMG_BLOCK</a></div><div class="ttdeci">#define IMG_BLOCK(imgno)</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00069">ml2d.h:69</a></div></div>
<div class="ttc" id="classProgML2D_html_ae91cfc8d366159cc5479418582e9825c"><div class="ttname"><a href="classProgML2D.html#ae91cfc8d366159cc5479418582e9825c">ProgML2D::wsum_corr</a></div><div class="ttdeci">double wsum_corr</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00092">ml_align2d.h:92</a></div></div>
<div class="ttc" id="classModelML2D_html_a975642ba000f15ba72f4a5c833205f92"><div class="ttname"><a href="classModelML2D.html#a975642ba000f15ba72f4a5c833205f92">ModelML2D::dim</a></div><div class="ttdeci">int dim</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00102">ml2d.h:102</a></div></div>
<div class="ttc" id="classProgML2D_html_a1be87962ea76cdc3641b99d8e4d6c4eb"><div class="ttname"><a href="classProgML2D.html#a1be87962ea76cdc3641b99d8e4d6c4eb">ProgML2D::iopt_flip</a></div><div class="ttdeci">int iopt_flip</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00084">ml_align2d.h:84</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78acb3aa7acca32f4524608635e2e09650e"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78acb3aa7acca32f4524608635e2e09650e">MDL_SHIFT_X</a></div><div class="ttdoc">Shift for the image in the X axis (double) </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00412">metadata_label.h:412</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a90f80f69b900eb15f9300560d50286ca"><div class="ttname"><a href="classML2DBaseProgram.html#a90f80f69b900eb15f9300560d50286ca">ML2DBaseProgram::average_scale</a></div><div class="ttdeci">double average_scale</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00213">ml2d.h:213</a></div></div>
<div class="ttc" id="group__GeometricalTransformations_html_ga3cc15e5dda7c58b9cacb7eee440d6bdc"><div class="ttname"><a href="group__GeometricalTransformations.html#ga3cc15e5dda7c58b9cacb7eee440d6bdc">applyGeometry</a></div><div class="ttdeci">void applyGeometry(int SplineDegree, MultidimArray&lt; std::complex&lt; double &gt; &gt; &amp;V2, const MultidimArray&lt; std::complex&lt; double &gt; &gt; &amp;V1, const Matrix2D&lt; double &gt; &amp;A, bool inv, bool wrap, std::complex&lt; double &gt; outside, MultidimArray&lt; double &gt; *BcoeffsPtr)</div><div class="ttdef"><b>Definition:</b> <a href="transformations_8cpp_source.html#l00517">transformations.cpp:517</a></div></div>
<div class="ttc" id="ml2d_8h_html_adab00b234e73d15cf164c0cc7de93d34a5a2bb3ae4005099790c981dd00c7403b"><div class="ttname"><a href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34a5a2bb3ae4005099790c981dd00c7403b">TH_RRR_REFNO</a></div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00074">ml2d.h:74</a></div></div>
<div class="ttc" id="classXmippProgram_html_aea0549c1e40215ee12b1abc36648b39a"><div class="ttname"><a href="classXmippProgram.html#aea0549c1e40215ee12b1abc36648b39a">XmippProgram::initProgress</a></div><div class="ttdeci">void initProgress(size_t total, size_t stepBin=60)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8cpp_source.html#l00307">xmipp_program.cpp:307</a></div></div>
<div class="ttc" id="classImageBase_html_ae81a8c11a832924c2bda0909882c3168"><div class="ttname"><a href="classImageBase.html#ae81a8c11a832924c2bda0909882c3168">ImageBase::write</a></div><div class="ttdeci">void write(const FileName &amp;name=&quot;&quot;, size_t select_img=ALL_IMAGES, bool isStack=false, int mode=WRITE_OVERWRITE, CastWriteMode castMode=CW_CAST, int _swapWrite=0)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__image__base_8cpp_source.html#l00210">xmipp_image_base.cpp:210</a></div></div>
<div class="ttc" id="classProgML2D_html_adbc31a919b1e6b554a3201ad8aca9fec"><div class="ttname"><a href="classProgML2D.html#adbc31a919b1e6b554a3201ad8aca9fec">ProgML2D::readParams</a></div><div class="ttdeci">void readParams()</div><div class="ttdoc">Read arguments from command line. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l00073">ml_align2d.cpp:73</a></div></div>
<div class="ttc" id="classProgML2D_html_a1df4cb7668c8de81e5f012be633c4b10"><div class="ttname"><a href="classProgML2D.html#a1df4cb7668c8de81e5f012be633c4b10">ProgML2D::fref</a></div><div class="ttdeci">std::vector&lt; MultidimArray&lt; std::complex&lt; double &gt; &gt; &gt; fref</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00082">ml_align2d.h:82</a></div></div>
<div class="ttc" id="group__MetaDataExtension_html_gac0be4f4f5a50390ff4939b437170e700"><div class="ttname"><a href="group__MetaDataExtension.html#gac0be4f4f5a50390ff4939b437170e700">getImageSize</a></div><div class="ttdeci">void getImageSize(const MetaData &amp;md, size_t &amp;Xdim, size_t &amp;Ydim, size_t &amp;Zdim, size_t &amp;Ndim, MDLabel image_label)</div><div class="ttdef"><b>Definition:</b> <a href="metadata__extension_8cpp_source.html#l00260">metadata_extension.cpp:260</a></div></div>
<div class="ttc" id="classModelML2D_html_a2b62f72135dd8b84c77a5c26203c7e19"><div class="ttname"><a href="classModelML2D.html#a2b62f72135dd8b84c77a5c26203c7e19">ModelML2D::do_student_sigma_trick</a></div><div class="ttdeci">bool do_student_sigma_trick</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00104">ml2d.h:104</a></div></div>
<div class="ttc" id="classMetaData_html_a01b7a1fe1f922a26349b10901ad6a3d2"><div class="ttname"><a href="classMetaData.html#a01b7a1fe1f922a26349b10901ad6a3d2">MetaData::unionAll</a></div><div class="ttdeci">void unionAll(const MetaData &amp;mdIn)</div><div class="ttdef"><b>Definition:</b> <a href="metadata_8cpp_source.html#l02063">metadata.cpp:2063</a></div></div>
<div class="ttc" id="group__Masks_html_gacca4111ca94cf58386ec048e31865962"><div class="ttname"><a href="group__Masks.html#gacca4111ca94cf58386ec048e31865962">INNER_MASK</a></div><div class="ttdeci">#define INNER_MASK</div><div class="ttdef"><b>Definition:</b> <a href="mask_8h_source.html#l00052">mask.h:52</a></div></div>
<div class="ttc" id="group__Fourier_html_ga615e066e3016d55d63fd5f9b5cb4836b"><div class="ttname"><a href="group__Fourier.html#ga615e066e3016d55d63fd5f9b5cb4836b">centerFFT2</a></div><div class="ttdeci">void centerFFT2(MultidimArray&lt; double &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__fft_8cpp_source.html#l00276">xmipp_fft.cpp:276</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a3c0b6cb5428a40ae95864f5c45c50940"><div class="ttname"><a href="classML2DBaseProgram.html#a3c0b6cb5428a40ae95864f5c45c50940">ML2DBaseProgram::myLastImg</a></div><div class="ttdeci">size_t myLastImg</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00168">ml2d.h:168</a></div></div>
<div class="ttc" id="ml2d_8h_html_a108b3141800d641ccdbab77acd07a7e1"><div class="ttname"><a href="ml2d_8h.html#a108b3141800d641ccdbab77acd07a7e1">FN_LOGS_MD</a></div><div class="ttdeci">#define FN_LOGS_MD(base)</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00056">ml2d.h:56</a></div></div>
<div class="ttc" id="ml2d_8h_html_adab00b234e73d15cf164c0cc7de93d34ada8af5b01ff37af5c23dedecb93d25c0"><div class="ttname"><a href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34ada8af5b01ff37af5c23dedecb93d25c0">TH_ESI_UPDATE_REFNO</a></div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00074">ml2d.h:74</a></div></div>
<div class="ttc" id="classProgML2D_html_a329b42f3d96b8366df10fa3bf093ac7d"><div class="ttname"><a href="classProgML2D.html#a329b42f3d96b8366df10fa3bf093ac7d">ProgML2D::maximization</a></div><div class="ttdeci">virtual void maximization()</div><div class="ttdoc">Update all model parameters, adapted for IEM blocks use. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l02015">ml_align2d.cpp:2015</a></div></div>
<div class="ttc" id="classModelML2D_html_aae60b45954a007f5f9b95ae73c637205"><div class="ttname"><a href="classModelML2D.html#aae60b45954a007f5f9b95ae73c637205">ModelML2D::mirror_fraction</a></div><div class="ttdeci">std::vector&lt; double &gt; mirror_fraction</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00093">ml2d.h:93</a></div></div>
<div class="ttc" id="classFileName_html_ab10d5ada0f956aef14ae171f12587d56"><div class="ttname"><a href="classFileName.html#ab10d5ada0f956aef14ae171f12587d56">FileName::compose</a></div><div class="ttdeci">void compose(const String &amp;str, const size_t no, const String &amp;ext=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__filename_8cpp_source.html#l00049">xmipp_filename.cpp:49</a></div></div>
<div class="ttc" id="classProgML2D_html_ad9f83e25ef28d8febe54e4930ce418a5"><div class="ttname"><a href="classProgML2D.html#ad9f83e25ef28d8febe54e4930ce418a5">ProgML2D::doThreadExpectationSingleImageRefno</a></div><div class="ttdeci">void doThreadExpectationSingleImageRefno()</div><div class="ttdoc">Thread code to parallelize refno loop in expectationSingleImage. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l01287">ml_align2d.cpp:1287</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78a114e3414dd216e4308946a016b5cc46f"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a114e3414dd216e4308946a016b5cc46f">MDL_ANGLE_PSI</a></div><div class="ttdoc">Special label to be used when gathering MDs in MpiMetadataPrograms. </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00054">metadata_label.h:54</a></div></div>
<div class="ttc" id="classMultidimArray_html_a239f45b043ed7715dec4d44ceef74dce"><div class="ttname"><a href="classMultidimArray.html#a239f45b043ed7715dec4d44ceef74dce">MultidimArray::initConstant</a></div><div class="ttdeci">void initConstant(T val)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l04309">multidim_array.h:4309</a></div></div>
<div class="ttc" id="classMetaData_html"><div class="ttname"><a href="classMetaData.html">MetaData</a></div><div class="ttdef"><b>Definition:</b> <a href="metadata_8h_source.html#l00234">metadata.h:234</a></div></div>
<div class="ttc" id="transformations_8h_html_a43c1de45dbd91827a260224c9c40221b"><div class="ttname"><a href="transformations_8h.html#a43c1de45dbd91827a260224c9c40221b">WRAP</a></div><div class="ttdeci">#define WRAP</div><div class="ttdef"><b>Definition:</b> <a href="transformations_8h_source.html#l00043">transformations.h:43</a></div></div>
<div class="ttc" id="classMDValueEQ_html"><div class="ttname"><a href="classMDValueEQ.html">MDValueEQ</a></div><div class="ttdef"><b>Definition:</b> <a href="metadata__sql_8h_source.html#l00464">metadata_sql.h:464</a></div></div>
<div class="ttc" id="classModelML2D_html_ab68333f3574c0098dd6caf51cfefc571"><div class="ttname"><a href="classModelML2D.html#ab68333f3574c0098dd6caf51cfefc571">ModelML2D::substractModel</a></div><div class="ttdeci">void substractModel(const ModelML2D &amp;model)</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8cpp_source.html#l00408">ml2d.cpp:408</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a4e593a9112ddcc0256bc9b72213cdb3b"><div class="ttname"><a href="classML2DBaseProgram.html#a4e593a9112ddcc0256bc9b72213cdb3b">ML2DBaseProgram::fn_img</a></div><div class="ttdeci">FileName fn_img</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00132">ml2d.h:132</a></div></div>
<div class="ttc" id="classModelML2D_html_a63a3a3534d1cb72a9db046508b9a59f6"><div class="ttname"><a href="classModelML2D.html#a63a3a3534d1cb72a9db046508b9a59f6">ModelML2D::n_ref</a></div><div class="ttdeci">int n_ref</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00083">ml2d.h:83</a></div></div>
<div class="ttc" id="classProgML2D_html_ad2908f9cced8aa5456025a8dcda6e6f1"><div class="ttname"><a href="classProgML2D.html#ad2908f9cced8aa5456025a8dcda6e6f1">ProgML2D::omask</a></div><div class="ttdeci">MultidimArray&lt; int &gt; omask</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00065">ml_align2d.h:65</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_aae259850c9b209a3ff3cbcc7799e2742"><div class="ttname"><a href="classML2DBaseProgram.html#aae259850c9b209a3ff3cbcc7799e2742">ML2DBaseProgram::psi_step</a></div><div class="ttdeci">double psi_step</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00158">ml2d.h:158</a></div></div>
<div class="ttc" id="classMatrix1D_html_a4afb1b4e8a8132a53b985e5fa7da6e30"><div class="ttname"><a href="classMatrix1D.html#a4afb1b4e8a8132a53b985e5fa7da6e30">Matrix1D::selfNormalize</a></div><div class="ttdeci">void selfNormalize()</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l01595">matrix1d.h:1595</a></div></div>
<div class="ttc" id="ml2d_8h_html_a4e0517338e6c4a31a2addafc06d4f3a3"><div class="ttname"><a href="ml2d_8h.html#a4e0517338e6c4a31a2addafc06d4f3a3">OutputType</a></div><div class="ttdeci">OutputType</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00076">ml2d.h:76</a></div></div>
<div class="ttc" id="classMetaData_html_ab7f8d43d77647ade923e6cd63eafdd03"><div class="ttname"><a href="classMetaData.html#ab7f8d43d77647ade923e6cd63eafdd03">MetaData::read</a></div><div class="ttdeci">void read(const FileName &amp;inFile, const std::vector&lt; MDLabel &gt; *desiredLabels=NULL, bool decomposeStack=true)</div><div class="ttdef"><b>Definition:</b> <a href="metadata_8cpp_source.html#l01447">metadata.cpp:1447</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78af25c0f56fca98fcdd37f613ba2c61de3"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78af25c0f56fca98fcdd37f613ba2c61de3">MDL_WROBUST</a></div><div class="ttdoc">Weight of t-student distribution in robust Maximum likelihood. </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00460">metadata_label.h:460</a></div></div>
<div class="ttc" id="classProgML2D_html_a0a5dc92e82fd69f9058becc96b9066b2"><div class="ttname"><a href="classProgML2D.html#a0a5dc92e82fd69f9058becc96b9066b2">ProgML2D::destroyThreads</a></div><div class="ttdeci">void destroyThreads()</div><div class="ttdoc">Exit threads and free memory. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l00958">ml_align2d.cpp:958</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78aae8fbada7502a20a4d465a68f27848ac"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78aae8fbada7502a20a4d465a68f27848ac">MDL_BGMEAN</a></div><div class="ttdoc">Mean background value for an image. </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00075">metadata_label.h:75</a></div></div>
<div class="ttc" id="ml2d_8h_html_adab00b234e73d15cf164c0cc7de93d34"><div class="ttname"><a href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34">ThreadTask</a></div><div class="ttdeci">ThreadTask</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00074">ml2d.h:74</a></div></div>
<div class="ttc" id="classModelML2D_html_aa1c0b1d7d95d9939d5cdb9ee4c923006"><div class="ttname"><a href="classModelML2D.html#aa1c0b1d7d95d9939d5cdb9ee4c923006">ModelML2D::setNRef</a></div><div class="ttdeci">void setNRef(int n_ref)</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8cpp_source.html#l00341">ml2d.cpp:341</a></div></div>
<div class="ttc" id="classProgML2D_html_ad72b32e1b0e8d1038ca0b96165ac3868"><div class="ttname"><a href="classProgML2D.html#ad72b32e1b0e8d1038ca0b96165ac3868">ProgML2D::produceSideInfo2</a></div><div class="ttdeci">virtual void produceSideInfo2()</div><div class="ttdoc">Try to merge produceSideInfo1 and 2. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l00355">ml_align2d.cpp:355</a></div></div>
<div class="ttc" id="classProgML2D_html_acc9ce2f79942c7bb7ac5edf22a7b8826"><div class="ttname"><a href="classProgML2D.html#acc9ce2f79942c7bb7ac5edf22a7b8826">ProgML2D::threads_d</a></div><div class="ttdeci">structThreadTasks * threads_d</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00070">ml_align2d.h:70</a></div></div>
<div class="ttc" id="classProgML2D_html_a54ffedea6c7c61f2e1ae50052dc07ce6"><div class="ttname"><a href="classProgML2D.html#a54ffedea6c7c61f2e1ae50052dc07ce6">ProgML2D::readModel</a></div><div class="ttdeci">virtual void readModel(ModelML2D &amp;model, int block)</div><div class="ttdoc">Read model from file. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l02330">ml_align2d.cpp:2330</a></div></div>
<div class="ttc" id="classProgML2D_html_aafe0bad5c89da244357a8a98000c7179"><div class="ttname"><a href="classProgML2D.html#aafe0bad5c89da244357a8a98000c7179">ProgML2D::pfs_count</a></div><div class="ttdeci">int pfs_count</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00102">ml_align2d.h:102</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a90e6ce499655b4566e17e32102a905c4"><div class="ttname"><a href="classML2DBaseProgram.html#a90e6ce499655b4566e17e32102a905c4">ML2DBaseProgram::hdim</a></div><div class="ttdeci">size_t hdim</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00151">ml2d.h:151</a></div></div>
<div class="ttc" id="classMetaData_html_acd6018636eda733443f3df6c61978faa"><div class="ttname"><a href="classMetaData.html#acd6018636eda733443f3df6c61978faa">MetaData::addObject</a></div><div class="ttdeci">size_t addObject()</div><div class="ttdef"><b>Definition:</b> <a href="metadata_8cpp_source.html#l00750">metadata.cpp:750</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_adfab8933f95443ac6d909a9b206b3fa8"><div class="ttname"><a href="classML2DBaseProgram.html#adfab8933f95443ac6d909a9b206b3fa8">ML2DBaseProgram::fn_root</a></div><div class="ttdeci">FileName fn_root</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00132">ml2d.h:132</a></div></div>
<div class="ttc" id="ml__align2d_8cpp_html_a943995a7bf30da3587664920856533ab"><div class="ttname"><a href="ml__align2d_8cpp.html#a943995a7bf30da3587664920856533ab">MAX_WEIGHT</a></div><div class="ttdeci">#define MAX_WEIGHT</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l01163">ml_align2d.cpp:1163</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a2ab21717291173f3155a2e4006137167"><div class="ttname"><a href="classML2DBaseProgram.html#a2ab21717291173f3155a2e4006137167">ML2DBaseProgram::psi_max</a></div><div class="ttdeci">double psi_max</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00160">ml2d.h:160</a></div></div>
<div class="ttc" id="ml2d_8h_html_adab00b234e73d15cf164c0cc7de93d34a392205928268f198ad445de1e9924612"><div class="ttname"><a href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34a392205928268f198ad445de1e9924612">TH_RR_REFNO</a></div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00074">ml2d.h:74</a></div></div>
<div class="ttc" id="ml__align2d_8cpp_html_ac2523bb35f42a8e134775400b70ae47d"><div class="ttname"><a href="ml__align2d_8cpp.html#ac2523bb35f42a8e134775400b70ae47d">WEIGHT</a></div><div class="ttdeci">#define WEIGHT</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l01162">ml_align2d.cpp:1162</a></div></div>
<div class="ttc" id="classProgML2D_html_a2725bcb11d4abfd956448b2384ec9dfe"><div class="ttname"><a href="classProgML2D.html#a2725bcb11d4abfd956448b2384ec9dfe">ProgML2D::Fimg_flip</a></div><div class="ttdeci">std::vector&lt; MultidimArray&lt; std::complex&lt; double &gt; &gt; &gt; Fimg_flip</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00090">ml_align2d.h:90</a></div></div>
<div class="ttc" id="classProgML2D_html_a3fdd8612a9d5a2e5e687fa33b0925f27"><div class="ttname"><a href="classProgML2D.html#a3fdd8612a9d5a2e5e687fa33b0925f27">ProgML2D::barrier</a></div><div class="ttdeci">barrier_t barrier</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00068">ml_align2d.h:68</a></div></div>
<div class="ttc" id="ml2d_8h_html_a6b49ded9ade4e2a8b65b16670db60486"><div class="ttname"><a href="ml2d_8h.html#a6b49ded9ade4e2a8b65b16670db60486">SMALLANGLE</a></div><div class="ttdeci">#define SMALLANGLE</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00049">ml2d.h:49</a></div></div>
<div class="ttc" id="classProgML2D_html_aee7b9878dfa5d8e714e00b6f4c91e845"><div class="ttname"><a href="classProgML2D.html#aee7b9878dfa5d8e714e00b6f4c91e845">ProgML2D::expectation</a></div><div class="ttdeci">virtual void expectation()</div><div class="ttdoc">Integrate over all experimental images. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l01705">ml_align2d.cpp:1705</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a8c1341b893fa1371ebf8fea3255d3e41"><div class="ttname"><a href="classML2DBaseProgram.html#a8c1341b893fa1371ebf8fea3255d3e41">ML2DBaseProgram::defineAdditionalParams</a></div><div class="ttdeci">virtual void defineAdditionalParams(XmippProgram *prog, const char *sectionLine)</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8cpp_source.html#l00265">ml2d.cpp:265</a></div></div>
<div class="ttc" id="classXmippProgram_html_aef9f1a6f495c898cb12eac9a7922a84c"><div class="ttname"><a href="classXmippProgram.html#aef9f1a6f495c898cb12eac9a7922a84c">XmippProgram::endProgress</a></div><div class="ttdeci">void endProgress()</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8cpp_source.html#l00327">xmipp_program.cpp:327</a></div></div>
<div class="ttc" id="classProgML2D_html_a60a40d22a1ca28a0ff4af54f0c83af08"><div class="ttname"><a href="classProgML2D.html#a60a40d22a1ca28a0ff4af54f0c83af08">ProgML2D::sumfracweight</a></div><div class="ttdeci">double sumfracweight</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00073">ml_align2d.h:73</a></div></div>
<div class="ttc" id="classFileName_html"><div class="ttname"><a href="classFileName.html">FileName</a></div><div class="ttdef"><b>Definition:</b> <a href="xmipp__filename_8h_source.html#l00068">xmipp_filename.h:68</a></div></div>
<div class="ttc" id="ml2d_8h_html_a8ef0c472d79a03426c3c02f8777ef3c3"><div class="ttname"><a href="ml2d_8h.html#a8ef0c472d79a03426c3c02f8777ef3c3">FN_CLASSES_MD</a></div><div class="ttdeci">#define FN_CLASSES_MD(base)</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00055">ml2d.h:55</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_ab81d9253b246f09be9999505d515d517"><div class="ttname"><a href="numerical__recipes_8cpp.html#ab81d9253b246f09be9999505d515d517">x</a></div><div class="ttdeci">doublereal * x</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02247">numerical_recipes.cpp:2247</a></div></div>
<div class="ttc" id="classModelML2D_html_a4254afe4781725aea4fce57e60a29ac4"><div class="ttname"><a href="classModelML2D.html#a4254afe4781725aea4fce57e60a29ac4">ModelML2D::update</a></div><div class="ttdeci">void update()</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8cpp_source.html#l00413">ml2d.cpp:413</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">#define i</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02510">numerical_recipes.cpp:2510</a></div></div>
<div class="ttc" id="classProgML2D_html_a9dd356894e80f8d88e81c6ae6315afcf"><div class="ttname"><a href="classProgML2D.html#a9dd356894e80f8d88e81c6ae6315afcf">ProgML2D::refno_index</a></div><div class="ttdeci">size_t refno_index</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00110">ml_align2d.h:110</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78adc4c6714fd11379df071ebe8a442c30d"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78adc4c6714fd11379df071ebe8a442c30d">MDL_ENABLED</a></div><div class="ttdoc">Is this image enabled? (int [-1 or 1]) </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00226">metadata_label.h:226</a></div></div>
<div class="ttc" id="classification_2pca_8cpp_html_ae5e08c2a7a15204653d0fdaabbc890ac"><div class="ttname"><a href="classification_2pca_8cpp.html#ae5e08c2a7a15204653d0fdaabbc890ac">rotate</a></div><div class="ttdeci">#define rotate(a, i, j, k, l)</div></div>
<div class="ttc" id="group__Masks_html_ga5bd552c32d3d6b6abd6ddf18677cf647"><div class="ttname"><a href="group__Masks.html#ga5bd552c32d3d6b6abd6ddf18677cf647">computeStats_within_binary_mask</a></div><div class="ttdeci">void computeStats_within_binary_mask(const MultidimArray&lt; T1 &gt; &amp;mask, const MultidimArray&lt; T &gt; &amp;m, double &amp;min_val, double &amp;max_val, double &amp;avg, double &amp;stddev)</div><div class="ttdef"><b>Definition:</b> <a href="mask_8h_source.html#l00804">mask.h:804</a></div></div>
<div class="ttc" id="classProgML2D_html_ae750407f07cf8ad2b23ff8a7ef640e5e"><div class="ttname"><a href="classProgML2D.html#ae750407f07cf8ad2b23ff8a7ef640e5e">ProgML2D::mygroup</a></div><div class="ttdeci">int mygroup</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00113">ml_align2d.h:113</a></div></div>
<div class="ttc" id="ml2d_8h_html_a5c733b69a54d6f6997b09d41b77ec37f"><div class="ttname"><a href="ml2d_8h.html#a5c733b69a54d6f6997b09d41b77ec37f">IMG_LOCAL_INDEX</a></div><div class="ttdeci">#define IMG_LOCAL_INDEX</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00067">ml2d.h:67</a></div></div>
<div class="ttc" id="classMultidimArrayBase_html_a0d4d898ee3a033a6f050cbdc3806b8fb"><div class="ttname"><a href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">MultidimArrayBase::setXmippOrigin</a></div><div class="ttdeci">void setXmippOrigin()</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8cpp_source.html#l00197">multidim_array.cpp:197</a></div></div>
<div class="ttc" id="classXmippProgram_html_a78cb844dedc5e8f4de8320c9a7c8d0a2"><div class="ttname"><a href="classXmippProgram.html#a78cb844dedc5e8f4de8320c9a7c8d0a2">XmippProgram::addSeeAlsoLine</a></div><div class="ttdeci">void addSeeAlsoLine(const char *seeAlso)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8cpp_source.html#l00346">xmipp_program.cpp:346</a></div></div>
<div class="ttc" id="group__GeneralFunctions_html_ga194d394b419778ebd11c83b43a213310"><div class="ttname"><a href="group__GeneralFunctions.html#ga194d394b419778ebd11c83b43a213310">divide_equally_group</a></div><div class="ttdeci">size_t divide_equally_group(size_t N, size_t size, size_t myself)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__funcs_8cpp_source.html#l01160">xmipp_funcs.cpp:1160</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_aca81c35c21e3a5f7f3a8d24504e76664"><div class="ttname"><a href="numerical__recipes_8cpp.html#aca81c35c21e3a5f7f3a8d24504e76664">theta</a></div><div class="ttdeci">double theta</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l06233">numerical_recipes.cpp:6233</a></div></div>
<div class="ttc" id="classProgML2D_html_a529bf5af816c32545f791c54b0d656eb"><div class="ttname"><a href="classProgML2D.html#a529bf5af816c32545f791c54b0d656eb">ProgML2D::ioptflip_ref</a></div><div class="ttdeci">std::vector&lt; int &gt; ioptflip_ref</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00097">ml_align2d.h:97</a></div></div>
<div class="ttc" id="classProgML2D_html_af4bf8cc040f12a2a38d278a0539117cf"><div class="ttname"><a href="classProgML2D.html#af4bf8cc040f12a2a38d278a0539117cf">ProgML2D::barrier3</a></div><div class="ttdeci">barrier_t barrier3</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00068">ml_align2d.h:68</a></div></div>
<div class="ttc" id="classFourierTransformer_html"><div class="ttname"><a href="classFourierTransformer.html">FourierTransformer</a></div><div class="ttdef"><b>Definition:</b> <a href="xmipp__fftw_8h_source.html#l00060">xmipp_fftw.h:60</a></div></div>
<div class="ttc" id="group__Matrices_html_gab40746be05d4bbf352787018922ecc2e"><div class="ttname"><a href="group__Matrices.html#gab40746be05d4bbf352787018922ecc2e">MAT_ELEM</a></div><div class="ttdeci">#define MAT_ELEM(m, i, j)</div><div class="ttdef"><b>Definition:</b> <a href="matrix2d_8h_source.html#l00117">matrix2d.h:117</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a5597237821521e53baea8549f16a8d55"><div class="ttname"><a href="classML2DBaseProgram.html#a5597237821521e53baea8549f16a8d55">ML2DBaseProgram::save_mem2</a></div><div class="ttdeci">bool save_mem2</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00192">ml2d.h:192</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a963af5cdb6f63d876c147c24fbf8452e"><div class="ttname"><a href="classML2DBaseProgram.html#a963af5cdb6f63d876c147c24fbf8452e">ML2DBaseProgram::do_ML3D</a></div><div class="ttdeci">bool do_ML3D</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00196">ml2d.h:196</a></div></div>
<div class="ttc" id="classMetaData_html_a2239fbb7e492654f1e2866ab27492a5d"><div class="ttname"><a href="classMetaData.html#a2239fbb7e492654f1e2866ab27492a5d">MetaData::getValue</a></div><div class="ttdeci">bool getValue(MDObject &amp;mdValueOut, size_t id) const </div><div class="ttdef"><b>Definition:</b> <a href="metadata_8cpp_source.html#l00217">metadata.cpp:217</a></div></div>
<div class="ttc" id="classProgML2D_html_ad26cadbfd0dfbaab4b1c19a5f2c9c939"><div class="ttname"><a href="classProgML2D.html#ad26cadbfd0dfbaab4b1c19a5f2c9c939">ProgML2D::LL</a></div><div class="ttdeci">double LL</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00073">ml_align2d.h:73</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_ac53bad3c2339d92ebbda4ba5abe7aa57"><div class="ttname"><a href="classML2DBaseProgram.html#ac53bad3c2339d92ebbda4ba5abe7aa57">ML2DBaseProgram::nr_images_local</a></div><div class="ttdeci">size_t nr_images_local</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00166">ml2d.h:166</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_acaec38248b66cfba849985072bd311f6"><div class="ttname"><a href="numerical__recipes_8cpp.html#acaec38248b66cfba849985072bd311f6">first</a></div><div class="ttdeci">glob_log first</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l05218">numerical_recipes.cpp:5218</a></div></div>
<div class="ttc" id="classXmippProgram_html_a8659f9e603143c1788360f0eeb01e589"><div class="ttname"><a href="classXmippProgram.html#a8659f9e603143c1788360f0eeb01e589">XmippProgram::argc</a></div><div class="ttdeci">int argc</div><div class="ttdoc">Original command line arguments. </div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8h_source.html#l00095">xmipp_program.h:95</a></div></div>
<div class="ttc" id="ml__align2d_8h_html_ad12cf04e6cd4aa26363fd70ae35905ed"><div class="ttname"><a href="ml__align2d_8h.html#ad12cf04e6cd4aa26363fd70ae35905ed">FOR_ALL_THREAD_REFNO</a></div><div class="ttdeci">#define FOR_ALL_THREAD_REFNO()</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00033">ml_align2d.h:33</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a4ca3328df09f636935d22b5b946a3704"><div class="ttname"><a href="classML2DBaseProgram.html#a4ca3328df09f636935d22b5b946a3704">ML2DBaseProgram::search_rot</a></div><div class="ttdeci">double search_rot</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00190">ml2d.h:190</a></div></div>
<div class="ttc" id="classProgML2D_html_a982205d6bc2ceb791f1abd3fbb1388bf"><div class="ttname"><a href="classProgML2D.html#a982205d6bc2ceb791f1abd3fbb1388bf">ProgML2D::ioptx</a></div><div class="ttdeci">int ioptx</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00096">ml_align2d.h:96</a></div></div>
<div class="ttc" id="classProgML2D_html_a2eddbf01d350e8ab9974d5e1654f383a"><div class="ttname"><a href="classProgML2D.html#a2eddbf01d350e8ab9974d5e1654f383a">ProgML2D::wsumimgs</a></div><div class="ttdeci">std::vector&lt; MultidimArray&lt; std::complex&lt; double &gt; &gt; &gt; wsumimgs</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00083">ml_align2d.h:83</a></div></div>
<div class="ttc" id="classProgML2D_html_a1ae2970adffcee179223e27c6b8f7c5e"><div class="ttname"><a href="classProgML2D.html#a1ae2970adffcee179223e27c6b8f7c5e">ProgML2D::doThreadRotateReferenceRefno</a></div><div class="ttdeci">void doThreadRotateReferenceRefno()</div><div class="ttdoc">Thread code to parallelize refno loop in rotateReference. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l01058">ml_align2d.cpp:1058</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a549ca4cda193eb449087f9a316c61f20"><div class="ttname"><a href="classML2DBaseProgram.html#a549ca4cda193eb449087f9a316c61f20">ML2DBaseProgram::limit_rot</a></div><div class="ttdeci">bool limit_rot</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00188">ml2d.h:188</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a791b7cb014db4297f7772becd1daa287"><div class="ttname"><a href="classML2DBaseProgram.html#a791b7cb014db4297f7772becd1daa287">ML2DBaseProgram::myFirstImg</a></div><div class="ttdeci">size_t myFirstImg</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00168">ml2d.h:168</a></div></div>
<div class="ttc" id="classModelML2D_html_acbf810e559c0ac21117558f703b603ff"><div class="ttname"><a href="classModelML2D.html#acbf810e559c0ac21117558f703b603ff">ModelML2D::print</a></div><div class="ttdeci">void print(int tabs=0) const </div><div class="ttdoc">Just for debugging now. </div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8cpp_source.html#l00474">ml2d.cpp:474</a></div></div>
<div class="ttc" id="image__operate_8cpp_html_a0994f8f1ab050711112683b89fb90b0b"><div class="ttname"><a href="image__operate_8cpp.html#a0994f8f1ab050711112683b89fb90b0b">log</a></div><div class="ttdeci">void log(Image&lt; double &gt; &amp;op)</div><div class="ttdef"><b>Definition:</b> <a href="image__operate_8cpp_source.html#l00225">image_operate.cpp:225</a></div></div>
<div class="ttc" id="group__Arguments_html_ga42227a0d5306b2b82e58b1952ab35976"><div class="ttname"><a href="group__Arguments.html#ga42227a0d5306b2b82e58b1952ab35976">getParameter</a></div><div class="ttdeci">const char * getParameter(int argc, const char **argv, const char *param, const char *option)</div><div class="ttdef"><b>Definition:</b> <a href="args_8cpp_source.html#l00030">args.cpp:30</a></div></div>
<div class="ttc" id="classProgML2D_html_a990c57b68223b7deafe042cb9cd2efa8"><div class="ttname"><a href="classProgML2D.html#a990c57b68223b7deafe042cb9cd2efa8">ProgML2D::mindiff</a></div><div class="ttdeci">double mindiff</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00094">ml_align2d.h:94</a></div></div>
<div class="ttc" id="classXmippProgram_html_a5d9e1f008822effa47814c59e9a3c797"><div class="ttname"><a href="classXmippProgram.html#a5d9e1f008822effa47814c59e9a3c797">XmippProgram::getParam</a></div><div class="ttdeci">const char * getParam(const char *param, int arg=0)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8cpp_source.html#l00377">xmipp_program.cpp:377</a></div></div>
<div class="ttc" id="classProgML2D_html_aafc61ce3cafabb12bbad05faf3f4b46e"><div class="ttname"><a href="classProgML2D.html#aafc61ce3cafabb12bbad05faf3f4b46e">ProgML2D::refno_load</a></div><div class="ttdeci">int refno_load</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00111">ml_align2d.h:111</a></div></div>
<div class="ttc" id="classFourierTransformer_html_a18bc840c781555b742d0185fb20925bf"><div class="ttname"><a href="classFourierTransformer.html#a18bc840c781555b742d0185fb20925bf">FourierTransformer::setReal</a></div><div class="ttdeci">void setReal(MultidimArray&lt; double &gt; &amp;img)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__fftw_8cpp_source.html#l00129">xmipp_fftw.cpp:129</a></div></div>
<div class="ttc" id="classProgML2D_html_aef35426c0860ea497a0fc71c9eb2bcbf"><div class="ttname"><a href="classProgML2D.html#aef35426c0860ea497a0fc71c9eb2bcbf">ProgML2D::bgmean</a></div><div class="ttdeci">double bgmean</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00085">ml_align2d.h:85</a></div></div>
<div class="ttc" id="classProgML2D_html_a89e864cc35899d6440890ad75efcbc1b"><div class="ttname"><a href="classProgML2D.html#a89e864cc35899d6440890ad75efcbc1b">ProgML2D::sumw</a></div><div class="ttdeci">std::vector&lt; double &gt; sumw</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00075">ml_align2d.h:75</a></div></div>
<div class="ttc" id="classProgML2D_html_a33abac49bbbe75a56fd9ac1a928151a1"><div class="ttname"><a href="classProgML2D.html#a33abac49bbbe75a56fd9ac1a928151a1">ProgML2D::doThreadReverseRotateReferenceRefno</a></div><div class="ttdeci">void doThreadReverseRotateReferenceRefno()</div><div class="ttdoc">Thread code to parallelize refno loop in reverseRotateReference. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l01119">ml_align2d.cpp:1119</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_ad2289c67cc7ca1c54d70d173b37d8820"><div class="ttname"><a href="numerical__recipes_8cpp.html#ad2289c67cc7ca1c54d70d173b37d8820">index</a></div><div class="ttdeci">viol index</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l05214">numerical_recipes.cpp:5214</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_ae0d684b9bbe78bfa5ed5ad2610dc4fbe"><div class="ttname"><a href="classML2DBaseProgram.html#ae0d684b9bbe78bfa5ed5ad2610dc4fbe">ML2DBaseProgram::imgs_oldtheta</a></div><div class="ttdeci">std::vector&lt; double &gt; imgs_oldtheta</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00194">ml2d.h:194</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga7fa7d580ab43d192c7933abd008bc756"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a></div><div class="ttdeci">#define FOR_ALL_ELEMENTS_IN_ARRAY2D(m)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00400">multidim_array.h:400</a></div></div>
<div class="ttc" id="classProgML2D_html_a2a7c59d85856b342e74ffd326e1a5765"><div class="ttname"><a href="classProgML2D.html#a2a7c59d85856b342e74ffd326e1a5765">ProgML2D::opt_refno</a></div><div class="ttdeci">int opt_refno</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00084">ml_align2d.h:84</a></div></div>
<div class="ttc" id="group__Macros_html_ga4ec18a98c812ab4d498c8111c193aa17"><div class="ttname"><a href="group__Macros.html#ga4ec18a98c812ab4d498c8111c193aa17">CEIL</a></div><div class="ttdeci">#define CEIL(x)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00225">xmipp_macros.h:225</a></div></div>
<div class="ttc" id="classProgML2D_html_a7a34a95a363891be46e76baa27975ce9"><div class="ttname"><a href="classProgML2D.html#a7a34a95a363891be46e76baa27975ce9">ProgML2D::maximizeModel</a></div><div class="ttdeci">void maximizeModel(ModelML2D &amp;model)</div><div class="ttdoc">Update all model parameters. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l01925">ml_align2d.cpp:1925</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a08dc75912c3b5bf4be88e88a81cf23fa"><div class="ttname"><a href="classML2DBaseProgram.html#a08dc75912c3b5bf4be88e88a81cf23fa">ML2DBaseProgram::initSamplingStuff</a></div><div class="ttdeci">void initSamplingStuff()</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8cpp_source.html#l00043">ml2d.cpp:43</a></div></div>
<div class="ttc" id="classMetaData_html_ad844b6a5655be4205e4bb03ab6372562"><div class="ttname"><a href="classMetaData.html#ad844b6a5655be4205e4bb03ab6372562">MetaData::size</a></div><div class="ttdeci">size_t size() const </div><div class="ttdef"><b>Definition:</b> <a href="metadata_8cpp_source.html#l00702">metadata.cpp:702</a></div></div>
<div class="ttc" id="classProgML2D_html_a8056b29f3479fde75215466ab904f6bd"><div class="ttname"><a href="classProgML2D.html#a8056b29f3479fde75215466ab904f6bd">ProgML2D::trymindiff</a></div><div class="ttdeci">double trymindiff</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00085">ml_align2d.h:85</a></div></div>
<div class="ttc" id="classProgML2D_html_aeba68b5ab11453cdd8685b63eb122628"><div class="ttname"><a href="classProgML2D.html#aeba68b5ab11453cdd8685b63eb122628">ProgML2D::wsum_sigma_noise</a></div><div class="ttdeci">double wsum_sigma_noise</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00074">ml_align2d.h:74</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_ac20210a2ca026ff1831be53bd25fe561"><div class="ttname"><a href="classML2DBaseProgram.html#ac20210a2ca026ff1831be53bd25fe561">ML2DBaseProgram::defineBasicParams</a></div><div class="ttdeci">virtual void defineBasicParams(XmippProgram *prog)</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8cpp_source.html#l00225">ml2d.cpp:225</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a879e423db0331279b0421e881b73be57"><div class="ttname"><a href="classML2DBaseProgram.html#a879e423db0331279b0421e881b73be57">ML2DBaseProgram::F</a></div><div class="ttdeci">std::vector&lt; Matrix2D&lt; double &gt; &gt; F</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00174">ml2d.h:174</a></div></div>
<div class="ttc" id="classProgML2D_html_a44b08930042f8d64a74eb588f6401408"><div class="ttname"><a href="classProgML2D.html#a44b08930042f8d64a74eb588f6401408">ProgML2D::preselectFastSignificant</a></div><div class="ttdeci">void preselectFastSignificant()</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l00674">ml_align2d.cpp:674</a></div></div>
<div class="ttc" id="ml__align2d_8h_html_a72aa83bdfba00606d1d7db206111a5a9"><div class="ttname"><a href="ml__align2d_8h.html#a72aa83bdfba00606d1d7db206111a5a9">SPECIAL_ITER</a></div><div class="ttdeci">#define SPECIAL_ITER</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00051">ml_align2d.h:51</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78af6495a877b8c80b9c45b8156b406b183"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78af6495a877b8c80b9c45b8156b406b183">MDL_FLIP</a></div><div class="ttdoc">Flip the image? (bool) </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00231">metadata_label.h:231</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a027f02ad68a63785c0ef49fa1b9db759"><div class="ttname"><a href="classML2DBaseProgram.html#a027f02ad68a63785c0ef49fa1b9db759">ML2DBaseProgram::Niter</a></div><div class="ttdeci">int Niter</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00149">ml2d.h:149</a></div></div>
<div class="ttc" id="classModelML2D_html_a33e5549c691cfd65ca3480f4388b577f"><div class="ttname"><a href="classModelML2D.html#a33e5549c691cfd65ca3480f4388b577f">ModelML2D::sumw_allrefs</a></div><div class="ttdeci">double sumw_allrefs</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00095">ml2d.h:95</a></div></div>
<div class="ttc" id="group__MLalign2D_html_ga37dd4c436766acd586ca95f773236000"><div class="ttname"><a href="group__MLalign2D.html#ga37dd4c436766acd586ca95f773236000">getIterExtraPath</a></div><div class="ttdeci">FileName getIterExtraPath(const FileName &amp;fn_root, int iter, bool makePath)</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8cpp_source.html#l00304">ml2d.cpp:304</a></div></div>
<div class="ttc" id="classProgML2D_html_a40a5d7f99135a4219f867273e3a704fe"><div class="ttname"><a href="classProgML2D.html#a40a5d7f99135a4219f867273e3a704fe">ProgML2D::iopt_psi</a></div><div class="ttdeci">int iopt_psi</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00084">ml_align2d.h:84</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a4f7d61fca21cd29df3119a200b9a4bd3"><div class="ttname"><a href="classML2DBaseProgram.html#a4f7d61fca21cd29df3119a200b9a4bd3">ML2DBaseProgram::do_restart</a></div><div class="ttdeci">bool do_restart</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00236">ml2d.h:236</a></div></div>
<div class="ttc" id="classProgML2D_html_ae0c18214588873b98a6ea20daabdd924"><div class="ttname"><a href="classProgML2D.html#ae0c18214588873b98a6ea20daabdd924">ProgML2D::refw_mirror</a></div><div class="ttdeci">std::vector&lt; double &gt; refw_mirror</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00091">ml_align2d.h:91</a></div></div>
<div class="ttc" id="classModelML2D_html_a5b67cc654d1cbdbd89e72251cf8a7110"><div class="ttname"><a href="classModelML2D.html#a5b67cc654d1cbdbd89e72251cf8a7110">ModelML2D::wsum_sigma_offset</a></div><div class="ttdeci">double wsum_sigma_offset</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00089">ml2d.h:89</a></div></div>
<div class="ttc" id="group__MetaData_html_ga85652b971edca3acc93a9f1bef2f17f6"><div class="ttname"><a href="group__MetaData.html#ga85652b971edca3acc93a9f1bef2f17f6">FOR_ALL_OBJECTS_IN_METADATA</a></div><div class="ttdeci">#define FOR_ALL_OBJECTS_IN_METADATA(__md)</div><div class="ttdef"><b>Definition:</b> <a href="metadata_8h_source.html#l00081">metadata.h:81</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78ad8a81df6271e91f540f943bf8ef0d192"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78ad8a81df6271e91f540f943bf8ef0d192">MDL_PMAX</a></div><div class="ttdoc">Maximum value of normalized probability function (now called &quot;Pmax/sumP&quot;) (double) ...</div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00338">metadata_label.h:338</a></div></div>
<div class="ttc" id="ml2d_8h_html_adab00b234e73d15cf164c0cc7de93d34a0baa34fa9ce901319175045df8e1aa0f"><div class="ttname"><a href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34a0baa34fa9ce901319175045df8e1aa0f">TH_ESI_REFNO</a></div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00074">ml2d.h:74</a></div></div>
<div class="ttc" id="transformations_8h_html_a855436c9d0ed5174df8917d5239d7597"><div class="ttname"><a href="transformations_8h.html#a855436c9d0ed5174df8917d5239d7597">IS_INV</a></div><div class="ttdeci">#define IS_INV</div><div class="ttdef"><b>Definition:</b> <a href="transformations_8h_source.html#l00040">transformations.h:40</a></div></div>
<div class="ttc" id="classModelML2D_html_a0645b5054c9b62af329b87f79ad256d8"><div class="ttname"><a href="classModelML2D.html#a0645b5054c9b62af329b87f79ad256d8">ModelML2D::sumw_allrefs2</a></div><div class="ttdeci">double sumw_allrefs2</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00095">ml2d.h:95</a></div></div>
<div class="ttc" id="image__operate_8cpp_html_ac5474a01d203d14c046620266b2f1954"><div class="ttname"><a href="image__operate_8cpp.html#ac5474a01d203d14c046620266b2f1954">max</a></div><div class="ttdeci">void max(Image&lt; double &gt; &amp;op1, const Image&lt; double &gt; &amp;op2)</div><div class="ttdef"><b>Definition:</b> <a href="image__operate_8cpp_source.html#l00125">image_operate.cpp:125</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a0ddfa227d1aec7fcfd31cb2c23ec3d0f"><div class="ttname"><a href="classML2DBaseProgram.html#a0ddfa227d1aec7fcfd31cb2c23ec3d0f">ML2DBaseProgram::docfiledata</a></div><div class="ttdeci">MultidimArray&lt; double &gt; docfiledata</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00234">ml2d.h:234</a></div></div>
<div class="ttc" id="ml2d_8h_html_a5478fca9f7c1fc0b3c861cee24fa73a6"><div class="ttname"><a href="ml2d_8h.html#a5478fca9f7c1fc0b3c861cee24fa73a6">FN_CLASS_IMAGES_MD</a></div><div class="ttdeci">#define FN_CLASS_IMAGES_MD(base, ref)</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00057">ml2d.h:57</a></div></div>
<div class="ttc" id="classXmippProgram_html_af2f60708934c302e1289c5405109dd45"><div class="ttname"><a href="classXmippProgram.html#af2f60708934c302e1289c5405109dd45">XmippProgram::argv</a></div><div class="ttdeci">const char ** argv</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8h_source.html#l00096">xmipp_program.h:96</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a0bff1f1ebc6ee583b1b6f4f2d55ec3ae"><div class="ttname"><a href="classML2DBaseProgram.html#a0bff1f1ebc6ee583b1b6f4f2d55ec3ae">ML2DBaseProgram::trymindiff_factor</a></div><div class="ttdeci">double trymindiff_factor</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00202">ml2d.h:202</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78af9ccf0b3cc12d07722d11549151d21f0"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78af9ccf0b3cc12d07722d11549151d21f0">MDL_SIGMANOISE</a></div><div class="ttdoc">Standard deviation of the noise in ML model. </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00422">metadata_label.h:422</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_adb224115e7f853ead371caf7a3767fa4"><div class="ttname"><a href="classML2DBaseProgram.html#adb224115e7f853ead371caf7a3767fa4">ML2DBaseProgram::imgs_offsets</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; double &gt; &gt; imgs_offsets</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00200">ml2d.h:200</a></div></div>
<div class="ttc" id="ml__align2d_8cpp_html_afed153190a447433ca6679468f1cb504"><div class="ttname"><a href="ml__align2d_8cpp.html#afed153190a447433ca6679468f1cb504">ITER_PREFIX</a></div><div class="ttdeci">#define ITER_PREFIX</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l02159">ml_align2d.cpp:2159</a></div></div>
<div class="ttc" id="group__GeometricalTransformations_html_gac645eb9a88619ee6f5e14c557ab8ef62"><div class="ttname"><a href="group__GeometricalTransformations.html#gac645eb9a88619ee6f5e14c557ab8ef62">LINEAR</a></div><div class="ttdeci">#define LINEAR</div><div class="ttdef"><b>Definition:</b> <a href="transformations_8h_source.html#l00208">transformations.h:208</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_gafa02b309a507bf04daf9f31fa828ce4f"><div class="ttname"><a href="group__MultidimensionalArrays.html#gafa02b309a507bf04daf9f31fa828ce4f">dAij</a></div><div class="ttdeci">#define dAij(M, i, j)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00355">multidim_array.h:355</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a495926025de4de5360efd7266377cc2c"><div class="ttname"><a href="classML2DBaseProgram.html#a495926025de4de5360efd7266377cc2c">ML2DBaseProgram::istart</a></div><div class="ttdeci">int istart</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00145">ml2d.h:145</a></div></div>
<div class="ttc" id="group__Macros_html_ga996f7be338ccb40d1a2a5abc1ad61759"><div class="ttname"><a href="group__Macros.html#ga996f7be338ccb40d1a2a5abc1ad61759">ABS</a></div><div class="ttdeci">#define ABS(x)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00142">xmipp_macros.h:142</a></div></div>
<div class="ttc" id="group__MetaData_html_ggaf446b6aff4a8c034231bfa3e1484bc47ae658bd63b5c203ea5e350a42881a57ca"><div class="ttname"><a href="group__MetaData.html#ggaf446b6aff4a8c034231bfa3e1484bc47ae658bd63b5c203ea5e350a42881a57ca">MD_APPEND</a></div><div class="ttdef"><b>Definition:</b> <a href="metadata_8h_source.html#l00060">metadata.h:60</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a8671946de2e241de54a47e2822989ca1"><div class="ttname"><a href="classML2DBaseProgram.html#a8671946de2e241de54a47e2822989ca1">ML2DBaseProgram::df</a></div><div class="ttdeci">double df</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00204">ml2d.h:204</a></div></div>
<div class="ttc" id="classProgML2D_html_a03314f1aa1a39bb98bdb0873d7eef331"><div class="ttname"><a href="classProgML2D.html#a03314f1aa1a39bb98bdb0873d7eef331">ProgML2D::defineParams</a></div><div class="ttdeci">void defineParams()</div><div class="ttdoc">Params definition. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l00043">ml_align2d.cpp:43</a></div></div>
<div class="ttc" id="ml__align2d_8cpp_html_aa5a923caf811bcd65e2b95bce6a609e4"><div class="ttname"><a href="ml__align2d_8cpp.html#aa5a923caf811bcd65e2b95bce6a609e4">MSIGNIFICANT</a></div><div class="ttdeci">#define MSIGNIFICANT</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l01164">ml_align2d.cpp:1164</a></div></div>
<div class="ttc" id="classXmippProgram_html_a4b8f0a6e1bd09e4dbf56a412101e905e"><div class="ttname"><a href="classXmippProgram.html#a4b8f0a6e1bd09e4dbf56a412101e905e">XmippProgram::addExampleLine</a></div><div class="ttdeci">void addExampleLine(const char *example, bool verbatim=true)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8cpp_source.html#l00342">xmipp_program.cpp:342</a></div></div>
<div class="ttc" id="group__Macros_html_gacd66e8cacf954c3bc3bba81d09425a12"><div class="ttname"><a href="group__Macros.html#gacd66e8cacf954c3bc3bba81d09425a12">ROUND</a></div><div class="ttdeci">#define ROUND(x)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00210">xmipp_macros.h:210</a></div></div>
<div class="ttc" id="classModelML2D_html_a9623e75d2dcf944d1fa02a53fe851cd0"><div class="ttname"><a href="classModelML2D.html#a9623e75d2dcf944d1fa02a53fe851cd0">ModelML2D::alpha_k</a></div><div class="ttdeci">std::vector&lt; double &gt; alpha_k</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00093">ml2d.h:93</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78a29c393fe6e00aa337783865f8694b0af"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a29c393fe6e00aa337783865f8694b0af">MDL_INTSCALE</a></div><div class="ttdoc">Intensity scale for an image. </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00249">metadata_label.h:249</a></div></div>
<div class="ttc" id="classProgML2D_html_adfb316a4df09eaf3a645d97e49f102f4"><div class="ttname"><a href="classProgML2D.html#adfb316a4df09eaf3a645d97e49f102f4">ProgML2D::wsum_sc2</a></div><div class="ttdeci">double wsum_sc2</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00093">ml_align2d.h:93</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_ae96de19117479eb8bf594268bb9af590"><div class="ttname"><a href="classML2DBaseProgram.html#ae96de19117479eb8bf594268bb9af590">ML2DBaseProgram::dim</a></div><div class="ttdeci">size_t dim</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00151">ml2d.h:151</a></div></div>
<div class="ttc" id="classModelML2D_html_ab7380ee8c8f0621acf0c49b43c0e0578"><div class="ttname"><a href="classModelML2D.html#ab7380ee8c8f0621acf0c49b43c0e0578">ModelML2D::avePmax</a></div><div class="ttdeci">double avePmax</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00097">ml2d.h:97</a></div></div>
<div class="ttc" id="classProgML2D_html_a665c986d28b896e593f1623b7389dc03"><div class="ttname"><a href="classProgML2D.html#a665c986d28b896e593f1623b7389dc03">ProgML2D::Xi2</a></div><div class="ttdeci">double Xi2</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00107">ml_align2d.h:107</a></div></div>
<div class="ttc" id="classProgML2D_html_a571bb2f7bac698c48cfbea17c9c12170"><div class="ttname"><a href="classProgML2D.html#a571bb2f7bac698c48cfbea17c9c12170">ProgML2D::maxweight2</a></div><div class="ttdeci">double maxweight2</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00086">ml_align2d.h:86</a></div></div>
<div class="ttc" id="structstructThreadTasks_html_ad02867e5644724dbb49bf0dcf0bd5901"><div class="ttname"><a href="structstructThreadTasks.html#ad02867e5644724dbb49bf0dcf0bd5901">structThreadTasks::thread_id</a></div><div class="ttdeci">int thread_id</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00046">ml_align2d.h:46</a></div></div>
<div class="ttc" id="group__GeometricalTransformations_html_gab8a49d8335f45ebd2ba7d86d98322bc0"><div class="ttname"><a href="group__GeometricalTransformations.html#gab8a49d8335f45ebd2ba7d86d98322bc0">BSPLINE3</a></div><div class="ttdeci">#define BSPLINE3</div><div class="ttdef"><b>Definition:</b> <a href="transformations_8h_source.html#l00210">transformations.h:210</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a4908e05cb99ce92314917225f524ac6c"><div class="ttname"><a href="classML2DBaseProgram.html#a4908e05cb99ce92314917225f524ac6c">ML2DBaseProgram::factor_nref</a></div><div class="ttdeci">int factor_nref</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00215">ml2d.h:215</a></div></div>
<div class="ttc" id="classXmippProgram_html_aed62cfe3c074e69076bf348fc101a717"><div class="ttname"><a href="classXmippProgram.html#aed62cfe3c074e69076bf348fc101a717">XmippProgram::verbose</a></div><div class="ttdeci">int verbose</div><div class="ttdoc">Verbosity level. </div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8h_source.html#l00168">xmipp_program.h:168</a></div></div>
<div class="ttc" id="ml__align2d_8h_html_a6e103bfffafe8ad89cbaf0d80a01cc96"><div class="ttname"><a href="ml__align2d_8h.html#a6e103bfffafe8ad89cbaf0d80a01cc96">FOR_ALL_THREAD_REFNO_NODECL</a></div><div class="ttdeci">#define FOR_ALL_THREAD_REFNO_NODECL()</div><div class="ttdoc">Same macro as before, but without declaring refno and load. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00038">ml_align2d.h:38</a></div></div>
<div class="ttc" id="classProgML2D_html_aebc66055676b2ac6f6f0995eaefb0efb"><div class="ttname"><a href="classProgML2D.html#aebc66055676b2ac6f6f0995eaefb0efb">ProgML2D::refno_count</a></div><div class="ttdeci">int refno_count</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00111">ml_align2d.h:111</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a2d817d670cd567d427da30fad46f5592"><div class="ttname"><a href="classML2DBaseProgram.html#a2d817d670cd567d427da30fad46f5592">ML2DBaseProgram::imgs_oldphi</a></div><div class="ttdeci">std::vector&lt; double &gt; imgs_oldphi</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00194">ml2d.h:194</a></div></div>
<div class="ttc" id="ml__align2d_8cpp_html_a911e59592bd1aa3d7f6bf57b60af5a0e"><div class="ttname"><a href="ml__align2d_8cpp.html#a911e59592bd1aa3d7f6bf57b60af5a0e">IIFLIP</a></div><div class="ttdeci">#define IIFLIP</div><div class="ttdoc">Some macro definitions for the following function. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l01159">ml_align2d.cpp:1159</a></div></div>
<div class="ttc" id="classProgML2D_html_a161f40ee3ca8ea86269a02026cda6040"><div class="ttname"><a href="classProgML2D.html#a161f40ee3ca8ea86269a02026cda6040">ProgML2D::A2</a></div><div class="ttdeci">std::vector&lt; double &gt; A2</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00105">ml_align2d.h:105</a></div></div>
<div class="ttc" id="classMetaData_html_a1a76384897857d639447524ff2f14ab3"><div class="ttname"><a href="classMetaData.html#a1a76384897857d639447524ff2f14ab3">MetaData::findObjects</a></div><div class="ttdeci">void findObjects(std::vector&lt; size_t &gt; &amp;objectsOut, const MDQuery &amp;query) const </div><div class="ttdef"><b>Definition:</b> <a href="metadata_8cpp_source.html#l00868">metadata.cpp:868</a></div></div>
<div class="ttc" id="classProgML2D_html_abeb29fd2474be31882bf38ba7d1ddb02"><div class="ttname"><a href="classProgML2D.html#abeb29fd2474be31882bf38ba7d1ddb02">ProgML2D::doThreadPreselectFastSignificantRefno</a></div><div class="ttdeci">void doThreadPreselectFastSignificantRefno()</div><div class="ttdoc">Thread code to parallelize refno loop in preselectFastSignificant. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l01166">ml_align2d.cpp:1166</a></div></div>
<div class="ttc" id="classFourierTransformer_html_abfdc5699d3c579a26bba39ec679b5adc"><div class="ttname"><a href="classFourierTransformer.html#abfdc5699d3c579a26bba39ec679b5adc">FourierTransformer::FourierTransform</a></div><div class="ttdeci">void FourierTransform(T &amp;v, T1 &amp;V, bool getCopy=true)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__fftw_8h_source.html#l00166">xmipp_fftw.h:166</a></div></div>
<div class="ttc" id="classProgML2D_html_a06a09c39a7e10416a588d9cacb42fb87"><div class="ttname"><a href="classProgML2D.html#a06a09c39a7e10416a588d9cacb42fb87">ProgML2D::writeOutputFiles</a></div><div class="ttdeci">virtual void writeOutputFiles(const ModelML2D &amp;model, OutputType outputType=OUT_FINAL)</div><div class="ttdoc">Write model parameters. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l02163">ml_align2d.cpp:2163</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a2d35db214957b6a4d00b411e8a63a554"><div class="ttname"><a href="classML2DBaseProgram.html#a2d35db214957b6a4d00b411e8a63a554">ML2DBaseProgram::imgs_optrefno</a></div><div class="ttdeci">std::vector&lt; int &gt; imgs_optrefno</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00211">ml2d.h:211</a></div></div>
<div class="ttc" id="group__Macros_html_gac9ae6a207f10c821b06a8c0df153a7d5"><div class="ttname"><a href="group__Macros.html#gac9ae6a207f10c821b06a8c0df153a7d5">XMIPP_MIN</a></div><div class="ttdeci">#define XMIPP_MIN(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00181">xmipp_macros.h:181</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a5bfd3f7250efeda01483917e5382b857"><div class="ttname"><a href="classML2DBaseProgram.html#a5bfd3f7250efeda01483917e5382b857">ML2DBaseProgram::defineHiddenParams</a></div><div class="ttdeci">virtual void defineHiddenParams(XmippProgram *prog)</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8cpp_source.html#l00289">ml2d.cpp:289</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78a44d2f7bdda1efb37f9218b2ac4eb8a2c"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a44d2f7bdda1efb37f9218b2ac4eb8a2c">MDL_SIGMAOFFSET</a></div><div class="ttdoc">Standard deviation of the offsets in ML model. </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00423">metadata_label.h:423</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a4646a8113c64d86101389cb4f373bca3"><div class="ttname"><a href="classML2DBaseProgram.html#a4646a8113c64d86101389cb4f373bca3">ML2DBaseProgram::fix_sigma_noise</a></div><div class="ttdeci">bool fix_sigma_noise</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00143">ml2d.h:143</a></div></div>
<div class="ttc" id="classProgML2D_html_af3ba3c5330db20cf897a5b83ce26ff69"><div class="ttname"><a href="classProgML2D.html#af3ba3c5330db20cf897a5b83ce26ff69">ProgML2D::pdf_directions</a></div><div class="ttdeci">std::vector&lt; double &gt; pdf_directions</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00080">ml_align2d.h:80</a></div></div>
<div class="ttc" id="classProgML2D_html_a1a99543c55fc5620370113ded2ae8301"><div class="ttname"><a href="classProgML2D.html#a1a99543c55fc5620370113ded2ae8301">ProgML2D::sumwsc2</a></div><div class="ttdeci">std::vector&lt; double &gt; sumwsc2</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00075">ml_align2d.h:75</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_aae82a1338cf72eb9a1cc7043f569537e"><div class="ttname"><a href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a></div><div class="ttdeci">#define j</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02510">numerical_recipes.cpp:2510</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78a1ffc2c5a3f3bfe6187db33cc1859aa9f"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a1ffc2c5a3f3bfe6187db33cc1859aa9f">MDL_REF3D</a></div><div class="ttdoc">3D Class to which the image belongs (int) </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00362">metadata_label.h:362</a></div></div>
<div class="ttc" id="classProgML2D_html_a8408a3dd090f5a67ffb34a209d48ce02"><div class="ttname"><a href="classProgML2D.html#a8408a3dd090f5a67ffb34a209d48ce02">ProgML2D::mask</a></div><div class="ttdeci">MultidimArray&lt; int &gt; mask</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00065">ml_align2d.h:65</a></div></div>
<div class="ttc" id="classProgML2D_html_a709602bc38cda149337eb088b00bcdca"><div class="ttname"><a href="classProgML2D.html#a709602bc38cda149337eb088b00bcdca">ProgML2D::refwsc2</a></div><div class="ttdeci">std::vector&lt; double &gt; refwsc2</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00091">ml_align2d.h:91</a></div></div>
<div class="ttc" id="classProgML2D_html_a4bafa5bbd30eedca53d94d6317be28ef"><div class="ttname"><a href="classProgML2D.html#a4bafa5bbd30eedca53d94d6317be28ef">ProgML2D::sum_refw2</a></div><div class="ttdeci">double sum_refw2</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00092">ml_align2d.h:92</a></div></div>
<div class="ttc" id="classXmippProgram_html_a0130b89f1f5431b03ef161d7e231bd48"><div class="ttname"><a href="classXmippProgram.html#a0130b89f1f5431b03ef161d7e231bd48">XmippProgram::debug</a></div><div class="ttdeci">int debug</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8h_source.html#l00170">xmipp_program.h:170</a></div></div>
<div class="ttc" id="classProgML2D_html_af1c07651bc4491471be58d1e3cf11413"><div class="ttname"><a href="classProgML2D.html#af1c07651bc4491471be58d1e3cf11413">ProgML2D::wsum_offset</a></div><div class="ttdeci">double wsum_offset</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00093">ml_align2d.h:93</a></div></div>
<div class="ttc" id="ml__align2d_8h_html"><div class="ttname"><a href="ml__align2d_8h.html">ml_align2d.h</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a3106e12c5756e90d770df3708307258d"><div class="ttname"><a href="classML2DBaseProgram.html#a3106e12c5756e90d770df3708307258d">ML2DBaseProgram::df2</a></div><div class="ttdeci">double df2</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00204">ml2d.h:204</a></div></div>
<div class="ttc" id="classProgML2D_html_a28206f5adc9ded7be742b51a9fa39c18"><div class="ttname"><a href="classProgML2D.html#a28206f5adc9ded7be742b51a9fa39c18">ProgML2D::mref</a></div><div class="ttdeci">std::vector&lt; MultidimArray&lt; double &gt; &gt; mref</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00081">ml_align2d.h:81</a></div></div>
<div class="ttc" id="group__ErrorHandling_html_ggab0df38968e4f03a3f1f6d6df0f31f45aa6183f94fdaa94dc490d796dad0814b78"><div class="ttname"><a href="group__ErrorHandling.html#ggab0df38968e4f03a3f1f6d6df0f31f45aa6183f94fdaa94dc490d796dad0814b78">ERR_THREADS_NOTINIT</a></div><div class="ttdoc">Threads cannot be initiated. </div><div class="ttdef"><b>Definition:</b> <a href="xmipp__error_8h_source.html#l00193">xmipp_error.h:193</a></div></div>
<div class="ttc" id="classImageBase_html_a8ea0cabc10eb710a8a997aa19bfb71a1"><div class="ttname"><a href="classImageBase.html#a8ea0cabc10eb710a8a997aa19bfb71a1">ImageBase::setEulerAngles</a></div><div class="ttdeci">void setEulerAngles(double rot, double tilt, double psi, const size_t n=0)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__image__base_8cpp_source.html#l00427">xmipp_image_base.cpp:427</a></div></div>
<div class="ttc" id="classProgML2D_html_a3ee54e92214ba139048b67204d33812a"><div class="ttname"><a href="classProgML2D.html#a3ee54e92214ba139048b67204d33812a">ProgML2D::allref_offsets</a></div><div class="ttdeci">std::vector&lt; double &gt; allref_offsets</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00079">ml_align2d.h:79</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a1b904ff65f4ee4b5bbcfd31f79753b5f"><div class="ttname"><a href="classML2DBaseProgram.html#a1b904ff65f4ee4b5bbcfd31f79753b5f">ML2DBaseProgram::fn_scratch</a></div><div class="ttdeci">FileName fn_scratch</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00132">ml2d.h:132</a></div></div>
<div class="ttc" id="classProgML2D_html_ae0bda101c64aff966641b35d19c6f910"><div class="ttname"><a href="classProgML2D.html#ae0bda101c64aff966641b35d19c6f910">ProgML2D::refw2</a></div><div class="ttdeci">std::vector&lt; double &gt; refw2</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00091">ml_align2d.h:91</a></div></div>
<div class="ttc" id="classMetaData_html_adf4ee2ad1ad0964990a8a11a2109d578"><div class="ttname"><a href="classMetaData.html#adf4ee2ad1ad0964990a8a11a2109d578">MetaData::setValue</a></div><div class="ttdeci">bool setValue(const MDLabel label, const T &amp;valueIn, size_t id)</div><div class="ttdef"><b>Definition:</b> <a href="metadata_8h_source.html#l00550">metadata.h:550</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78a3637da3214664c45458ae3e56a92c88e"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a3637da3214664c45458ae3e56a92c88e">MDL_REF</a></div><div class="ttdoc">Class to which the image belongs (int) </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00363">metadata_label.h:363</a></div></div>
<div class="ttc" id="ml__align2d_8cpp_html_ad7ec30f41bf25bb8e5554d39539ea758"><div class="ttname"><a href="ml__align2d_8cpp.html#ad7ec30f41bf25bb8e5554d39539ea758">ASSIGN</a></div><div class="ttdeci">#define ASSIGN(var)</div></div>
<div class="ttc" id="mpi__write__test_8cpp_html_a158a8c64f24645c7478298399825737f"><div class="ttname"><a href="mpi__write__test_8cpp.html#a158a8c64f24645c7478298399825737f">LOG</a></div><div class="ttdeci">#define LOG(msg)</div><div class="ttdef"><b>Definition:</b> <a href="mpi__write__test_8cpp_source.html#l00049">mpi_write_test.cpp:49</a></div></div>
<div class="ttc" id="ml2d_8h_html_a4e0517338e6c4a31a2addafc06d4f3a3a95f19e9cdaad9d8da56495e668998343"><div class="ttname"><a href="ml2d_8h.html#a4e0517338e6c4a31a2addafc06d4f3a3a95f19e9cdaad9d8da56495e668998343">OUT_BLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00076">ml2d.h:76</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a62caa148ed1109af0cf324ffec9ff2cd"><div class="ttname"><a href="classML2DBaseProgram.html#a62caa148ed1109af0cf324ffec9ff2cd">ML2DBaseProgram::MDref</a></div><div class="ttdeci">MetaData MDref</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00172">ml2d.h:172</a></div></div>
<div class="ttc" id="classXmippProgram_html_a074c10cbbaa660749bbc2778592a54c4"><div class="ttname"><a href="classXmippProgram.html#a074c10cbbaa660749bbc2778592a54c4">XmippProgram::setProgress</a></div><div class="ttdeci">void setProgress(size_t value=0)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8cpp_source.html#l00319">xmipp_program.cpp:319</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga4ac4645adc643c1865419c09033c9f1d"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a></div><div class="ttdeci">#define DIRECT_MULTIDIM_ELEM(v, n)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00171">multidim_array.h:171</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a950eaf7e71168d33294c20a7b3efa94b"><div class="ttname"><a href="classML2DBaseProgram.html#a950eaf7e71168d33294c20a7b3efa94b">ML2DBaseProgram::setNumberOfLocalImages</a></div><div class="ttdeci">virtual void setNumberOfLocalImages()</div><div class="ttdoc">Set the number of images, this function is useful only for MPI. </div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8cpp_source.html#l00109">ml2d.cpp:109</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_abf6ec880b915a0887a9e0a864c3ff467"><div class="ttname"><a href="classML2DBaseProgram.html#abf6ec880b915a0887a9e0a864c3ff467">ML2DBaseProgram::fn_frac</a></div><div class="ttdeci">FileName fn_frac</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00132">ml2d.h:132</a></div></div>
<div class="ttc" id="structmybarrier__t_html"><div class="ttname"><a href="structmybarrier__t.html">mybarrier_t</a></div><div class="ttdef"><b>Definition:</b> <a href="xmipp__threads_8h_source.html#l00472">xmipp_threads.h:472</a></div></div>
<div class="ttc" id="classProgML2D_html_ad46ab7ada3d4a4cf173ccd5871a005af"><div class="ttname"><a href="classProgML2D.html#ad46ab7ada3d4a4cf173ccd5871a005af">ProgML2D::opt_psi</a></div><div class="ttdeci">double opt_psi</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00085">ml_align2d.h:85</a></div></div>
<div class="ttc" id="classProgML2D_html_aeef0f8238948edd17db1e4652bbd18ac"><div class="ttname"><a href="classProgML2D.html#aeef0f8238948edd17db1e4652bbd18ac">ProgML2D::maxweight</a></div><div class="ttdeci">double maxweight</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00092">ml_align2d.h:92</a></div></div>
<div class="ttc" id="namespacealglib_html_a43452b10ffe26174e5d328a6ceb5fa9a"><div class="ttname"><a href="namespacealglib.html#a43452b10ffe26174e5d328a6ceb5fa9a">alglib::round</a></div><div class="ttdeci">int round(double x)</div><div class="ttdef"><b>Definition:</b> <a href="ap_8cpp_source.html#l07245">ap.cpp:7245</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga4e8db4e5757ca2f6e233d0a1eec7ff1c"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga4e8db4e5757ca2f6e233d0a1eec7ff1c">FOR_ALL_DIRECT_ELEMENTS_IN_ARRAY2D</a></div><div class="ttdeci">#define FOR_ALL_DIRECT_ELEMENTS_IN_ARRAY2D(m)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00519">multidim_array.h:519</a></div></div>
<div class="ttc" id="lib__pwk_8cpp_html_a1b33162134537b4be1f614f7e8094d35"><div class="ttname"><a href="lib__pwk_8cpp.html#a1b33162134537b4be1f614f7e8094d35">translate</a></div><div class="ttdeci">void translate(PDB *pdb_original, PDB *pdb_move, unsigned num_atoms, double x0, double y0, double z0)</div><div class="ttdef"><b>Definition:</b> <a href="lib__pwk_8cpp_source.html#l00125">lib_pwk.cpp:125</a></div></div>
<div class="ttc" id="classProgML2D_html_a2cf96ff3fc13f9f4593ff1ba0eb3c8d6"><div class="ttname"><a href="classProgML2D.html#a2cf96ff3fc13f9f4593ff1ba0eb3c8d6">ProgML2D::calculatePdfInplane</a></div><div class="ttdeci">void calculatePdfInplane()</div><div class="ttdoc">Calculate probability density distribution for in-plane transformations. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l00553">ml_align2d.cpp:553</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78a9d13c72718d18011b83425689e4d6e59"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a9d13c72718d18011b83425689e4d6e59">MDL_CLASS_COUNT</a></div><div class="ttdoc">Number of images assigned to the same class as this image. </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00080">metadata_label.h:80</a></div></div>
<div class="ttc" id="ml__align2d_8cpp_html_ad318491593a53b4c93f2cd401c2ec199"><div class="ttname"><a href="ml__align2d_8cpp.html#ad318491593a53b4c93f2cd401c2ec199">DP</a></div><div class="ttdeci">#define DP(x)</div></div>
<div class="ttc" id="group__GeometricalTransformations_html_gae9f9e35557a7659baf5a1bdbe62e3afc"><div class="ttname"><a href="group__GeometricalTransformations.html#gae9f9e35557a7659baf5a1bdbe62e3afc">selfTranslate</a></div><div class="ttdeci">void selfTranslate(int SplineDegree, MultidimArray&lt; T &gt; &amp;V1, const Matrix1D&lt; double &gt; &amp;v, bool wrap=WRAP, T outside=0)</div><div class="ttdef"><b>Definition:</b> <a href="transformations_8h_source.html#l01176">transformations.h:1176</a></div></div>
<div class="ttc" id="ml2d_8h_html_a110de41c02a5f818c5a698293cf0b9e8"><div class="ttname"><a href="ml2d_8h.html#a110de41c02a5f818c5a698293cf0b9e8">FN_IMAGES_MD</a></div><div class="ttdeci">#define FN_IMAGES_MD(base)</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00054">ml2d.h:54</a></div></div>
<div class="ttc" id="classProgML2D_html_a6f1b8e425483f7b4f97e68e4eb6233fd"><div class="ttname"><a href="classProgML2D.html#a6f1b8e425483f7b4f97e68e4eb6233fd">ProgML2D::iopty</a></div><div class="ttdeci">int iopty</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00096">ml_align2d.h:96</a></div></div>
<div class="ttc" id="classModelML2D_html_aa1281d05277a75579f9adb3b19304a7b"><div class="ttname"><a href="classModelML2D.html#aa1281d05277a75579f9adb3b19304a7b">ModelML2D::sigma_noise</a></div><div class="ttdeci">double sigma_noise</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00087">ml2d.h:87</a></div></div>
<div class="ttc" id="classModelML2D_html_a29baa2fb66177265cb0de6d027ea454a"><div class="ttname"><a href="classModelML2D.html#a29baa2fb66177265cb0de6d027ea454a">ModelML2D::Iref</a></div><div class="ttdeci">std::vector&lt; Image&lt; double &gt; &gt; Iref</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00085">ml2d.h:85</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a080fbf81a2b9dfceab4cfe1a649f13a4"><div class="ttname"><a href="classML2DBaseProgram.html#a080fbf81a2b9dfceab4cfe1a649f13a4">ML2DBaseProgram::MDimg</a></div><div class="ttdeci">MetaData MDimg</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00172">ml2d.h:172</a></div></div>
<div class="ttc" id="classMatrix1D_html"><div class="ttname"><a href="classMatrix1D.html">Matrix1D&lt; double &gt;</a></div></div>
<div class="ttc" id="group__Vectors_html_ga5d2bc77c327154906885f1ebedc8d787"><div class="ttname"><a href="group__Vectors.html#ga5d2bc77c327154906885f1ebedc8d787">dotProduct</a></div><div class="ttdeci">T dotProduct(const Matrix1D&lt; T &gt; &amp;v1, const Matrix1D&lt; T &gt; &amp;v2)</div><div class="ttdef"><b>Definition:</b> <a href="matrix1d_8h_source.html#l01817">matrix1d.h:1817</a></div></div>
<div class="ttc" id="classMetaData_html_a55651d0806335c55622838d62b8068b5"><div class="ttname"><a href="classMetaData.html#a55651d0806335c55622838d62b8068b5">MetaData::removeDisabled</a></div><div class="ttdeci">void removeDisabled()</div><div class="ttdef"><b>Definition:</b> <a href="metadata_8cpp_source.html#l02093">metadata.cpp:2093</a></div></div>
<div class="ttc" id="ml2d_8h_html_adab00b234e73d15cf164c0cc7de93d34adb6dfa9d4fd7acfbba0ca98a7627750c"><div class="ttname"><a href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34adb6dfa9d4fd7acfbba0ca98a7627750c">TH_EXIT</a></div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00074">ml2d.h:74</a></div></div>
<div class="ttc" id="group__Macros_html_ga18b5ff2c19b69c072069398c7a5520cd"><div class="ttname"><a href="group__Macros.html#ga18b5ff2c19b69c072069398c7a5520cd">RAD2DEG</a></div><div class="ttdeci">#define RAD2DEG(r)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00320">xmipp_macros.h:320</a></div></div>
<div class="ttc" id="classProgML2D_html_ae2e77769eb2149319d7f136f9f45b42a"><div class="ttname"><a href="classProgML2D.html#ae2e77769eb2149319d7f136f9f45b42a">ProgML2D::rotateReference</a></div><div class="ttdeci">void rotateReference()</div><div class="ttdoc">Fill vector of matrices with all rotations of reference. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l00603">ml_align2d.cpp:603</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a67faef1c7bbe1544c7f51e4d4fa0e833"><div class="ttname"><a href="classML2DBaseProgram.html#a67faef1c7bbe1544c7f51e4d4fa0e833">ML2DBaseProgram::C_fast</a></div><div class="ttdeci">double C_fast</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00182">ml2d.h:182</a></div></div>
<div class="ttc" id="classModelML2D_html_ae003e31cd7f8e88de554157e5b8a62f5"><div class="ttname"><a href="classModelML2D.html#ae003e31cd7f8e88de554157e5b8a62f5">ModelML2D::sumfracweight</a></div><div class="ttdeci">double sumfracweight</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00097">ml2d.h:97</a></div></div>
<div class="ttc" id="classProgML2D_html_a1cea5bc589a8f97575862d7521f0fc1e"><div class="ttname"><a href="classProgML2D.html#a1cea5bc589a8f97575862d7521f0fc1e">ProgML2D::no_iem</a></div><div class="ttdeci">bool no_iem</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00063">ml_align2d.h:63</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a9544695d9d0054d6e75d62f227bee889"><div class="ttname"><a href="classML2DBaseProgram.html#a9544695d9d0054d6e75d62f227bee889">ML2DBaseProgram::fn_ref</a></div><div class="ttdeci">FileName fn_ref</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00132">ml2d.h:132</a></div></div>
<div class="ttc" id="classFourierTransformer_html_a6335c9c01f240a8edf3b363cef43248b"><div class="ttname"><a href="classFourierTransformer.html#a6335c9c01f240a8edf3b363cef43248b">FourierTransformer::getFourierAlias</a></div><div class="ttdeci">void getFourierAlias(T &amp;V)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__fftw_8h_source.html#l00207">xmipp_fftw.h:207</a></div></div>
<div class="ttc" id="classProgML2D_html_a93b28ad122ffdbf8bb7fcd54e8540f8e"><div class="ttname"><a href="classProgML2D.html#a93b28ad122ffdbf8bb7fcd54e8540f8e">ProgML2D::reverseRotateReference</a></div><div class="ttdeci">void reverseRotateReference()</div><div class="ttdoc">Apply reverse rotations to all matrices in vector and fill new matrix with their sum. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l00618">ml_align2d.cpp:618</a></div></div>
<div class="ttc" id="classProgML2D_html_a16a298494284883677c3848d109ca8ca"><div class="ttname"><a href="classProgML2D.html#a16a298494284883677c3848d109ca8ca">ProgML2D::expectationSingleImage</a></div><div class="ttdeci">void expectationSingleImage(Matrix1D&lt; double &gt; &amp;opt_offsets)</div><div class="ttdoc">ML-integration over all (or -fast) translations. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l00700">ml_align2d.cpp:700</a></div></div>
<div class="ttc" id="classModelML2D_html_a8ee9d8ba6b21965a4fd84a8987c0b76e"><div class="ttname"><a href="classModelML2D.html#a8ee9d8ba6b21965a4fd84a8987c0b76e">ModelML2D::sigma_offset</a></div><div class="ttdeci">double sigma_offset</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00089">ml2d.h:89</a></div></div>
<div class="ttc" id="ml__align2d_8cpp_html_a8c04d9a53742f1b981c80dd88aa430a1"><div class="ttname"><a href="ml__align2d_8cpp.html#a8c04d9a53742f1b981c80dd88aa430a1">update_mutex</a></div><div class="ttdeci">pthread_mutex_t update_mutex</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l00029">ml_align2d.cpp:29</a></div></div>
<div class="ttc" id="classProgML2D_html_ac86ae3f69ec448da39d9a662827dbf6a"><div class="ttname"><a href="classProgML2D.html#ac86ae3f69ec448da39d9a662827dbf6a">ProgML2D::sumwsc</a></div><div class="ttdeci">std::vector&lt; double &gt; sumwsc</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00075">ml_align2d.h:75</a></div></div>
<div class="ttc" id="classMultidimArray_html_ae9f104cb09328048ed9aa7aec03c792c"><div class="ttname"><a href="classMultidimArray.html#ae9f104cb09328048ed9aa7aec03c792c">MultidimArray::sum2</a></div><div class="ttdeci">double sum2() const </div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l05114">multidim_array.h:5114</a></div></div>
<div class="ttc" id="classProgML2D_html_ab3401ed5e2fdaef29418db09181b706d"><div class="ttname"><a href="classProgML2D.html#ab3401ed5e2fdaef29418db09181b706d">ProgML2D::wsum_Mref</a></div><div class="ttdeci">std::vector&lt; MultidimArray&lt; double &gt; &gt; wsum_Mref</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00076">ml_align2d.h:76</a></div></div>
<div class="ttc" id="classProgML2D_html_a0ce68be471d505dc112d1fedef5e3092"><div class="ttname"><a href="classProgML2D.html#a0ce68be471d505dc112d1fedef5e3092">ProgML2D::doThreadESIUpdateRefno</a></div><div class="ttdeci">void doThreadESIUpdateRefno()</div><div class="ttdoc">Thread code to parallelize update loop in ESI. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l01616">ml_align2d.cpp:1616</a></div></div>
<div class="ttc" id="classImage_html"><div class="ttname"><a href="classImage.html">Image&lt; double &gt;</a></div></div>
<div class="ttc" id="xmipp__strings_8h_html_afbeda3fd1bdc8c37d01bdf9f5c8274ff"><div class="ttname"><a href="xmipp__strings_8h.html#afbeda3fd1bdc8c37d01bdf9f5c8274ff">String</a></div><div class="ttdeci">std::string String</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__strings_8h_source.html#l00034">xmipp_strings.h:34</a></div></div>
<div class="ttc" id="namespacealglib_html_a0759579762ef75075769325153538c5b"><div class="ttname"><a href="namespacealglib.html#a0759579762ef75075769325153538c5b">alglib::psi</a></div><div class="ttdeci">double psi(const double x)</div><div class="ttdef"><b>Definition:</b> <a href="specialfunctions_8cpp_source.html#l02492">specialfunctions.cpp:2492</a></div></div>
<div class="ttc" id="classModelML2D_html_a8ba63ac8129e521abfeaeaee3bb4c38d"><div class="ttname"><a href="classModelML2D.html#a8ba63ac8129e521abfeaeaee3bb4c38d">ModelML2D::do_student</a></div><div class="ttdeci">bool do_student</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00104">ml2d.h:104</a></div></div>
<div class="ttc" id="classMultidimArray_html_ac03a790d43ff768b7cc7f8cd6d3038ad"><div class="ttname"><a href="classMultidimArray.html#ac03a790d43ff768b7cc7f8cd6d3038ad">MultidimArray::computeAvg</a></div><div class="ttdeci">double computeAvg() const </div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l03325">multidim_array.h:3325</a></div></div>
<div class="ttc" id="classProgML2D_html_a38a613cb2ebb88a3e8ed436f6743b15b"><div class="ttname"><a href="classProgML2D.html#a38a613cb2ebb88a3e8ed436f6743b15b">ProgML2D::refno_load_param</a></div><div class="ttdeci">size_t refno_load_param</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00110">ml_align2d.h:110</a></div></div>
<div class="ttc" id="classProgML2D_html_a481fb6a97fef42aa5a9e2b56ce6d1cb8"><div class="ttname"><a href="classProgML2D.html#a481fb6a97fef42aa5a9e2b56ce6d1cb8">ProgML2D::awakeThreads</a></div><div class="ttdeci">void awakeThreads(ThreadTask task, int start_refno, int load=1)</div><div class="ttdoc">Awake threads for different tasks. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l01046">ml_align2d.cpp:1046</a></div></div>
<div class="ttc" id="ml2d_8h_html_a705c821075be62861b850210b9157c3d"><div class="ttname"><a href="ml2d_8h.html#a705c821075be62861b850210b9157c3d">FN_CLASSES_STK</a></div><div class="ttdeci">#define FN_CLASSES_STK(base)</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00058">ml2d.h:58</a></div></div>
<div class="ttc" id="ml__align2d_8cpp_html_a25b0a1c7379cd817732735a0fc7f267d"><div class="ttname"><a href="ml__align2d_8cpp.html#a25b0a1c7379cd817732735a0fc7f267d">doThreadsTasks</a></div><div class="ttdeci">void * doThreadsTasks(void *data)</div><div class="ttdoc">Function for threads do different tasks. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l00967">ml_align2d.cpp:967</a></div></div>
<div class="ttc" id="classProgML2D_html_ae2342cb5f821a8f8d90d103b543c1083"><div class="ttname"><a href="classProgML2D.html#ae2342cb5f821a8f8d90d103b543c1083">ProgML2D::refw</a></div><div class="ttdeci">std::vector&lt; double &gt; refw</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00091">ml_align2d.h:91</a></div></div>
<div class="ttc" id="classMetaData_html_a94973ba346a77cdb9aaf44fe65b2dd3c"><div class="ttname"><a href="classMetaData.html#a94973ba346a77cdb9aaf44fe65b2dd3c">MetaData::importObjects</a></div><div class="ttdeci">void importObjects(const MetaData &amp;md, const std::vector&lt; size_t &gt; &amp;objectsToAdd, bool doClear=true)</div><div class="ttdef"><b>Definition:</b> <a href="metadata_8cpp_source.html#l00761">metadata.cpp:761</a></div></div>
<div class="ttc" id="group__StringUtilities_html_gaa405c9a5b808e428554e540028085dd3"><div class="ttname"><a href="group__StringUtilities.html#gaa405c9a5b808e428554e540028085dd3">formatString</a></div><div class="ttdeci">String formatString(const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__strings_8cpp_source.html#l00610">xmipp_strings.cpp:610</a></div></div>
<div class="ttc" id="classModelML2D_html"><div class="ttname"><a href="classModelML2D.html">ModelML2D</a></div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00079">ml2d.h:79</a></div></div>
<div class="ttc" id="classProgML2D_html_aac2d16debfdf2fe8866e3f444ed8a697"><div class="ttname"><a href="classProgML2D.html#aac2d16debfdf2fe8866e3f444ed8a697">ProgML2D::sumw_refpsi</a></div><div class="ttdeci">std::vector&lt; double &gt; sumw_refpsi</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00091">ml_align2d.h:91</a></div></div>
<div class="ttc" id="group__Macros_html_ga25935c2309abe02cff60809c4d7d9b9e"><div class="ttname"><a href="group__Macros.html#ga25935c2309abe02cff60809c4d7d9b9e">realWRAP</a></div><div class="ttdeci">#define realWRAP(x, x0, xF)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00304">xmipp_macros.h:304</a></div></div>
<div class="ttc" id="ml2d_8h_html_adab00b234e73d15cf164c0cc7de93d34a1a6e11e088b022a7ab94b8438b4b0843"><div class="ttname"><a href="ml2d_8h.html#adab00b234e73d15cf164c0cc7de93d34a1a6e11e088b022a7ab94b8438b4b0843">TH_PFS_REFNO</a></div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00074">ml2d.h:74</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a6f44905656bc9d5a5bb57dea399cd18e"><div class="ttname"><a href="classML2DBaseProgram.html#a6f44905656bc9d5a5bb57dea399cd18e">ML2DBaseProgram::P_phi</a></div><div class="ttdeci">MultidimArray&lt; double &gt; P_phi</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00178">ml2d.h:178</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_gad60a440a5ba86f9f7f40cf4a23682500"><div class="ttname"><a href="group__MultidimensionalArrays.html#gad60a440a5ba86f9f7f40cf4a23682500">FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY</a></div><div class="ttdeci">#define FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY(v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00186">multidim_array.h:186</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_a6277e2a7446059985dc9bcf0a4ac1a8f"><div class="ttname"><a href="numerical__recipes_8cpp.html#a6277e2a7446059985dc9bcf0a4ac1a8f">u</a></div><div class="ttdeci">doublereal * u</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02247">numerical_recipes.cpp:2247</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_ac3eac3d0fb4000223088846bee6bcb0b"><div class="ttname"><a href="classML2DBaseProgram.html#ac3eac3d0fb4000223088846bee6bcb0b">ML2DBaseProgram::outRefsMd</a></div><div class="ttdeci">String outRefsMd</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00250">ml2d.h:250</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_af9a692726fabc472f521d3e6ecaf432d"><div class="ttname"><a href="classML2DBaseProgram.html#af9a692726fabc472f521d3e6ecaf432d">ML2DBaseProgram::randomizeImagesOrder</a></div><div class="ttdeci">virtual void randomizeImagesOrder()</div><div class="ttdoc">Randomize initial images order, only once. </div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8cpp_source.html#l00095">ml2d.cpp:95</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_ad9b9535e1774d805e5bbee89dee0f4b5"><div class="ttname"><a href="classML2DBaseProgram.html#ad9b9535e1774d805e5bbee89dee0f4b5">ML2DBaseProgram::do_mirror</a></div><div class="ttdeci">bool do_mirror</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00137">ml2d.h:137</a></div></div>
<div class="ttc" id="classXmippProgram_html_a51ae38ef10274f8f7c6c02ab2a67a28c"><div class="ttname"><a href="classXmippProgram.html#a51ae38ef10274f8f7c6c02ab2a67a28c">XmippProgram::seed</a></div><div class="ttdeci">int seed</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8h_source.html#l00170">xmipp_program.h:170</a></div></div>
<div class="ttc" id="classProgML2D_html_aa975456b33d5133bcc002c29d6a9da20"><div class="ttname"><a href="classProgML2D.html#aa975456b33d5133bcc002c29d6a9da20">ProgML2D::th_ids</a></div><div class="ttdeci">pthread_t * th_ids</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00069">ml_align2d.h:69</a></div></div>
<div class="ttc" id="classXmippProgram_html_a1a27c450de95c55d122be23e3fe89ac1"><div class="ttname"><a href="classXmippProgram.html#a1a27c450de95c55d122be23e3fe89ac1">XmippProgram::checkParam</a></div><div class="ttdeci">bool checkParam(const char *param)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8cpp_source.html#l00425">xmipp_program.cpp:425</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a47f7cd87d5f078979db61864b4f6d55f"><div class="ttname"><a href="classML2DBaseProgram.html#a47f7cd87d5f078979db61864b4f6d55f">ML2DBaseProgram::fast_mode</a></div><div class="ttdeci">bool fast_mode</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00180">ml2d.h:180</a></div></div>
<div class="ttc" id="classImageBase_html_a88636b7a7bd4e0e454877e691ee2da84"><div class="ttname"><a href="classImageBase.html#a88636b7a7bd4e0e454877e691ee2da84">ImageBase::read</a></div><div class="ttdeci">int read(const FileName &amp;name, DataMode datamode=DATA, size_t select_img=ALL_IMAGES, bool mapData=false, int mode=WRITE_READONLY)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__image__base_8cpp_source.html#l00061">xmipp_image_base.cpp:61</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a3c0fde6f9005eec528cc1f703019719c"><div class="ttname"><a href="classML2DBaseProgram.html#a3c0fde6f9005eec528cc1f703019719c">ML2DBaseProgram::fix_sigma_offset</a></div><div class="ttdeci">bool fix_sigma_offset</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00141">ml2d.h:141</a></div></div>
<div class="ttc" id="image__find__center_8cpp_html_ab7a69dabaa7151dae4d7a3998167e2f3"><div class="ttname"><a href="image__find__center_8cpp.html#ab7a69dabaa7151dae4d7a3998167e2f3">r2</a></div><div class="ttdeci">float r2</div><div class="ttdef"><b>Definition:</b> <a href="image__find__center_8cpp_source.html#l00051">image_find_center.cpp:51</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a55332f697c74f72635ae850439407645"><div class="ttname"><a href="classML2DBaseProgram.html#a55332f697c74f72635ae850439407645">ML2DBaseProgram::nr_images_global</a></div><div class="ttdeci">size_t nr_images_global</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00164">ml2d.h:164</a></div></div>
<div class="ttc" id="mpi__classify__CL2D_8cpp_html_a831c08adbb8230fd6a60f4a130923a19"><div class="ttname"><a href="mpi__classify__CL2D_8cpp.html#a831c08adbb8230fd6a60f4a130923a19">prm</a></div><div class="ttdeci">ProgClassifyCL2D * prm</div><div class="ttdef"><b>Definition:</b> <a href="mpi__classify__CL2D_8cpp_source.html#l00033">mpi_classify_CL2D.cpp:33</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_adf6efe79d6a17ff818c2f06d11e7b7b0"><div class="ttname"><a href="classML2DBaseProgram.html#adf6efe79d6a17ff818c2f06d11e7b7b0">ML2DBaseProgram::imgs_trymindiff</a></div><div class="ttdeci">std::vector&lt; double &gt; imgs_trymindiff</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00209">ml2d.h:209</a></div></div>
<div class="ttc" id="classProgML2D_html_aa36f14d7a179db98ac4ee1dae1bba998"><div class="ttname"><a href="classProgML2D.html#aa36f14d7a179db98ac4ee1dae1bba998">ProgML2D::correctScaleAverage</a></div><div class="ttdeci">void correctScaleAverage()</div><div class="ttdoc">Correct references scale. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l02077">ml_align2d.cpp:2077</a></div></div>
<div class="ttc" id="classModelML2D_html_ad96c07a510bde15050c4862c41df0318"><div class="ttname"><a href="classModelML2D.html#ad96c07a510bde15050c4862c41df0318">ModelML2D::sumw_mirror</a></div><div class="ttdeci">std::vector&lt; double &gt; sumw_mirror</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00091">ml2d.h:91</a></div></div>
<div class="ttc" id="ml2d_8h_html_a12d43bb17e6532367f74d92c2f08ef73"><div class="ttname"><a href="ml2d_8h.html#a12d43bb17e6532367f74d92c2f08ef73">SIGNIFICANT_WEIGHT_LOW</a></div><div class="ttdeci">#define SIGNIFICANT_WEIGHT_LOW</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00048">ml2d.h:48</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78a0704d0153add5aa8abcf3e82bb174ebc"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a0704d0153add5aa8abcf3e82bb174ebc">MDL_MIRRORFRAC</a></div><div class="ttdoc">Mirror fraction for a Maximum Likelihood model. </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00280">metadata_label.h:280</a></div></div>
<div class="ttc" id="structstructThreadTasks_html_af02b96b72e4d115cf3bd22146db1c261"><div class="ttname"><a href="structstructThreadTasks.html#af02b96b72e4d115cf3bd22146db1c261">structThreadTasks::prm</a></div><div class="ttdeci">ProgML2D * prm</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00047">ml_align2d.h:47</a></div></div>
<div class="ttc" id="xmipp__funcs_8cpp_html_a6b2ac43eac850ac39594e8a5f5aa42fe"><div class="ttname"><a href="xmipp__funcs_8cpp.html#a6b2ac43eac850ac39594e8a5f5aa42fe">idum</a></div><div class="ttdeci">int idum</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__funcs_8cpp_source.html#l00382">xmipp_funcs.cpp:382</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78ab00882fc483e9a1a7e6af5829a6afb8e"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78ab00882fc483e9a1a7e6af5829a6afb8e">MDL_SHIFT_Y</a></div><div class="ttdoc">Shift for the image in the Y axis (double) </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00415">metadata_label.h:415</a></div></div>
<div class="ttc" id="classXmippProgram_html_a4f396af57519ec443b4656176eb962bf"><div class="ttname"><a href="classXmippProgram.html#a4f396af57519ec443b4656176eb962bf">XmippProgram::addUsageLine</a></div><div class="ttdeci">void addUsageLine(const char *line, bool verbatim=false)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8cpp_source.html#l00338">xmipp_program.cpp:338</a></div></div>
<div class="ttc" id="classMultidimArray_html_a738eab72b6bd48a98d78745bc24f36bd"><div class="ttname"><a href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">MultidimArray::initZeros</a></div><div class="ttdeci">void initZeros(const MultidimArray&lt; T1 &gt; &amp;op)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l04327">multidim_array.h:4327</a></div></div>
<div class="ttc" id="ml2d_8h_html_a119f8d4cc2bfa19d21093a7694874226"><div class="ttname"><a href="ml2d_8h.html#a119f8d4cc2bfa19d21093a7694874226">DATALINELENGTH</a></div><div class="ttdeci">#define DATALINELENGTH</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00050">ml2d.h:50</a></div></div>
<div class="ttc" id="classModelML2D_html_ab7d8a52f604b05bd0c078e639d6799b4"><div class="ttname"><a href="classModelML2D.html#ab7d8a52f604b05bd0c078e639d6799b4">ModelML2D::WsumMref</a></div><div class="ttdeci">std::vector&lt; Image&lt; double &gt; &gt; WsumMref</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00085">ml2d.h:85</a></div></div>
<div class="ttc" id="classProgML2D_html_aa5d75659fd752108984bd946431828ba"><div class="ttname"><a href="classProgML2D.html#aa5d75659fd752108984bd946431828ba">ProgML2D::getBaseName</a></div><div class="ttdeci">FileName getBaseName(String suffix=&quot;&quot;, int number=-1)</div><div class="ttdoc">Get base name based on fn_root and some number. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l02370">ml_align2d.cpp:2370</a></div></div>
<div class="ttc" id="classImageBase_html_ad19263dd187d5a29fc6ed889ba299097"><div class="ttname"><a href="classImageBase.html#ad19263dd187d5a29fc6ed889ba299097">ImageBase::setWeight</a></div><div class="ttdeci">void setWeight(double weight, const size_t n=0)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__image__base_8h_source.html#l00748">xmipp_image_base.h:748</a></div></div>
<div class="ttc" id="ml2d_8h_html_a4e0517338e6c4a31a2addafc06d4f3a3a6fd70d363102c21d4574856dc09395b8"><div class="ttname"><a href="ml2d_8h.html#a4e0517338e6c4a31a2addafc06d4f3a3a6fd70d363102c21d4574856dc09395b8">OUT_FINAL</a></div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00076">ml2d.h:76</a></div></div>
<div class="ttc" id="classProgML2D_html_a1c25285ac94df07073424f8bd59ec401"><div class="ttname"><a href="classProgML2D.html#a1c25285ac94df07073424f8bd59ec401">ProgML2D::show</a></div><div class="ttdeci">virtual void show()</div><div class="ttdoc">Show info at starting program. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l00194">ml_align2d.cpp:194</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_ad640e8275de5576531913f2e9ed1628d"><div class="ttname"><a href="classML2DBaseProgram.html#ad640e8275de5576531913f2e9ed1628d">ML2DBaseProgram::save_mem1</a></div><div class="ttdeci">bool save_mem1</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00192">ml2d.h:192</a></div></div>
<div class="ttc" id="classProgML2D_html_a0af09c8aabc38a238206b9551ceedb24"><div class="ttname"><a href="classProgML2D.html#a0af09c8aabc38a238206b9551ceedb24">ProgML2D::pfs_weight</a></div><div class="ttdeci">MultidimArray&lt; double &gt; pfs_weight</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00101">ml_align2d.h:101</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a997e2be4af206a96283a2f73cfacdcfe"><div class="ttname"><a href="classML2DBaseProgram.html#a997e2be4af206a96283a2f73cfacdcfe">ML2DBaseProgram::dim2</a></div><div class="ttdeci">size_t dim2</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00151">ml2d.h:151</a></div></div>
<div class="ttc" id="group__Threads_html_ga99a3a59fba69ac42cf6fb51df0dc5b64"><div class="ttname"><a href="group__Threads.html#ga99a3a59fba69ac42cf6fb51df0dc5b64">barrier_wait</a></div><div class="ttdeci">int barrier_wait(barrier_t *barrier)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__threads_8cpp_source.html#l00382">xmipp_threads.cpp:382</a></div></div>
<div class="ttc" id="tools_8h_html_a598a3330b3c21701223ee0ca14316eca"><div class="ttname"><a href="tools_8h.html#a598a3330b3c21701223ee0ca14316eca">PI</a></div><div class="ttdeci">#define PI</div><div class="ttdef"><b>Definition:</b> <a href="tools_8h_source.html#l00043">tools.h:43</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78abbbbb24eaf2b80e9a7ed50bd6075e833"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78abbbbb24eaf2b80e9a7ed50bd6075e833">MDL_ITER</a></div><div class="ttdoc">Current iteration number (int) </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00251">metadata_label.h:251</a></div></div>
<div class="ttc" id="classProgML2D_html_a2038e3b1923671ed4c6c293da2339b24"><div class="ttname"><a href="classProgML2D.html#a2038e3b1923671ed4c6c293da2339b24">ProgML2D::iteration</a></div><div class="ttdeci">virtual void iteration()</div><div class="ttdoc">Perform an iteration. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l01693">ml_align2d.cpp:1693</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_abe104a9ef312f6d857b008188e5dfbea"><div class="ttname"><a href="classML2DBaseProgram.html#abe104a9ef312f6d857b008188e5dfbea">ML2DBaseProgram::nr_nomirror_flips</a></div><div class="ttdeci">size_t nr_nomirror_flips</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00162">ml2d.h:162</a></div></div>
<div class="ttc" id="classXmippProgram_html_a7b7ddf0836dc1079ea2622e2a420c39c"><div class="ttname"><a href="classXmippProgram.html#a7b7ddf0836dc1079ea2622e2a420c39c">XmippProgram::getIntParam</a></div><div class="ttdeci">int getIntParam(const char *param, int arg=0)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__program_8cpp_source.html#l00387">xmipp_program.cpp:387</a></div></div>
<div class="ttc" id="classProgML2D_html_ae79f14fb1780011236766b2b6cb9748d"><div class="ttname"><a href="classProgML2D.html#ae79f14fb1780011236766b2b6cb9748d">ProgML2D::fracweight</a></div><div class="ttdeci">double fracweight</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00086">ml_align2d.h:86</a></div></div>
<div class="ttc" id="classMetaData_html_a9f88f42faff8bfbc1952c50e2a6ffc42"><div class="ttname"><a href="classMetaData.html#a9f88f42faff8bfbc1952c50e2a6ffc42">MetaData::firstObject</a></div><div class="ttdeci">size_t firstObject() const </div><div class="ttdef"><b>Definition:</b> <a href="metadata_8cpp_source.html#l00849">metadata.cpp:849</a></div></div>
<div class="ttc" id="group__ErrorHandling_html_ggab0df38968e4f03a3f1f6d6df0f31f45aad02217f52cd3ac70b89edec020dd25c0"><div class="ttname"><a href="group__ErrorHandling.html#ggab0df38968e4f03a3f1f6d6df0f31f45aad02217f52cd3ac70b89edec020dd25c0">ERR_VALUE_INCORRECT</a></div><div class="ttdoc">Incorrect value received. </div><div class="ttdef"><b>Definition:</b> <a href="xmipp__error_8h_source.html#l00200">xmipp_error.h:200</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_aa53d160970e65511ba3f5d89db29b651"><div class="ttname"><a href="classML2DBaseProgram.html#aa53d160970e65511ba3f5d89db29b651">ML2DBaseProgram::Iold</a></div><div class="ttdeci">std::vector&lt; Image&lt; double &gt; &gt; Iold</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00176">ml2d.h:176</a></div></div>
<div class="ttc" id="ml__align2d_8cpp_html_a434e4700cbd673d587cedf170679ab1f"><div class="ttname"><a href="ml__align2d_8cpp.html#a434e4700cbd673d587cedf170679ab1f">refno_mutex</a></div><div class="ttdeci">pthread_mutex_t refno_mutex</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l00032">ml_align2d.cpp:32</a></div></div>
<div class="ttc" id="classProgML2D_html_ac5e5c4cf86a9dad9ac604abf2aaa94cf"><div class="ttname"><a href="classProgML2D.html#ac5e5c4cf86a9dad9ac604abf2aaa94cf">ProgML2D::mysumimgs</a></div><div class="ttdeci">std::vector&lt; MultidimArray&lt; std::complex&lt; double &gt; &gt; &gt; mysumimgs</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00090">ml_align2d.h:90</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a3b21e31f64ae12053ef1192ef39e309e"><div class="ttname"><a href="classML2DBaseProgram.html#a3b21e31f64ae12053ef1192ef39e309e">ML2DBaseProgram::conv</a></div><div class="ttdeci">std::vector&lt; double &gt; conv</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00219">ml2d.h:219</a></div></div>
<div class="ttc" id="structstructThreadTasks_html"><div class="ttname"><a href="structstructThreadTasks.html">structThreadTasks</a></div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00044">ml_align2d.h:44</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a7b0d716eb64a885e060bd3d380fe83be"><div class="ttname"><a href="classML2DBaseProgram.html#a7b0d716eb64a885e060bd3d380fe83be">ML2DBaseProgram::blocks</a></div><div class="ttdeci">size_t blocks</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00227">ml2d.h:227</a></div></div>
<div class="ttc" id="classModelML2D_html_afb7a89515e4d8891cbc47b9b32857eb1"><div class="ttname"><a href="classModelML2D.html#afb7a89515e4d8891cbc47b9b32857eb1">ModelML2D::scale</a></div><div class="ttdeci">std::vector&lt; double &gt; scale</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00093">ml2d.h:93</a></div></div>
<div class="ttc" id="group__Masks_html_gadbf06cdc74e0428f1578bde31368cea1"><div class="ttname"><a href="group__Masks.html#gadbf06cdc74e0428f1578bde31368cea1">OUTSIDE_MASK</a></div><div class="ttdeci">#define OUTSIDE_MASK</div><div class="ttdef"><b>Definition:</b> <a href="mask_8h_source.html#l00053">mask.h:53</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_a76f11d9a0a47b94f72c2d0e77fb32240"><div class="ttname"><a href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a></div><div class="ttdeci">int * n</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02246">numerical_recipes.cpp:2246</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78af4298cfa617e6143f021d0d7956a7f70"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78af4298cfa617e6143f021d0d7956a7f70">MDL_IMAGE</a></div><div class="ttdoc">Name of an image (std::string) </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00235">metadata_label.h:235</a></div></div>
<div class="ttc" id="ml2d_8h_html_a4e0517338e6c4a31a2addafc06d4f3a3a89efaab8334ac6cb11c69e69f3cf30d4"><div class="ttname"><a href="ml2d_8h.html#a4e0517338e6c4a31a2addafc06d4f3a3a89efaab8334ac6cb11c69e69f3cf30d4">OUT_IMGS</a></div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00076">ml2d.h:76</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_af249c63e39331ba0e4dfbcd39cafdce9"><div class="ttname"><a href="classML2DBaseProgram.html#af249c63e39331ba0e4dfbcd39cafdce9">ML2DBaseProgram::threads</a></div><div class="ttdeci">int threads</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00244">ml2d.h:244</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_ae32011b5a8251cbaaf3b5e28933b9806"><div class="ttname"><a href="classML2DBaseProgram.html#ae32011b5a8251cbaaf3b5e28933b9806">ML2DBaseProgram::imgs_bgmean</a></div><div class="ttdeci">std::vector&lt; double &gt; imgs_bgmean</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00209">ml2d.h:209</a></div></div>
<div class="ttc" id="classModelML2D_html_ad9b4518ce2b8f448efa173251e529ffc"><div class="ttname"><a href="classModelML2D.html#ad9b4518ce2b8f448efa173251e529ffc">ModelML2D::do_norm</a></div><div class="ttdeci">bool do_norm</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00104">ml2d.h:104</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_ae01374ddda83bc2216ba9df9c76d9995"><div class="ttname"><a href="numerical__recipes_8cpp.html#ae01374ddda83bc2216ba9df9c76d9995">gammln</a></div><div class="ttdeci">double gammln(double xx)</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l00587">numerical_recipes.cpp:587</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_ab31f295dfdeb52bada9f0ca819c8fb29"><div class="ttname"><a href="classML2DBaseProgram.html#ab31f295dfdeb52bada9f0ca819c8fb29">ML2DBaseProgram::current_image</a></div><div class="ttdeci">size_t current_image</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00221">ml2d.h:221</a></div></div>
<div class="ttc" id="classModelML2D_html_a3278f0162a362cbf3ddb48df1c0e832e"><div class="ttname"><a href="classModelML2D.html#a3278f0162a362cbf3ddb48df1c0e832e">ModelML2D::addModel</a></div><div class="ttdeci">void addModel(const ModelML2D &amp;model)</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8cpp_source.html#l00403">ml2d.cpp:403</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a909478a47c338d181693f9421ecb4bd3"><div class="ttname"><a href="classML2DBaseProgram.html#a909478a47c338d181693f9421ecb4bd3">ML2DBaseProgram::eps</a></div><div class="ttdeci">double eps</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00170">ml2d.h:170</a></div></div>
<div class="ttc" id="classProgML2D_html_a75cc3fc6713d2e0b3952a5ee1078014a"><div class="ttname"><a href="classProgML2D.html#a75cc3fc6713d2e0b3952a5ee1078014a">ProgML2D::Msignificant</a></div><div class="ttdeci">MultidimArray&lt; int &gt; Msignificant</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00077">ml_align2d.h:77</a></div></div>
<div class="ttc" id="classProgML2D_html_a278477791b8743ce9578d57154e937da"><div class="ttname"><a href="classProgML2D.html#a278477791b8743ce9578d57154e937da">ProgML2D::sumw2</a></div><div class="ttdeci">std::vector&lt; double &gt; sumw2</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00075">ml_align2d.h:75</a></div></div>
<div class="ttc" id="classProgML2D_html_ad27429da545246b2d9d953e99fca0a4a"><div class="ttname"><a href="classProgML2D.html#ad27429da545246b2d9d953e99fca0a4a">ProgML2D::produceSideInfo</a></div><div class="ttdeci">virtual void produceSideInfo()</div><div class="ttdoc">Try to merge produceSideInfo1 and 2. </div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8cpp_source.html#l00288">ml_align2d.cpp:288</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78a8807f4c926a3e980249df162c9ff0bdf"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a8807f4c926a3e980249df162c9ff0bdf">MDL_WEIGHT</a></div><div class="ttdoc">&lt; Score 4 for volumes </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00448">metadata_label.h:448</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_ab7caa861fcd7c5a139c0a0825c1abbe0"><div class="ttname"><a href="classML2DBaseProgram.html#ab7caa861fcd7c5a139c0a0825c1abbe0">ML2DBaseProgram::imgs_scale</a></div><div class="ttdeci">std::vector&lt; double &gt; imgs_scale</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00209">ml2d.h:209</a></div></div>
<div class="ttc" id="classProgML2D_html_ae9bc9d23d569122e31bf8925a1910559"><div class="ttname"><a href="classProgML2D.html#ae9bc9d23d569122e31bf8925a1910559">ProgML2D::pfs_maxweight</a></div><div class="ttdeci">MultidimArray&lt; double &gt; pfs_maxweight</div><div class="ttdef"><b>Definition:</b> <a href="ml__align2d_8h_source.html#l00100">ml_align2d.h:100</a></div></div>
<div class="ttc" id="classML2DBaseProgram_html_a62698e9d68c10fa72db6deb1d3fc6794"><div class="ttname"><a href="classML2DBaseProgram.html#a62698e9d68c10fa72db6deb1d3fc6794">ML2DBaseProgram::cline</a></div><div class="ttdeci">String cline</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00134">ml2d.h:134</a></div></div>
<div class="ttc" id="classModelML2D_html_a8ef40e1e3d8cd33a2b424346ccd69346"><div class="ttname"><a href="classModelML2D.html#a8ef40e1e3d8cd33a2b424346ccd69346">ModelML2D::wsum_sigma_noise</a></div><div class="ttdeci">double wsum_sigma_noise</div><div class="ttdef"><b>Definition:</b> <a href="ml2d_8h_source.html#l00087">ml2d.h:87</a></div></div>
<div class="ttc" id="group__MetaData_html_gga7a6f95c8cfb46e6dfb2689b5cabd3f78a31de7898d23a11e9b1b2ba4cc816d365"><div class="ttname"><a href="group__MetaData.html#gga7a6f95c8cfb46e6dfb2689b5cabd3f78a31de7898d23a11e9b1b2ba4cc816d365">MDL_RANDOMSEED</a></div><div class="ttdoc">Seed for random number generator. </div><div class="ttdef"><b>Definition:</b> <a href="metadata__label_8h_source.html#l00361">metadata_label.h:361</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
