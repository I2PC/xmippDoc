<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Xmipp: Normalization of images and volumes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xmipp_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Xmipp
   &#160;<span id="projectnumber">v20.07</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle">
<div class="title">Normalization of images and volumes</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classProgNormalize.html">ProgNormalize</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="member-group"></a>
Image normalization procedures</h2></td></tr>
<tr><td class="ititle" colspan="2"><p><a class="anchor" id="amgrp98fbd8711d2afe6a6485b6e742ee181a"></a>This functions implement the normalization of a single image. They should be called with all images in the corresponding <a class="el" href="classSelFile.html">SelFile</a>. In the following documentation m(x) is the mean of x, v(x) is the variance, bg(x) is its background.</p>
<p>The original image is X and is supposed to be related to each single projection by I=a*(X+n)+b where a and b are different for every projection.</p>
<p>Noise is assumed to follow a gaussian distribution N(0,sqrt(v(n)))</p>
<p>In general the background mask is used only to compute statistics, while the mask is the one which is really applied to the image. Supply NULL if you don't want any mask to be applied</p>
<p>When b is used it is measured as the mean in the background, while a*sqrt(v(n)) is the standard deviation in the same area. </p>
</td></tr>
<tr class="memitem:ga3816a01b39c37c2b6fbc27841426d375"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Normalize.html#ga3816a01b39c37c2b6fbc27841426d375">normalize_OldXmipp</a> (<a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;I)</td></tr>
<tr class="separator:ga3816a01b39c37c2b6fbc27841426d375"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga607840d4422fc8d37cab493300620b58"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Normalize.html#ga607840d4422fc8d37cab493300620b58">normalize_Near_OldXmipp</a> (<a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;I, const <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;bg_mask)</td></tr>
<tr class="separator:ga607840d4422fc8d37cab493300620b58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga329a2c9e0148ba20d02b9787888ee422"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Normalize.html#ga329a2c9e0148ba20d02b9787888ee422">normalize_OldXmipp_decomposition</a> (<a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;I, const <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;bg_mask, const <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; *mask=NULL)</td></tr>
<tr class="separator:ga329a2c9e0148ba20d02b9787888ee422"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafb921d78efb86e7fc4ea5afe5d48be37"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Normalize.html#gafb921d78efb86e7fc4ea5afe5d48be37">normalize_tomography</a> (<a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;I, double tilt, double &amp;mui, double &amp;sigmai, bool tiltMask, bool tomography0=false, double mu0=0, double sigma0=1)</td></tr>
<tr class="separator:gafb921d78efb86e7fc4ea5afe5d48be37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8758f482f5e7d5939fb7f22000b3437f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Normalize.html#ga8758f482f5e7d5939fb7f22000b3437f">normalize_Michael</a> (<a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;I, const <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;bg_mask)</td></tr>
<tr class="separator:ga8758f482f5e7d5939fb7f22000b3437f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gada2ad8d95626323a3da6c26c22fb1762"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Normalize.html#gada2ad8d95626323a3da6c26c22fb1762">normalize_NewXmipp</a> (<a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;I, const <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;bg_mask)</td></tr>
<tr class="separator:gada2ad8d95626323a3da6c26c22fb1762"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7f05e421067893cdc87c7c224962f991"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Normalize.html#ga7f05e421067893cdc87c7c224962f991">normalize_NewXmipp2</a> (<a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;I, const <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;bg_mask)</td></tr>
<tr class="separator:ga7f05e421067893cdc87c7c224962f991"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa81fefa03525c5f4981dcadc2392fe07"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Normalize.html#gaa81fefa03525c5f4981dcadc2392fe07">normalize_Robust</a> (<a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;I, const <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;bg_mask, bool clip)</td></tr>
<tr class="separator:gaa81fefa03525c5f4981dcadc2392fe07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac947cd7ad53ceac5d45f230fb7cd2147"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Normalize.html#gac947cd7ad53ceac5d45f230fb7cd2147">normalize_ramp</a> (<a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;I, <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; *bg_mask=NULL)</td></tr>
<tr class="separator:gac947cd7ad53ceac5d45f230fb7cd2147"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaaa5c1b883cdb3ae7017d1e1d7075b33c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Normalize.html#gaaa5c1b883cdb3ae7017d1e1d7075b33c">normalize_remove_neighbours</a> (<a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;I, const <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;bg_mask, const double &amp;<a class="el" href="lib__vwk_8h.html#a624a8b0f9f8900df6f540fa654e179b3">threshold</a>)</td></tr>
<tr class="separator:gaaa5c1b883cdb3ae7017d1e1d7075b33c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga8758f482f5e7d5939fb7f22000b3437f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void normalize_Michael </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>I</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>bg_mask</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Michael's normalization.</p>
<p>Formula: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;I&#39;=(I-b)/b</div></div><!-- fragment --><p> Properties: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;m(I&#39;)=0                             m(bg(I&#39;))=-a*m(x)/b</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;v(I&#39;)=a^2*(v(X)+v(n))/b^2           v(bg(I&#39;))=a^2*v(n)/b^2</div></div><!-- fragment --><p> Comments: it's not bad but positivity constraints cannot be imposed and the statistical properties are not so good. </p>

<p>Definition at line <a class="el" href="normalize_8cpp_source.html#l00219">219</a> of file <a class="el" href="normalize_8cpp_source.html">normalize.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;{</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordtype">double</span> avg, stddev, <a class="code" href="image__operate_8cpp.html#afbbd36781c10524238c70745c6f6f35d">min</a>=0., <a class="code" href="image__operate_8cpp.html#ac5474a01d203d14c046620266b2f1954">max</a>;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordtype">double</span> avgbg, stddevbg, minbg, maxbg;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    I.<a class="code" href="classMultidimArray.html#ab648c97e18d063ce966db9c61b68f066">computeStats</a>(avg, stddev, min, <a class="code" href="image__operate_8cpp.html#ac5474a01d203d14c046620266b2f1954">max</a>);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <a class="code" href="group__Masks.html#ga5bd552c32d3d6b6abd6ddf18677cf647">computeStats_within_binary_mask</a>(bg_mask, I, minbg, maxbg, avgbg,</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                                    stddevbg);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">if</span> (avgbg &gt; 0)</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    {</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        I -= avgbg;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        I /= avgbg;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    { <span class="comment">// To avoid the contrast inversion</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        I -= (avgbg - <a class="code" href="image__operate_8cpp.html#afbbd36781c10524238c70745c6f6f35d">min</a>);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        I /= (avgbg - <a class="code" href="image__operate_8cpp.html#afbbd36781c10524238c70745c6f6f35d">min</a>);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    }</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;}</div><div class="ttc" id="image__operate_8cpp_html_afbbd36781c10524238c70745c6f6f35d"><div class="ttname"><a href="image__operate_8cpp.html#afbbd36781c10524238c70745c6f6f35d">min</a></div><div class="ttdeci">void min(Image&lt; double &gt; &amp;op1, const Image&lt; double &gt; &amp;op2)</div><div class="ttdef"><b>Definition:</b> <a href="image__operate_8cpp_source.html#l00115">image_operate.cpp:115</a></div></div>
<div class="ttc" id="classMultidimArray_html_ab648c97e18d063ce966db9c61b68f066"><div class="ttname"><a href="classMultidimArray.html#ab648c97e18d063ce966db9c61b68f066">MultidimArray::computeStats</a></div><div class="ttdeci">void computeStats(double &amp;avg, double &amp;stddev, T &amp;minval, T &amp;maxval) const </div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l03377">multidim_array.h:3377</a></div></div>
<div class="ttc" id="group__Masks_html_ga5bd552c32d3d6b6abd6ddf18677cf647"><div class="ttname"><a href="group__Masks.html#ga5bd552c32d3d6b6abd6ddf18677cf647">computeStats_within_binary_mask</a></div><div class="ttdeci">void computeStats_within_binary_mask(const MultidimArray&lt; T1 &gt; &amp;mask, const MultidimArray&lt; T &gt; &amp;m, double &amp;min_val, double &amp;max_val, double &amp;avg, double &amp;stddev)</div><div class="ttdef"><b>Definition:</b> <a href="mask_8h_source.html#l00804">mask.h:804</a></div></div>
<div class="ttc" id="image__operate_8cpp_html_ac5474a01d203d14c046620266b2f1954"><div class="ttname"><a href="image__operate_8cpp.html#ac5474a01d203d14c046620266b2f1954">max</a></div><div class="ttdeci">void max(Image&lt; double &gt; &amp;op1, const Image&lt; double &gt; &amp;op2)</div><div class="ttdef"><b>Definition:</b> <a href="image__operate_8cpp_source.html#l00125">image_operate.cpp:125</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga607840d4422fc8d37cab493300620b58"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void normalize_Near_OldXmipp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>I</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>bg_mask</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Near_OldXmipp normalization.</p>
<p>Formula: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;I&#39;=(I-m(I))/sqrt(v(bg))</div></div><!-- fragment --><p> Properties: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;m(I&#39;)=0                             m(bg(I&#39;))=-m(x)/sqrt(v(n))</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;v(I&#39;)=(v(X)+v(n))/v(n)              v(bg(I&#39;))=1</div></div><!-- fragment --><p> Comments: it's not bad but positivity constraints cannot be imposed </p>

<p>Definition at line <a class="el" href="normalize_8cpp_source.html#l00045">45</a> of file <a class="el" href="normalize_8cpp_source.html">normalize.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;{</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordtype">double</span> avg=0., stddev, <a class="code" href="image__operate_8cpp.html#afbbd36781c10524238c70745c6f6f35d">min</a>, <a class="code" href="image__operate_8cpp.html#ac5474a01d203d14c046620266b2f1954">max</a>;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordtype">double</span> avgbg, stddevbg, minbg, maxbg;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    I.<a class="code" href="classMultidimArray.html#ab648c97e18d063ce966db9c61b68f066">computeStats</a>(avg, stddev, min, max);</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="group__Masks.html#ga5bd552c32d3d6b6abd6ddf18677cf647">computeStats_within_binary_mask</a>(bg_mask, I, minbg, maxbg, avgbg,</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                                    stddevbg);</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    I -= avg;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    I /= stddevbg;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;}</div><div class="ttc" id="image__operate_8cpp_html_afbbd36781c10524238c70745c6f6f35d"><div class="ttname"><a href="image__operate_8cpp.html#afbbd36781c10524238c70745c6f6f35d">min</a></div><div class="ttdeci">void min(Image&lt; double &gt; &amp;op1, const Image&lt; double &gt; &amp;op2)</div><div class="ttdef"><b>Definition:</b> <a href="image__operate_8cpp_source.html#l00115">image_operate.cpp:115</a></div></div>
<div class="ttc" id="classMultidimArray_html_ab648c97e18d063ce966db9c61b68f066"><div class="ttname"><a href="classMultidimArray.html#ab648c97e18d063ce966db9c61b68f066">MultidimArray::computeStats</a></div><div class="ttdeci">void computeStats(double &amp;avg, double &amp;stddev, T &amp;minval, T &amp;maxval) const </div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l03377">multidim_array.h:3377</a></div></div>
<div class="ttc" id="group__Masks_html_ga5bd552c32d3d6b6abd6ddf18677cf647"><div class="ttname"><a href="group__Masks.html#ga5bd552c32d3d6b6abd6ddf18677cf647">computeStats_within_binary_mask</a></div><div class="ttdeci">void computeStats_within_binary_mask(const MultidimArray&lt; T1 &gt; &amp;mask, const MultidimArray&lt; T &gt; &amp;m, double &amp;min_val, double &amp;max_val, double &amp;avg, double &amp;stddev)</div><div class="ttdef"><b>Definition:</b> <a href="mask_8h_source.html#l00804">mask.h:804</a></div></div>
<div class="ttc" id="image__operate_8cpp_html_ac5474a01d203d14c046620266b2f1954"><div class="ttname"><a href="image__operate_8cpp.html#ac5474a01d203d14c046620266b2f1954">max</a></div><div class="ttdeci">void max(Image&lt; double &gt; &amp;op1, const Image&lt; double &gt; &amp;op2)</div><div class="ttdef"><b>Definition:</b> <a href="image__operate_8cpp_source.html#l00125">image_operate.cpp:125</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gada2ad8d95626323a3da6c26c22fb1762"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void normalize_NewXmipp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>I</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>bg_mask</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>NewXmipp's normalization.</p>
<p>Formula: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;I&#39;=(I-b)/a*sqrt(v(n))</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;// I&#39;&#39;=(I&#39;&gt;0)? I&#39;:0</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;// I&#39;&#39;&#39;=I&#39;&#39;-a*sqrt(v(n)/2*PI)</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;I&#39;&#39;&#39;&#39;=I&#39;&#39;&#39;*mask</div></div><!-- fragment --><p> Properties: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;m(I&#39;)=m(X)/sqrt(v(n))               m(bg(I&#39;))=0</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;v(I&#39;)=(v(X)+v(n))/v(n)              v(bg(I&#39;))=1</div></div><!-- fragment --><p> Comments: In general, we cannot assure that mass projects into positive numbers, so the "denoising" capability directly on the images is disabled. However, a positivity constraint can be applied on the 3D volume. </p>

<p>Definition at line <a class="el" href="normalize_8cpp_source.html#l00238">238</a> of file <a class="el" href="normalize_8cpp_source.html">normalize.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;{</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordtype">double</span> avgbg, stddevbg;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    I.<a class="code" href="classMultidimArray.html#a9e0cf9e48e99338f7698c6018a0e7ee3">computeAvgStdev_within_binary_mask</a>(bg_mask, avgbg, stddevbg);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordtype">double</span> istddevbg=1.0/stddevbg;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#gad60a440a5ba86f9f7f40cf4a23682500">FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY</a>(I)</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(I,<a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>)=(<a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(I,<a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>)-avgbg)*istddevbg;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;}</div><div class="ttc" id="classMultidimArray_html_a9e0cf9e48e99338f7698c6018a0e7ee3"><div class="ttname"><a href="classMultidimArray.html#a9e0cf9e48e99338f7698c6018a0e7ee3">MultidimArray::computeAvgStdev_within_binary_mask</a></div><div class="ttdeci">void computeAvgStdev_within_binary_mask(const MultidimArray&lt; int &gt; &amp;mask, double &amp;avg, double &amp;stddev) const </div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l03459">multidim_array.h:3459</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga4ac4645adc643c1865419c09033c9f1d"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a></div><div class="ttdeci">#define DIRECT_MULTIDIM_ELEM(v, n)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00171">multidim_array.h:171</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_gad60a440a5ba86f9f7f40cf4a23682500"><div class="ttname"><a href="group__MultidimensionalArrays.html#gad60a440a5ba86f9f7f40cf4a23682500">FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY</a></div><div class="ttdeci">#define FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY(v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00186">multidim_array.h:186</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_a76f11d9a0a47b94f72c2d0e77fb32240"><div class="ttname"><a href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a></div><div class="ttdeci">int * n</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02246">numerical_recipes.cpp:2246</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga7f05e421067893cdc87c7c224962f991"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void normalize_NewXmipp2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>I</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>bg_mask</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>NewXmipp 2's normalization.</p>
<p>Formula: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;I&#39;=(I-m(bg))/(m(I)-m(bg))</div></div><!-- fragment --><p> Properties: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;m(I&#39;)=m(X)/sqrt(v(n))               m(bg(I&#39;))=0</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;v(I&#39;)=(v(X)+v(n))/v(n)              v(bg(I&#39;))=1</div></div><!-- fragment --><p> Comments: In general, we cannot assure that mass projects into positive numbers, so the "denoising" capability directly on the images is disabled. However, a positivity constraint can be applied on the 3D volume. </p>

<p>Definition at line <a class="el" href="normalize_8cpp_source.html#l00284">284</a> of file <a class="el" href="normalize_8cpp_source.html">normalize.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;{</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordtype">double</span> avg=0, stddev, <a class="code" href="image__operate_8cpp.html#afbbd36781c10524238c70745c6f6f35d">min</a>, <a class="code" href="image__operate_8cpp.html#ac5474a01d203d14c046620266b2f1954">max</a>;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordtype">double</span> avgbg=0, stddevbg, minbg, maxbg;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    I.<a class="code" href="classMultidimArray.html#ab648c97e18d063ce966db9c61b68f066">computeStats</a>(avg, stddev, min, max);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <a class="code" href="group__Masks.html#ga5bd552c32d3d6b6abd6ddf18677cf647">computeStats_within_binary_mask</a>(bg_mask, I, minbg, maxbg, avgbg,</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                                    stddevbg);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="libraries_2data_2integration_8cpp.html#a97d832ae23af4f215e801e37e4f94254">K</a>=1.0/fabs(avg - avgbg);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#gad60a440a5ba86f9f7f40cf4a23682500">FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY</a>(I)</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(I,<a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>)=(<a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(I,<a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>)-avgbg)*K;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;}</div><div class="ttc" id="image__operate_8cpp_html_afbbd36781c10524238c70745c6f6f35d"><div class="ttname"><a href="image__operate_8cpp.html#afbbd36781c10524238c70745c6f6f35d">min</a></div><div class="ttdeci">void min(Image&lt; double &gt; &amp;op1, const Image&lt; double &gt; &amp;op2)</div><div class="ttdef"><b>Definition:</b> <a href="image__operate_8cpp_source.html#l00115">image_operate.cpp:115</a></div></div>
<div class="ttc" id="classMultidimArray_html_ab648c97e18d063ce966db9c61b68f066"><div class="ttname"><a href="classMultidimArray.html#ab648c97e18d063ce966db9c61b68f066">MultidimArray::computeStats</a></div><div class="ttdeci">void computeStats(double &amp;avg, double &amp;stddev, T &amp;minval, T &amp;maxval) const </div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l03377">multidim_array.h:3377</a></div></div>
<div class="ttc" id="group__Masks_html_ga5bd552c32d3d6b6abd6ddf18677cf647"><div class="ttname"><a href="group__Masks.html#ga5bd552c32d3d6b6abd6ddf18677cf647">computeStats_within_binary_mask</a></div><div class="ttdeci">void computeStats_within_binary_mask(const MultidimArray&lt; T1 &gt; &amp;mask, const MultidimArray&lt; T &gt; &amp;m, double &amp;min_val, double &amp;max_val, double &amp;avg, double &amp;stddev)</div><div class="ttdef"><b>Definition:</b> <a href="mask_8h_source.html#l00804">mask.h:804</a></div></div>
<div class="ttc" id="image__operate_8cpp_html_ac5474a01d203d14c046620266b2f1954"><div class="ttname"><a href="image__operate_8cpp.html#ac5474a01d203d14c046620266b2f1954">max</a></div><div class="ttdeci">void max(Image&lt; double &gt; &amp;op1, const Image&lt; double &gt; &amp;op2)</div><div class="ttdef"><b>Definition:</b> <a href="image__operate_8cpp_source.html#l00125">image_operate.cpp:125</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga4ac4645adc643c1865419c09033c9f1d"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a></div><div class="ttdeci">#define DIRECT_MULTIDIM_ELEM(v, n)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00171">multidim_array.h:171</a></div></div>
<div class="ttc" id="libraries_2data_2integration_8cpp_html_a97d832ae23af4f215e801e37e4f94254"><div class="ttname"><a href="libraries_2data_2integration_8cpp.html#a97d832ae23af4f215e801e37e4f94254">K</a></div><div class="ttdeci">#define K</div><div class="ttdef"><b>Definition:</b> <a href="libraries_2data_2integration_8cpp_source.html#l00118">integration.cpp:118</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_gad60a440a5ba86f9f7f40cf4a23682500"><div class="ttname"><a href="group__MultidimensionalArrays.html#gad60a440a5ba86f9f7f40cf4a23682500">FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY</a></div><div class="ttdeci">#define FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY(v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00186">multidim_array.h:186</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_a76f11d9a0a47b94f72c2d0e77fb32240"><div class="ttname"><a href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a></div><div class="ttdeci">int * n</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02246">numerical_recipes.cpp:2246</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga3816a01b39c37c2b6fbc27841426d375"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void normalize_OldXmipp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>I</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>OldXmipp normalization.</p>
<p>Formula: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;I&#39;=(I-m(I))/sqrt(v(I))</div></div><!-- fragment --><p> Properties: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;m(I&#39;)=0                             m(bg(I&#39;))=-m(x)/sqrt((v(X)+v(n)))</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;v(I&#39;)=1                             v(bg(I&#39;))=v(n)/(v(X)+v(n))</div></div><!-- fragment --><p> Comments: it's not bad but positivity constraints cannot be imposed </p>

<p>Definition at line <a class="el" href="normalize_8cpp_source.html#l00036">36</a> of file <a class="el" href="normalize_8cpp_source.html">normalize.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;{</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordtype">double</span> mean,<a class="code" href="namespacestd.html">std</a>;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    I.<a class="code" href="classMultidimArray.html#a3e6470485fbdde47cb3238520568c28d">computeAvgStdev</a>(mean,std);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordtype">double</span> istd=1.0/std;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#gad60a440a5ba86f9f7f40cf4a23682500">FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY</a>(I)</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(I,<a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>)=(<a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(I,<a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>)-mean)*istd;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;}</div><div class="ttc" id="classMultidimArray_html_a3e6470485fbdde47cb3238520568c28d"><div class="ttname"><a href="classMultidimArray.html#a3e6470485fbdde47cb3238520568c28d">MultidimArray::computeAvgStdev</a></div><div class="ttdeci">void computeAvgStdev(U &amp;avg, U &amp;stddev) const </div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l03422">multidim_array.h:3422</a></div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdef"><b>Definition:</b> <a href="gtest_8h_source.html#l00663">gtest.h:663</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga4ac4645adc643c1865419c09033c9f1d"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a></div><div class="ttdeci">#define DIRECT_MULTIDIM_ELEM(v, n)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00171">multidim_array.h:171</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_gad60a440a5ba86f9f7f40cf4a23682500"><div class="ttname"><a href="group__MultidimensionalArrays.html#gad60a440a5ba86f9f7f40cf4a23682500">FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY</a></div><div class="ttdeci">#define FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY(v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00186">multidim_array.h:186</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_a76f11d9a0a47b94f72c2d0e77fb32240"><div class="ttname"><a href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a></div><div class="ttdeci">int * n</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02246">numerical_recipes.cpp:2246</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga329a2c9e0148ba20d02b9787888ee422"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void normalize_OldXmipp_decomposition </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>I</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>bg_mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; *&#160;</td>
          <td class="paramname"><em>mask</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>OldXmipp decomposition.</p>
<p>Formula: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;I&#39;=(I-b)/a*sqrt(v(n))</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;I&#39;&#39;=I&#39;*mask</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;I&#39;&#39;&#39;=(I&#39;&#39;-m(I&#39;&#39;))/sqrt(v(I&#39;&#39;))</div></div><!-- fragment --><p> Properties: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;m(I&#39;)=m(X)/sqrt(v(n))               m(bg(I&#39;))=0</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;v(I&#39;)=(v(X)+v(n))/v(n)              v(bg(I&#39;))=1</div></div><!-- fragment --><p> Comments: it's not bad but positivity constraints cannot be imposed. If no mask is applied, then this formula is a beautiful decomposition of the OldXmipp method in two steps. </p>

<p>Definition at line <a class="el" href="normalize_8cpp_source.html#l00056">56</a> of file <a class="el" href="normalize_8cpp_source.html">normalize.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;{</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordtype">double</span> avgbg, stddevbg, minbg, maxbg;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <a class="code" href="group__Masks.html#ga5bd552c32d3d6b6abd6ddf18677cf647">computeStats_within_binary_mask</a>(bg_mask, I, minbg, maxbg, avgbg,</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                                    stddevbg);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    I -= avgbg;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    I /= stddevbg;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordflow">if</span> (mask != NULL)</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        I *= *mask;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="group__Normalize.html#ga3816a01b39c37c2b6fbc27841426d375">normalize_OldXmipp</a>(I);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;}</div><div class="ttc" id="group__Masks_html_ga5bd552c32d3d6b6abd6ddf18677cf647"><div class="ttname"><a href="group__Masks.html#ga5bd552c32d3d6b6abd6ddf18677cf647">computeStats_within_binary_mask</a></div><div class="ttdeci">void computeStats_within_binary_mask(const MultidimArray&lt; T1 &gt; &amp;mask, const MultidimArray&lt; T &gt; &amp;m, double &amp;min_val, double &amp;max_val, double &amp;avg, double &amp;stddev)</div><div class="ttdef"><b>Definition:</b> <a href="mask_8h_source.html#l00804">mask.h:804</a></div></div>
<div class="ttc" id="group__Normalize_html_ga3816a01b39c37c2b6fbc27841426d375"><div class="ttname"><a href="group__Normalize.html#ga3816a01b39c37c2b6fbc27841426d375">normalize_OldXmipp</a></div><div class="ttdeci">void normalize_OldXmipp(MultidimArray&lt; double &gt; &amp;I)</div><div class="ttdef"><b>Definition:</b> <a href="normalize_8cpp_source.html#l00036">normalize.cpp:36</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gac947cd7ad53ceac5d45f230fb7cd2147"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void normalize_ramp </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>I</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; *&#160;</td>
          <td class="paramname"><em>bg_mask</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Removal of inclined background densities (ramps).</p>
<p>fitting of a least squares plane through the pixels in the bg_mask, then subtraction of the plane, and division by the standard deviation of the pixels in the bg_mask </p>

<p>Definition at line <a class="el" href="normalize_8cpp_source.html#l00296">296</a> of file <a class="el" href="normalize_8cpp_source.html">normalize.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;{</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordtype">int</span> Npoints=0;              <span class="comment">// # points in mask.</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordtype">double</span> pA, pB, pC;          <span class="comment">// Least squares coefficients.</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="comment">// Only 2D ramps implemented</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    I.checkDimension(2);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">// Check if mask is NULL.</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordflow">if</span> (bg_mask == NULL)</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        Npoints = I.<a class="code" href="classMultidimArrayBase.html#a6d50e69638ce9965ce56fbefa0840f2a">xdim</a>*I.<a class="code" href="classMultidimArrayBase.html#a239bae0a69ae7de31ed5627bdb65bda4">ydim</a>;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    }</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="comment">// Check if mask is not full of 0&#39;s.</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        Npoints=(int)bg_mask-&gt;<a class="code" href="classMultidimArray.html#a2917347534008460dd52e90049e4257f">sum</a>();</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="comment">// Fit a least squares plane through the background pixels</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    I.<a class="code" href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">setXmippOrigin</a>();</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">if</span> (bg_mask == NULL)</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <a class="code" href="group__Geometry.html#ga132d339f9935014a8df1c1073e6400cd">least_squares_plane_fit_All_Points</a>(I, pA, pB, pC);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    }</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    {</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keywordtype">int</span> idx=0;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        bg_mask-&gt;<a class="code" href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">setXmippOrigin</a>();</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <a class="code" href="structFitPoint.html">FitPoint</a> *allpoints=<span class="keyword">new</span> <a class="code" href="structFitPoint.html">FitPoint</a>[Npoints];</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <a class="code" href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a>(I)</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        {</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>( *bg_mask, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>))</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            {</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                <a class="code" href="structFitPoint.html">FitPoint</a> &amp;p=allpoints[idx++];</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                p.<a class="code" href="structFitPoint.html#ab99c7363be00be51a757b651d0e3c1ad">x</a> = <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                p.<a class="code" href="structFitPoint.html#af985f5a0c42728bacb9b8a34e52c7740">y</a> = <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                p.<a class="code" href="structFitPoint.html#a92d92a0a18160ec456e56ace85c9eddb">z</a> = <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                p.<a class="code" href="structFitPoint.html#aedc11e94cbd1158d90508a91223fbd13">w</a> = 1.;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        }</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <a class="code" href="group__Geometry.html#ga390c0b3d3c4ee8857d9c9e5ab36d7f30">least_squares_plane_fit</a>(allpoints, Npoints, pA, pB, pC);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keyword">delete</span> [] allpoints;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    }</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">// Subtract the plane from the image and compute stddev within mask</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordtype">double</span> sum1 = 0;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordtype">double</span> sum2 = 0;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">if</span> (bg_mask == NULL)</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    {</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="keywordtype">double</span> *ref;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=<a class="code" href="group__MultidimensionalArrays.html#ga6557f9334712651f0c240ec8bf03a8d8">STARTINGY</a>(I); <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=<a class="code" href="group__MultidimensionalArrays.html#gab21d2b58d5f934e687856c15fb59acf5">FINISHINGY</a>(I); <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            <span class="keywordtype">double</span> aux=pB * <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> + pC;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            ref = &amp;<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="group__MultidimensionalArrays.html#gad48b8b757cdd227ab33a016449982592">STARTINGX</a>(I));</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>=<a class="code" href="group__MultidimensionalArrays.html#gad48b8b757cdd227ab33a016449982592">STARTINGX</a>(I); <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>&lt;=<a class="code" href="group__MultidimensionalArrays.html#ga494f0325c3fd49f368cad0e45e6a386a">FINISHINGX</a>(I); <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>++)</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            {</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                (*ref) -= pA * <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> + aux;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                sum1 += (*ref);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                sum2 += (*ref)*(*ref);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                ref++;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            }</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        }</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    }</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    {</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=<a class="code" href="group__MultidimensionalArrays.html#ga6557f9334712651f0c240ec8bf03a8d8">STARTINGY</a>(I); <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=<a class="code" href="group__MultidimensionalArrays.html#gab21d2b58d5f934e687856c15fb59acf5">FINISHINGY</a>(I); <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        {</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            <span class="keywordtype">double</span> aux=pB * <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> + pC;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>=<a class="code" href="group__MultidimensionalArrays.html#gad48b8b757cdd227ab33a016449982592">STARTINGX</a>(I); <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>&lt;=<a class="code" href="group__MultidimensionalArrays.html#ga494f0325c3fd49f368cad0e45e6a386a">FINISHINGX</a>(I); <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>++)</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) -= pA * <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> + aux;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>( *bg_mask, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>))</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                {</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                    <span class="keywordtype">double</span> aux=<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                    sum1 += aux;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                    sum2 += aux*aux;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                }</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            }</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        }</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordtype">double</span> avgbg  = sum1 / Npoints;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordtype">double</span> stddevbg = <a class="code" href="image__operate_8cpp.html#aba02a4405b44e10470c7af98477800a9">sqrt</a>(fabs(sum2 / Npoints - avgbg * avgbg) * Npoints / (Npoints - 1));</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">if</span> (stddevbg&gt;1e-6)</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    {</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        I *= 1.0/stddevbg;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    }</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;}</div><div class="ttc" id="group__MultidimensionalArrays_html_ga9cf9c3a95f2270982504fd5e40133864"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a></div><div class="ttdeci">#define A2D_ELEM(v, i, j)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00364">multidim_array.h:364</a></div></div>
<div class="ttc" id="group__Geometry_html_ga390c0b3d3c4ee8857d9c9e5ab36d7f30"><div class="ttname"><a href="group__Geometry.html#ga390c0b3d3c4ee8857d9c9e5ab36d7f30">least_squares_plane_fit</a></div><div class="ttdeci">void least_squares_plane_fit(FitPoint *IN_points, int Npoints, double &amp;plane_a, double &amp;plane_b, double &amp;plane_c)</div><div class="ttdef"><b>Definition:</b> <a href="geometry_8cpp_source.html#l00098">geometry.cpp:98</a></div></div>
<div class="ttc" id="structFitPoint_html_a92d92a0a18160ec456e56ace85c9eddb"><div class="ttname"><a href="structFitPoint.html#a92d92a0a18160ec456e56ace85c9eddb">FitPoint::z</a></div><div class="ttdeci">double z</div><div class="ttdoc">z coordinate, assumed to be a function of x and y </div><div class="ttdef"><b>Definition:</b> <a href="geometry_8h_source.html#l00190">geometry.h:190</a></div></div>
<div class="ttc" id="image__operate_8cpp_html_aba02a4405b44e10470c7af98477800a9"><div class="ttname"><a href="image__operate_8cpp.html#aba02a4405b44e10470c7af98477800a9">sqrt</a></div><div class="ttdeci">void sqrt(Image&lt; double &gt; &amp;op)</div><div class="ttdef"><b>Definition:</b> <a href="image__operate_8cpp_source.html#l00207">image_operate.cpp:207</a></div></div>
<div class="ttc" id="structFitPoint_html_ab99c7363be00be51a757b651d0e3c1ad"><div class="ttname"><a href="structFitPoint.html#ab99c7363be00be51a757b651d0e3c1ad">FitPoint::x</a></div><div class="ttdeci">double x</div><div class="ttdoc">x coordinate </div><div class="ttdef"><b>Definition:</b> <a href="geometry_8h_source.html#l00186">geometry.h:186</a></div></div>
<div class="ttc" id="structFitPoint_html_aedc11e94cbd1158d90508a91223fbd13"><div class="ttname"><a href="structFitPoint.html#aedc11e94cbd1158d90508a91223fbd13">FitPoint::w</a></div><div class="ttdeci">double w</div><div class="ttdoc">Weight of the point in the Least-Squares problem. </div><div class="ttdef"><b>Definition:</b> <a href="geometry_8h_source.html#l00192">geometry.h:192</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga494f0325c3fd49f368cad0e45e6a386a"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga494f0325c3fd49f368cad0e45e6a386a">FINISHINGX</a></div><div class="ttdeci">#define FINISHINGX(v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00065">multidim_array.h:65</a></div></div>
<div class="ttc" id="classMultidimArrayBase_html_a239bae0a69ae7de31ed5627bdb65bda4"><div class="ttname"><a href="classMultidimArrayBase.html#a239bae0a69ae7de31ed5627bdb65bda4">MultidimArrayBase::ydim</a></div><div class="ttdeci">size_t ydim</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00726">multidim_array.h:726</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">#define i</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02510">numerical_recipes.cpp:2510</a></div></div>
<div class="ttc" id="classMultidimArrayBase_html_a0d4d898ee3a033a6f050cbdc3806b8fb"><div class="ttname"><a href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">MultidimArrayBase::setXmippOrigin</a></div><div class="ttdeci">void setXmippOrigin()</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8cpp_source.html#l00197">multidim_array.cpp:197</a></div></div>
<div class="ttc" id="classMultidimArrayBase_html_a6d50e69638ce9965ce56fbefa0840f2a"><div class="ttname"><a href="classMultidimArrayBase.html#a6d50e69638ce9965ce56fbefa0840f2a">MultidimArrayBase::xdim</a></div><div class="ttdeci">size_t xdim</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00729">multidim_array.h:729</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga6557f9334712651f0c240ec8bf03a8d8"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga6557f9334712651f0c240ec8bf03a8d8">STARTINGY</a></div><div class="ttdeci">#define STARTINGY(v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00069">multidim_array.h:69</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga7fa7d580ab43d192c7933abd008bc756"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a></div><div class="ttdeci">#define FOR_ALL_ELEMENTS_IN_ARRAY2D(m)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00400">multidim_array.h:400</a></div></div>
<div class="ttc" id="classMultidimArray_html_a2917347534008460dd52e90049e4257f"><div class="ttname"><a href="classMultidimArray.html#a2917347534008460dd52e90049e4257f">MultidimArray::sum</a></div><div class="ttdeci">double sum() const </div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l05095">multidim_array.h:5095</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_gad48b8b757cdd227ab33a016449982592"><div class="ttname"><a href="group__MultidimensionalArrays.html#gad48b8b757cdd227ab33a016449982592">STARTINGX</a></div><div class="ttdeci">#define STARTINGX(v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00061">multidim_array.h:61</a></div></div>
<div class="ttc" id="structFitPoint_html_af985f5a0c42728bacb9b8a34e52c7740"><div class="ttname"><a href="structFitPoint.html#af985f5a0c42728bacb9b8a34e52c7740">FitPoint::y</a></div><div class="ttdeci">double y</div><div class="ttdoc">y coordinate </div><div class="ttdef"><b>Definition:</b> <a href="geometry_8h_source.html#l00188">geometry.h:188</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_aae82a1338cf72eb9a1cc7043f569537e"><div class="ttname"><a href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a></div><div class="ttdeci">#define j</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02510">numerical_recipes.cpp:2510</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_gab21d2b58d5f934e687856c15fb59acf5"><div class="ttname"><a href="group__MultidimensionalArrays.html#gab21d2b58d5f934e687856c15fb59acf5">FINISHINGY</a></div><div class="ttdeci">#define FINISHINGY(v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00073">multidim_array.h:73</a></div></div>
<div class="ttc" id="structFitPoint_html"><div class="ttname"><a href="structFitPoint.html">FitPoint</a></div><div class="ttdef"><b>Definition:</b> <a href="geometry_8h_source.html#l00183">geometry.h:183</a></div></div>
<div class="ttc" id="group__Geometry_html_ga132d339f9935014a8df1c1073e6400cd"><div class="ttname"><a href="group__Geometry.html#ga132d339f9935014a8df1c1073e6400cd">least_squares_plane_fit_All_Points</a></div><div class="ttdeci">void least_squares_plane_fit_All_Points(const MultidimArray&lt; double &gt; &amp;Image, double &amp;plane_a, double &amp;plane_b, double &amp;plane_c)</div><div class="ttdef"><b>Definition:</b> <a href="geometry_8cpp_source.html#l00151">geometry.cpp:151</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaaa5c1b883cdb3ae7017d1e1d7075b33c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void normalize_remove_neighbours </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>I</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>bg_mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double &amp;&#160;</td>
          <td class="paramname"><em>threshold</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Removal of neighbouring particles.</p>
<p>.... </p>

<p>Definition at line <a class="el" href="normalize_8cpp_source.html#l00388">388</a> of file <a class="el" href="normalize_8cpp_source.html">normalize.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;{</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordtype">double</span>             pA, pB, pC;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordtype">double</span>             avgbg, stddevbg, minbg, maxbg, aux, newstddev;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordtype">double</span>             sum1 = 0.;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordtype">double</span>             sum2 = 0;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordtype">int</span>                N = 0;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="comment">// Only implemented for 2D arrays</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    I.checkDimension(2);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="comment">// Fit a least squares plane through the background pixels</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordtype">int</span> Npoints=(int)bg_mask.<a class="code" href="classMultidimArray.html#a2917347534008460dd52e90049e4257f">sum</a>();</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <a class="code" href="structFitPoint.html">FitPoint</a> *allpoints=<span class="keyword">new</span> <a class="code" href="structFitPoint.html">FitPoint</a>[Npoints];</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    I.<a class="code" href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">setXmippOrigin</a>();</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="comment">// Get initial statistics</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <a class="code" href="group__Masks.html#ga5bd552c32d3d6b6abd6ddf18677cf647">computeStats_within_binary_mask</a>(bg_mask, I, minbg, maxbg, avgbg,stddevbg);</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="comment">// Fit plane through those pixels within +/- threshold*sigma</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordtype">int</span> idx=0;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a>(I)</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    {</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(bg_mask, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>))</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        {</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            <span class="keywordflow">if</span> ( fabs(avgbg - <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)) &lt; <a class="code" href="lib__vwk_8cpp.html#a2834b5125eb5ac411feb578af1fac2ea">threshold</a> * stddevbg)</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            {</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                <a class="code" href="structFitPoint.html">FitPoint</a> &amp;p=allpoints[idx++];</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                p.<a class="code" href="structFitPoint.html#ab99c7363be00be51a757b651d0e3c1ad">x</a> = <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                p.<a class="code" href="structFitPoint.html#af985f5a0c42728bacb9b8a34e52c7740">y</a> = <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                p.<a class="code" href="structFitPoint.html#a92d92a0a18160ec456e56ace85c9eddb">z</a> = <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                p.<a class="code" href="structFitPoint.html#aedc11e94cbd1158d90508a91223fbd13">w</a> = 1.;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            }</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        }</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    }</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <a class="code" href="group__Geometry.html#ga390c0b3d3c4ee8857d9c9e5ab36d7f30">least_squares_plane_fit</a>(allpoints, Npoints, pA, pB, pC);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keyword">delete</span> []allpoints;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="comment">// Subtract the plane from the image</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a>(I)</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    {</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>) -= pA * <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> + pB * <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> + pC;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    }</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="comment">// Get std.dev. of the background pixels within +/- threshold*sigma</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a>(I)</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    {</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(bg_mask, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>))</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        {</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            <span class="keywordflow">if</span> ( <a class="code" href="group__Macros.html#ga996f7be338ccb40d1a2a5abc1ad61759">ABS</a>(<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)) &lt; <a class="code" href="lib__vwk_8cpp.html#a2834b5125eb5ac411feb578af1fac2ea">threshold</a> * stddevbg)</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            {</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                N++;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                sum1 +=  (double) <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                sum2 += ((double) <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)) *</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                        ((<span class="keywordtype">double</span>) <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>));</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        }</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    }</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="comment">// average and standard deviation</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">if</span> (0 == N) {</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <a class="code" href="group__ErrorHandling.html#ga4ab7f9b2fd1ec4b9efcfba0c9b33052c">REPORT_ERROR</a>(<a class="code" href="group__ErrorHandling.html#ggab0df38968e4f03a3f1f6d6df0f31f45aa22981b63092f2ecbaee8984f0bc9867c">ERR_NUMERICAL</a>, <span class="stringliteral">&quot;N is zero (0), which would lead to division by zero&quot;</span>);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    }</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    aux = sum1 / (double) N;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    newstddev = <a class="code" href="image__operate_8cpp.html#aba02a4405b44e10470c7af98477800a9">sqrt</a>(fabs(sum2 / N - aux*aux) * N / (N - 1));</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="comment">// Replace pixels outside +/- threshold*sigma by samples from</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="comment">// a gaussian with avg-plane and newstddev</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a>(I)</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    {</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(bg_mask, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>))</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        {</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            <span class="keywordflow">if</span> ( fabs(<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)) &gt; <a class="code" href="lib__vwk_8cpp.html#a2834b5125eb5ac411feb578af1fac2ea">threshold</a> * stddevbg)</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            {</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                <span class="comment">// get local average</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                aux = pA * <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a> + pB * <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a> + pC;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I, <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>, <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)=<a class="code" href="group__GeneralFunctions.html#gaa9eace3a9deaad3f11f57a37f8787e9b">rnd_gaus</a>(aux, newstddev );</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            }</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        }</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    }</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="comment">// Divide the entire image by the new background</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    I /= newstddev;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;}</div><div class="ttc" id="group__MultidimensionalArrays_html_ga9cf9c3a95f2270982504fd5e40133864"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a></div><div class="ttdeci">#define A2D_ELEM(v, i, j)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00364">multidim_array.h:364</a></div></div>
<div class="ttc" id="group__Geometry_html_ga390c0b3d3c4ee8857d9c9e5ab36d7f30"><div class="ttname"><a href="group__Geometry.html#ga390c0b3d3c4ee8857d9c9e5ab36d7f30">least_squares_plane_fit</a></div><div class="ttdeci">void least_squares_plane_fit(FitPoint *IN_points, int Npoints, double &amp;plane_a, double &amp;plane_b, double &amp;plane_c)</div><div class="ttdef"><b>Definition:</b> <a href="geometry_8cpp_source.html#l00098">geometry.cpp:98</a></div></div>
<div class="ttc" id="group__ErrorHandling_html_ga4ab7f9b2fd1ec4b9efcfba0c9b33052c"><div class="ttname"><a href="group__ErrorHandling.html#ga4ab7f9b2fd1ec4b9efcfba0c9b33052c">REPORT_ERROR</a></div><div class="ttdeci">#define REPORT_ERROR(nerr, ErrormMsg)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__error_8h_source.html#l00238">xmipp_error.h:238</a></div></div>
<div class="ttc" id="structFitPoint_html_a92d92a0a18160ec456e56ace85c9eddb"><div class="ttname"><a href="structFitPoint.html#a92d92a0a18160ec456e56ace85c9eddb">FitPoint::z</a></div><div class="ttdeci">double z</div><div class="ttdoc">z coordinate, assumed to be a function of x and y </div><div class="ttdef"><b>Definition:</b> <a href="geometry_8h_source.html#l00190">geometry.h:190</a></div></div>
<div class="ttc" id="image__operate_8cpp_html_aba02a4405b44e10470c7af98477800a9"><div class="ttname"><a href="image__operate_8cpp.html#aba02a4405b44e10470c7af98477800a9">sqrt</a></div><div class="ttdeci">void sqrt(Image&lt; double &gt; &amp;op)</div><div class="ttdef"><b>Definition:</b> <a href="image__operate_8cpp_source.html#l00207">image_operate.cpp:207</a></div></div>
<div class="ttc" id="structFitPoint_html_ab99c7363be00be51a757b651d0e3c1ad"><div class="ttname"><a href="structFitPoint.html#ab99c7363be00be51a757b651d0e3c1ad">FitPoint::x</a></div><div class="ttdeci">double x</div><div class="ttdoc">x coordinate </div><div class="ttdef"><b>Definition:</b> <a href="geometry_8h_source.html#l00186">geometry.h:186</a></div></div>
<div class="ttc" id="structFitPoint_html_aedc11e94cbd1158d90508a91223fbd13"><div class="ttname"><a href="structFitPoint.html#aedc11e94cbd1158d90508a91223fbd13">FitPoint::w</a></div><div class="ttdeci">double w</div><div class="ttdoc">Weight of the point in the Least-Squares problem. </div><div class="ttdef"><b>Definition:</b> <a href="geometry_8h_source.html#l00192">geometry.h:192</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">#define i</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02510">numerical_recipes.cpp:2510</a></div></div>
<div class="ttc" id="group__Masks_html_ga5bd552c32d3d6b6abd6ddf18677cf647"><div class="ttname"><a href="group__Masks.html#ga5bd552c32d3d6b6abd6ddf18677cf647">computeStats_within_binary_mask</a></div><div class="ttdeci">void computeStats_within_binary_mask(const MultidimArray&lt; T1 &gt; &amp;mask, const MultidimArray&lt; T &gt; &amp;m, double &amp;min_val, double &amp;max_val, double &amp;avg, double &amp;stddev)</div><div class="ttdef"><b>Definition:</b> <a href="mask_8h_source.html#l00804">mask.h:804</a></div></div>
<div class="ttc" id="classMultidimArrayBase_html_a0d4d898ee3a033a6f050cbdc3806b8fb"><div class="ttname"><a href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">MultidimArrayBase::setXmippOrigin</a></div><div class="ttdeci">void setXmippOrigin()</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8cpp_source.html#l00197">multidim_array.cpp:197</a></div></div>
<div class="ttc" id="lib__vwk_8cpp_html_a2834b5125eb5ac411feb578af1fac2ea"><div class="ttname"><a href="lib__vwk_8cpp.html#a2834b5125eb5ac411feb578af1fac2ea">threshold</a></div><div class="ttdeci">void threshold(double *phi, unsigned long nvox, double limit)</div><div class="ttdef"><b>Definition:</b> <a href="lib__vwk_8cpp_source.html#l00524">lib_vwk.cpp:524</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga7fa7d580ab43d192c7933abd008bc756"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a></div><div class="ttdeci">#define FOR_ALL_ELEMENTS_IN_ARRAY2D(m)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00400">multidim_array.h:400</a></div></div>
<div class="ttc" id="group__ErrorHandling_html_ggab0df38968e4f03a3f1f6d6df0f31f45aa22981b63092f2ecbaee8984f0bc9867c"><div class="ttname"><a href="group__ErrorHandling.html#ggab0df38968e4f03a3f1f6d6df0f31f45aa22981b63092f2ecbaee8984f0bc9867c">ERR_NUMERICAL</a></div><div class="ttdoc">Error related to numerical calculation. </div><div class="ttdef"><b>Definition:</b> <a href="xmipp__error_8h_source.html#l00184">xmipp_error.h:184</a></div></div>
<div class="ttc" id="group__Macros_html_ga996f7be338ccb40d1a2a5abc1ad61759"><div class="ttname"><a href="group__Macros.html#ga996f7be338ccb40d1a2a5abc1ad61759">ABS</a></div><div class="ttdeci">#define ABS(x)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00142">xmipp_macros.h:142</a></div></div>
<div class="ttc" id="classMultidimArray_html_a2917347534008460dd52e90049e4257f"><div class="ttname"><a href="classMultidimArray.html#a2917347534008460dd52e90049e4257f">MultidimArray::sum</a></div><div class="ttdeci">double sum() const </div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l05095">multidim_array.h:5095</a></div></div>
<div class="ttc" id="structFitPoint_html_af985f5a0c42728bacb9b8a34e52c7740"><div class="ttname"><a href="structFitPoint.html#af985f5a0c42728bacb9b8a34e52c7740">FitPoint::y</a></div><div class="ttdeci">double y</div><div class="ttdoc">y coordinate </div><div class="ttdef"><b>Definition:</b> <a href="geometry_8h_source.html#l00188">geometry.h:188</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_aae82a1338cf72eb9a1cc7043f569537e"><div class="ttname"><a href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a></div><div class="ttdeci">#define j</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02510">numerical_recipes.cpp:2510</a></div></div>
<div class="ttc" id="structFitPoint_html"><div class="ttname"><a href="structFitPoint.html">FitPoint</a></div><div class="ttdef"><b>Definition:</b> <a href="geometry_8h_source.html#l00183">geometry.h:183</a></div></div>
<div class="ttc" id="group__GeneralFunctions_html_gaa9eace3a9deaad3f11f57a37f8787e9b"><div class="ttname"><a href="group__GeneralFunctions.html#gaa9eace3a9deaad3f11f57a37f8787e9b">rnd_gaus</a></div><div class="ttdeci">double rnd_gaus()</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__funcs_8cpp_source.html#l00457">xmipp_funcs.cpp:457</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaa81fefa03525c5f4981dcadc2392fe07"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void normalize_Robust </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>I</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>bg_mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>clip</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="normalize_8cpp_source.html#l00247">247</a> of file <a class="el" href="normalize_8cpp_source.html">normalize.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;{</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    std::vector&lt;double&gt; voxel_vector;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordtype">double</span> maxI, minI;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <a class="code" href="group__Macros.html#ga536d5c60e25ce994a433d115ca6de5c9">SPEED_UP_temps</a>;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    </div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#gad60a440a5ba86f9f7f40cf4a23682500">FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY</a>(bg_mask)</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    {</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(bg_mask, <a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) == 0)</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            voxel_vector.push_back(<a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(I,<a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>));</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="sorting_8cpp.html#acffaa2cf1dee75a78d918a708a5fb87a">std::sort</a>(voxel_vector.begin(), voxel_vector.end());</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordtype">double</span> medianBg, p95, ip95;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    I.<a class="code" href="classMultidimArray.html#a8fd0f3d0cf98875fa87cbfed35c5c09c">computeMedian_within_binary_mask</a>(bg_mask, medianBg);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    idx = voxel_vector.size() * 0.95;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    p95 = voxel_vector[idx];</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    ip95 = 1 / p95;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#gad60a440a5ba86f9f7f40cf4a23682500">FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY</a>(I)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(I,<a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>)=(<a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(I,<a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) - medianBg) * ip95;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <a class="code" href="numerical__recipes_8cpp.html#aba441ebef6931295ba1cb63e2cca89a8">if</a> (clip)</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <a class="code" href="group__MultidimensionalArrays.html#gad60a440a5ba86f9f7f40cf4a23682500">FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY</a>(I)</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <a class="code" href="numerical__recipes_8cpp.html#aba441ebef6931295ba1cb63e2cca89a8">if</a> (<a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(I,<a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) &gt; 1.8787)</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            {</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                <a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(I,n) = 1.8787;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            }</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(I,<a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) &lt; -1.8787)</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            {</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                <a class="code" href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a>(I,<a class="code" href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) = -1.8787;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            }           </div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    }</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;}</div><div class="ttc" id="classMultidimArray_html_a8fd0f3d0cf98875fa87cbfed35c5c09c"><div class="ttname"><a href="classMultidimArray.html#a8fd0f3d0cf98875fa87cbfed35c5c09c">MultidimArray::computeMedian_within_binary_mask</a></div><div class="ttdeci">void computeMedian_within_binary_mask(const MultidimArray&lt; int &gt; &amp;mask, double &amp;median) const </div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l03485">multidim_array.h:3485</a></div></div>
<div class="ttc" id="sorting_8cpp_html_acffaa2cf1dee75a78d918a708a5fb87a"><div class="ttname"><a href="sorting_8cpp.html#acffaa2cf1dee75a78d918a708a5fb87a">sort</a></div><div class="ttdeci">void sort(struct DCEL_T *dcel)</div><div class="ttdef"><b>Definition:</b> <a href="sorting_8cpp_source.html#l00018">sorting.cpp:18</a></div></div>
<div class="ttc" id="group__Macros_html_ga536d5c60e25ce994a433d115ca6de5c9"><div class="ttname"><a href="group__Macros.html#ga536d5c60e25ce994a433d115ca6de5c9">SPEED_UP_temps</a></div><div class="ttdeci">#define SPEED_UP_temps</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00419">xmipp_macros.h:419</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga4ac4645adc643c1865419c09033c9f1d"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga4ac4645adc643c1865419c09033c9f1d">DIRECT_MULTIDIM_ELEM</a></div><div class="ttdeci">#define DIRECT_MULTIDIM_ELEM(v, n)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00171">multidim_array.h:171</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_gad60a440a5ba86f9f7f40cf4a23682500"><div class="ttname"><a href="group__MultidimensionalArrays.html#gad60a440a5ba86f9f7f40cf4a23682500">FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY</a></div><div class="ttdeci">#define FOR_ALL_DIRECT_ELEMENTS_IN_MULTIDIMARRAY(v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00186">multidim_array.h:186</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_a76f11d9a0a47b94f72c2d0e77fb32240"><div class="ttname"><a href="numerical__recipes_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a></div><div class="ttdeci">int * n</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02246">numerical_recipes.cpp:2246</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_aba441ebef6931295ba1cb63e2cca89a8"><div class="ttname"><a href="numerical__recipes_8cpp.html#aba441ebef6931295ba1cb63e2cca89a8">if</a></div><div class="ttdeci">if(fabs(c[*nmax+*nmax *c_dim1])==0.e0)</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02296">numerical_recipes.cpp:2296</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gafb921d78efb86e7fc4ea5afe5d48be37"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void normalize_tomography </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classMultidimArray.html">MultidimArray</a>&lt; double &gt; &amp;&#160;</td>
          <td class="paramname"><em>I</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>tilt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double &amp;&#160;</td>
          <td class="paramname"><em>mui</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double &amp;&#160;</td>
          <td class="paramname"><em>sigmai</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>tiltMask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>tomography0</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>mu0</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>sigma0</em> = <code>1</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Tomography normalization.</p>
<p>This is similar to the OldXmipp normalization, but the mean and standard deviation of the images are computed only within a region determined by the tilt angle. Formula for tomography: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;I&#39;=(I-m(I))/(sqrt(v(I))*cos^2(tilt))</div></div><!-- fragment --><p>Formula for tomography0: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;I&#39;=(I/cos(tilt)-m0)/(sqrt(v(I))*cos(tilt))</div></div><!-- fragment --><p>The estimated mean of the image and the local variance are returned in sigmai and mui. </p>

<p>Definition at line <a class="el" href="normalize_8cpp_source.html#l00070">70</a> of file <a class="el" href="normalize_8cpp_source.html">normalize.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;{</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// Tilt series are always 2D</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    I.checkDimension(2);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> L=2;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">// Build a mask using the tilt angle</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    I.<a class="code" href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">setXmippOrigin</a>();</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;int&gt;</a> mask;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    mask.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>(I);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordtype">int</span> Xdimtilt=(int)<a class="code" href="group__Macros.html#gac9ae6a207f10c821b06a8c0df153a7d5">XMIPP_MIN</a>(<a class="code" href="group__Macros.html#ga2f0eecb0f7856721f56faff8f27b0dc1">FLOOR</a>(0.5*(<a class="code" href="group__MultidimensionalArrays.html#ga4b3f38e76847a3fbe3e579610b23ad29">XSIZE</a>(I)*cos(<a class="code" href="group__Macros.html#gadec1e6bbd34c5cf8765a457da4876c91">DEG2RAD</a>(tilt)))),</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                           0.5*(<a class="code" href="group__MultidimensionalArrays.html#ga4b3f38e76847a3fbe3e579610b23ad29">XSIZE</a>(I)-(2*L+1)));</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordtype">int</span> N=0;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>=<a class="code" href="group__MultidimensionalArrays.html#ga6557f9334712651f0c240ec8bf03a8d8">STARTINGY</a>(I); <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;=<a class="code" href="group__MultidimensionalArrays.html#gab21d2b58d5f934e687856c15fb59acf5">FINISHINGY</a>(I); <a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>=-Xdimtilt; <a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>&lt;=Xdimtilt;<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>++)</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        {</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(mask,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)=1;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            N++;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        }</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">// Estimate the local variance</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="classMultidimArray.html">MultidimArray&lt;double&gt;</a> localVariance;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    localVariance.<a class="code" href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">initZeros</a>(I);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordtype">double</span> meanVariance=0;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a>(I)</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="comment">// Center a mask of size 5x5 and estimate the variance within the mask</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="keywordtype">double</span> meanPiece=0, variancePiece=0;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="keywordtype">double</span> Npiece=0;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii=<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>-L; ii&lt;=<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>+L; ii++)</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="group__MultidimensionalArrays.html#ga93566c818a8b508272dd62e7104419b8">INSIDEY</a>(I,ii))</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jj=<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>-L; jj&lt;=<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>+L; jj++)</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="group__MultidimensionalArrays.html#ga972c277d0dea0031261b9b75faed04e2">INSIDEX</a>(I,jj))</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                    {</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                        <span class="keywordtype">double</span> pixval=<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I,ii,jj);</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                        meanPiece+=pixval;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                        variancePiece+=pixval*pixval;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                        ++Npiece;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                    }</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        meanPiece/=Npiece;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        variancePiece=variancePiece/(Npiece-1)-</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                      Npiece/(Npiece-1)*meanPiece*meanPiece;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(localVariance,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)=variancePiece;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        meanVariance+=variancePiece;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    }</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">if</span> (0 == N) {</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <a class="code" href="group__ErrorHandling.html#ga4ab7f9b2fd1ec4b9efcfba0c9b33052c">REPORT_ERROR</a>(<a class="code" href="group__ErrorHandling.html#ggab0df38968e4f03a3f1f6d6df0f31f45aa22981b63092f2ecbaee8984f0bc9867c">ERR_NUMERICAL</a>, <span class="stringliteral">&quot;N is zero (0), which would lead to division by zero&quot;</span>);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    }</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    meanVariance*=1.0/N;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">// Test the hypothesis that the variance in this piece is</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">// the same as the variance in the whole image</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordtype">double</span> iFu=1/<a class="code" href="group__GeneralFunctions.html#ga01582f05156bfe0180230bcceccdb484">icdf_FSnedecor</a>(4*L*L+4*L,N-1,0.975);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordtype">double</span> iFl=1/<a class="code" href="group__GeneralFunctions.html#ga01582f05156bfe0180230bcceccdb484">icdf_FSnedecor</a>(4*L*L+4*L,N-1,0.025);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordtype">double</span> iMeanVariance=1.0/meanVariance;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a>(localVariance)</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(localVariance,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)==0)</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(mask,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)=-2;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(mask,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)==1)</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        {</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            <span class="keywordtype">double</span> ratio=<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(localVariance,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)*iMeanVariance;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            <span class="keywordtype">double</span> thl=ratio*iFu;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            <span class="keywordtype">double</span> thu=ratio*iFl;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <span class="keywordflow">if</span> (thl&gt;1 || thu&lt;1)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(mask,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>)=-1;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        }</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="classImage.html">Image&lt;double&gt;</a> save;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    save()=I;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    save.<a class="code" href="classImageBase.html#ae81a8c11a832924c2bda0909882c3168">write</a>(<span class="stringliteral">&quot;PPP.xmp&quot;</span>);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    save()=localVariance;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    save.<a class="code" href="classImageBase.html#ae81a8c11a832924c2bda0909882c3168">write</a>(<span class="stringliteral">&quot;PPPLocalVariance.xmp&quot;</span>);</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <a class="code" href="classImage.html">Image&lt;int&gt;</a> savemask;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    savemask()=mask;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    savemask.<a class="code" href="classImageBase.html#ae81a8c11a832924c2bda0909882c3168">write</a>(<span class="stringliteral">&quot;PPPmask.xmp&quot;</span>);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="comment">// Compute the statistics again in the reduced mask</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordtype">double</span> avg, stddev, <a class="code" href="image__operate_8cpp.html#afbbd36781c10524238c70745c6f6f35d">min</a>, <a class="code" href="image__operate_8cpp.html#ac5474a01d203d14c046620266b2f1954">max</a>;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="group__Masks.html#ga5bd552c32d3d6b6abd6ddf18677cf647">computeStats_within_binary_mask</a>(mask, I, min, max, avg, stddev);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordtype">double</span> cosTilt=cos(<a class="code" href="group__Macros.html#gadec1e6bbd34c5cf8765a457da4876c91">DEG2RAD</a>(tilt));</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordtype">double</span> iCosTilt=1.0/cosTilt;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">if</span> (tomography0)</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordtype">double</span> iadjustedStddev=1.0/(sigma0*cosTilt);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <a class="code" href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a>(I)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <a class="code" href="numerical__recipes_8cpp.html#aefb1b99960fcc5e01a981373c311eb97">switch</a> (<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(mask,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>))</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        {</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordflow">case</span> -2:</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I,i,j)=0;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <span class="keywordflow">if</span> (tiltMask)</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I,i,j)=0;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I,i,j)=(<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I,i,j)*iCosTilt-mu0)*iadjustedStddev;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">case</span> -1:</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I,i,j)=(<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I,i,j)*iCosTilt-mu0)*iadjustedStddev;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        }</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    {</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keywordtype">double</span> adjustedStddev=stddev*cosTilt;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordtype">double</span> iAdjustedStddev=1.0/adjustedStddev;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <a class="code" href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a>(I)</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <a class="code" href="numerical__recipes_8cpp.html#aefb1b99960fcc5e01a981373c311eb97">switch</a> (<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(mask,<a class="code" href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a>))</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="keywordflow">case</span> -2:</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I,i,j)=0;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            <span class="keywordflow">if</span> (tiltMask)</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I,i,j)=0;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I,i,j)=(<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I,i,j)-avg)*iAdjustedStddev;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordflow">case</span> -1:</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I,i,j)=(<a class="code" href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a>(I,i,j)-avg)*iAdjustedStddev;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        }</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    }</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">// Prepare values for returning</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    mui=avg;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    sigmai=<a class="code" href="image__operate_8cpp.html#aba02a4405b44e10470c7af98477800a9">sqrt</a>(meanVariance);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    save()=I;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    save.<a class="code" href="classImageBase.html#ae81a8c11a832924c2bda0909882c3168">write</a>(<span class="stringliteral">&quot;PPPafter.xmp&quot;</span>);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Press any key\n&quot;</span>;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordtype">char</span> <a class="code" href="numerical__recipes_8cpp.html#ae0323a9039add2978bf5b49550572c7c">c</a>;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    std::cin &gt;&gt; <a class="code" href="numerical__recipes_8cpp.html#ae0323a9039add2978bf5b49550572c7c">c</a>;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;}</div><div class="ttc" id="image__operate_8cpp_html_afbbd36781c10524238c70745c6f6f35d"><div class="ttname"><a href="image__operate_8cpp.html#afbbd36781c10524238c70745c6f6f35d">min</a></div><div class="ttdeci">void min(Image&lt; double &gt; &amp;op1, const Image&lt; double &gt; &amp;op2)</div><div class="ttdef"><b>Definition:</b> <a href="image__operate_8cpp_source.html#l00115">image_operate.cpp:115</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga9cf9c3a95f2270982504fd5e40133864"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga9cf9c3a95f2270982504fd5e40133864">A2D_ELEM</a></div><div class="ttdeci">#define A2D_ELEM(v, i, j)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00364">multidim_array.h:364</a></div></div>
<div class="ttc" id="classMultidimArray_html"><div class="ttname"><a href="classMultidimArray.html">MultidimArray&lt; int &gt;</a></div></div>
<div class="ttc" id="group__ErrorHandling_html_ga4ab7f9b2fd1ec4b9efcfba0c9b33052c"><div class="ttname"><a href="group__ErrorHandling.html#ga4ab7f9b2fd1ec4b9efcfba0c9b33052c">REPORT_ERROR</a></div><div class="ttdeci">#define REPORT_ERROR(nerr, ErrormMsg)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__error_8h_source.html#l00238">xmipp_error.h:238</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_ae0323a9039add2978bf5b49550572c7c"><div class="ttname"><a href="numerical__recipes_8cpp.html#ae0323a9039add2978bf5b49550572c7c">c</a></div><div class="ttdeci">doublereal * c</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02247">numerical_recipes.cpp:2247</a></div></div>
<div class="ttc" id="group__Macros_html_gadec1e6bbd34c5cf8765a457da4876c91"><div class="ttname"><a href="group__Macros.html#gadec1e6bbd34c5cf8765a457da4876c91">DEG2RAD</a></div><div class="ttdeci">#define DEG2RAD(d)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00312">xmipp_macros.h:312</a></div></div>
<div class="ttc" id="image__operate_8cpp_html_aba02a4405b44e10470c7af98477800a9"><div class="ttname"><a href="image__operate_8cpp.html#aba02a4405b44e10470c7af98477800a9">sqrt</a></div><div class="ttdeci">void sqrt(Image&lt; double &gt; &amp;op)</div><div class="ttdef"><b>Definition:</b> <a href="image__operate_8cpp_source.html#l00207">image_operate.cpp:207</a></div></div>
<div class="ttc" id="classImageBase_html_ae81a8c11a832924c2bda0909882c3168"><div class="ttname"><a href="classImageBase.html#ae81a8c11a832924c2bda0909882c3168">ImageBase::write</a></div><div class="ttdeci">void write(const FileName &amp;name=&quot;&quot;, size_t select_img=ALL_IMAGES, bool isStack=false, int mode=WRITE_OVERWRITE, CastWriteMode castMode=CW_CAST, int _swapWrite=0)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__image__base_8cpp_source.html#l00210">xmipp_image_base.cpp:210</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga93566c818a8b508272dd62e7104419b8"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga93566c818a8b508272dd62e7104419b8">INSIDEY</a></div><div class="ttdeci">#define INSIDEY(v, y)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00088">multidim_array.h:88</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga4b3f38e76847a3fbe3e579610b23ad29"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga4b3f38e76847a3fbe3e579610b23ad29">XSIZE</a></div><div class="ttdeci">#define XSIZE(v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00101">multidim_array.h:101</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="project__crystal_8cpp.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">#define i</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02510">numerical_recipes.cpp:2510</a></div></div>
<div class="ttc" id="group__Masks_html_ga5bd552c32d3d6b6abd6ddf18677cf647"><div class="ttname"><a href="group__Masks.html#ga5bd552c32d3d6b6abd6ddf18677cf647">computeStats_within_binary_mask</a></div><div class="ttdeci">void computeStats_within_binary_mask(const MultidimArray&lt; T1 &gt; &amp;mask, const MultidimArray&lt; T &gt; &amp;m, double &amp;min_val, double &amp;max_val, double &amp;avg, double &amp;stddev)</div><div class="ttdef"><b>Definition:</b> <a href="mask_8h_source.html#l00804">mask.h:804</a></div></div>
<div class="ttc" id="classMultidimArrayBase_html_a0d4d898ee3a033a6f050cbdc3806b8fb"><div class="ttname"><a href="classMultidimArrayBase.html#a0d4d898ee3a033a6f050cbdc3806b8fb">MultidimArrayBase::setXmippOrigin</a></div><div class="ttdeci">void setXmippOrigin()</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8cpp_source.html#l00197">multidim_array.cpp:197</a></div></div>
<div class="ttc" id="numerical__recipes_8cpp_html_aefb1b99960fcc5e01a981373c311eb97"><div class="ttname"><a href="numerical__recipes_8cpp.html#aefb1b99960fcc5e01a981373c311eb97">switch</a></div><div class="ttdeci">switch((int) mflag)</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l04003">numerical_recipes.cpp:4003</a></div></div>
<div class="ttc" id="group__Macros_html_ga2f0eecb0f7856721f56faff8f27b0dc1"><div class="ttname"><a href="group__Macros.html#ga2f0eecb0f7856721f56faff8f27b0dc1">FLOOR</a></div><div class="ttdeci">#define FLOOR(x)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00240">xmipp_macros.h:240</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga6557f9334712651f0c240ec8bf03a8d8"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga6557f9334712651f0c240ec8bf03a8d8">STARTINGY</a></div><div class="ttdeci">#define STARTINGY(v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00069">multidim_array.h:69</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga7fa7d580ab43d192c7933abd008bc756"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga7fa7d580ab43d192c7933abd008bc756">FOR_ALL_ELEMENTS_IN_ARRAY2D</a></div><div class="ttdeci">#define FOR_ALL_ELEMENTS_IN_ARRAY2D(m)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00400">multidim_array.h:400</a></div></div>
<div class="ttc" id="image__operate_8cpp_html_ac5474a01d203d14c046620266b2f1954"><div class="ttname"><a href="image__operate_8cpp.html#ac5474a01d203d14c046620266b2f1954">max</a></div><div class="ttdeci">void max(Image&lt; double &gt; &amp;op1, const Image&lt; double &gt; &amp;op2)</div><div class="ttdef"><b>Definition:</b> <a href="image__operate_8cpp_source.html#l00125">image_operate.cpp:125</a></div></div>
<div class="ttc" id="group__ErrorHandling_html_ggab0df38968e4f03a3f1f6d6df0f31f45aa22981b63092f2ecbaee8984f0bc9867c"><div class="ttname"><a href="group__ErrorHandling.html#ggab0df38968e4f03a3f1f6d6df0f31f45aa22981b63092f2ecbaee8984f0bc9867c">ERR_NUMERICAL</a></div><div class="ttdoc">Error related to numerical calculation. </div><div class="ttdef"><b>Definition:</b> <a href="xmipp__error_8h_source.html#l00184">xmipp_error.h:184</a></div></div>
<div class="ttc" id="group__GeneralFunctions_html_ga01582f05156bfe0180230bcceccdb484"><div class="ttname"><a href="group__GeneralFunctions.html#ga01582f05156bfe0180230bcceccdb484">icdf_FSnedecor</a></div><div class="ttdeci">double icdf_FSnedecor(int d1, int d2, double p)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__funcs_8cpp_source.html#l00360">xmipp_funcs.cpp:360</a></div></div>
<div class="ttc" id="group__Macros_html_gac9ae6a207f10c821b06a8c0df153a7d5"><div class="ttname"><a href="group__Macros.html#gac9ae6a207f10c821b06a8c0df153a7d5">XMIPP_MIN</a></div><div class="ttdeci">#define XMIPP_MIN(x, y)</div><div class="ttdef"><b>Definition:</b> <a href="xmipp__macros_8h_source.html#l00181">xmipp_macros.h:181</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_ga972c277d0dea0031261b9b75faed04e2"><div class="ttname"><a href="group__MultidimensionalArrays.html#ga972c277d0dea0031261b9b75faed04e2">INSIDEX</a></div><div class="ttdeci">#define INSIDEX(v, x)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00085">multidim_array.h:85</a></div></div>
<div class="ttc" id="project__crystal_8cpp_html_aae82a1338cf72eb9a1cc7043f569537e"><div class="ttname"><a href="project__crystal_8cpp.html#aae82a1338cf72eb9a1cc7043f569537e">j</a></div><div class="ttdeci">#define j</div><div class="ttdef"><b>Definition:</b> <a href="numerical__recipes_8cpp_source.html#l02510">numerical_recipes.cpp:2510</a></div></div>
<div class="ttc" id="group__MultidimensionalArrays_html_gab21d2b58d5f934e687856c15fb59acf5"><div class="ttname"><a href="group__MultidimensionalArrays.html#gab21d2b58d5f934e687856c15fb59acf5">FINISHINGY</a></div><div class="ttdeci">#define FINISHINGY(v)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l00073">multidim_array.h:73</a></div></div>
<div class="ttc" id="classImage_html"><div class="ttname"><a href="classImage.html">Image&lt; double &gt;</a></div></div>
<div class="ttc" id="classMultidimArray_html_a738eab72b6bd48a98d78745bc24f36bd"><div class="ttname"><a href="classMultidimArray.html#a738eab72b6bd48a98d78745bc24f36bd">MultidimArray::initZeros</a></div><div class="ttdeci">void initZeros(const MultidimArray&lt; T1 &gt; &amp;op)</div><div class="ttdef"><b>Definition:</b> <a href="multidim__array_8h_source.html#l04327">multidim_array.h:4327</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
